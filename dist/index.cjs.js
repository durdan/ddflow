"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("react/jsx-runtime"),M=require("react");var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qg(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function uc(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var un,Dc;function Og(){if(Dc)return un;Dc=1;function i(){this.__data__=[],this.size=0}return un=i,un}var pn,Lc;function Lt(){if(Lc)return pn;Lc=1;function i(t,r){return t===r||t!==t&&r!==r}return pn=i,pn}var hn,zc;function Ar(){if(zc)return hn;zc=1;var i=Lt();function t(r,n){for(var a=r.length;a--;)if(i(r[a][0],n))return a;return-1}return hn=t,hn}var fn,Bc;function Fg(){if(Bc)return fn;Bc=1;var i=Ar(),t=Array.prototype,r=t.splice;function n(a){var s=this.__data__,e=i(s,a);if(e<0)return!1;var l=s.length-1;return e==l?s.pop():r.call(s,e,1),--this.size,!0}return fn=n,fn}var gn,Wc;function Ug(){if(Wc)return gn;Wc=1;var i=Ar();function t(r){var n=this.__data__,a=i(n,r);return a<0?void 0:n[a][1]}return gn=t,gn}var xn,Nc;function Gg(){if(Nc)return xn;Nc=1;var i=Ar();function t(r){return i(this.__data__,r)>-1}return xn=t,xn}var mn,qc;function Yg(){if(qc)return mn;qc=1;var i=Ar();function t(r,n){var a=this.__data__,s=i(a,r);return s<0?(++this.size,a.push([r,n])):a[s][1]=n,this}return mn=t,mn}var yn,Oc;function Tr(){if(Oc)return yn;Oc=1;var i=Og(),t=Fg(),r=Ug(),n=Gg(),a=Yg();function s(e){var l=-1,h=e==null?0:e.length;for(this.clear();++l<h;){var d=e[l];this.set(d[0],d[1])}}return s.prototype.clear=i,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=a,yn=s,yn}var bn,Fc;function Hg(){if(Fc)return bn;Fc=1;var i=Tr();function t(){this.__data__=new i,this.size=0}return bn=t,bn}var vn,Uc;function Vg(){if(Uc)return vn;Uc=1;function i(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n}return vn=i,vn}var wn,Gc;function Xg(){if(Gc)return wn;Gc=1;function i(t){return this.__data__.get(t)}return wn=i,wn}var Sn,Yc;function Kg(){if(Yc)return Sn;Yc=1;function i(t){return this.__data__.has(t)}return Sn=i,Sn}var kn,Hc;function Hh(){if(Hc)return kn;Hc=1;var i=typeof vr=="object"&&vr&&vr.Object===Object&&vr;return kn=i,kn}var jn,Vc;function Je(){if(Vc)return jn;Vc=1;var i=Hh(),t=typeof self=="object"&&self&&self.Object===Object&&self,r=i||t||Function("return this")();return jn=r,jn}var Cn,Xc;function zt(){if(Xc)return Cn;Xc=1;var i=Je(),t=i.Symbol;return Cn=t,Cn}var En,Kc;function Qg(){if(Kc)return En;Kc=1;var i=zt(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=i?i.toStringTag:void 0;function s(e){var l=r.call(e,a),h=e[a];try{e[a]=void 0;var d=!0}catch{}var p=n.call(e);return d&&(l?e[a]=h:delete e[a]),p}return En=s,En}var Mn,Qc;function Zg(){if(Qc)return Mn;Qc=1;var i=Object.prototype,t=i.toString;function r(n){return t.call(n)}return Mn=r,Mn}var $n,Zc;function Rt(){if(Zc)return $n;Zc=1;var i=zt(),t=Qg(),r=Zg(),n="[object Null]",a="[object Undefined]",s=i?i.toStringTag:void 0;function e(l){return l==null?l===void 0?a:n:s&&s in Object(l)?t(l):r(l)}return $n=e,$n}var Rn,Jc;function Ve(){if(Jc)return Rn;Jc=1;function i(t){var r=typeof t;return t!=null&&(r=="object"||r=="function")}return Rn=i,Rn}var _n,el;function Kt(){if(el)return _n;el=1;var i=Rt(),t=Ve(),r="[object AsyncFunction]",n="[object Function]",a="[object GeneratorFunction]",s="[object Proxy]";function e(l){if(!t(l))return!1;var h=i(l);return h==n||h==a||h==r||h==s}return _n=e,_n}var In,tl;function Jg(){if(tl)return In;tl=1;var i=Je(),t=i["__core-js_shared__"];return In=t,In}var An,rl;function ex(){if(rl)return An;rl=1;var i=Jg(),t=function(){var n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!t&&t in n}return An=r,An}var Tn,nl;function Vh(){if(nl)return Tn;nl=1;var i=Function.prototype,t=i.toString;function r(n){if(n!=null){try{return t.call(n)}catch{}try{return n+""}catch{}}return""}return Tn=r,Tn}var Pn,il;function tx(){if(il)return Pn;il=1;var i=Kt(),t=ex(),r=Ve(),n=Vh(),a=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,e=Function.prototype,l=Object.prototype,h=e.toString,d=l.hasOwnProperty,p=RegExp("^"+h.call(d).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function f(x){if(!r(x)||t(x))return!1;var g=i(x)?p:s;return g.test(n(x))}return Pn=f,Pn}var Dn,ol;function rx(){if(ol)return Dn;ol=1;function i(t,r){return t==null?void 0:t[r]}return Dn=i,Dn}var Ln,al;function _t(){if(al)return Ln;al=1;var i=tx(),t=rx();function r(n,a){var s=t(n,a);return i(s)?s:void 0}return Ln=r,Ln}var zn,sl;function pc(){if(sl)return zn;sl=1;var i=_t(),t=Je(),r=i(t,"Map");return zn=r,zn}var Bn,cl;function Pr(){if(cl)return Bn;cl=1;var i=_t(),t=i(Object,"create");return Bn=t,Bn}var Wn,ll;function nx(){if(ll)return Wn;ll=1;var i=Pr();function t(){this.__data__=i?i(null):{},this.size=0}return Wn=t,Wn}var Nn,dl;function ix(){if(dl)return Nn;dl=1;function i(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r}return Nn=i,Nn}var qn,ul;function ox(){if(ul)return qn;ul=1;var i=Pr(),t="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function a(s){var e=this.__data__;if(i){var l=e[s];return l===t?void 0:l}return n.call(e,s)?e[s]:void 0}return qn=a,qn}var On,pl;function ax(){if(pl)return On;pl=1;var i=Pr(),t=Object.prototype,r=t.hasOwnProperty;function n(a){var s=this.__data__;return i?s[a]!==void 0:r.call(s,a)}return On=n,On}var Fn,hl;function sx(){if(hl)return Fn;hl=1;var i=Pr(),t="__lodash_hash_undefined__";function r(n,a){var s=this.__data__;return this.size+=this.has(n)?0:1,s[n]=i&&a===void 0?t:a,this}return Fn=r,Fn}var Un,fl;function cx(){if(fl)return Un;fl=1;var i=nx(),t=ix(),r=ox(),n=ax(),a=sx();function s(e){var l=-1,h=e==null?0:e.length;for(this.clear();++l<h;){var d=e[l];this.set(d[0],d[1])}}return s.prototype.clear=i,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=a,Un=s,Un}var Gn,gl;function lx(){if(gl)return Gn;gl=1;var i=cx(),t=Tr(),r=pc();function n(){this.size=0,this.__data__={hash:new i,map:new(r||t),string:new i}}return Gn=n,Gn}var Yn,xl;function dx(){if(xl)return Yn;xl=1;function i(t){var r=typeof t;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?t!=="__proto__":t===null}return Yn=i,Yn}var Hn,ml;function Dr(){if(ml)return Hn;ml=1;var i=dx();function t(r,n){var a=r.__data__;return i(n)?a[typeof n=="string"?"string":"hash"]:a.map}return Hn=t,Hn}var Vn,yl;function ux(){if(yl)return Vn;yl=1;var i=Dr();function t(r){var n=i(this,r).delete(r);return this.size-=n?1:0,n}return Vn=t,Vn}var Xn,bl;function px(){if(bl)return Xn;bl=1;var i=Dr();function t(r){return i(this,r).get(r)}return Xn=t,Xn}var Kn,vl;function hx(){if(vl)return Kn;vl=1;var i=Dr();function t(r){return i(this,r).has(r)}return Kn=t,Kn}var Qn,wl;function fx(){if(wl)return Qn;wl=1;var i=Dr();function t(r,n){var a=i(this,r),s=a.size;return a.set(r,n),this.size+=a.size==s?0:1,this}return Qn=t,Qn}var Zn,Sl;function hc(){if(Sl)return Zn;Sl=1;var i=lx(),t=ux(),r=px(),n=hx(),a=fx();function s(e){var l=-1,h=e==null?0:e.length;for(this.clear();++l<h;){var d=e[l];this.set(d[0],d[1])}}return s.prototype.clear=i,s.prototype.delete=t,s.prototype.get=r,s.prototype.has=n,s.prototype.set=a,Zn=s,Zn}var Jn,kl;function gx(){if(kl)return Jn;kl=1;var i=Tr(),t=pc(),r=hc(),n=200;function a(s,e){var l=this.__data__;if(l instanceof i){var h=l.__data__;if(!t||h.length<n-1)return h.push([s,e]),this.size=++l.size,this;l=this.__data__=new r(h)}return l.set(s,e),this.size=l.size,this}return Jn=a,Jn}var ei,jl;function Lr(){if(jl)return ei;jl=1;var i=Tr(),t=Hg(),r=Vg(),n=Xg(),a=Kg(),s=gx();function e(l){var h=this.__data__=new i(l);this.size=h.size}return e.prototype.clear=t,e.prototype.delete=r,e.prototype.get=n,e.prototype.has=a,e.prototype.set=s,ei=e,ei}var ti,Cl;function fc(){if(Cl)return ti;Cl=1;function i(t,r){for(var n=-1,a=t==null?0:t.length;++n<a&&r(t[n],n,t)!==!1;);return t}return ti=i,ti}var ri,El;function Xh(){if(El)return ri;El=1;var i=_t(),t=function(){try{var r=i(Object,"defineProperty");return r({},"",{}),r}catch{}}();return ri=t,ri}var ni,Ml;function zr(){if(Ml)return ni;Ml=1;var i=Xh();function t(r,n,a){n=="__proto__"&&i?i(r,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):r[n]=a}return ni=t,ni}var ii,$l;function Br(){if($l)return ii;$l=1;var i=zr(),t=Lt(),r=Object.prototype,n=r.hasOwnProperty;function a(s,e,l){var h=s[e];(!(n.call(s,e)&&t(h,l))||l===void 0&&!(e in s))&&i(s,e,l)}return ii=a,ii}var oi,Rl;function Qt(){if(Rl)return oi;Rl=1;var i=Br(),t=zr();function r(n,a,s,e){var l=!s;s||(s={});for(var h=-1,d=a.length;++h<d;){var p=a[h],f=e?e(s[p],n[p],p,s,n):void 0;f===void 0&&(f=n[p]),l?t(s,p,f):i(s,p,f)}return s}return oi=r,oi}var ai,_l;function xx(){if(_l)return ai;_l=1;function i(t,r){for(var n=-1,a=Array(t);++n<t;)a[n]=r(n);return a}return ai=i,ai}var si,Il;function at(){if(Il)return si;Il=1;function i(t){return t!=null&&typeof t=="object"}return si=i,si}var ci,Al;function mx(){if(Al)return ci;Al=1;var i=Rt(),t=at(),r="[object Arguments]";function n(a){return t(a)&&i(a)==r}return ci=n,ci}var li,Tl;function Zt(){if(Tl)return li;Tl=1;var i=mx(),t=at(),r=Object.prototype,n=r.hasOwnProperty,a=r.propertyIsEnumerable,s=i(function(){return arguments}())?i:function(e){return t(e)&&n.call(e,"callee")&&!a.call(e,"callee")};return li=s,li}var di,Pl;function Ee(){if(Pl)return di;Pl=1;var i=Array.isArray;return di=i,di}var Ft={exports:{}},ui,Dl;function yx(){if(Dl)return ui;Dl=1;function i(){return!1}return ui=i,ui}Ft.exports;var Ll;function Bt(){return Ll||(Ll=1,function(i,t){var r=Je(),n=yx(),a=t&&!t.nodeType&&t,s=a&&!0&&i&&!i.nodeType&&i,e=s&&s.exports===a,l=e?r.Buffer:void 0,h=l?l.isBuffer:void 0,d=h||n;i.exports=d}(Ft,Ft.exports)),Ft.exports}var pi,zl;function Wr(){if(zl)return pi;zl=1;var i=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function r(n,a){var s=typeof n;return a=a??i,!!a&&(s=="number"||s!="symbol"&&t.test(n))&&n>-1&&n%1==0&&n<a}return pi=r,pi}var hi,Bl;function gc(){if(Bl)return hi;Bl=1;var i=9007199254740991;function t(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=i}return hi=t,hi}var fi,Wl;function bx(){if(Wl)return fi;Wl=1;var i=Rt(),t=gc(),r=at(),n="[object Arguments]",a="[object Array]",s="[object Boolean]",e="[object Date]",l="[object Error]",h="[object Function]",d="[object Map]",p="[object Number]",f="[object Object]",x="[object RegExp]",g="[object Set]",m="[object String]",c="[object WeakMap]",u="[object ArrayBuffer]",b="[object DataView]",y="[object Float32Array]",S="[object Float64Array]",w="[object Int8Array]",k="[object Int16Array]",j="[object Int32Array]",C="[object Uint8Array]",E="[object Uint8ClampedArray]",R="[object Uint16Array]",T="[object Uint32Array]",I={};I[y]=I[S]=I[w]=I[k]=I[j]=I[C]=I[E]=I[R]=I[T]=!0,I[n]=I[a]=I[u]=I[s]=I[b]=I[e]=I[l]=I[h]=I[d]=I[p]=I[f]=I[x]=I[g]=I[m]=I[c]=!1;function B(z){return r(z)&&t(z.length)&&!!I[i(z)]}return fi=B,fi}var gi,Nl;function Nr(){if(Nl)return gi;Nl=1;function i(t){return function(r){return t(r)}}return gi=i,gi}var Ut={exports:{}};Ut.exports;var ql;function xc(){return ql||(ql=1,function(i,t){var r=Hh(),n=t&&!t.nodeType&&t,a=n&&!0&&i&&!i.nodeType&&i,s=a&&a.exports===n,e=s&&r.process,l=function(){try{var h=a&&a.require&&a.require("util").types;return h||e&&e.binding&&e.binding("util")}catch{}}();i.exports=l}(Ut,Ut.exports)),Ut.exports}var xi,Ol;function Jt(){if(Ol)return xi;Ol=1;var i=bx(),t=Nr(),r=xc(),n=r&&r.isTypedArray,a=n?t(n):i;return xi=a,xi}var mi,Fl;function Kh(){if(Fl)return mi;Fl=1;var i=xx(),t=Zt(),r=Ee(),n=Bt(),a=Wr(),s=Jt(),e=Object.prototype,l=e.hasOwnProperty;function h(d,p){var f=r(d),x=!f&&t(d),g=!f&&!x&&n(d),m=!f&&!x&&!g&&s(d),c=f||x||g||m,u=c?i(d.length,String):[],b=u.length;for(var y in d)(p||l.call(d,y))&&!(c&&(y=="length"||g&&(y=="offset"||y=="parent")||m&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||a(y,b)))&&u.push(y);return u}return mi=h,mi}var yi,Ul;function qr(){if(Ul)return yi;Ul=1;var i=Object.prototype;function t(r){var n=r&&r.constructor,a=typeof n=="function"&&n.prototype||i;return r===a}return yi=t,yi}var bi,Gl;function Qh(){if(Gl)return bi;Gl=1;function i(t,r){return function(n){return t(r(n))}}return bi=i,bi}var vi,Yl;function vx(){if(Yl)return vi;Yl=1;var i=Qh(),t=i(Object.keys,Object);return vi=t,vi}var wi,Hl;function mc(){if(Hl)return wi;Hl=1;var i=qr(),t=vx(),r=Object.prototype,n=r.hasOwnProperty;function a(s){if(!i(s))return t(s);var e=[];for(var l in Object(s))n.call(s,l)&&l!="constructor"&&e.push(l);return e}return wi=a,wi}var Si,Vl;function ft(){if(Vl)return Si;Vl=1;var i=Kt(),t=gc();function r(n){return n!=null&&t(n.length)&&!i(n)}return Si=r,Si}var ki,Xl;function Et(){if(Xl)return ki;Xl=1;var i=Kh(),t=mc(),r=ft();function n(a){return r(a)?i(a):t(a)}return ki=n,ki}var ji,Kl;function wx(){if(Kl)return ji;Kl=1;var i=Qt(),t=Et();function r(n,a){return n&&i(a,t(a),n)}return ji=r,ji}var Ci,Ql;function Sx(){if(Ql)return Ci;Ql=1;function i(t){var r=[];if(t!=null)for(var n in Object(t))r.push(n);return r}return Ci=i,Ci}var Ei,Zl;function kx(){if(Zl)return Ei;Zl=1;var i=Ve(),t=qr(),r=Sx(),n=Object.prototype,a=n.hasOwnProperty;function s(e){if(!i(e))return r(e);var l=t(e),h=[];for(var d in e)d=="constructor"&&(l||!a.call(e,d))||h.push(d);return h}return Ei=s,Ei}var Mi,Jl;function It(){if(Jl)return Mi;Jl=1;var i=Kh(),t=kx(),r=ft();function n(a){return r(a)?i(a,!0):t(a)}return Mi=n,Mi}var $i,ed;function jx(){if(ed)return $i;ed=1;var i=Qt(),t=It();function r(n,a){return n&&i(a,t(a),n)}return $i=r,$i}var Gt={exports:{}};Gt.exports;var td;function Zh(){return td||(td=1,function(i,t){var r=Je(),n=t&&!t.nodeType&&t,a=n&&!0&&i&&!i.nodeType&&i,s=a&&a.exports===n,e=s?r.Buffer:void 0,l=e?e.allocUnsafe:void 0;function h(d,p){if(p)return d.slice();var f=d.length,x=l?l(f):new d.constructor(f);return d.copy(x),x}i.exports=h}(Gt,Gt.exports)),Gt.exports}var Ri,rd;function Jh(){if(rd)return Ri;rd=1;function i(t,r){var n=-1,a=t.length;for(r||(r=Array(a));++n<a;)r[n]=t[n];return r}return Ri=i,Ri}var _i,nd;function ef(){if(nd)return _i;nd=1;function i(t,r){for(var n=-1,a=t==null?0:t.length,s=0,e=[];++n<a;){var l=t[n];r(l,n,t)&&(e[s++]=l)}return e}return _i=i,_i}var Ii,id;function tf(){if(id)return Ii;id=1;function i(){return[]}return Ii=i,Ii}var Ai,od;function yc(){if(od)return Ai;od=1;var i=ef(),t=tf(),r=Object.prototype,n=r.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return e==null?[]:(e=Object(e),i(a(e),function(l){return n.call(e,l)}))}:t;return Ai=s,Ai}var Ti,ad;function Cx(){if(ad)return Ti;ad=1;var i=Qt(),t=yc();function r(n,a){return i(n,t(n),a)}return Ti=r,Ti}var Pi,sd;function bc(){if(sd)return Pi;sd=1;function i(t,r){for(var n=-1,a=r.length,s=t.length;++n<a;)t[s+n]=r[n];return t}return Pi=i,Pi}var Di,cd;function Or(){if(cd)return Di;cd=1;var i=Qh(),t=i(Object.getPrototypeOf,Object);return Di=t,Di}var Li,ld;function rf(){if(ld)return Li;ld=1;var i=bc(),t=Or(),r=yc(),n=tf(),a=Object.getOwnPropertySymbols,s=a?function(e){for(var l=[];e;)i(l,r(e)),e=t(e);return l}:n;return Li=s,Li}var zi,dd;function Ex(){if(dd)return zi;dd=1;var i=Qt(),t=rf();function r(n,a){return i(n,t(n),a)}return zi=r,zi}var Bi,ud;function nf(){if(ud)return Bi;ud=1;var i=bc(),t=Ee();function r(n,a,s){var e=a(n);return t(n)?e:i(e,s(n))}return Bi=r,Bi}var Wi,pd;function of(){if(pd)return Wi;pd=1;var i=nf(),t=yc(),r=Et();function n(a){return i(a,r,t)}return Wi=n,Wi}var Ni,hd;function Mx(){if(hd)return Ni;hd=1;var i=nf(),t=rf(),r=It();function n(a){return i(a,r,t)}return Ni=n,Ni}var qi,fd;function $x(){if(fd)return qi;fd=1;var i=_t(),t=Je(),r=i(t,"DataView");return qi=r,qi}var Oi,gd;function Rx(){if(gd)return Oi;gd=1;var i=_t(),t=Je(),r=i(t,"Promise");return Oi=r,Oi}var Fi,xd;function af(){if(xd)return Fi;xd=1;var i=_t(),t=Je(),r=i(t,"Set");return Fi=r,Fi}var Ui,md;function _x(){if(md)return Ui;md=1;var i=_t(),t=Je(),r=i(t,"WeakMap");return Ui=r,Ui}var Gi,yd;function Wt(){if(yd)return Gi;yd=1;var i=$x(),t=pc(),r=Rx(),n=af(),a=_x(),s=Rt(),e=Vh(),l="[object Map]",h="[object Object]",d="[object Promise]",p="[object Set]",f="[object WeakMap]",x="[object DataView]",g=e(i),m=e(t),c=e(r),u=e(n),b=e(a),y=s;return(i&&y(new i(new ArrayBuffer(1)))!=x||t&&y(new t)!=l||r&&y(r.resolve())!=d||n&&y(new n)!=p||a&&y(new a)!=f)&&(y=function(S){var w=s(S),k=w==h?S.constructor:void 0,j=k?e(k):"";if(j)switch(j){case g:return x;case m:return l;case c:return d;case u:return p;case b:return f}return w}),Gi=y,Gi}var Yi,bd;function Ix(){if(bd)return Yi;bd=1;var i=Object.prototype,t=i.hasOwnProperty;function r(n){var a=n.length,s=new n.constructor(a);return a&&typeof n[0]=="string"&&t.call(n,"index")&&(s.index=n.index,s.input=n.input),s}return Yi=r,Yi}var Hi,vd;function sf(){if(vd)return Hi;vd=1;var i=Je(),t=i.Uint8Array;return Hi=t,Hi}var Vi,wd;function vc(){if(wd)return Vi;wd=1;var i=sf();function t(r){var n=new r.constructor(r.byteLength);return new i(n).set(new i(r)),n}return Vi=t,Vi}var Xi,Sd;function Ax(){if(Sd)return Xi;Sd=1;var i=vc();function t(r,n){var a=n?i(r.buffer):r.buffer;return new r.constructor(a,r.byteOffset,r.byteLength)}return Xi=t,Xi}var Ki,kd;function Tx(){if(kd)return Ki;kd=1;var i=/\w*$/;function t(r){var n=new r.constructor(r.source,i.exec(r));return n.lastIndex=r.lastIndex,n}return Ki=t,Ki}var Qi,jd;function Px(){if(jd)return Qi;jd=1;var i=zt(),t=i?i.prototype:void 0,r=t?t.valueOf:void 0;function n(a){return r?Object(r.call(a)):{}}return Qi=n,Qi}var Zi,Cd;function cf(){if(Cd)return Zi;Cd=1;var i=vc();function t(r,n){var a=n?i(r.buffer):r.buffer;return new r.constructor(a,r.byteOffset,r.length)}return Zi=t,Zi}var Ji,Ed;function Dx(){if(Ed)return Ji;Ed=1;var i=vc(),t=Ax(),r=Tx(),n=Px(),a=cf(),s="[object Boolean]",e="[object Date]",l="[object Map]",h="[object Number]",d="[object RegExp]",p="[object Set]",f="[object String]",x="[object Symbol]",g="[object ArrayBuffer]",m="[object DataView]",c="[object Float32Array]",u="[object Float64Array]",b="[object Int8Array]",y="[object Int16Array]",S="[object Int32Array]",w="[object Uint8Array]",k="[object Uint8ClampedArray]",j="[object Uint16Array]",C="[object Uint32Array]";function E(R,T,I){var B=R.constructor;switch(T){case g:return i(R);case s:case e:return new B(+R);case m:return t(R,I);case c:case u:case b:case y:case S:case w:case k:case j:case C:return a(R,I);case l:return new B;case h:case f:return new B(R);case d:return r(R);case p:return new B;case x:return n(R)}}return Ji=E,Ji}var eo,Md;function lf(){if(Md)return eo;Md=1;var i=Ve(),t=Object.create,r=function(){function n(){}return function(a){if(!i(a))return{};if(t)return t(a);n.prototype=a;var s=new n;return n.prototype=void 0,s}}();return eo=r,eo}var to,$d;function df(){if($d)return to;$d=1;var i=lf(),t=Or(),r=qr();function n(a){return typeof a.constructor=="function"&&!r(a)?i(t(a)):{}}return to=n,to}var ro,Rd;function Lx(){if(Rd)return ro;Rd=1;var i=Wt(),t=at(),r="[object Map]";function n(a){return t(a)&&i(a)==r}return ro=n,ro}var no,_d;function zx(){if(_d)return no;_d=1;var i=Lx(),t=Nr(),r=xc(),n=r&&r.isMap,a=n?t(n):i;return no=a,no}var io,Id;function Bx(){if(Id)return io;Id=1;var i=Wt(),t=at(),r="[object Set]";function n(a){return t(a)&&i(a)==r}return io=n,io}var oo,Ad;function Wx(){if(Ad)return oo;Ad=1;var i=Bx(),t=Nr(),r=xc(),n=r&&r.isSet,a=n?t(n):i;return oo=a,oo}var ao,Td;function uf(){if(Td)return ao;Td=1;var i=Lr(),t=fc(),r=Br(),n=wx(),a=jx(),s=Zh(),e=Jh(),l=Cx(),h=Ex(),d=of(),p=Mx(),f=Wt(),x=Ix(),g=Dx(),m=df(),c=Ee(),u=Bt(),b=zx(),y=Ve(),S=Wx(),w=Et(),k=It(),j=1,C=2,E=4,R="[object Arguments]",T="[object Array]",I="[object Boolean]",B="[object Date]",z="[object Error]",D="[object Function]",U="[object GeneratorFunction]",N="[object Map]",H="[object Number]",ee="[object Object]",ne="[object RegExp]",J="[object Set]",ie="[object String]",F="[object Symbol]",_="[object WeakMap]",q="[object ArrayBuffer]",$="[object DataView]",P="[object Float32Array]",L="[object Float64Array]",Y="[object Int8Array]",X="[object Int16Array]",K="[object Int32Array]",be="[object Uint8Array]",ve="[object Uint8ClampedArray]",Q="[object Uint16Array]",ge="[object Uint32Array]",ae={};ae[R]=ae[T]=ae[q]=ae[$]=ae[I]=ae[B]=ae[P]=ae[L]=ae[Y]=ae[X]=ae[K]=ae[N]=ae[H]=ae[ee]=ae[ne]=ae[J]=ae[ie]=ae[F]=ae[be]=ae[ve]=ae[Q]=ae[ge]=!0,ae[z]=ae[D]=ae[_]=!1;function _e(oe,le,Pe,Ge,De,Ae){var Ce,ke=le&j,Qe=le&C,rt=le&E;if(Pe&&(Ce=De?Pe(oe,Ge,De,Ae):Pe(oe)),Ce!==void 0)return Ce;if(!y(oe))return oe;var xt=c(oe);if(xt){if(Ce=x(oe),!ke)return e(oe,Ce)}else{var nt=f(oe),Pt=nt==D||nt==U;if(u(oe))return s(oe,ke);if(nt==ee||nt==R||Pt&&!De){if(Ce=Qe||Pt?{}:m(oe),!ke)return Qe?h(oe,a(Ce,oe)):l(oe,n(Ce,oe))}else{if(!ae[nt])return De?oe:{};Ce=g(oe,nt,ke)}}Ae||(Ae=new i);var mt=Ae.get(oe);if(mt)return mt;Ae.set(oe,Ce),S(oe)?oe.forEach(function(Ne){Ce.add(_e(Ne,le,Pe,Ne,oe,Ae))}):b(oe)&&oe.forEach(function(Ne,ze){Ce.set(ze,_e(Ne,le,Pe,ze,oe,Ae))});var yt=rt?Qe?p:d:Qe?k:w,ct=xt?void 0:yt(oe);return t(ct||oe,function(Ne,ze){ct&&(ze=Ne,Ne=oe[ze]),r(Ce,ze,_e(Ne,le,Pe,ze,oe,Ae))}),Ce}return ao=_e,ao}var so,Pd;function Nx(){if(Pd)return so;Pd=1;var i=uf(),t=4;function r(n){return i(n,t)}return so=r,so}var co,Dd;function wc(){if(Dd)return co;Dd=1;function i(t){return function(){return t}}return co=i,co}var lo,Ld;function qx(){if(Ld)return lo;Ld=1;function i(t){return function(r,n,a){for(var s=-1,e=Object(r),l=a(r),h=l.length;h--;){var d=l[t?h:++s];if(n(e[d],d,e)===!1)break}return r}}return lo=i,lo}var uo,zd;function Sc(){if(zd)return uo;zd=1;var i=qx(),t=i();return uo=t,uo}var po,Bd;function kc(){if(Bd)return po;Bd=1;var i=Sc(),t=Et();function r(n,a){return n&&i(n,a,t)}return po=r,po}var ho,Wd;function Ox(){if(Wd)return ho;Wd=1;var i=ft();function t(r,n){return function(a,s){if(a==null)return a;if(!i(a))return r(a,s);for(var e=a.length,l=n?e:-1,h=Object(a);(n?l--:++l<e)&&s(h[l],l,h)!==!1;);return a}}return ho=t,ho}var fo,Nd;function Fr(){if(Nd)return fo;Nd=1;var i=kc(),t=Ox(),r=t(i);return fo=r,fo}var go,qd;function At(){if(qd)return go;qd=1;function i(t){return t}return go=i,go}var xo,Od;function pf(){if(Od)return xo;Od=1;var i=At();function t(r){return typeof r=="function"?r:i}return xo=t,xo}var mo,Fd;function hf(){if(Fd)return mo;Fd=1;var i=fc(),t=Fr(),r=pf(),n=Ee();function a(s,e){var l=n(s)?i:t;return l(s,r(e))}return mo=a,mo}var yo,Ud;function ff(){return Ud||(Ud=1,yo=hf()),yo}var bo,Gd;function Fx(){if(Gd)return bo;Gd=1;var i=Fr();function t(r,n){var a=[];return i(r,function(s,e,l){n(s,e,l)&&a.push(s)}),a}return bo=t,bo}var vo,Yd;function Ux(){if(Yd)return vo;Yd=1;var i="__lodash_hash_undefined__";function t(r){return this.__data__.set(r,i),this}return vo=t,vo}var wo,Hd;function Gx(){if(Hd)return wo;Hd=1;function i(t){return this.__data__.has(t)}return wo=i,wo}var So,Vd;function gf(){if(Vd)return So;Vd=1;var i=hc(),t=Ux(),r=Gx();function n(a){var s=-1,e=a==null?0:a.length;for(this.__data__=new i;++s<e;)this.add(a[s])}return n.prototype.add=n.prototype.push=t,n.prototype.has=r,So=n,So}var ko,Xd;function Yx(){if(Xd)return ko;Xd=1;function i(t,r){for(var n=-1,a=t==null?0:t.length;++n<a;)if(r(t[n],n,t))return!0;return!1}return ko=i,ko}var jo,Kd;function xf(){if(Kd)return jo;Kd=1;function i(t,r){return t.has(r)}return jo=i,jo}var Co,Qd;function mf(){if(Qd)return Co;Qd=1;var i=gf(),t=Yx(),r=xf(),n=1,a=2;function s(e,l,h,d,p,f){var x=h&n,g=e.length,m=l.length;if(g!=m&&!(x&&m>g))return!1;var c=f.get(e),u=f.get(l);if(c&&u)return c==l&&u==e;var b=-1,y=!0,S=h&a?new i:void 0;for(f.set(e,l),f.set(l,e);++b<g;){var w=e[b],k=l[b];if(d)var j=x?d(k,w,b,l,e,f):d(w,k,b,e,l,f);if(j!==void 0){if(j)continue;y=!1;break}if(S){if(!t(l,function(C,E){if(!r(S,E)&&(w===C||p(w,C,h,d,f)))return S.push(E)})){y=!1;break}}else if(!(w===k||p(w,k,h,d,f))){y=!1;break}}return f.delete(e),f.delete(l),y}return Co=s,Co}var Eo,Zd;function Hx(){if(Zd)return Eo;Zd=1;function i(t){var r=-1,n=Array(t.size);return t.forEach(function(a,s){n[++r]=[s,a]}),n}return Eo=i,Eo}var Mo,Jd;function jc(){if(Jd)return Mo;Jd=1;function i(t){var r=-1,n=Array(t.size);return t.forEach(function(a){n[++r]=a}),n}return Mo=i,Mo}var $o,eu;function Vx(){if(eu)return $o;eu=1;var i=zt(),t=sf(),r=Lt(),n=mf(),a=Hx(),s=jc(),e=1,l=2,h="[object Boolean]",d="[object Date]",p="[object Error]",f="[object Map]",x="[object Number]",g="[object RegExp]",m="[object Set]",c="[object String]",u="[object Symbol]",b="[object ArrayBuffer]",y="[object DataView]",S=i?i.prototype:void 0,w=S?S.valueOf:void 0;function k(j,C,E,R,T,I,B){switch(E){case y:if(j.byteLength!=C.byteLength||j.byteOffset!=C.byteOffset)return!1;j=j.buffer,C=C.buffer;case b:return!(j.byteLength!=C.byteLength||!I(new t(j),new t(C)));case h:case d:case x:return r(+j,+C);case p:return j.name==C.name&&j.message==C.message;case g:case c:return j==C+"";case f:var z=a;case m:var D=R&e;if(z||(z=s),j.size!=C.size&&!D)return!1;var U=B.get(j);if(U)return U==C;R|=l,B.set(j,C);var N=n(z(j),z(C),R,T,I,B);return B.delete(j),N;case u:if(w)return w.call(j)==w.call(C)}return!1}return $o=k,$o}var Ro,tu;function Xx(){if(tu)return Ro;tu=1;var i=of(),t=1,r=Object.prototype,n=r.hasOwnProperty;function a(s,e,l,h,d,p){var f=l&t,x=i(s),g=x.length,m=i(e),c=m.length;if(g!=c&&!f)return!1;for(var u=g;u--;){var b=x[u];if(!(f?b in e:n.call(e,b)))return!1}var y=p.get(s),S=p.get(e);if(y&&S)return y==e&&S==s;var w=!0;p.set(s,e),p.set(e,s);for(var k=f;++u<g;){b=x[u];var j=s[b],C=e[b];if(h)var E=f?h(C,j,b,e,s,p):h(j,C,b,s,e,p);if(!(E===void 0?j===C||d(j,C,l,h,p):E)){w=!1;break}k||(k=b=="constructor")}if(w&&!k){var R=s.constructor,T=e.constructor;R!=T&&"constructor"in s&&"constructor"in e&&!(typeof R=="function"&&R instanceof R&&typeof T=="function"&&T instanceof T)&&(w=!1)}return p.delete(s),p.delete(e),w}return Ro=a,Ro}var _o,ru;function Kx(){if(ru)return _o;ru=1;var i=Lr(),t=mf(),r=Vx(),n=Xx(),a=Wt(),s=Ee(),e=Bt(),l=Jt(),h=1,d="[object Arguments]",p="[object Array]",f="[object Object]",x=Object.prototype,g=x.hasOwnProperty;function m(c,u,b,y,S,w){var k=s(c),j=s(u),C=k?p:a(c),E=j?p:a(u);C=C==d?f:C,E=E==d?f:E;var R=C==f,T=E==f,I=C==E;if(I&&e(c)){if(!e(u))return!1;k=!0,R=!1}if(I&&!R)return w||(w=new i),k||l(c)?t(c,u,b,y,S,w):r(c,u,C,b,y,S,w);if(!(b&h)){var B=R&&g.call(c,"__wrapped__"),z=T&&g.call(u,"__wrapped__");if(B||z){var D=B?c.value():c,U=z?u.value():u;return w||(w=new i),S(D,U,b,y,w)}}return I?(w||(w=new i),n(c,u,b,y,S,w)):!1}return _o=m,_o}var Io,nu;function yf(){if(nu)return Io;nu=1;var i=Kx(),t=at();function r(n,a,s,e,l){return n===a?!0:n==null||a==null||!t(n)&&!t(a)?n!==n&&a!==a:i(n,a,s,e,r,l)}return Io=r,Io}var Ao,iu;function Qx(){if(iu)return Ao;iu=1;var i=Lr(),t=yf(),r=1,n=2;function a(s,e,l,h){var d=l.length,p=d,f=!h;if(s==null)return!p;for(s=Object(s);d--;){var x=l[d];if(f&&x[2]?x[1]!==s[x[0]]:!(x[0]in s))return!1}for(;++d<p;){x=l[d];var g=x[0],m=s[g],c=x[1];if(f&&x[2]){if(m===void 0&&!(g in s))return!1}else{var u=new i;if(h)var b=h(m,c,g,s,e,u);if(!(b===void 0?t(c,m,r|n,h,u):b))return!1}}return!0}return Ao=a,Ao}var To,ou;function bf(){if(ou)return To;ou=1;var i=Ve();function t(r){return r===r&&!i(r)}return To=t,To}var Po,au;function Zx(){if(au)return Po;au=1;var i=bf(),t=Et();function r(n){for(var a=t(n),s=a.length;s--;){var e=a[s],l=n[e];a[s]=[e,l,i(l)]}return a}return Po=r,Po}var Do,su;function vf(){if(su)return Do;su=1;function i(t,r){return function(n){return n==null?!1:n[t]===r&&(r!==void 0||t in Object(n))}}return Do=i,Do}var Lo,cu;function Jx(){if(cu)return Lo;cu=1;var i=Qx(),t=Zx(),r=vf();function n(a){var s=t(a);return s.length==1&&s[0][2]?r(s[0][0],s[0][1]):function(e){return e===a||i(e,a,s)}}return Lo=n,Lo}var zo,lu;function Nt(){if(lu)return zo;lu=1;var i=Rt(),t=at(),r="[object Symbol]";function n(a){return typeof a=="symbol"||t(a)&&i(a)==r}return zo=n,zo}var Bo,du;function Cc(){if(du)return Bo;du=1;var i=Ee(),t=Nt(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function a(s,e){if(i(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||t(s)?!0:n.test(s)||!r.test(s)||e!=null&&s in Object(e)}return Bo=a,Bo}var Wo,uu;function em(){if(uu)return Wo;uu=1;var i=hc(),t="Expected a function";function r(n,a){if(typeof n!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var s=function(){var e=arguments,l=a?a.apply(this,e):e[0],h=s.cache;if(h.has(l))return h.get(l);var d=n.apply(this,e);return s.cache=h.set(l,d)||h,d};return s.cache=new(r.Cache||i),s}return r.Cache=i,Wo=r,Wo}var No,pu;function tm(){if(pu)return No;pu=1;var i=em(),t=500;function r(n){var a=i(n,function(e){return s.size===t&&s.clear(),e}),s=a.cache;return a}return No=r,No}var qo,hu;function rm(){if(hu)return qo;hu=1;var i=tm(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=i(function(a){var s=[];return a.charCodeAt(0)===46&&s.push(""),a.replace(t,function(e,l,h,d){s.push(h?d.replace(r,"$1"):l||e)}),s});return qo=n,qo}var Oo,fu;function Ur(){if(fu)return Oo;fu=1;function i(t,r){for(var n=-1,a=t==null?0:t.length,s=Array(a);++n<a;)s[n]=r(t[n],n,t);return s}return Oo=i,Oo}var Fo,gu;function nm(){if(gu)return Fo;gu=1;var i=zt(),t=Ur(),r=Ee(),n=Nt(),a=i?i.prototype:void 0,s=a?a.toString:void 0;function e(l){if(typeof l=="string")return l;if(r(l))return t(l,e)+"";if(n(l))return s?s.call(l):"";var h=l+"";return h=="0"&&1/l==-1/0?"-0":h}return Fo=e,Fo}var Uo,xu;function wf(){if(xu)return Uo;xu=1;var i=nm();function t(r){return r==null?"":i(r)}return Uo=t,Uo}var Go,mu;function Gr(){if(mu)return Go;mu=1;var i=Ee(),t=Cc(),r=rm(),n=wf();function a(s,e){return i(s)?s:t(s,e)?[s]:r(n(s))}return Go=a,Go}var Yo,yu;function er(){if(yu)return Yo;yu=1;var i=Nt();function t(r){if(typeof r=="string"||i(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return Yo=t,Yo}var Ho,bu;function Yr(){if(bu)return Ho;bu=1;var i=Gr(),t=er();function r(n,a){a=i(a,n);for(var s=0,e=a.length;n!=null&&s<e;)n=n[t(a[s++])];return s&&s==e?n:void 0}return Ho=r,Ho}var Vo,vu;function im(){if(vu)return Vo;vu=1;var i=Yr();function t(r,n,a){var s=r==null?void 0:i(r,n);return s===void 0?a:s}return Vo=t,Vo}var Xo,wu;function om(){if(wu)return Xo;wu=1;function i(t,r){return t!=null&&r in Object(t)}return Xo=i,Xo}var Ko,Su;function Sf(){if(Su)return Ko;Su=1;var i=Gr(),t=Zt(),r=Ee(),n=Wr(),a=gc(),s=er();function e(l,h,d){h=i(h,l);for(var p=-1,f=h.length,x=!1;++p<f;){var g=s(h[p]);if(!(x=l!=null&&d(l,g)))break;l=l[g]}return x||++p!=f?x:(f=l==null?0:l.length,!!f&&a(f)&&n(g,f)&&(r(l)||t(l)))}return Ko=e,Ko}var Qo,ku;function kf(){if(ku)return Qo;ku=1;var i=om(),t=Sf();function r(n,a){return n!=null&&t(n,a,i)}return Qo=r,Qo}var Zo,ju;function am(){if(ju)return Zo;ju=1;var i=yf(),t=im(),r=kf(),n=Cc(),a=bf(),s=vf(),e=er(),l=1,h=2;function d(p,f){return n(p)&&a(f)?s(e(p),f):function(x){var g=t(x,p);return g===void 0&&g===f?r(x,p):i(f,g,l|h)}}return Zo=d,Zo}var Jo,Cu;function jf(){if(Cu)return Jo;Cu=1;function i(t){return function(r){return r==null?void 0:r[t]}}return Jo=i,Jo}var ea,Eu;function sm(){if(Eu)return ea;Eu=1;var i=Yr();function t(r){return function(n){return i(n,r)}}return ea=t,ea}var ta,Mu;function cm(){if(Mu)return ta;Mu=1;var i=jf(),t=sm(),r=Cc(),n=er();function a(s){return r(s)?i(n(s)):t(s)}return ta=a,ta}var ra,$u;function gt(){if($u)return ra;$u=1;var i=Jx(),t=am(),r=At(),n=Ee(),a=cm();function s(e){return typeof e=="function"?e:e==null?r:typeof e=="object"?n(e)?t(e[0],e[1]):i(e):a(e)}return ra=s,ra}var na,Ru;function Cf(){if(Ru)return na;Ru=1;var i=ef(),t=Fx(),r=gt(),n=Ee();function a(s,e){var l=n(s)?i:t;return l(s,r(e,3))}return na=a,na}var ia,_u;function lm(){if(_u)return ia;_u=1;var i=Object.prototype,t=i.hasOwnProperty;function r(n,a){return n!=null&&t.call(n,a)}return ia=r,ia}var oa,Iu;function Ef(){if(Iu)return oa;Iu=1;var i=lm(),t=Sf();function r(n,a){return n!=null&&t(n,a,i)}return oa=r,oa}var aa,Au;function dm(){if(Au)return aa;Au=1;var i=mc(),t=Wt(),r=Zt(),n=Ee(),a=ft(),s=Bt(),e=qr(),l=Jt(),h="[object Map]",d="[object Set]",p=Object.prototype,f=p.hasOwnProperty;function x(g){if(g==null)return!0;if(a(g)&&(n(g)||typeof g=="string"||typeof g.splice=="function"||s(g)||l(g)||r(g)))return!g.length;var m=t(g);if(m==h||m==d)return!g.size;if(e(g))return!i(g).length;for(var c in g)if(f.call(g,c))return!1;return!0}return aa=x,aa}var sa,Tu;function Mf(){if(Tu)return sa;Tu=1;function i(t){return t===void 0}return sa=i,sa}var ca,Pu;function $f(){if(Pu)return ca;Pu=1;var i=Fr(),t=ft();function r(n,a){var s=-1,e=t(n)?Array(n.length):[];return i(n,function(l,h,d){e[++s]=a(l,h,d)}),e}return ca=r,ca}var la,Du;function Rf(){if(Du)return la;Du=1;var i=Ur(),t=gt(),r=$f(),n=Ee();function a(s,e){var l=n(s)?i:r;return l(s,t(e,3))}return la=a,la}var da,Lu;function um(){if(Lu)return da;Lu=1;function i(t,r,n,a){var s=-1,e=t==null?0:t.length;for(a&&e&&(n=t[++s]);++s<e;)n=r(n,t[s],s,t);return n}return da=i,da}var ua,zu;function pm(){if(zu)return ua;zu=1;function i(t,r,n,a,s){return s(t,function(e,l,h){n=a?(a=!1,e):r(n,e,l,h)}),n}return ua=i,ua}var pa,Bu;function _f(){if(Bu)return pa;Bu=1;var i=um(),t=Fr(),r=gt(),n=pm(),a=Ee();function s(e,l,h){var d=a(e)?i:n,p=arguments.length<3;return d(e,r(l,4),h,p,t)}return pa=s,pa}var ha,Wu;function hm(){if(Wu)return ha;Wu=1;var i=Rt(),t=Ee(),r=at(),n="[object String]";function a(s){return typeof s=="string"||!t(s)&&r(s)&&i(s)==n}return ha=a,ha}var fa,Nu;function fm(){if(Nu)return fa;Nu=1;var i=jf(),t=i("length");return fa=t,fa}var ga,qu;function gm(){if(qu)return ga;qu=1;var i="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,s="\\ufe0e\\ufe0f",e="\\u200d",l=RegExp("["+e+i+a+s+"]");function h(d){return l.test(d)}return ga=h,ga}var xa,Ou;function xm(){if(Ou)return xa;Ou=1;var i="\\ud800-\\udfff",t="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=t+r+n,s="\\ufe0e\\ufe0f",e="["+i+"]",l="["+a+"]",h="\\ud83c[\\udffb-\\udfff]",d="(?:"+l+"|"+h+")",p="[^"+i+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",x="[\\ud800-\\udbff][\\udc00-\\udfff]",g="\\u200d",m=d+"?",c="["+s+"]?",u="(?:"+g+"(?:"+[p,f,x].join("|")+")"+c+m+")*",b=c+m+u,y="(?:"+[p+l+"?",l,f,x,e].join("|")+")",S=RegExp(h+"(?="+h+")|"+y+b,"g");function w(k){for(var j=S.lastIndex=0;S.test(k);)++j;return j}return xa=w,xa}var ma,Fu;function mm(){if(Fu)return ma;Fu=1;var i=fm(),t=gm(),r=xm();function n(a){return t(a)?r(a):i(a)}return ma=n,ma}var ya,Uu;function ym(){if(Uu)return ya;Uu=1;var i=mc(),t=Wt(),r=ft(),n=hm(),a=mm(),s="[object Map]",e="[object Set]";function l(h){if(h==null)return 0;if(r(h))return n(h)?a(h):h.length;var d=t(h);return d==s||d==e?h.size:i(h).length}return ya=l,ya}var ba,Gu;function bm(){if(Gu)return ba;Gu=1;var i=fc(),t=lf(),r=kc(),n=gt(),a=Or(),s=Ee(),e=Bt(),l=Kt(),h=Ve(),d=Jt();function p(f,x,g){var m=s(f),c=m||e(f)||d(f);if(x=n(x,4),g==null){var u=f&&f.constructor;c?g=m?new u:[]:h(f)?g=l(u)?t(a(f)):{}:g={}}return(c?i:r)(f,function(b,y,S){return x(g,b,y,S)}),g}return ba=p,ba}var va,Yu;function vm(){if(Yu)return va;Yu=1;var i=zt(),t=Zt(),r=Ee(),n=i?i.isConcatSpreadable:void 0;function a(s){return r(s)||t(s)||!!(n&&s&&s[n])}return va=a,va}var wa,Hu;function Ec(){if(Hu)return wa;Hu=1;var i=bc(),t=vm();function r(n,a,s,e,l){var h=-1,d=n.length;for(s||(s=t),l||(l=[]);++h<d;){var p=n[h];a>0&&s(p)?a>1?r(p,a-1,s,e,l):i(l,p):e||(l[l.length]=p)}return l}return wa=r,wa}var Sa,Vu;function wm(){if(Vu)return Sa;Vu=1;function i(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}return Sa=i,Sa}var ka,Xu;function If(){if(Xu)return ka;Xu=1;var i=wm(),t=Math.max;function r(n,a,s){return a=t(a===void 0?n.length-1:a,0),function(){for(var e=arguments,l=-1,h=t(e.length-a,0),d=Array(h);++l<h;)d[l]=e[a+l];l=-1;for(var p=Array(a+1);++l<a;)p[l]=e[l];return p[a]=s(d),i(n,this,p)}}return ka=r,ka}var ja,Ku;function Sm(){if(Ku)return ja;Ku=1;var i=wc(),t=Xh(),r=At(),n=t?function(a,s){return t(a,"toString",{configurable:!0,enumerable:!1,value:i(s),writable:!0})}:r;return ja=n,ja}var Ca,Qu;function km(){if(Qu)return Ca;Qu=1;var i=800,t=16,r=Date.now;function n(a){var s=0,e=0;return function(){var l=r(),h=t-(l-e);if(e=l,h>0){if(++s>=i)return arguments[0]}else s=0;return a.apply(void 0,arguments)}}return Ca=n,Ca}var Ea,Zu;function Af(){if(Zu)return Ea;Zu=1;var i=Sm(),t=km(),r=t(i);return Ea=r,Ea}var Ma,Ju;function Hr(){if(Ju)return Ma;Ju=1;var i=At(),t=If(),r=Af();function n(a,s){return r(t(a,s,i),a+"")}return Ma=n,Ma}var $a,ep;function Tf(){if(ep)return $a;ep=1;function i(t,r,n,a){for(var s=t.length,e=n+(a?1:-1);a?e--:++e<s;)if(r(t[e],e,t))return e;return-1}return $a=i,$a}var Ra,tp;function jm(){if(tp)return Ra;tp=1;function i(t){return t!==t}return Ra=i,Ra}var _a,rp;function Cm(){if(rp)return _a;rp=1;function i(t,r,n){for(var a=n-1,s=t.length;++a<s;)if(t[a]===r)return a;return-1}return _a=i,_a}var Ia,np;function Em(){if(np)return Ia;np=1;var i=Tf(),t=jm(),r=Cm();function n(a,s,e){return s===s?r(a,s,e):i(a,t,e)}return Ia=n,Ia}var Aa,ip;function Mm(){if(ip)return Aa;ip=1;var i=Em();function t(r,n){var a=r==null?0:r.length;return!!a&&i(r,n,0)>-1}return Aa=t,Aa}var Ta,op;function $m(){if(op)return Ta;op=1;function i(t,r,n){for(var a=-1,s=t==null?0:t.length;++a<s;)if(n(r,t[a]))return!0;return!1}return Ta=i,Ta}var Pa,ap;function Rm(){if(ap)return Pa;ap=1;function i(){}return Pa=i,Pa}var Da,sp;function _m(){if(sp)return Da;sp=1;var i=af(),t=Rm(),r=jc(),n=1/0,a=i&&1/r(new i([,-0]))[1]==n?function(s){return new i(s)}:t;return Da=a,Da}var La,cp;function Im(){if(cp)return La;cp=1;var i=gf(),t=Mm(),r=$m(),n=xf(),a=_m(),s=jc(),e=200;function l(h,d,p){var f=-1,x=t,g=h.length,m=!0,c=[],u=c;if(p)m=!1,x=r;else if(g>=e){var b=d?null:a(h);if(b)return s(b);m=!1,x=n,u=new i}else u=d?[]:c;e:for(;++f<g;){var y=h[f],S=d?d(y):y;if(y=p||y!==0?y:0,m&&S===S){for(var w=u.length;w--;)if(u[w]===S)continue e;d&&u.push(S),c.push(y)}else x(u,S,p)||(u!==c&&u.push(S),c.push(y))}return c}return La=l,La}var za,lp;function Pf(){if(lp)return za;lp=1;var i=ft(),t=at();function r(n){return t(n)&&i(n)}return za=r,za}var Ba,dp;function Am(){if(dp)return Ba;dp=1;var i=Ec(),t=Hr(),r=Im(),n=Pf(),a=t(function(s){return r(i(s,1,n,!0))});return Ba=a,Ba}var Wa,up;function Tm(){if(up)return Wa;up=1;var i=Ur();function t(r,n){return i(n,function(a){return r[a]})}return Wa=t,Wa}var Na,pp;function Df(){if(pp)return Na;pp=1;var i=Tm(),t=Et();function r(n){return n==null?[]:i(n,t(n))}return Na=r,Na}var qa,hp;function Xe(){if(hp)return qa;hp=1;var i;if(typeof uc=="function")try{i={clone:Nx(),constant:wc(),each:ff(),filter:Cf(),has:Ef(),isArray:Ee(),isEmpty:dm(),isFunction:Kt(),isUndefined:Mf(),keys:Et(),map:Rf(),reduce:_f(),size:ym(),transform:bm(),union:Am(),values:Df()}}catch{}return i||(i=window._),qa=i,qa}var Oa,fp;function Mc(){if(fp)return Oa;fp=1;var i=Xe();Oa=a;var t="\0",r="\0",n="";function a(p){this._isDirected=i.has(p,"directed")?p.directed:!0,this._isMultigraph=i.has(p,"multigraph")?p.multigraph:!1,this._isCompound=i.has(p,"compound")?p.compound:!1,this._label=void 0,this._defaultNodeLabelFn=i.constant(void 0),this._defaultEdgeLabelFn=i.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[r]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}a.prototype._nodeCount=0,a.prototype._edgeCount=0,a.prototype.isDirected=function(){return this._isDirected},a.prototype.isMultigraph=function(){return this._isMultigraph},a.prototype.isCompound=function(){return this._isCompound},a.prototype.setGraph=function(p){return this._label=p,this},a.prototype.graph=function(){return this._label},a.prototype.setDefaultNodeLabel=function(p){return i.isFunction(p)||(p=i.constant(p)),this._defaultNodeLabelFn=p,this},a.prototype.nodeCount=function(){return this._nodeCount},a.prototype.nodes=function(){return i.keys(this._nodes)},a.prototype.sources=function(){var p=this;return i.filter(this.nodes(),function(f){return i.isEmpty(p._in[f])})},a.prototype.sinks=function(){var p=this;return i.filter(this.nodes(),function(f){return i.isEmpty(p._out[f])})},a.prototype.setNodes=function(p,f){var x=arguments,g=this;return i.each(p,function(m){x.length>1?g.setNode(m,f):g.setNode(m)}),this},a.prototype.setNode=function(p,f){return i.has(this._nodes,p)?(arguments.length>1&&(this._nodes[p]=f),this):(this._nodes[p]=arguments.length>1?f:this._defaultNodeLabelFn(p),this._isCompound&&(this._parent[p]=r,this._children[p]={},this._children[r][p]=!0),this._in[p]={},this._preds[p]={},this._out[p]={},this._sucs[p]={},++this._nodeCount,this)},a.prototype.node=function(p){return this._nodes[p]},a.prototype.hasNode=function(p){return i.has(this._nodes,p)},a.prototype.removeNode=function(p){var f=this;if(i.has(this._nodes,p)){var x=function(g){f.removeEdge(f._edgeObjs[g])};delete this._nodes[p],this._isCompound&&(this._removeFromParentsChildList(p),delete this._parent[p],i.each(this.children(p),function(g){f.setParent(g)}),delete this._children[p]),i.each(i.keys(this._in[p]),x),delete this._in[p],delete this._preds[p],i.each(i.keys(this._out[p]),x),delete this._out[p],delete this._sucs[p],--this._nodeCount}return this},a.prototype.setParent=function(p,f){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(i.isUndefined(f))f=r;else{f+="";for(var x=f;!i.isUndefined(x);x=this.parent(x))if(x===p)throw new Error("Setting "+f+" as parent of "+p+" would create a cycle");this.setNode(f)}return this.setNode(p),this._removeFromParentsChildList(p),this._parent[p]=f,this._children[f][p]=!0,this},a.prototype._removeFromParentsChildList=function(p){delete this._children[this._parent[p]][p]},a.prototype.parent=function(p){if(this._isCompound){var f=this._parent[p];if(f!==r)return f}},a.prototype.children=function(p){if(i.isUndefined(p)&&(p=r),this._isCompound){var f=this._children[p];if(f)return i.keys(f)}else{if(p===r)return this.nodes();if(this.hasNode(p))return[]}},a.prototype.predecessors=function(p){var f=this._preds[p];if(f)return i.keys(f)},a.prototype.successors=function(p){var f=this._sucs[p];if(f)return i.keys(f)},a.prototype.neighbors=function(p){var f=this.predecessors(p);if(f)return i.union(f,this.successors(p))},a.prototype.isLeaf=function(p){var f;return this.isDirected()?f=this.successors(p):f=this.neighbors(p),f.length===0},a.prototype.filterNodes=function(p){var f=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});f.setGraph(this.graph());var x=this;i.each(this._nodes,function(c,u){p(u)&&f.setNode(u,c)}),i.each(this._edgeObjs,function(c){f.hasNode(c.v)&&f.hasNode(c.w)&&f.setEdge(c,x.edge(c))});var g={};function m(c){var u=x.parent(c);return u===void 0||f.hasNode(u)?(g[c]=u,u):u in g?g[u]:m(u)}return this._isCompound&&i.each(f.nodes(),function(c){f.setParent(c,m(c))}),f},a.prototype.setDefaultEdgeLabel=function(p){return i.isFunction(p)||(p=i.constant(p)),this._defaultEdgeLabelFn=p,this},a.prototype.edgeCount=function(){return this._edgeCount},a.prototype.edges=function(){return i.values(this._edgeObjs)},a.prototype.setPath=function(p,f){var x=this,g=arguments;return i.reduce(p,function(m,c){return g.length>1?x.setEdge(m,c,f):x.setEdge(m,c),c}),this},a.prototype.setEdge=function(){var p,f,x,g,m=!1,c=arguments[0];typeof c=="object"&&c!==null&&"v"in c?(p=c.v,f=c.w,x=c.name,arguments.length===2&&(g=arguments[1],m=!0)):(p=c,f=arguments[1],x=arguments[3],arguments.length>2&&(g=arguments[2],m=!0)),p=""+p,f=""+f,i.isUndefined(x)||(x=""+x);var u=l(this._isDirected,p,f,x);if(i.has(this._edgeLabels,u))return m&&(this._edgeLabels[u]=g),this;if(!i.isUndefined(x)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(p),this.setNode(f),this._edgeLabels[u]=m?g:this._defaultEdgeLabelFn(p,f,x);var b=h(this._isDirected,p,f,x);return p=b.v,f=b.w,Object.freeze(b),this._edgeObjs[u]=b,s(this._preds[f],p),s(this._sucs[p],f),this._in[f][u]=b,this._out[p][u]=b,this._edgeCount++,this},a.prototype.edge=function(p,f,x){var g=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,p,f,x);return this._edgeLabels[g]},a.prototype.hasEdge=function(p,f,x){var g=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,p,f,x);return i.has(this._edgeLabels,g)},a.prototype.removeEdge=function(p,f,x){var g=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,p,f,x),m=this._edgeObjs[g];return m&&(p=m.v,f=m.w,delete this._edgeLabels[g],delete this._edgeObjs[g],e(this._preds[f],p),e(this._sucs[p],f),delete this._in[f][g],delete this._out[p][g],this._edgeCount--),this},a.prototype.inEdges=function(p,f){var x=this._in[p];if(x){var g=i.values(x);return f?i.filter(g,function(m){return m.v===f}):g}},a.prototype.outEdges=function(p,f){var x=this._out[p];if(x){var g=i.values(x);return f?i.filter(g,function(m){return m.w===f}):g}},a.prototype.nodeEdges=function(p,f){var x=this.inEdges(p,f);if(x)return x.concat(this.outEdges(p,f))};function s(p,f){p[f]?p[f]++:p[f]=1}function e(p,f){--p[f]||delete p[f]}function l(p,f,x,g){var m=""+f,c=""+x;if(!p&&m>c){var u=m;m=c,c=u}return m+n+c+n+(i.isUndefined(g)?t:g)}function h(p,f,x,g){var m=""+f,c=""+x;if(!p&&m>c){var u=m;m=c,c=u}var b={v:m,w:c};return g&&(b.name=g),b}function d(p,f){return l(p,f.v,f.w,f.name)}return Oa}var Fa,gp;function Pm(){return gp||(gp=1,Fa="2.1.8"),Fa}var Ua,xp;function Dm(){return xp||(xp=1,Ua={Graph:Mc(),version:Pm()}),Ua}var Ga,mp;function Lm(){if(mp)return Ga;mp=1;var i=Xe(),t=Mc();Ga={write:r,read:s};function r(e){var l={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:n(e),edges:a(e)};return i.isUndefined(e.graph())||(l.value=i.clone(e.graph())),l}function n(e){return i.map(e.nodes(),function(l){var h=e.node(l),d=e.parent(l),p={v:l};return i.isUndefined(h)||(p.value=h),i.isUndefined(d)||(p.parent=d),p})}function a(e){return i.map(e.edges(),function(l){var h=e.edge(l),d={v:l.v,w:l.w};return i.isUndefined(l.name)||(d.name=l.name),i.isUndefined(h)||(d.value=h),d})}function s(e){var l=new t(e.options).setGraph(e.value);return i.each(e.nodes,function(h){l.setNode(h.v,h.value),h.parent&&l.setParent(h.v,h.parent)}),i.each(e.edges,function(h){l.setEdge({v:h.v,w:h.w,name:h.name},h.value)}),l}return Ga}var Ya,yp;function zm(){if(yp)return Ya;yp=1;var i=Xe();Ya=t;function t(r){var n={},a=[],s;function e(l){i.has(n,l)||(n[l]=!0,s.push(l),i.each(r.successors(l),e),i.each(r.predecessors(l),e))}return i.each(r.nodes(),function(l){s=[],e(l),s.length&&a.push(s)}),a}return Ya}var Ha,bp;function Lf(){if(bp)return Ha;bp=1;var i=Xe();Ha=t;function t(){this._arr=[],this._keyIndices={}}return t.prototype.size=function(){return this._arr.length},t.prototype.keys=function(){return this._arr.map(function(r){return r.key})},t.prototype.has=function(r){return i.has(this._keyIndices,r)},t.prototype.priority=function(r){var n=this._keyIndices[r];if(n!==void 0)return this._arr[n].priority},t.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},t.prototype.add=function(r,n){var a=this._keyIndices;if(r=String(r),!i.has(a,r)){var s=this._arr,e=s.length;return a[r]=e,s.push({key:r,priority:n}),this._decrease(e),!0}return!1},t.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var r=this._arr.pop();return delete this._keyIndices[r.key],this._heapify(0),r.key},t.prototype.decrease=function(r,n){var a=this._keyIndices[r];if(n>this._arr[a].priority)throw new Error("New priority is greater than current priority. Key: "+r+" Old: "+this._arr[a].priority+" New: "+n);this._arr[a].priority=n,this._decrease(a)},t.prototype._heapify=function(r){var n=this._arr,a=2*r,s=a+1,e=r;a<n.length&&(e=n[a].priority<n[e].priority?a:e,s<n.length&&(e=n[s].priority<n[e].priority?s:e),e!==r&&(this._swap(r,e),this._heapify(e)))},t.prototype._decrease=function(r){for(var n=this._arr,a=n[r].priority,s;r!==0&&(s=r>>1,!(n[s].priority<a));)this._swap(r,s),r=s},t.prototype._swap=function(r,n){var a=this._arr,s=this._keyIndices,e=a[r],l=a[n];a[r]=l,a[n]=e,s[l.key]=r,s[e.key]=n},Ha}var Va,vp;function zf(){if(vp)return Va;vp=1;var i=Xe(),t=Lf();Va=n;var r=i.constant(1);function n(s,e,l,h){return a(s,String(e),l||r,h||function(d){return s.outEdges(d)})}function a(s,e,l,h){var d={},p=new t,f,x,g=function(m){var c=m.v!==f?m.v:m.w,u=d[c],b=l(m),y=x.distance+b;if(b<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+m+" Weight: "+b);y<u.distance&&(u.distance=y,u.predecessor=f,p.decrease(c,y))};for(s.nodes().forEach(function(m){var c=m===e?0:Number.POSITIVE_INFINITY;d[m]={distance:c},p.add(m,c)});p.size()>0&&(f=p.removeMin(),x=d[f],x.distance!==Number.POSITIVE_INFINITY);)h(f).forEach(g);return d}return Va}var Xa,wp;function Bm(){if(wp)return Xa;wp=1;var i=zf(),t=Xe();Xa=r;function r(n,a,s){return t.transform(n.nodes(),function(e,l){e[l]=i(n,l,a,s)},{})}return Xa}var Ka,Sp;function Bf(){if(Sp)return Ka;Sp=1;var i=Xe();Ka=t;function t(r){var n=0,a=[],s={},e=[];function l(h){var d=s[h]={onStack:!0,lowlink:n,index:n++};if(a.push(h),r.successors(h).forEach(function(x){i.has(s,x)?s[x].onStack&&(d.lowlink=Math.min(d.lowlink,s[x].index)):(l(x),d.lowlink=Math.min(d.lowlink,s[x].lowlink))}),d.lowlink===d.index){var p=[],f;do f=a.pop(),s[f].onStack=!1,p.push(f);while(h!==f);e.push(p)}}return r.nodes().forEach(function(h){i.has(s,h)||l(h)}),e}return Ka}var Qa,kp;function Wm(){if(kp)return Qa;kp=1;var i=Xe(),t=Bf();Qa=r;function r(n){return i.filter(t(n),function(a){return a.length>1||a.length===1&&n.hasEdge(a[0],a[0])})}return Qa}var Za,jp;function Nm(){if(jp)return Za;jp=1;var i=Xe();Za=r;var t=i.constant(1);function r(a,s,e){return n(a,s||t,e||function(l){return a.outEdges(l)})}function n(a,s,e){var l={},h=a.nodes();return h.forEach(function(d){l[d]={},l[d][d]={distance:0},h.forEach(function(p){d!==p&&(l[d][p]={distance:Number.POSITIVE_INFINITY})}),e(d).forEach(function(p){var f=p.v===d?p.w:p.v,x=s(p);l[d][f]={distance:x,predecessor:d}})}),h.forEach(function(d){var p=l[d];h.forEach(function(f){var x=l[f];h.forEach(function(g){var m=x[d],c=p[g],u=x[g],b=m.distance+c.distance;b<u.distance&&(u.distance=b,u.predecessor=c.predecessor)})})}),l}return Za}var Ja,Cp;function Wf(){if(Cp)return Ja;Cp=1;var i=Xe();Ja=t,t.CycleException=r;function t(n){var a={},s={},e=[];function l(h){if(i.has(s,h))throw new r;i.has(a,h)||(s[h]=!0,a[h]=!0,i.each(n.predecessors(h),l),delete s[h],e.push(h))}if(i.each(n.sinks(),l),i.size(a)!==n.nodeCount())throw new r;return e}function r(){}return r.prototype=new Error,Ja}var es,Ep;function qm(){if(Ep)return es;Ep=1;var i=Wf();es=t;function t(r){try{i(r)}catch(n){if(n instanceof i.CycleException)return!1;throw n}return!0}return es}var ts,Mp;function Nf(){if(Mp)return ts;Mp=1;var i=Xe();ts=t;function t(n,a,s){i.isArray(a)||(a=[a]);var e=(n.isDirected()?n.successors:n.neighbors).bind(n),l=[],h={};return i.each(a,function(d){if(!n.hasNode(d))throw new Error("Graph does not have node: "+d);r(n,d,s==="post",h,e,l)}),l}function r(n,a,s,e,l,h){i.has(e,a)||(e[a]=!0,s||h.push(a),i.each(l(a),function(d){r(n,d,s,e,l,h)}),s&&h.push(a))}return ts}var rs,$p;function Om(){if($p)return rs;$p=1;var i=Nf();rs=t;function t(r,n){return i(r,n,"post")}return rs}var ns,Rp;function Fm(){if(Rp)return ns;Rp=1;var i=Nf();ns=t;function t(r,n){return i(r,n,"pre")}return ns}var is,_p;function Um(){if(_p)return is;_p=1;var i=Xe(),t=Mc(),r=Lf();is=n;function n(a,s){var e=new t,l={},h=new r,d;function p(x){var g=x.v===d?x.w:x.v,m=h.priority(g);if(m!==void 0){var c=s(x);c<m&&(l[g]=d,h.decrease(g,c))}}if(a.nodeCount()===0)return e;i.each(a.nodes(),function(x){h.add(x,Number.POSITIVE_INFINITY),e.setNode(x)}),h.decrease(a.nodes()[0],0);for(var f=!1;h.size()>0;){if(d=h.removeMin(),i.has(l,d))e.setEdge(d,l[d]);else{if(f)throw new Error("Input graph is not connected: "+a);f=!0}a.nodeEdges(d).forEach(p)}return e}return is}var os,Ip;function Gm(){return Ip||(Ip=1,os={components:zm(),dijkstra:zf(),dijkstraAll:Bm(),findCycles:Wm(),floydWarshall:Nm(),isAcyclic:qm(),postorder:Om(),preorder:Fm(),prim:Um(),tarjan:Bf(),topsort:Wf()}),os}var as,Ap;function Ym(){if(Ap)return as;Ap=1;var i=Dm();return as={Graph:i.Graph,json:Lm(),alg:Gm(),version:i.version},as}var Cr;if(typeof uc=="function")try{Cr=Ym()}catch{}Cr||(Cr=window.graphlib);var et=Cr,ss,Tp;function Hm(){if(Tp)return ss;Tp=1;var i=uf(),t=1,r=4;function n(a){return i(a,t|r)}return ss=n,ss}var cs,Pp;function Vr(){if(Pp)return cs;Pp=1;var i=Lt(),t=ft(),r=Wr(),n=Ve();function a(s,e,l){if(!n(l))return!1;var h=typeof e;return(h=="number"?t(l)&&r(e,l.length):h=="string"&&e in l)?i(l[e],s):!1}return cs=a,cs}var ls,Dp;function Vm(){if(Dp)return ls;Dp=1;var i=Hr(),t=Lt(),r=Vr(),n=It(),a=Object.prototype,s=a.hasOwnProperty,e=i(function(l,h){l=Object(l);var d=-1,p=h.length,f=p>2?h[2]:void 0;for(f&&r(h[0],h[1],f)&&(p=1);++d<p;)for(var x=h[d],g=n(x),m=-1,c=g.length;++m<c;){var u=g[m],b=l[u];(b===void 0||t(b,a[u])&&!s.call(l,u))&&(l[u]=x[u])}return l});return ls=e,ls}var ds,Lp;function Xm(){if(Lp)return ds;Lp=1;var i=gt(),t=ft(),r=Et();function n(a){return function(s,e,l){var h=Object(s);if(!t(s)){var d=i(e,3);s=r(s),e=function(f){return d(h[f],f,h)}}var p=a(s,e,l);return p>-1?h[d?s[p]:p]:void 0}}return ds=n,ds}var us,zp;function Km(){if(zp)return us;zp=1;var i=/\s/;function t(r){for(var n=r.length;n--&&i.test(r.charAt(n)););return n}return us=t,us}var ps,Bp;function Qm(){if(Bp)return ps;Bp=1;var i=Km(),t=/^\s+/;function r(n){return n&&n.slice(0,i(n)+1).replace(t,"")}return ps=r,ps}var hs,Wp;function Zm(){if(Wp)return hs;Wp=1;var i=Qm(),t=Ve(),r=Nt(),n=NaN,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,e=/^0o[0-7]+$/i,l=parseInt;function h(d){if(typeof d=="number")return d;if(r(d))return n;if(t(d)){var p=typeof d.valueOf=="function"?d.valueOf():d;d=t(p)?p+"":p}if(typeof d!="string")return d===0?d:+d;d=i(d);var f=s.test(d);return f||e.test(d)?l(d.slice(2),f?2:8):a.test(d)?n:+d}return hs=h,hs}var fs,Np;function qf(){if(Np)return fs;Np=1;var i=Zm(),t=1/0,r=17976931348623157e292;function n(a){if(!a)return a===0?a:0;if(a=i(a),a===t||a===-t){var s=a<0?-1:1;return s*r}return a===a?a:0}return fs=n,fs}var gs,qp;function Jm(){if(qp)return gs;qp=1;var i=qf();function t(r){var n=i(r),a=n%1;return n===n?a?n-a:n:0}return gs=t,gs}var xs,Op;function e0(){if(Op)return xs;Op=1;var i=Tf(),t=gt(),r=Jm(),n=Math.max;function a(s,e,l){var h=s==null?0:s.length;if(!h)return-1;var d=l==null?0:r(l);return d<0&&(d=n(h+d,0)),i(s,t(e,3),d)}return xs=a,xs}var ms,Fp;function t0(){if(Fp)return ms;Fp=1;var i=Xm(),t=e0(),r=i(t);return ms=r,ms}var ys,Up;function Of(){if(Up)return ys;Up=1;var i=Ec();function t(r){var n=r==null?0:r.length;return n?i(r,1):[]}return ys=t,ys}var bs,Gp;function r0(){if(Gp)return bs;Gp=1;var i=Sc(),t=pf(),r=It();function n(a,s){return a==null?a:i(a,t(s),r)}return bs=n,bs}var vs,Yp;function n0(){if(Yp)return vs;Yp=1;function i(t){var r=t==null?0:t.length;return r?t[r-1]:void 0}return vs=i,vs}var ws,Hp;function i0(){if(Hp)return ws;Hp=1;var i=zr(),t=kc(),r=gt();function n(a,s){var e={};return s=r(s,3),t(a,function(l,h,d){i(e,h,s(l,h,d))}),e}return ws=n,ws}var Ss,Vp;function $c(){if(Vp)return Ss;Vp=1;var i=Nt();function t(r,n,a){for(var s=-1,e=r.length;++s<e;){var l=r[s],h=n(l);if(h!=null&&(d===void 0?h===h&&!i(h):a(h,d)))var d=h,p=l}return p}return Ss=t,Ss}var ks,Xp;function o0(){if(Xp)return ks;Xp=1;function i(t,r){return t>r}return ks=i,ks}var js,Kp;function a0(){if(Kp)return js;Kp=1;var i=$c(),t=o0(),r=At();function n(a){return a&&a.length?i(a,r,t):void 0}return js=n,js}var Cs,Qp;function Ff(){if(Qp)return Cs;Qp=1;var i=zr(),t=Lt();function r(n,a,s){(s!==void 0&&!t(n[a],s)||s===void 0&&!(a in n))&&i(n,a,s)}return Cs=r,Cs}var Es,Zp;function s0(){if(Zp)return Es;Zp=1;var i=Rt(),t=Or(),r=at(),n="[object Object]",a=Function.prototype,s=Object.prototype,e=a.toString,l=s.hasOwnProperty,h=e.call(Object);function d(p){if(!r(p)||i(p)!=n)return!1;var f=t(p);if(f===null)return!0;var x=l.call(f,"constructor")&&f.constructor;return typeof x=="function"&&x instanceof x&&e.call(x)==h}return Es=d,Es}var Ms,Jp;function Uf(){if(Jp)return Ms;Jp=1;function i(t,r){if(!(r==="constructor"&&typeof t[r]=="function")&&r!="__proto__")return t[r]}return Ms=i,Ms}var $s,eh;function c0(){if(eh)return $s;eh=1;var i=Qt(),t=It();function r(n){return i(n,t(n))}return $s=r,$s}var Rs,th;function l0(){if(th)return Rs;th=1;var i=Ff(),t=Zh(),r=cf(),n=Jh(),a=df(),s=Zt(),e=Ee(),l=Pf(),h=Bt(),d=Kt(),p=Ve(),f=s0(),x=Jt(),g=Uf(),m=c0();function c(u,b,y,S,w,k,j){var C=g(u,y),E=g(b,y),R=j.get(E);if(R){i(u,y,R);return}var T=k?k(C,E,y+"",u,b,j):void 0,I=T===void 0;if(I){var B=e(E),z=!B&&h(E),D=!B&&!z&&x(E);T=E,B||z||D?e(C)?T=C:l(C)?T=n(C):z?(I=!1,T=t(E,!0)):D?(I=!1,T=r(E,!0)):T=[]:f(E)||s(E)?(T=C,s(C)?T=m(C):(!p(C)||d(C))&&(T=a(E))):I=!1}I&&(j.set(E,T),w(T,E,S,k,j),j.delete(E)),i(u,y,T)}return Rs=c,Rs}var _s,rh;function d0(){if(rh)return _s;rh=1;var i=Lr(),t=Ff(),r=Sc(),n=l0(),a=Ve(),s=It(),e=Uf();function l(h,d,p,f,x){h!==d&&r(d,function(g,m){if(x||(x=new i),a(g))n(h,d,m,p,l,f,x);else{var c=f?f(e(h,m),g,m+"",h,d,x):void 0;c===void 0&&(c=g),t(h,m,c)}},s)}return _s=l,_s}var Is,nh;function u0(){if(nh)return Is;nh=1;var i=Hr(),t=Vr();function r(n){return i(function(a,s){var e=-1,l=s.length,h=l>1?s[l-1]:void 0,d=l>2?s[2]:void 0;for(h=n.length>3&&typeof h=="function"?(l--,h):void 0,d&&t(s[0],s[1],d)&&(h=l<3?void 0:h,l=1),a=Object(a);++e<l;){var p=s[e];p&&n(a,p,e,h)}return a})}return Is=r,Is}var As,ih;function p0(){if(ih)return As;ih=1;var i=d0(),t=u0(),r=t(function(n,a,s){i(n,a,s)});return As=r,As}var Ts,oh;function Gf(){if(oh)return Ts;oh=1;function i(t,r){return t<r}return Ts=i,Ts}var Ps,ah;function h0(){if(ah)return Ps;ah=1;var i=$c(),t=Gf(),r=At();function n(a){return a&&a.length?i(a,r,t):void 0}return Ps=n,Ps}var Ds,sh;function f0(){if(sh)return Ds;sh=1;var i=$c(),t=gt(),r=Gf();function n(a,s){return a&&a.length?i(a,t(s,2),r):void 0}return Ds=n,Ds}var Ls,ch;function g0(){if(ch)return Ls;ch=1;var i=Je(),t=function(){return i.Date.now()};return Ls=t,Ls}var zs,lh;function x0(){if(lh)return zs;lh=1;var i=Br(),t=Gr(),r=Wr(),n=Ve(),a=er();function s(e,l,h,d){if(!n(e))return e;l=t(l,e);for(var p=-1,f=l.length,x=f-1,g=e;g!=null&&++p<f;){var m=a(l[p]),c=h;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(p!=x){var u=g[m];c=d?d(u,m,g):void 0,c===void 0&&(c=n(u)?u:r(l[p+1])?[]:{})}i(g,m,c),g=g[m]}return e}return zs=s,zs}var Bs,dh;function m0(){if(dh)return Bs;dh=1;var i=Yr(),t=x0(),r=Gr();function n(a,s,e){for(var l=-1,h=s.length,d={};++l<h;){var p=s[l],f=i(a,p);e(f,p)&&t(d,r(p,a),f)}return d}return Bs=n,Bs}var Ws,uh;function y0(){if(uh)return Ws;uh=1;var i=m0(),t=kf();function r(n,a){return i(n,a,function(s,e){return t(n,e)})}return Ws=r,Ws}var Ns,ph;function b0(){if(ph)return Ns;ph=1;var i=Of(),t=If(),r=Af();function n(a){return r(t(a,void 0,i),a+"")}return Ns=n,Ns}var qs,hh;function v0(){if(hh)return qs;hh=1;var i=y0(),t=b0(),r=t(function(n,a){return n==null?{}:i(n,a)});return qs=r,qs}var Os,fh;function w0(){if(fh)return Os;fh=1;var i=Math.ceil,t=Math.max;function r(n,a,s,e){for(var l=-1,h=t(i((a-n)/(s||1)),0),d=Array(h);h--;)d[e?h:++l]=n,n+=s;return d}return Os=r,Os}var Fs,gh;function S0(){if(gh)return Fs;gh=1;var i=w0(),t=Vr(),r=qf();function n(a){return function(s,e,l){return l&&typeof l!="number"&&t(s,e,l)&&(e=l=void 0),s=r(s),e===void 0?(e=s,s=0):e=r(e),l=l===void 0?s<e?1:-1:r(l),i(s,e,l,a)}}return Fs=n,Fs}var Us,xh;function k0(){if(xh)return Us;xh=1;var i=S0(),t=i();return Us=t,Us}var Gs,mh;function j0(){if(mh)return Gs;mh=1;function i(t,r){var n=t.length;for(t.sort(r);n--;)t[n]=t[n].value;return t}return Gs=i,Gs}var Ys,yh;function C0(){if(yh)return Ys;yh=1;var i=Nt();function t(r,n){if(r!==n){var a=r!==void 0,s=r===null,e=r===r,l=i(r),h=n!==void 0,d=n===null,p=n===n,f=i(n);if(!d&&!f&&!l&&r>n||l&&h&&p&&!d&&!f||s&&h&&p||!a&&p||!e)return 1;if(!s&&!l&&!f&&r<n||f&&a&&e&&!s&&!l||d&&a&&e||!h&&e||!p)return-1}return 0}return Ys=t,Ys}var Hs,bh;function E0(){if(bh)return Hs;bh=1;var i=C0();function t(r,n,a){for(var s=-1,e=r.criteria,l=n.criteria,h=e.length,d=a.length;++s<h;){var p=i(e[s],l[s]);if(p){if(s>=d)return p;var f=a[s];return p*(f=="desc"?-1:1)}}return r.index-n.index}return Hs=t,Hs}var Vs,vh;function M0(){if(vh)return Vs;vh=1;var i=Ur(),t=Yr(),r=gt(),n=$f(),a=j0(),s=Nr(),e=E0(),l=At(),h=Ee();function d(p,f,x){f.length?f=i(f,function(c){return h(c)?function(u){return t(u,c.length===1?c[0]:c)}:c}):f=[l];var g=-1;f=i(f,s(r));var m=n(p,function(c,u,b){var y=i(f,function(S){return S(c)});return{criteria:y,index:++g,value:c}});return a(m,function(c,u){return e(c,u,x)})}return Vs=d,Vs}var Xs,wh;function $0(){if(wh)return Xs;wh=1;var i=Ec(),t=M0(),r=Hr(),n=Vr(),a=r(function(s,e){if(s==null)return[];var l=e.length;return l>1&&n(s,e[0],e[1])?e=[]:l>2&&n(e[0],e[1],e[2])&&(e=[e[0]]),t(s,i(e,1),[])});return Xs=a,Xs}var Ks,Sh;function R0(){if(Sh)return Ks;Sh=1;var i=wf(),t=0;function r(n){var a=++t;return i(n)+a}return Ks=r,Ks}var Qs,kh;function _0(){if(kh)return Qs;kh=1;function i(t,r,n){for(var a=-1,s=t.length,e=r.length,l={};++a<s;){var h=a<e?r[a]:void 0;n(l,t[a],h)}return l}return Qs=i,Qs}var Zs,jh;function I0(){if(jh)return Zs;jh=1;var i=Br(),t=_0();function r(n,a){return t(n||[],a||[],i)}return Zs=r,Zs}var Er;if(typeof uc=="function")try{Er={cloneDeep:Hm(),constant:wc(),defaults:Vm(),each:ff(),filter:Cf(),find:t0(),flatten:Of(),forEach:hf(),forIn:r0(),has:Ef(),isUndefined:Mf(),last:n0(),map:Rf(),mapValues:i0(),max:a0(),merge:p0(),min:h0(),minBy:f0(),now:g0(),pick:v0(),range:k0(),reduce:_f(),sortBy:$0(),uniqueId:R0(),values:Df(),zipObject:I0()}}catch{}Er||(Er=window._);var Se=Er,A0=Xr;function Xr(){var i={};i._next=i._prev=i,this._sentinel=i}Xr.prototype.dequeue=function(){var i=this._sentinel,t=i._prev;if(t!==i)return Yf(t),t};Xr.prototype.enqueue=function(i){var t=this._sentinel;i._prev&&i._next&&Yf(i),i._next=t._next,t._next._prev=i,t._next=i,i._prev=t};Xr.prototype.toString=function(){for(var i=[],t=this._sentinel,r=t._prev;r!==t;)i.push(JSON.stringify(r,T0)),r=r._prev;return"["+i.join(", ")+"]"};function Yf(i){i._prev._next=i._next,i._next._prev=i._prev,delete i._next,delete i._prev}function T0(i,t){if(i!=="_next"&&i!=="_prev")return t}var ut=Se,P0=et.Graph,D0=A0,L0=B0,z0=ut.constant(1);function B0(i,t){if(i.nodeCount()<=1)return[];var r=N0(i,t||z0),n=W0(r.graph,r.buckets,r.zeroIdx);return ut.flatten(ut.map(n,function(a){return i.outEdges(a.v,a.w)}),!0)}function W0(i,t,r){for(var n=[],a=t[t.length-1],s=t[0],e;i.nodeCount();){for(;e=s.dequeue();)Js(i,t,r,e);for(;e=a.dequeue();)Js(i,t,r,e);if(i.nodeCount()){for(var l=t.length-2;l>0;--l)if(e=t[l].dequeue(),e){n=n.concat(Js(i,t,r,e,!0));break}}}return n}function Js(i,t,r,n,a){var s=a?[]:void 0;return ut.forEach(i.inEdges(n.v),function(e){var l=i.edge(e),h=i.node(e.v);a&&s.push({v:e.v,w:e.w}),h.out-=l,sc(t,r,h)}),ut.forEach(i.outEdges(n.v),function(e){var l=i.edge(e),h=e.w,d=i.node(h);d.in-=l,sc(t,r,d)}),i.removeNode(n.v),s}function N0(i,t){var r=new P0,n=0,a=0;ut.forEach(i.nodes(),function(l){r.setNode(l,{v:l,in:0,out:0})}),ut.forEach(i.edges(),function(l){var h=r.edge(l.v,l.w)||0,d=t(l),p=h+d;r.setEdge(l.v,l.w,p),a=Math.max(a,r.node(l.v).out+=d),n=Math.max(n,r.node(l.w).in+=d)});var s=ut.range(a+n+3).map(function(){return new D0}),e=n+1;return ut.forEach(r.nodes(),function(l){sc(s,e,r.node(l))}),{graph:r,buckets:s,zeroIdx:e}}function sc(i,t,r){r.out?r.in?i[r.out-r.in+t].enqueue(r):i[i.length-1].enqueue(r):i[0].enqueue(r)}var $t=Se,q0=L0,O0={run:F0,undo:G0};function F0(i){var t=i.graph().acyclicer==="greedy"?q0(i,r(i)):U0(i);$t.forEach(t,function(n){var a=i.edge(n);i.removeEdge(n),a.forwardName=n.name,a.reversed=!0,i.setEdge(n.w,n.v,a,$t.uniqueId("rev"))});function r(n){return function(a){return n.edge(a).weight}}}function U0(i){var t=[],r={},n={};function a(s){$t.has(n,s)||(n[s]=!0,r[s]=!0,$t.forEach(i.outEdges(s),function(e){$t.has(r,e.w)?t.push(e):a(e.w)}),delete r[s])}return $t.forEach(i.nodes(),a),t}function G0(i){$t.forEach(i.edges(),function(t){var r=i.edge(t);if(r.reversed){i.removeEdge(t);var n=r.forwardName;delete r.reversed,delete r.forwardName,i.setEdge(t.w,t.v,r,n)}})}var fe=Se,Hf=et.Graph,Fe={addDummyNode:Vf,simplify:Y0,asNonCompoundGraph:H0,successorWeights:V0,predecessorWeights:X0,intersectRect:K0,buildLayerMatrix:Q0,normalizeRanks:Z0,removeEmptyRanks:J0,addBorderNode:ey,maxRank:Xf,partition:ty,time:ry,notime:ny};function Vf(i,t,r,n){var a;do a=fe.uniqueId(n);while(i.hasNode(a));return r.dummy=t,i.setNode(a,r),a}function Y0(i){var t=new Hf().setGraph(i.graph());return fe.forEach(i.nodes(),function(r){t.setNode(r,i.node(r))}),fe.forEach(i.edges(),function(r){var n=t.edge(r.v,r.w)||{weight:0,minlen:1},a=i.edge(r);t.setEdge(r.v,r.w,{weight:n.weight+a.weight,minlen:Math.max(n.minlen,a.minlen)})}),t}function H0(i){var t=new Hf({multigraph:i.isMultigraph()}).setGraph(i.graph());return fe.forEach(i.nodes(),function(r){i.children(r).length||t.setNode(r,i.node(r))}),fe.forEach(i.edges(),function(r){t.setEdge(r,i.edge(r))}),t}function V0(i){var t=fe.map(i.nodes(),function(r){var n={};return fe.forEach(i.outEdges(r),function(a){n[a.w]=(n[a.w]||0)+i.edge(a).weight}),n});return fe.zipObject(i.nodes(),t)}function X0(i){var t=fe.map(i.nodes(),function(r){var n={};return fe.forEach(i.inEdges(r),function(a){n[a.v]=(n[a.v]||0)+i.edge(a).weight}),n});return fe.zipObject(i.nodes(),t)}function K0(i,t){var r=i.x,n=i.y,a=t.x-r,s=t.y-n,e=i.width/2,l=i.height/2;if(!a&&!s)throw new Error("Not possible to find intersection inside of the rectangle");var h,d;return Math.abs(s)*e>Math.abs(a)*l?(s<0&&(l=-l),h=l*a/s,d=l):(a<0&&(e=-e),h=e,d=e*s/a),{x:r+h,y:n+d}}function Q0(i){var t=fe.map(fe.range(Xf(i)+1),function(){return[]});return fe.forEach(i.nodes(),function(r){var n=i.node(r),a=n.rank;fe.isUndefined(a)||(t[a][n.order]=r)}),t}function Z0(i){var t=fe.min(fe.map(i.nodes(),function(r){return i.node(r).rank}));fe.forEach(i.nodes(),function(r){var n=i.node(r);fe.has(n,"rank")&&(n.rank-=t)})}function J0(i){var t=fe.min(fe.map(i.nodes(),function(s){return i.node(s).rank})),r=[];fe.forEach(i.nodes(),function(s){var e=i.node(s).rank-t;r[e]||(r[e]=[]),r[e].push(s)});var n=0,a=i.graph().nodeRankFactor;fe.forEach(r,function(s,e){fe.isUndefined(s)&&e%a!==0?--n:n&&fe.forEach(s,function(l){i.node(l).rank+=n})})}function ey(i,t,r,n){var a={width:0,height:0};return arguments.length>=4&&(a.rank=r,a.order=n),Vf(i,"border",a,t)}function Xf(i){return fe.max(fe.map(i.nodes(),function(t){var r=i.node(t).rank;if(!fe.isUndefined(r))return r}))}function ty(i,t){var r={lhs:[],rhs:[]};return fe.forEach(i,function(n){t(n)?r.lhs.push(n):r.rhs.push(n)}),r}function ry(i,t){var r=fe.now();try{return t()}finally{console.log(i+" time: "+(fe.now()-r)+"ms")}}function ny(i,t){return t()}var Kf=Se,iy=Fe,oy={run:ay,undo:cy};function ay(i){i.graph().dummyChains=[],Kf.forEach(i.edges(),function(t){sy(i,t)})}function sy(i,t){var r=t.v,n=i.node(r).rank,a=t.w,s=i.node(a).rank,e=t.name,l=i.edge(t),h=l.labelRank;if(s!==n+1){i.removeEdge(t);var d,p,f;for(f=0,++n;n<s;++f,++n)l.points=[],p={width:0,height:0,edgeLabel:l,edgeObj:t,rank:n},d=iy.addDummyNode(i,"edge",p,"_d"),n===h&&(p.width=l.width,p.height=l.height,p.dummy="edge-label",p.labelpos=l.labelpos),i.setEdge(r,d,{weight:l.weight},e),f===0&&i.graph().dummyChains.push(d),r=d;i.setEdge(r,a,{weight:l.weight},e)}}function cy(i){Kf.forEach(i.graph().dummyChains,function(t){var r=i.node(t),n=r.edgeLabel,a;for(i.setEdge(r.edgeObj,n);r.dummy;)a=i.successors(t)[0],i.removeNode(t),n.points.push({x:r.x,y:r.y}),r.dummy==="edge-label"&&(n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height),t=a,r=i.node(t)})}var wr=Se,Kr={longestPath:ly,slack:dy};function ly(i){var t={};function r(n){var a=i.node(n);if(wr.has(t,n))return a.rank;t[n]=!0;var s=wr.min(wr.map(i.outEdges(n),function(e){return r(e.w)-i.edge(e).minlen}));return(s===Number.POSITIVE_INFINITY||s===void 0||s===null)&&(s=0),a.rank=s}wr.forEach(i.sources(),r)}function dy(i,t){return i.node(t.w).rank-i.node(t.v).rank-i.edge(t).minlen}var Mr=Se,uy=et.Graph,$r=Kr.slack,Qf=py;function py(i){var t=new uy({directed:!1}),r=i.nodes()[0],n=i.nodeCount();t.setNode(r,{});for(var a,s;hy(t,i)<n;)a=fy(t,i),s=t.hasNode(a.v)?$r(i,a):-$r(i,a),gy(t,i,s);return t}function hy(i,t){function r(n){Mr.forEach(t.nodeEdges(n),function(a){var s=a.v,e=n===s?a.w:s;!i.hasNode(e)&&!$r(t,a)&&(i.setNode(e,{}),i.setEdge(n,e,{}),r(e))})}return Mr.forEach(i.nodes(),r),i.nodeCount()}function fy(i,t){return Mr.minBy(t.edges(),function(r){if(i.hasNode(r.v)!==i.hasNode(r.w))return $r(t,r)})}function gy(i,t,r){Mr.forEach(i.nodes(),function(n){t.node(n).rank+=r})}var ht=Se,xy=Qf,my=Kr.slack,yy=Kr.longestPath,by=et.alg.preorder,vy=et.alg.postorder,wy=Fe.simplify,Sy=Tt;Tt.initLowLimValues=_c;Tt.initCutValues=Rc;Tt.calcCutValue=Zf;Tt.leaveEdge=eg;Tt.enterEdge=tg;Tt.exchangeEdges=rg;function Tt(i){i=wy(i),yy(i);var t=xy(i);_c(t),Rc(t,i);for(var r,n;r=eg(t);)n=tg(t,i,r),rg(t,i,r,n)}function Rc(i,t){var r=vy(i,i.nodes());r=r.slice(0,r.length-1),ht.forEach(r,function(n){ky(i,t,n)})}function ky(i,t,r){var n=i.node(r),a=n.parent;i.edge(r,a).cutvalue=Zf(i,t,r)}function Zf(i,t,r){var n=i.node(r),a=n.parent,s=!0,e=t.edge(r,a),l=0;return e||(s=!1,e=t.edge(a,r)),l=e.weight,ht.forEach(t.nodeEdges(r),function(h){var d=h.v===r,p=d?h.w:h.v;if(p!==a){var f=d===s,x=t.edge(h).weight;if(l+=f?x:-x,Cy(i,r,p)){var g=i.edge(r,p).cutvalue;l+=f?-g:g}}}),l}function _c(i,t){arguments.length<2&&(t=i.nodes()[0]),Jf(i,{},1,t)}function Jf(i,t,r,n,a){var s=r,e=i.node(n);return t[n]=!0,ht.forEach(i.neighbors(n),function(l){ht.has(t,l)||(r=Jf(i,t,r,l,n))}),e.low=s,e.lim=r++,a?e.parent=a:delete e.parent,r}function eg(i){return ht.find(i.edges(),function(t){return i.edge(t).cutvalue<0})}function tg(i,t,r){var n=r.v,a=r.w;t.hasEdge(n,a)||(n=r.w,a=r.v);var s=i.node(n),e=i.node(a),l=s,h=!1;s.lim>e.lim&&(l=e,h=!0);var d=ht.filter(t.edges(),function(p){return h===Ch(i,i.node(p.v),l)&&h!==Ch(i,i.node(p.w),l)});return ht.minBy(d,function(p){return my(t,p)})}function rg(i,t,r,n){var a=r.v,s=r.w;i.removeEdge(a,s),i.setEdge(n.v,n.w,{}),_c(i),Rc(i,t),jy(i,t)}function jy(i,t){var r=ht.find(i.nodes(),function(a){return!t.node(a).parent}),n=by(i,r);n=n.slice(1),ht.forEach(n,function(a){var s=i.node(a).parent,e=t.edge(a,s),l=!1;e||(e=t.edge(s,a),l=!0),t.node(a).rank=t.node(s).rank+(l?e.minlen:-e.minlen)})}function Cy(i,t,r){return i.hasEdge(t,r)}function Ch(i,t,r){return r.low<=t.lim&&t.lim<=r.lim}var Ey=Kr,ng=Ey.longestPath,My=Qf,$y=Sy,Ry=_y;function _y(i){switch(i.graph().ranker){case"network-simplex":Eh(i);break;case"tight-tree":Ay(i);break;case"longest-path":Iy(i);break;default:Eh(i)}}var Iy=ng;function Ay(i){ng(i),My(i)}function Eh(i){$y(i)}var cc=Se,Ty=Py;function Py(i){var t=Ly(i);cc.forEach(i.graph().dummyChains,function(r){for(var n=i.node(r),a=n.edgeObj,s=Dy(i,t,a.v,a.w),e=s.path,l=s.lca,h=0,d=e[h],p=!0;r!==a.w;){if(n=i.node(r),p){for(;(d=e[h])!==l&&i.node(d).maxRank<n.rank;)h++;d===l&&(p=!1)}if(!p){for(;h<e.length-1&&i.node(d=e[h+1]).minRank<=n.rank;)h++;d=e[h]}i.setParent(r,d),r=i.successors(r)[0]}})}function Dy(i,t,r,n){var a=[],s=[],e=Math.min(t[r].low,t[n].low),l=Math.max(t[r].lim,t[n].lim),h,d;h=r;do h=i.parent(h),a.push(h);while(h&&(t[h].low>e||l>t[h].lim));for(d=h,h=n;(h=i.parent(h))!==d;)s.push(h);return{path:a.concat(s.reverse()),lca:d}}function Ly(i){var t={},r=0;function n(a){var s=r;cc.forEach(i.children(a),n),t[a]={low:s,lim:r++}}return cc.forEach(i.children(),n),t}var pt=Se,lc=Fe,zy={run:By,cleanup:qy};function By(i){var t=lc.addDummyNode(i,"root",{},"_root"),r=Wy(i),n=pt.max(pt.values(r))-1,a=2*n+1;i.graph().nestingRoot=t,pt.forEach(i.edges(),function(e){i.edge(e).minlen*=a});var s=Ny(i)+1;pt.forEach(i.children(),function(e){ig(i,t,a,s,n,r,e)}),i.graph().nodeRankFactor=a}function ig(i,t,r,n,a,s,e){var l=i.children(e);if(!l.length){e!==t&&i.setEdge(t,e,{weight:0,minlen:r});return}var h=lc.addBorderNode(i,"_bt"),d=lc.addBorderNode(i,"_bb"),p=i.node(e);i.setParent(h,e),p.borderTop=h,i.setParent(d,e),p.borderBottom=d,pt.forEach(l,function(f){ig(i,t,r,n,a,s,f);var x=i.node(f),g=x.borderTop?x.borderTop:f,m=x.borderBottom?x.borderBottom:f,c=x.borderTop?n:2*n,u=g!==m?1:a-s[e]+1;i.setEdge(h,g,{weight:c,minlen:u,nestingEdge:!0}),i.setEdge(m,d,{weight:c,minlen:u,nestingEdge:!0})}),i.parent(e)||i.setEdge(t,h,{weight:0,minlen:a+s[e]})}function Wy(i){var t={};function r(n,a){var s=i.children(n);s&&s.length&&pt.forEach(s,function(e){r(e,a+1)}),t[n]=a}return pt.forEach(i.children(),function(n){r(n,1)}),t}function Ny(i){return pt.reduce(i.edges(),function(t,r){return t+i.edge(r).weight},0)}function qy(i){var t=i.graph();i.removeNode(t.nestingRoot),delete t.nestingRoot,pt.forEach(i.edges(),function(r){var n=i.edge(r);n.nestingEdge&&i.removeEdge(r)})}var ec=Se,Oy=Fe,Fy=Uy;function Uy(i){function t(r){var n=i.children(r),a=i.node(r);if(n.length&&ec.forEach(n,t),ec.has(a,"minRank")){a.borderLeft=[],a.borderRight=[];for(var s=a.minRank,e=a.maxRank+1;s<e;++s)Mh(i,"borderLeft","_bl",r,a,s),Mh(i,"borderRight","_br",r,a,s)}}ec.forEach(i.children(),t)}function Mh(i,t,r,n,a,s){var e={width:0,height:0,rank:s,borderType:t},l=a[t][s-1],h=Oy.addDummyNode(i,"border",e,r);a[t][s]=h,i.setParent(h,n),l&&i.setEdge(l,h,{weight:1})}var ot=Se,Gy={adjust:Yy,undo:Hy};function Yy(i){var t=i.graph().rankdir.toLowerCase();(t==="lr"||t==="rl")&&og(i)}function Hy(i){var t=i.graph().rankdir.toLowerCase();(t==="bt"||t==="rl")&&Vy(i),(t==="lr"||t==="rl")&&(Xy(i),og(i))}function og(i){ot.forEach(i.nodes(),function(t){$h(i.node(t))}),ot.forEach(i.edges(),function(t){$h(i.edge(t))})}function $h(i){var t=i.width;i.width=i.height,i.height=t}function Vy(i){ot.forEach(i.nodes(),function(t){tc(i.node(t))}),ot.forEach(i.edges(),function(t){var r=i.edge(t);ot.forEach(r.points,tc),ot.has(r,"y")&&tc(r)})}function tc(i){i.y=-i.y}function Xy(i){ot.forEach(i.nodes(),function(t){rc(i.node(t))}),ot.forEach(i.edges(),function(t){var r=i.edge(t);ot.forEach(r.points,rc),ot.has(r,"x")&&rc(r)})}function rc(i){var t=i.x;i.x=i.y,i.y=t}var lt=Se,Ky=Qy;function Qy(i){var t={},r=lt.filter(i.nodes(),function(l){return!i.children(l).length}),n=lt.max(lt.map(r,function(l){return i.node(l).rank})),a=lt.map(lt.range(n+1),function(){return[]});function s(l){if(!lt.has(t,l)){t[l]=!0;var h=i.node(l);a[h.rank].push(l),lt.forEach(i.successors(l),s)}}var e=lt.sortBy(r,function(l){return i.node(l).rank});return lt.forEach(e,s),a}var vt=Se,Zy=Jy;function Jy(i,t){for(var r=0,n=1;n<t.length;++n)r+=eb(i,t[n-1],t[n]);return r}function eb(i,t,r){for(var n=vt.zipObject(r,vt.map(r,function(d,p){return p})),a=vt.flatten(vt.map(t,function(d){return vt.sortBy(vt.map(i.outEdges(d),function(p){return{pos:n[p.w],weight:i.edge(p).weight}}),"pos")}),!0),s=1;s<r.length;)s<<=1;var e=2*s-1;s-=1;var l=vt.map(new Array(e),function(){return 0}),h=0;return vt.forEach(a.forEach(function(d){var p=d.pos+s;l[p]+=d.weight;for(var f=0;p>0;)p%2&&(f+=l[p+1]),p=p-1>>1,l[p]+=d.weight;h+=d.weight*f})),h}var Rh=Se,tb=rb;function rb(i,t){return Rh.map(t,function(r){var n=i.inEdges(r);if(n.length){var a=Rh.reduce(n,function(s,e){var l=i.edge(e),h=i.node(e.v);return{sum:s.sum+l.weight*h.order,weight:s.weight+l.weight}},{sum:0,weight:0});return{v:r,barycenter:a.sum/a.weight,weight:a.weight}}else return{v:r}})}var Ye=Se,nb=ib;function ib(i,t){var r={};Ye.forEach(i,function(a,s){var e=r[a.v]={indegree:0,in:[],out:[],vs:[a.v],i:s};Ye.isUndefined(a.barycenter)||(e.barycenter=a.barycenter,e.weight=a.weight)}),Ye.forEach(t.edges(),function(a){var s=r[a.v],e=r[a.w];!Ye.isUndefined(s)&&!Ye.isUndefined(e)&&(e.indegree++,s.out.push(r[a.w]))});var n=Ye.filter(r,function(a){return!a.indegree});return ob(n)}function ob(i){var t=[];function r(s){return function(e){e.merged||(Ye.isUndefined(e.barycenter)||Ye.isUndefined(s.barycenter)||e.barycenter>=s.barycenter)&&ab(s,e)}}function n(s){return function(e){e.in.push(s),--e.indegree===0&&i.push(e)}}for(;i.length;){var a=i.pop();t.push(a),Ye.forEach(a.in.reverse(),r(a)),Ye.forEach(a.out,n(a))}return Ye.map(Ye.filter(t,function(s){return!s.merged}),function(s){return Ye.pick(s,["vs","i","barycenter","weight"])})}function ab(i,t){var r=0,n=0;i.weight&&(r+=i.barycenter*i.weight,n+=i.weight),t.weight&&(r+=t.barycenter*t.weight,n+=t.weight),i.vs=t.vs.concat(i.vs),i.barycenter=r/n,i.weight=n,i.i=Math.min(t.i,i.i),t.merged=!0}var Yt=Se,sb=Fe,cb=lb;function lb(i,t){var r=sb.partition(i,function(p){return Yt.has(p,"barycenter")}),n=r.lhs,a=Yt.sortBy(r.rhs,function(p){return-p.i}),s=[],e=0,l=0,h=0;n.sort(db(!!t)),h=_h(s,a,h),Yt.forEach(n,function(p){h+=p.vs.length,s.push(p.vs),e+=p.barycenter*p.weight,l+=p.weight,h=_h(s,a,h)});var d={vs:Yt.flatten(s,!0)};return l&&(d.barycenter=e/l,d.weight=l),d}function _h(i,t,r){for(var n;t.length&&(n=Yt.last(t)).i<=r;)t.pop(),i.push(n.vs),r++;return r}function db(i){return function(t,r){return t.barycenter<r.barycenter?-1:t.barycenter>r.barycenter?1:i?r.i-t.i:t.i-r.i}}var wt=Se,ub=tb,pb=nb,hb=cb,fb=ag;function ag(i,t,r,n){var a=i.children(t),s=i.node(t),e=s?s.borderLeft:void 0,l=s?s.borderRight:void 0,h={};e&&(a=wt.filter(a,function(m){return m!==e&&m!==l}));var d=ub(i,a);wt.forEach(d,function(m){if(i.children(m.v).length){var c=ag(i,m.v,r,n);h[m.v]=c,wt.has(c,"barycenter")&&xb(m,c)}});var p=pb(d,r);gb(p,h);var f=hb(p,n);if(e&&(f.vs=wt.flatten([e,f.vs,l],!0),i.predecessors(e).length)){var x=i.node(i.predecessors(e)[0]),g=i.node(i.predecessors(l)[0]);wt.has(f,"barycenter")||(f.barycenter=0,f.weight=0),f.barycenter=(f.barycenter*f.weight+x.order+g.order)/(f.weight+2),f.weight+=2}return f}function gb(i,t){wt.forEach(i,function(r){r.vs=wt.flatten(r.vs.map(function(n){return t[n]?t[n].vs:n}),!0)})}function xb(i,t){wt.isUndefined(i.barycenter)?(i.barycenter=t.barycenter,i.weight=t.weight):(i.barycenter=(i.barycenter*i.weight+t.barycenter*t.weight)/(i.weight+t.weight),i.weight+=t.weight)}var Ht=Se,mb=et.Graph,yb=bb;function bb(i,t,r){var n=vb(i),a=new mb({compound:!0}).setGraph({root:n}).setDefaultNodeLabel(function(s){return i.node(s)});return Ht.forEach(i.nodes(),function(s){var e=i.node(s),l=i.parent(s);(e.rank===t||e.minRank<=t&&t<=e.maxRank)&&(a.setNode(s),a.setParent(s,l||n),Ht.forEach(i[r](s),function(h){var d=h.v===s?h.w:h.v,p=a.edge(d,s),f=Ht.isUndefined(p)?0:p.weight;a.setEdge(d,s,{weight:i.edge(h).weight+f})}),Ht.has(e,"minRank")&&a.setNode(s,{borderLeft:e.borderLeft[t],borderRight:e.borderRight[t]}))}),a}function vb(i){for(var t;i.hasNode(t=Ht.uniqueId("_root")););return t}var wb=Se,Sb=kb;function kb(i,t,r){var n={},a;wb.forEach(r,function(s){for(var e=i.parent(s),l,h;e;){if(l=i.parent(e),l?(h=n[l],n[l]=e):(h=a,a=e),h&&h!==e){t.setEdge(h,e);return}e=l}})}var kt=Se,jb=Ky,Cb=Zy,Eb=fb,Mb=yb,$b=Sb,Rb=et.Graph,Ih=Fe,_b=Ib;function Ib(i){var t=Ih.maxRank(i),r=Ah(i,kt.range(1,t+1),"inEdges"),n=Ah(i,kt.range(t-1,-1,-1),"outEdges"),a=jb(i);Th(i,a);for(var s=Number.POSITIVE_INFINITY,e,l=0,h=0;h<4;++l,++h){Ab(l%2?r:n,l%4>=2),a=Ih.buildLayerMatrix(i);var d=Cb(i,a);d<s&&(h=0,e=kt.cloneDeep(a),s=d)}Th(i,e)}function Ah(i,t,r){return kt.map(t,function(n){return Mb(i,n,r)})}function Ab(i,t){var r=new Rb;kt.forEach(i,function(n){var a=n.graph().root,s=Eb(n,a,r,t);kt.forEach(s.vs,function(e,l){n.node(e).order=l}),$b(n,r,s.vs)})}function Th(i,t){kt.forEach(t,function(r){kt.forEach(r,function(n,a){i.node(n).order=a})})}var ce=Se,Tb=et.Graph,Pb=Fe,Db={positionX:Yb};function Lb(i,t){var r={};function n(a,s){var e=0,l=0,h=a.length,d=ce.last(s);return ce.forEach(s,function(p,f){var x=Bb(i,p),g=x?i.node(x).order:h;(x||p===d)&&(ce.forEach(s.slice(l,f+1),function(m){ce.forEach(i.predecessors(m),function(c){var u=i.node(c),b=u.order;(b<e||g<b)&&!(u.dummy&&i.node(m).dummy)&&sg(r,c,m)})}),l=f+1,e=g)}),s}return ce.reduce(t,n),r}function zb(i,t){var r={};function n(s,e,l,h,d){var p;ce.forEach(ce.range(e,l),function(f){p=s[f],i.node(p).dummy&&ce.forEach(i.predecessors(p),function(x){var g=i.node(x);g.dummy&&(g.order<h||g.order>d)&&sg(r,x,p)})})}function a(s,e){var l=-1,h,d=0;return ce.forEach(e,function(p,f){if(i.node(p).dummy==="border"){var x=i.predecessors(p);x.length&&(h=i.node(x[0]).order,n(e,d,f,l,h),d=f,l=h)}n(e,d,e.length,h,s.length)}),e}return ce.reduce(t,a),r}function Bb(i,t){if(i.node(t).dummy)return ce.find(i.predecessors(t),function(r){return i.node(r).dummy})}function sg(i,t,r){if(t>r){var n=t;t=r,r=n}var a=i[t];a||(i[t]=a={}),a[r]=!0}function Wb(i,t,r){if(t>r){var n=t;t=r,r=n}return ce.has(i[t],r)}function Nb(i,t,r,n){var a={},s={},e={};return ce.forEach(t,function(l){ce.forEach(l,function(h,d){a[h]=h,s[h]=h,e[h]=d})}),ce.forEach(t,function(l){var h=-1;ce.forEach(l,function(d){var p=n(d);if(p.length){p=ce.sortBy(p,function(c){return e[c]});for(var f=(p.length-1)/2,x=Math.floor(f),g=Math.ceil(f);x<=g;++x){var m=p[x];s[d]===d&&h<e[m]&&!Wb(r,d,m)&&(s[m]=d,s[d]=a[d]=a[m],h=e[m])}}})}),{root:a,align:s}}function qb(i,t,r,n,a){var s={},e=Ob(i,t,r,a),l=a?"borderLeft":"borderRight";function h(f,x){for(var g=e.nodes(),m=g.pop(),c={};m;)c[m]?f(m):(c[m]=!0,g.push(m),g=g.concat(x(m))),m=g.pop()}function d(f){s[f]=e.inEdges(f).reduce(function(x,g){return Math.max(x,s[g.v]+e.edge(g))},0)}function p(f){var x=e.outEdges(f).reduce(function(m,c){return Math.min(m,s[c.w]-e.edge(c))},Number.POSITIVE_INFINITY),g=i.node(f);x!==Number.POSITIVE_INFINITY&&g.borderType!==l&&(s[f]=Math.max(s[f],x))}return h(d,e.predecessors.bind(e)),h(p,e.successors.bind(e)),ce.forEach(n,function(f){s[f]=s[r[f]]}),s}function Ob(i,t,r,n){var a=new Tb,s=i.graph(),e=Hb(s.nodesep,s.edgesep,n);return ce.forEach(t,function(l){var h;ce.forEach(l,function(d){var p=r[d];if(a.setNode(p),h){var f=r[h],x=a.edge(f,p);a.setEdge(f,p,Math.max(e(i,d,h),x||0))}h=d})}),a}function Fb(i,t){return ce.minBy(ce.values(t),function(r){var n=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return ce.forIn(r,function(s,e){var l=Vb(i,e)/2;n=Math.max(s+l,n),a=Math.min(s-l,a)}),n-a})}function Ub(i,t){var r=ce.values(t),n=ce.min(r),a=ce.max(r);ce.forEach(["u","d"],function(s){ce.forEach(["l","r"],function(e){var l=s+e,h=i[l],d;if(h!==t){var p=ce.values(h);d=e==="l"?n-ce.min(p):a-ce.max(p),d&&(i[l]=ce.mapValues(h,function(f){return f+d}))}})})}function Gb(i,t){return ce.mapValues(i.ul,function(r,n){if(t)return i[t.toLowerCase()][n];var a=ce.sortBy(ce.map(i,n));return(a[1]+a[2])/2})}function Yb(i){var t=Pb.buildLayerMatrix(i),r=ce.merge(Lb(i,t),zb(i,t)),n={},a;ce.forEach(["u","d"],function(e){a=e==="u"?t:ce.values(t).reverse(),ce.forEach(["l","r"],function(l){l==="r"&&(a=ce.map(a,function(f){return ce.values(f).reverse()}));var h=(e==="u"?i.predecessors:i.successors).bind(i),d=Nb(i,a,r,h),p=qb(i,a,d.root,d.align,l==="r");l==="r"&&(p=ce.mapValues(p,function(f){return-f})),n[e+l]=p})});var s=Fb(i,n);return Ub(n,s),Gb(n,i.graph().align)}function Hb(i,t,r){return function(n,a,s){var e=n.node(a),l=n.node(s),h=0,d;if(h+=e.width/2,ce.has(e,"labelpos"))switch(e.labelpos.toLowerCase()){case"l":d=-e.width/2;break;case"r":d=e.width/2;break}if(d&&(h+=r?d:-d),d=0,h+=(e.dummy?t:i)/2,h+=(l.dummy?t:i)/2,h+=l.width/2,ce.has(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":d=l.width/2;break;case"r":d=-l.width/2;break}return d&&(h+=r?d:-d),d=0,h}}function Vb(i,t){return i.node(t).width}var Vt=Se,cg=Fe,Xb=Db.positionX,Kb=Qb;function Qb(i){i=cg.asNonCompoundGraph(i),Zb(i),Vt.forEach(Xb(i),function(t,r){i.node(r).x=t})}function Zb(i){var t=cg.buildLayerMatrix(i),r=i.graph().ranksep,n=0;Vt.forEach(t,function(a){var s=Vt.max(Vt.map(a,function(e){return i.node(e).height}));Vt.forEach(a,function(e){i.node(e).y=n+s/2}),n+=s+r})}var pe=Se,Ph=O0,Dh=oy,Jb=Ry,e1=Fe.normalizeRanks,t1=Ty,r1=Fe.removeEmptyRanks,Lh=zy,n1=Fy,zh=Gy,i1=_b,o1=Kb,jt=Fe,a1=et.Graph,s1=c1;function c1(i,t){var r=t&&t.debugTiming?jt.time:jt.notime;r("layout",function(){var n=r("  buildLayoutGraph",function(){return b1(i)});r("  runLayout",function(){l1(n,r)}),r("  updateInputGraph",function(){d1(i,n)})})}function l1(i,t){t("    makeSpaceForEdgeLabels",function(){v1(i)}),t("    removeSelfEdges",function(){R1(i)}),t("    acyclic",function(){Ph.run(i)}),t("    nestingGraph.run",function(){Lh.run(i)}),t("    rank",function(){Jb(jt.asNonCompoundGraph(i))}),t("    injectEdgeLabelProxies",function(){w1(i)}),t("    removeEmptyRanks",function(){r1(i)}),t("    nestingGraph.cleanup",function(){Lh.cleanup(i)}),t("    normalizeRanks",function(){e1(i)}),t("    assignRankMinMax",function(){S1(i)}),t("    removeEdgeLabelProxies",function(){k1(i)}),t("    normalize.run",function(){Dh.run(i)}),t("    parentDummyChains",function(){t1(i)}),t("    addBorderSegments",function(){n1(i)}),t("    order",function(){i1(i)}),t("    insertSelfEdges",function(){_1(i)}),t("    adjustCoordinateSystem",function(){zh.adjust(i)}),t("    position",function(){o1(i)}),t("    positionSelfEdges",function(){I1(i)}),t("    removeBorderNodes",function(){$1(i)}),t("    normalize.undo",function(){Dh.undo(i)}),t("    fixupEdgeLabelCoords",function(){E1(i)}),t("    undoCoordinateSystem",function(){zh.undo(i)}),t("    translateGraph",function(){j1(i)}),t("    assignNodeIntersects",function(){C1(i)}),t("    reversePoints",function(){M1(i)}),t("    acyclic.undo",function(){Ph.undo(i)})}function d1(i,t){pe.forEach(i.nodes(),function(r){var n=i.node(r),a=t.node(r);n&&(n.x=a.x,n.y=a.y,t.children(r).length&&(n.width=a.width,n.height=a.height))}),pe.forEach(i.edges(),function(r){var n=i.edge(r),a=t.edge(r);n.points=a.points,pe.has(a,"x")&&(n.x=a.x,n.y=a.y)}),i.graph().width=t.graph().width,i.graph().height=t.graph().height}var u1=["nodesep","edgesep","ranksep","marginx","marginy"],p1={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},h1=["acyclicer","ranker","rankdir","align"],f1=["width","height"],g1={width:0,height:0},x1=["minlen","weight","width","height","labeloffset"],m1={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},y1=["labelpos"];function b1(i){var t=new a1({multigraph:!0,compound:!0}),r=ic(i.graph());return t.setGraph(pe.merge({},p1,nc(r,u1),pe.pick(r,h1))),pe.forEach(i.nodes(),function(n){var a=ic(i.node(n));t.setNode(n,pe.defaults(nc(a,f1),g1)),t.setParent(n,i.parent(n))}),pe.forEach(i.edges(),function(n){var a=ic(i.edge(n));t.setEdge(n,pe.merge({},m1,nc(a,x1),pe.pick(a,y1)))}),t}function v1(i){var t=i.graph();t.ranksep/=2,pe.forEach(i.edges(),function(r){var n=i.edge(r);n.minlen*=2,n.labelpos.toLowerCase()!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?n.width+=n.labeloffset:n.height+=n.labeloffset)})}function w1(i){pe.forEach(i.edges(),function(t){var r=i.edge(t);if(r.width&&r.height){var n=i.node(t.v),a=i.node(t.w),s={rank:(a.rank-n.rank)/2+n.rank,e:t};jt.addDummyNode(i,"edge-proxy",s,"_ep")}})}function S1(i){var t=0;pe.forEach(i.nodes(),function(r){var n=i.node(r);n.borderTop&&(n.minRank=i.node(n.borderTop).rank,n.maxRank=i.node(n.borderBottom).rank,t=pe.max(t,n.maxRank))}),i.graph().maxRank=t}function k1(i){pe.forEach(i.nodes(),function(t){var r=i.node(t);r.dummy==="edge-proxy"&&(i.edge(r.e).labelRank=r.rank,i.removeNode(t))})}function j1(i){var t=Number.POSITIVE_INFINITY,r=0,n=Number.POSITIVE_INFINITY,a=0,s=i.graph(),e=s.marginx||0,l=s.marginy||0;function h(d){var p=d.x,f=d.y,x=d.width,g=d.height;t=Math.min(t,p-x/2),r=Math.max(r,p+x/2),n=Math.min(n,f-g/2),a=Math.max(a,f+g/2)}pe.forEach(i.nodes(),function(d){h(i.node(d))}),pe.forEach(i.edges(),function(d){var p=i.edge(d);pe.has(p,"x")&&h(p)}),t-=e,n-=l,pe.forEach(i.nodes(),function(d){var p=i.node(d);p.x-=t,p.y-=n}),pe.forEach(i.edges(),function(d){var p=i.edge(d);pe.forEach(p.points,function(f){f.x-=t,f.y-=n}),pe.has(p,"x")&&(p.x-=t),pe.has(p,"y")&&(p.y-=n)}),s.width=r-t+e,s.height=a-n+l}function C1(i){pe.forEach(i.edges(),function(t){var r=i.edge(t),n=i.node(t.v),a=i.node(t.w),s,e;r.points?(s=r.points[0],e=r.points[r.points.length-1]):(r.points=[],s=a,e=n),r.points.unshift(jt.intersectRect(n,s)),r.points.push(jt.intersectRect(a,e))})}function E1(i){pe.forEach(i.edges(),function(t){var r=i.edge(t);if(pe.has(r,"x"))switch((r.labelpos==="l"||r.labelpos==="r")&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}})}function M1(i){pe.forEach(i.edges(),function(t){var r=i.edge(t);r.reversed&&r.points.reverse()})}function $1(i){pe.forEach(i.nodes(),function(t){if(i.children(t).length){var r=i.node(t),n=i.node(r.borderTop),a=i.node(r.borderBottom),s=i.node(pe.last(r.borderLeft)),e=i.node(pe.last(r.borderRight));r.width=Math.abs(e.x-s.x),r.height=Math.abs(a.y-n.y),r.x=s.x+r.width/2,r.y=n.y+r.height/2}}),pe.forEach(i.nodes(),function(t){i.node(t).dummy==="border"&&i.removeNode(t)})}function R1(i){pe.forEach(i.edges(),function(t){if(t.v===t.w){var r=i.node(t.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:t,label:i.edge(t)}),i.removeEdge(t)}})}function _1(i){var t=jt.buildLayerMatrix(i);pe.forEach(t,function(r){var n=0;pe.forEach(r,function(a,s){var e=i.node(a);e.order=s+n,pe.forEach(e.selfEdges,function(l){jt.addDummyNode(i,"selfedge",{width:l.label.width,height:l.label.height,rank:e.rank,order:s+ ++n,e:l.e,label:l.label},"_se")}),delete e.selfEdges})})}function I1(i){pe.forEach(i.nodes(),function(t){var r=i.node(t);if(r.dummy==="selfedge"){var n=i.node(r.e.v),a=n.x+n.width/2,s=n.y,e=r.x-a,l=n.height/2;i.setEdge(r.e,r.label),i.removeNode(t),r.label.points=[{x:a+2*e/3,y:s-l},{x:a+5*e/6,y:s-l},{x:a+e,y:s},{x:a+5*e/6,y:s+l},{x:a+2*e/3,y:s+l}],r.label.x=r.x,r.label.y=r.y}})}function nc(i,t){return pe.mapValues(pe.pick(i,t),Number)}function ic(i){var t={};return pe.forEach(i,function(r,n){t[n.toLowerCase()]=r}),t}var Sr=Se,A1=Fe,T1=et.Graph,P1={debugOrdering:D1};function D1(i){var t=A1.buildLayerMatrix(i),r=new T1({compound:!0,multigraph:!0}).setGraph({});return Sr.forEach(i.nodes(),function(n){r.setNode(n,{label:n}),r.setParent(n,"layer"+i.node(n).rank)}),Sr.forEach(i.edges(),function(n){r.setEdge(n.v,n.w,{},n.name)}),Sr.forEach(t,function(n,a){var s="layer"+a;r.setNode(s,{rank:"same"}),Sr.reduce(n,function(e,l){return r.setEdge(e,l,{style:"invis"}),l})}),r}var L1="0.8.5",z1={graphlib:et,layout:s1,debug:P1,util:{time:Fe.time,notime:Fe.notime},version:L1};const Bh=qg(z1);async function B1(i,t=[]){throw new Error("OpenAI API key not configured. Please set VITE_OPENAI_API_KEY in .env")}function Rr(i){const t=i.match(/<!--\s*type:\s*(\w+)\s*-->/);return t?t[1]:"flowchart"}function W1(i){const t=i.match(/<!--\s*name:\s*(.+?)\s*-->/);return t?t[1].trim():null}function N1(i){const t=i.match(/<!--\s*alternatives:\s*(.+?)\s*-->/);if(!t)return[];const r=t[1].trim().toLowerCase();return r==="none"?[]:r.split(/[,\s]+/).map(n=>n.trim()).filter(n=>n&&n!=="none")}function _r(i){return i.replace(/<!--\s*type:\s*\w+\s*-->\n?/g,"").replace(/<!--\s*name:\s*.+?\s*-->\n?/g,"").replace(/<!--\s*alternatives:\s*.+?\s*-->\n?/g,"").trim()}async function q1(i,t=[]){let r;r=await B1(i,t);const n=Rr(r),a=_r(r);return{type:n,dsl:a,raw:r}}function Dt(){return!1}function O1(){return"GPT-4"}async function Ic(i,t){return F1()}async function F1(i,t){throw new Error("OpenAI API key not configured. Please set VITE_OPENAI_API_KEY in .env")}async function U1(i,t){return await Ic()}async function G1(i,t){const r=await Ic(),n=r.split("---EXPLANATION---");if(n.length===2){const s=n[0].trim(),e=n[1].trim(),l=Rr(s)||t;return{dsl:_r(s),type:l,explanation:e,raw:r}}return r.match(/<!--\s*type:\s*(\w+)\s*-->/)?{dsl:_r(r),type:Rr(r),explanation:"Improvements applied.",raw:r}:{dsl:i,type:t,explanation:r,raw:r}}async function Y1(i,t){const r=await Ic();try{const n=r.match(/\{[\s\S]*\}/);return n?JSON.parse(n[0]):{isValid:!0,errors:[],warnings:["Could not parse validation response"],suggestions:[r]}}catch{return{isValid:!0,errors:[],warnings:["Validation response was not in expected format"],suggestions:[r]}}}async function H1(i,t){throw new Error("OpenAI API key not configured. Please set VITE_OPENAI_API_KEY in .env")}function V1(i){if(!i.includes("->"))return i;let t=i.replace(/->\s*\n\s*/g,"-> ");t=t.replace(/,\s*\n\s*(?![A-Z])/g,", ");const r=t.split(`
`).filter(p=>p.trim()),n=new Map,a=new Set,s=new Set;r.forEach(p=>{const f=p.match(/^(.+?)\s*->\s*(.+)$/);if(f){const x=f[1].trim(),m=f[2].trim().split(",").map(c=>c.trim()).filter(c=>c);a.add(x),m.forEach(c=>{a.add(c),s.add(c)}),n.has(x)||n.set(x,[]),n.get(x).push(...m)}else p.trim()&&!p.includes("->")&&a.add(p.trim())});const e=[...a].filter(p=>!s.has(p));if(e.length===0)return i;const l=[],h=new Set;function d(p,f){if(h.has(p))return;h.add(p),l.push("  ".repeat(f)+p),(n.get(p)||[]).forEach(g=>d(g,f+1))}return e.forEach(p=>d(p,0)),l.join(`
`)}function X1(i){if(!/^\s*\(([^)]+)\)\s+\1\s*$/m.test(i))return{dsl:i,convertToMindmap:!1};const r=i.split(`
`).filter(p=>p.trim()),n=new Map,a=new Set,s=new Set;r.forEach(p=>{const f=p.match(/^\s*\(([^)]+)\)\s+\1\s*->\s*\(([^)]+)\)\s+\2\s*$/);if(f){const x=f[1].trim(),g=f[2].trim();a.add(x),a.add(g),s.add(g),n.has(x)||n.set(x,[]),n.get(x).push(g)}else{const x=p.match(/^\s*\(([^)]+)\)\s+\1\s*$/);x&&a.add(x[1].trim())}});const e=[...a].filter(p=>!s.has(p));if(e.length===0)return{dsl:i,convertToMindmap:!1};const l=[],h=new Set;function d(p,f){if(h.has(p))return;h.add(p),l.push("  ".repeat(f)+p),(n.get(p)||[]).forEach(g=>d(g,f+1))}return e.forEach(p=>d(p,0)),{dsl:l.join(`
`),convertToMindmap:!0}}async function K1(i,t="image/png"){let r;r=await H1();let n=Rr(r),a=_r(r);const s=W1(r);let e=N1(r);if((n==="mindmap"||n==="orgchart")&&a.includes("->")&&(a=V1(a)),n==="flowchart"){const l=X1(a);l.convertToMindmap&&(e.includes("flowchart")||(e=["flowchart",...e]),n="mindmap",a=l.dsl)}return e=e.filter(l=>l!==n),{type:n,name:s||"Imported Diagram",alternatives:e,dsl:a,raw:r}}const Ot={purple:"#7C3AED",green:"#10B981"};function Q1({onApplyDiagram:i,isOpen:t,onClose:r}){const[n,a]=M.useState([]),[s,e]=M.useState(""),[l,h]=M.useState(!1),[d,p]=M.useState(null),f=M.useRef(null),x=M.useRef(null),g=()=>{var w;(w=f.current)==null||w.scrollIntoView({behavior:"smooth"})};M.useEffect(()=>{g()},[n]),M.useEffect(()=>{t&&x.current&&x.current.focus()},[t]);const m=async w=>{if(w.preventDefault(),!s.trim()||l)return;const k=s.trim();e(""),p(null),a(j=>[...j,{role:"user",content:k}]),h(!0);try{const j=n.map(E=>({role:E.role,content:E.content})),C=await q1(k,j);a(E=>[...E,{role:"assistant",content:C.raw,type:C.type,dsl:C.dsl}])}catch(j){p(j.message),a(C=>[...C,{role:"error",content:j.message}])}finally{h(!1)}},c=w=>{w.dsl&&w.type&&i(w.type,w.dsl)},u=async w=>{try{await navigator.clipboard.writeText(w)}catch(k){console.error("Failed to copy:",k)}},b=()=>{a([]),p(null)};if(!t)return null;const y=Dt(),S=O1();return o.jsxs("div",{style:{position:"fixed",right:0,top:0,bottom:0,width:"380px",background:"rgba(10, 10, 15, 0.98)",borderLeft:"1px solid rgba(124, 58, 237, 0.3)",display:"flex",flexDirection:"column",zIndex:1e3,backdropFilter:"blur(20px)"},children:[o.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(124, 58, 237, 0.1)"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[o.jsx("span",{style:{fontSize:"20px"},children:""}),o.jsxs("div",{children:[o.jsx("div",{style:{color:"#fff",fontWeight:600,fontSize:"14px"},children:"AI Diagram Assistant"}),o.jsxs("div",{style:{color:"#888",fontSize:"11px"},children:["Powered by ",S]})]})]}),o.jsxs("div",{style:{display:"flex",gap:"8px"},children:[o.jsx("button",{onClick:b,style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"6px",padding:"6px 10px",color:"#888",cursor:"pointer",fontSize:"12px"},title:"Clear chat",children:"Clear"}),o.jsx("button",{onClick:r,style:{background:"transparent",border:"none",color:"#888",cursor:"pointer",fontSize:"18px",padding:"4px 8px"},children:""})]})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[!y&&o.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",padding:"12px",color:"#f87171",fontSize:"13px"},children:[o.jsx("strong",{children:"API Key Required"}),o.jsxs("p",{style:{margin:"8px 0 0 0",color:"#fca5a5"},children:["Please configure your API key in ",o.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:".env"})," file. Copy ",o.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:".env.example"})," to ",o.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:".env"})," and add your key."]})]}),n.length===0&&y&&o.jsxs("div",{style:{textAlign:"center",color:"#666",padding:"40px 20px"},children:[o.jsx("div",{style:{fontSize:"40px",marginBottom:"16px"},children:""}),o.jsx("div",{style:{fontSize:"14px",marginBottom:"8px"},children:"Describe the diagram you want to create"}),o.jsx("div",{style:{fontSize:"12px",color:"#555"},children:'Try: "Create a flowchart for user login with email verification"'})]}),n.map((w,k)=>o.jsx("div",{style:{alignSelf:w.role==="user"?"flex-end":"flex-start",maxWidth:"90%"},children:w.role==="user"?o.jsx("div",{style:{background:"linear-gradient(135deg, #7C3AED, #6366F1)",borderRadius:"12px 12px 4px 12px",padding:"10px 14px",color:"#fff",fontSize:"13px"},children:w.content}):w.role==="error"?o.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px 12px 12px 4px",padding:"10px 14px",color:"#f87171",fontSize:"13px"},children:[" ",w.content]}):o.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px 12px 12px 4px",padding:"12px",width:"100%"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[o.jsx("span",{style:{background:`${Ot.purple}30`,color:Ot.purple,padding:"3px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:600,textTransform:"uppercase"},children:w.type}),o.jsxs("div",{style:{display:"flex",gap:"6px"},children:[o.jsx("button",{onClick:()=>u(w.dsl),style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"4px",padding:"4px 8px",color:"#888",cursor:"pointer",fontSize:"11px"},children:"Copy"}),o.jsx("button",{onClick:()=>c(w),style:{background:Ot.green,border:"none",borderRadius:"4px",padding:"4px 10px",color:"#fff",cursor:"pointer",fontSize:"11px",fontWeight:600},children:"Apply"})]})]}),o.jsx("pre",{style:{background:"rgba(0,0,0,0.3)",borderRadius:"6px",padding:"10px",margin:0,fontSize:"11px",color:"#e0e0e0",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto",fontFamily:"Monaco, Consolas, monospace"},children:w.dsl})]})},k)),l&&o.jsxs("div",{style:{alignSelf:"flex-start",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px 12px 12px 4px",padding:"12px 16px",display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("div",{style:{width:"8px",height:"8px",background:Ot.purple,borderRadius:"50%",animation:"pulse 1s infinite"}}),o.jsx("span",{style:{color:"#888",fontSize:"13px"},children:"Generating diagram..."}),o.jsx("style",{children:`
              @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.3; }
              }
            `})]}),o.jsx("div",{ref:f})]}),o.jsxs("form",{onSubmit:m,style:{padding:"16px",borderTop:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.2)"},children:[o.jsxs("div",{style:{display:"flex",gap:"8px"},children:[o.jsx("input",{ref:x,type:"text",value:s,onChange:w=>e(w.target.value),placeholder:y?"Describe your diagram...":"Configure API key first",disabled:!y||l,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"12px 14px",color:"#fff",fontSize:"13px",outline:"none"}}),o.jsx("button",{type:"submit",disabled:!y||l||!s.trim(),style:{background:y&&s.trim()?Ot.purple:"rgba(255,255,255,0.1)",border:"none",borderRadius:"8px",padding:"12px 16px",color:y&&s.trim()?"#fff":"#666",cursor:y&&s.trim()?"pointer":"not-allowed",fontSize:"14px"},children:l?"...":""})]}),o.jsx("div",{style:{marginTop:"8px",fontSize:"11px",color:"#555",textAlign:"center"},children:"Press Enter to send  Supports all 22 diagram types"})]})]})}const Ac={CUSTOM_TEMPLATES:"ddflow_custom_templates"},Z={FLOWCHARTS:"Flowcharts",ARCHITECTURE:"Architecture",DATA_MODELING:"Data Modeling",PROJECT_MANAGEMENT:"Project Management",SOFTWARE_DESIGN:"Software Design",BUSINESS:"Business",NETWORK:"Network",UI_DESIGN:"UI Design",APP_BUNDLES:"App Bundles"},Tc=[{id:"login-flow",name:"User Login Flow",description:"Authentication flow with validation and error handling",category:Z.FLOWCHARTS,type:"flowchart",thumbnail:"flowchart",source:`(start) Start
Start -> (io) Enter Credentials
Enter Credentials -> (process) Validate Input
Validate Input -> (decision) Valid Format?
Valid Format? -> (process) Check Database: Yes
Valid Format? -> (io) Show Format Error: No
Show Format Error -> Enter Credentials
Check Database -> (decision) User Exists?
User Exists? -> (decision) Password Correct?: Yes
User Exists? -> (io) Show User Error: No
Show User Error -> Enter Credentials
Password Correct? -> (process) Create Session: Yes
Password Correct? -> (io) Show Auth Error: No
Show Auth Error -> Enter Credentials
Create Session -> (end) Dashboard`},{id:"order-process",name:"Order Processing",description:"E-commerce order flow from cart to delivery",category:Z.FLOWCHARTS,type:"flowchart",thumbnail:"flowchart",source:`(start) Cart
Cart -> (process) Calculate Total
Calculate Total -> (io) Enter Shipping
Enter Shipping -> (io) Enter Payment
Enter Payment -> (decision) Payment Valid?
Payment Valid? -> (process) Process Payment: Yes
Payment Valid? -> (io) Show Error: No
Show Error -> Enter Payment
Process Payment -> (decision) Payment Success?
Payment Success? -> (process) Create Order: Yes
Payment Success? -> (io) Payment Failed: No
Payment Failed -> Enter Payment
Create Order -> (io) Send Confirmation
Send Confirmation -> (process) Prepare Shipment
Prepare Shipment -> (end) Delivered`},{id:"approval-workflow",name:"Approval Workflow",description:"Multi-level approval process with escalation",category:Z.FLOWCHARTS,type:"flowchart",thumbnail:"flowchart",source:`(start) Submit Request
Submit Request -> (process) Initial Review
Initial Review -> (decision) Meets Criteria?
Meets Criteria? -> (process) Manager Review: Yes
Meets Criteria? -> (io) Return for Revision: No
Return for Revision -> Submit Request
Manager Review -> (decision) Manager Approves?
Manager Approves? -> (decision) Above Threshold?: Yes
Manager Approves? -> (io) Rejected: No
Rejected -> (end) Closed
Above Threshold? -> (process) Director Review: Yes
Above Threshold? -> (process) Approved: No
Director Review -> (decision) Director Approves?
Director Approves? -> Approved: Yes
Director Approves? -> Rejected: No
Approved -> (end) Complete`},{id:"bug-triage",name:"Bug Triage Process",description:"Software bug reporting and resolution workflow",category:Z.FLOWCHARTS,type:"flowchart",thumbnail:"flowchart",source:`(start) Bug Reported
Bug Reported -> (process) Reproduce Issue
Reproduce Issue -> (decision) Reproducible?
Reproducible? -> (process) Classify Severity: Yes
Reproducible? -> (io) Request More Info: No
Request More Info -> Bug Reported
Classify Severity -> (decision) Critical?
Critical? -> (process) Assign Senior Dev: Yes
Critical? -> (decision) High Priority?: No
High Priority? -> (process) Add to Sprint: Yes
High Priority? -> (process) Add to Backlog: No
Add to Backlog -> (end) Queued
Assign Senior Dev -> (process) Fix Bug
Add to Sprint -> Fix Bug
Fix Bug -> (process) Code Review
Code Review -> (decision) Approved?
Approved? -> (process) Deploy Fix: Yes
Approved? -> Fix Bug: No
Deploy Fix -> (process) Verify Fix
Verify Fix -> (end) Resolved`},{id:"microservices",name:"Microservices Architecture",description:"Modern microservices with API gateway and message queue",category:Z.ARCHITECTURE,type:"architecture",thumbnail:"architecture",source:`[clients] Web App, Mobile App, Third-Party
[gateway] API Gateway, Load Balancer
[services] Auth Service, User Service, Product Service, Order Service, Payment Service, Notification Service
[queue] RabbitMQ, Redis Cache
[data] PostgreSQL, MongoDB, Elasticsearch

Web App -> API Gateway
Mobile App -> API Gateway
Third-Party -> API Gateway
API Gateway -> Load Balancer
Load Balancer -> Auth Service
Load Balancer -> User Service
Load Balancer -> Product Service
Load Balancer -> Order Service
Auth Service -> Redis Cache
User Service -> PostgreSQL
Product Service -> MongoDB
Product Service -> Elasticsearch
Order Service -> PostgreSQL
Order Service -> RabbitMQ
Payment Service -> RabbitMQ
Notification Service -> RabbitMQ`},{id:"serverless",name:"Serverless Architecture",description:"AWS serverless architecture with Lambda and DynamoDB",category:Z.ARCHITECTURE,type:"architecture",thumbnail:"architecture",source:`[clients] Web Client, Mobile Client
[gateway] API Gateway, CloudFront CDN
[services] Auth Lambda, API Lambda, Worker Lambda
[queue] SQS Queue, SNS Topics
[storage] S3 Bucket
[data] DynamoDB, ElastiCache

Web Client -> CloudFront CDN
Mobile Client -> API Gateway
CloudFront CDN -> S3 Bucket
API Gateway -> Auth Lambda
API Gateway -> API Lambda
Auth Lambda -> DynamoDB
API Lambda -> DynamoDB
API Lambda -> ElastiCache
API Lambda -> SQS Queue
SQS Queue -> Worker Lambda
Worker Lambda -> SNS Topics
Worker Lambda -> S3 Bucket`},{id:"event-driven",name:"Event-Driven Architecture",description:"Event sourcing with CQRS pattern",category:Z.ARCHITECTURE,type:"architecture",thumbnail:"architecture",source:`[clients] Web UI, Admin Dashboard
[gateway] API Gateway
[services] Command Handler, Event Processor, Query Handler, Saga Orchestrator
[queue] Event Bus, Command Queue
[data] Event Store, Read Database, Projections

Web UI -> API Gateway
Admin Dashboard -> API Gateway
API Gateway -> Command Handler
API Gateway -> Query Handler
Command Handler -> Command Queue
Command Queue -> Event Processor
Event Processor -> Event Bus
Event Processor -> Event Store
Event Bus -> Saga Orchestrator
Event Bus -> Projections
Projections -> Read Database
Query Handler -> Read Database`},{id:"three-tier",name:"Three-Tier Application",description:"Traditional three-tier web application",category:Z.ARCHITECTURE,type:"architecture",thumbnail:"architecture",source:`[clients] Browser, Mobile App
[gateway] Load Balancer
[services] Web Server, Application Server, Background Jobs
[cache] Redis Cache, Session Store
[data] Primary Database, Read Replica, File Storage

Browser -> Load Balancer
Mobile App -> Load Balancer
Load Balancer -> Web Server
Web Server -> Application Server
Application Server -> Redis Cache
Application Server -> Session Store
Application Server -> Primary Database
Application Server -> Background Jobs
Primary Database -> Read Replica
Background Jobs -> File Storage`},{id:"ecommerce-erd",name:"E-Commerce Database",description:"Complete e-commerce database schema",category:Z.DATA_MODELING,type:"erd",thumbnail:"erd",source:`CREATE TABLE users (
  id UUID PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  password_hash VARCHAR(255),
  first_name VARCHAR(100),
  last_name VARCHAR(100),
  phone VARCHAR(20),
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

CREATE TABLE addresses (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  type VARCHAR(20),
  street VARCHAR(255),
  city VARCHAR(100),
  state VARCHAR(100),
  postal_code VARCHAR(20),
  country VARCHAR(100),
  is_default BOOLEAN
);

CREATE TABLE categories (
  id UUID PRIMARY KEY,
  name VARCHAR(100),
  slug VARCHAR(100),
  parent_id UUID REFERENCES categories(id),
  description TEXT
);

CREATE TABLE products (
  id UUID PRIMARY KEY,
  category_id UUID REFERENCES categories(id),
  name VARCHAR(255),
  slug VARCHAR(255),
  description TEXT,
  price DECIMAL(10,2),
  stock_quantity INTEGER,
  is_active BOOLEAN,
  created_at TIMESTAMP
);

CREATE TABLE orders (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  shipping_address_id UUID REFERENCES addresses(id),
  status VARCHAR(50),
  subtotal DECIMAL(10,2),
  tax DECIMAL(10,2),
  shipping_cost DECIMAL(10,2),
  total DECIMAL(10,2),
  created_at TIMESTAMP
);

CREATE TABLE order_items (
  id UUID PRIMARY KEY,
  order_id UUID REFERENCES orders(id),
  product_id UUID REFERENCES products(id),
  quantity INTEGER,
  unit_price DECIMAL(10,2),
  total_price DECIMAL(10,2)
);`},{id:"blog-erd",name:"Blog Platform Database",description:"Blog with posts, comments, and tags",category:Z.DATA_MODELING,type:"erd",thumbnail:"erd",source:`CREATE TABLE authors (
  id UUID PRIMARY KEY,
  username VARCHAR(50) UNIQUE,
  email VARCHAR(255) UNIQUE,
  bio TEXT,
  avatar_url VARCHAR(500),
  created_at TIMESTAMP
);

CREATE TABLE posts (
  id UUID PRIMARY KEY,
  author_id UUID REFERENCES authors(id),
  title VARCHAR(255),
  slug VARCHAR(255) UNIQUE,
  content TEXT,
  excerpt TEXT,
  status VARCHAR(20),
  published_at TIMESTAMP,
  created_at TIMESTAMP
);

CREATE TABLE tags (
  id UUID PRIMARY KEY,
  name VARCHAR(50),
  slug VARCHAR(50) UNIQUE
);

CREATE TABLE post_tags (
  post_id UUID REFERENCES posts(id),
  tag_id UUID REFERENCES tags(id),
  PRIMARY KEY (post_id, tag_id)
);

CREATE TABLE comments (
  id UUID PRIMARY KEY,
  post_id UUID REFERENCES posts(id),
  author_id UUID REFERENCES authors(id),
  parent_id UUID REFERENCES comments(id),
  content TEXT,
  is_approved BOOLEAN,
  created_at TIMESTAMP
);`},{id:"saas-erd",name:"SaaS Multi-Tenant Database",description:"Multi-tenant SaaS application schema",category:Z.DATA_MODELING,type:"erd",thumbnail:"erd",source:`CREATE TABLE organizations (
  id UUID PRIMARY KEY,
  name VARCHAR(255),
  slug VARCHAR(100) UNIQUE,
  plan VARCHAR(50),
  status VARCHAR(20),
  created_at TIMESTAMP
);

CREATE TABLE users (
  id UUID PRIMARY KEY,
  org_id UUID REFERENCES organizations(id),
  email VARCHAR(255),
  role VARCHAR(50),
  status VARCHAR(20),
  last_login_at TIMESTAMP,
  created_at TIMESTAMP
);

CREATE TABLE subscriptions (
  id UUID PRIMARY KEY,
  org_id UUID REFERENCES organizations(id),
  plan VARCHAR(50),
  status VARCHAR(20),
  current_period_start TIMESTAMP,
  current_period_end TIMESTAMP,
  stripe_subscription_id VARCHAR(255)
);

CREATE TABLE invoices (
  id UUID PRIMARY KEY,
  org_id UUID REFERENCES organizations(id),
  subscription_id UUID REFERENCES subscriptions(id),
  amount DECIMAL(10,2),
  status VARCHAR(20),
  due_date DATE,
  paid_at TIMESTAMP
);

CREATE TABLE audit_logs (
  id UUID PRIMARY KEY,
  org_id UUID REFERENCES organizations(id),
  user_id UUID REFERENCES users(id),
  action VARCHAR(100),
  resource_type VARCHAR(50),
  resource_id UUID,
  metadata JSONB,
  created_at TIMESTAMP
);`},{id:"product-roadmap",name:"Product Roadmap",description:"Quarterly product development roadmap",category:Z.PROJECT_MANAGEMENT,type:"timeline",thumbnail:"timeline",source:`[Q1 2025] *Kickoff | Project initiation and team assembly
[Q1 2025] Research Phase | Market analysis and user research
[Q1 2025] Design Sprint | UI/UX design and prototyping
[Q2 2025] *MVP Development | Core feature implementation
[Q2 2025] Internal Testing | QA and bug fixes
[Q2 2025] *Beta Launch | Limited release to beta users
[Q3 2025] User Feedback | Collect and analyze feedback
[Q3 2025] Feature Iteration | Implement improvements
[Q3 2025] *Public Launch | Version 1.0 release
[Q4 2025] Growth Phase | Marketing and user acquisition
[Q4 2025] Feature Expansion | New features development
[Q4 2025] *Scale | Infrastructure optimization`},{id:"sprint-gantt",name:"Sprint Planning",description:"2-week sprint with tasks and dependencies",category:Z.PROJECT_MANAGEMENT,type:"gantt",thumbnail:"gantt",source:`Sprint Planning, 0, 0.5, 100
Backlog Refinement, 0.5, 0.5, 100
Design Review, 1, 1, 100
API Development, 2, 3, 75
Frontend Development, 3, 4, 50
Integration, 5, 2, 25
Unit Testing, 6, 2, 10
QA Testing, 7, 2, 0
Bug Fixes, 8, 1, 0
Code Review, 9, 1, 0
Sprint Review, 9.5, 0.5, 0
Retrospective, 10, 0.5, 0`},{id:"project-wbs",name:"Project Work Breakdown",description:"Work breakdown structure for project planning",category:Z.PROJECT_MANAGEMENT,type:"wbs",thumbnail:"mindmap",source:`Project Launch
  Planning
    Requirements Gathering
    Scope Definition
    Resource Allocation
    Timeline Creation
  Design
    Architecture Design
    Database Design
    UI/UX Design
    API Design
  Development
    Backend
      Core Services
      Database Layer
      API Endpoints
    Frontend
      Components
      State Management
      API Integration
  Testing
    Unit Tests
    Integration Tests
    Performance Tests
    Security Tests
  Deployment
    Environment Setup
    CI/CD Pipeline
    Monitoring
    Documentation`},{id:"team-org",name:"Development Team Structure",description:"Software development team organization",category:Z.PROJECT_MANAGEMENT,type:"orgchart",thumbnail:"orgchart",source:`VP of Engineering [Executive]
  Engineering Manager [Management]
    Tech Lead - Backend [Leadership]
      Senior Backend Dev
      Backend Developer
      Backend Developer
    Tech Lead - Frontend [Leadership]
      Senior Frontend Dev
      Frontend Developer
      Frontend Developer
    Tech Lead - DevOps [Leadership]
      DevOps Engineer
      SRE Engineer
  QA Manager [Management]
    QA Lead [Leadership]
      Senior QA Engineer
      QA Engineer
      QA Engineer
  Product Manager [Product]
    UX Designer
    Technical Writer`},{id:"api-sequence",name:"REST API Flow",description:"API request/response with authentication",category:Z.SOFTWARE_DESIGN,type:"sequence",thumbnail:"sequence",source:`participant Client, API Gateway, Auth Service, User Service, Database

Client -> API Gateway: POST /api/users
API Gateway -> Auth Service: Validate JWT
Auth Service --> API Gateway: Token Valid
API Gateway -> User Service: Create User Request
User Service -> Database: INSERT user
Database --> User Service: User Record
User Service -> Database: INSERT audit_log
Database --> User Service: OK
User Service --> API Gateway: User Created Response
API Gateway --> Client: 201 Created + User JSON`},{id:"oauth-sequence",name:"OAuth 2.0 Flow",description:"OAuth authorization code flow",category:Z.SOFTWARE_DESIGN,type:"sequence",thumbnail:"sequence",source:`participant User, Client App, Auth Server, Resource Server

User -> Client App: Click Login
Client App -> Auth Server: Authorization Request
Auth Server -> User: Login Page
User -> Auth Server: Credentials
Auth Server --> User: Authorization Code
User -> Client App: Redirect with Code
Client App -> Auth Server: Exchange Code for Token
Auth Server --> Client App: Access Token + Refresh Token
Client App -> Resource Server: API Request + Access Token
Resource Server --> Client App: Protected Resource
Client App --> User: Display Data`},{id:"order-state",name:"Order State Machine",description:"E-commerce order lifecycle states",category:Z.SOFTWARE_DESIGN,type:"state",thumbnail:"state",source:`(initial) Draft
(final) Completed
(final) Cancelled
(final) Refunded

Draft -> Pending: SUBMIT_ORDER
Pending -> Confirmed: PAYMENT_SUCCESS
Pending -> Cancelled: PAYMENT_FAILED
Pending -> Cancelled: CANCEL_ORDER
Confirmed -> Processing: START_PROCESSING
Processing -> Shipped: SHIP_ORDER
Shipped -> Delivered: CONFIRM_DELIVERY
Delivered -> Completed: CLOSE_ORDER
Delivered -> Refunded: REQUEST_REFUND
Confirmed -> Cancelled: CANCEL_ORDER`},{id:"user-classes",name:"User Management Classes",description:"OOP class diagram for user system",category:Z.SOFTWARE_DESIGN,type:"class",thumbnail:"class",source:`class User
  + id: UUID
  + email: string
  + username: string
  - passwordHash: string
  + role: Role
  + createdAt: Date
  + login(password): boolean
  + updateProfile(data): void
  # hashPassword(plain): string

class Role
  + id: UUID
  + name: string
  + permissions: Permission[]
  + hasPermission(action): boolean

class Permission
  + id: UUID
  + name: string
  + resource: string
  + action: string

class AuthService
  - userRepo: UserRepository
  - tokenService: TokenService
  + authenticate(email, password): Token
  + register(userData): User
  + refreshToken(token): Token
  - validatePassword(plain, hash): boolean`},{id:"shopping-usecase",name:"E-Commerce Use Cases",description:"Online shopping use case diagram",category:Z.SOFTWARE_DESIGN,type:"usecase",thumbnail:"usecase",source:`actor Customer
actor Admin
actor Payment System

(Browse Products)
(Search Products)
(Add to Cart)
(Checkout)
(Process Payment)
(View Order History)
(Manage Products)
(Manage Orders)
(Generate Reports)

Customer -> Browse Products
Customer -> Search Products
Customer -> Add to Cart
Customer -> Checkout
Customer -> View Order History
Checkout -> Process Payment
Payment System -> Process Payment
Admin -> Manage Products
Admin -> Manage Orders
Admin -> Generate Reports`},{id:"c4-system",name:"C4 System Context",description:"C4 model system context diagram",category:Z.SOFTWARE_DESIGN,type:"c4",thumbnail:"c4",source:`[person] Customer: A registered user of the system
[person] Admin: System administrator
[system] E-Commerce Platform: Main application for online shopping
[container] Web Application: React SPA
[container] Mobile App: iOS/Android app
[container] API Server: Node.js backend
[container] Database: PostgreSQL
[external] Payment Gateway: Stripe
[external] Email Service: SendGrid
[external] Analytics: Google Analytics

Customer -> Web Application: Browse and purchase
Customer -> Mobile App: Browse and purchase
Admin -> Web Application: Manage system
Web Application -> API Server: API calls
Mobile App -> API Server: API calls
API Server -> Database: Read/Write data
API Server -> Payment Gateway: Process payments
API Server -> Email Service: Send notifications
Web Application -> Analytics: Track events`},{id:"customer-journey",name:"Customer Onboarding Journey",description:"New customer onboarding experience map",category:Z.BUSINESS,type:"journey",thumbnail:"journey",source:`[actor] New Customer
[page] Landing Page
[action] Sign Up
[form] Registration Form
[email] Welcome Email
[page] Dashboard
[action] Complete Profile
[action] Watch Tutorial
[milestone] First Action
[notification] Tips Notification
[success] Fully Onboarded

New Customer -> Landing Page
Landing Page -browses-> Sign Up
Sign Up -> Registration Form
Registration Form -submits-> Welcome Email
Welcome Email -clicks link-> Dashboard
Dashboard -> Complete Profile
Dashboard -> Watch Tutorial
Complete Profile -> First Action
Watch Tutorial -> First Action
First Action -> Tips Notification
Tips Notification -> Fully Onboarded`},{id:"priority-quadrant",name:"Priority Matrix",description:"Eisenhower matrix for task prioritization",category:Z.BUSINESS,type:"quadrant",thumbnail:"quadrant",source:`title: Priority Matrix
x-axis: Urgency ->
y-axis: Importance ->
quadrant-1: Do First
quadrant-2: Schedule
quadrant-3: Delegate
quadrant-4: Eliminate

Customer Bug Fix: [85, 90]
Security Patch: [90, 95]
Feature Request A: [25, 85]
Code Refactoring: [20, 70]
Documentation: [30, 60]
Meeting Prep: [75, 40]
Email Responses: [80, 30]
Social Media: [15, 15]`},{id:"market-pie",name:"Market Share Analysis",description:"Pie chart for market distribution",category:Z.BUSINESS,type:"pie",thumbnail:"pie",source:`"Our Product": 28
"Competitor A": 25
"Competitor B": 20
"Competitor C": 15
"Others": 12`},{id:"requirements",name:"System Requirements",description:"Requirement specification with traceability",category:Z.BUSINESS,type:"requirement",thumbnail:"requirement",source:`requirement User Authentication {
  text: System shall authenticate users via email and password
  risk: High
  priority: Critical
}

requirement Password Security {
  text: Passwords must be hashed using bcrypt with cost factor 12
  risk: High
  priority: Critical
}

requirement Session Management {
  text: Sessions expire after 24 hours of inactivity
  risk: Medium
  priority: High
}

requirement Multi-Factor Auth {
  text: System shall support TOTP-based 2FA
  risk: Medium
  priority: Medium
}

requirement Rate Limiting {
  text: Login attempts limited to 5 per minute per IP
  risk: Low
  priority: High
}

User Authentication -> Password Security: derives
User Authentication -> Session Management: traces
User Authentication -> Multi-Factor Auth: refines
Password Security -> Rate Limiting: traces`},{id:"corporate-network",name:"Corporate Network",description:"Enterprise network with DMZ and internal zones",category:Z.NETWORK,type:"network",thumbnail:"network",source:`[cloud] Internet
[firewall] Edge Firewall (10.0.0.1)
[router] Core Router (10.0.0.2)
[firewall] Internal Firewall (10.0.1.1)
[switch] DMZ Switch (10.0.2.1)
[switch] Internal Switch (10.1.0.1)
[server] Web Server (10.0.2.10)
[server] Mail Server (10.0.2.11)
[server] App Server (10.1.0.10)
[server] Database Server (10.1.0.11)
[server] File Server (10.1.0.12)
[computer] Workstations (10.1.1.0/24)

Internet -- Edge Firewall
Edge Firewall -- Core Router
Core Router -- DMZ Switch
Core Router -- Internal Firewall
DMZ Switch -- Web Server: HTTPS
DMZ Switch -- Mail Server: SMTP
Internal Firewall -- Internal Switch
Internal Switch -- App Server
Internal Switch -- Database Server: TCP
Internal Switch -- File Server: SMB
Internal Switch -- Workstations`},{id:"cloud-vpc",name:"Cloud VPC Architecture",description:"AWS VPC with public and private subnets",category:Z.NETWORK,type:"network",thumbnail:"network",source:`[cloud] AWS Region
[router] Internet Gateway
[router] NAT Gateway (10.0.1.100)
[switch] Public Subnet A (10.0.1.0/24)
[switch] Public Subnet B (10.0.2.0/24)
[switch] Private Subnet A (10.0.10.0/24)
[switch] Private Subnet B (10.0.20.0/24)
[server] Load Balancer
[server] Bastion Host (10.0.1.10)
[server] App Server 1 (10.0.10.10)
[server] App Server 2 (10.0.20.10)
[database] RDS Primary (10.0.10.100)
[database] RDS Replica (10.0.20.100)

AWS Region -- Internet Gateway
Internet Gateway -- Public Subnet A
Internet Gateway -- Public Subnet B
Public Subnet A -- Load Balancer
Public Subnet A -- Bastion Host
Public Subnet A -- NAT Gateway
NAT Gateway -- Private Subnet A
NAT Gateway -- Private Subnet B
Private Subnet A -- App Server 1
Private Subnet B -- App Server 2
Private Subnet A -- RDS Primary
Private Subnet B -- RDS Replica`},{id:"landing-page-wireframe",name:"Landing Page",description:"Complete landing page with hero, features, pricing, testimonials",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{SaaS Landing Page}
[[ Logo | Features | Pricing | About | [Sign Up] ]]

[hero: Build Amazing Products Faster | The all-in-one platform for modern teams to collaborate, build, and ship products. | Start Free Trial]

---

## Why Teams Love Us

[feature:  | Lightning Fast | Deploy in seconds with our optimized infrastructure and global CDN.]

[feature:  | Enterprise Security | SOC 2 compliant with end-to-end encryption and SSO support.]

[feature:  | Real-time Analytics | Get instant insights with beautiful dashboards and reports.]

[feature:  | Team Collaboration | Work together seamlessly with built-in comments and sharing.]

---

## Simple, Transparent Pricing

[pricing: Starter | $9 | 5 projects, 10GB storage, Email support | Get Started]

[pricing: Pro | $29 | Unlimited projects, 100GB storage, Priority support, API access | Start Free Trial]

[pricing: Enterprise | $99 | Everything in Pro, SSO, Dedicated support, Custom integrations | Contact Sales]

---

[testimonial: "This platform transformed how our team works. We shipped 3x faster!" | Sarah Chen | VP Engineering, TechCorp]

[testimonial: "The best investment we made this year. Incredible ROI." | Marcus Johnson | CEO, StartupXYZ]

---

[cta: Ready to get started? | Join 10,000+ teams already using our platform. | Start Free Trial]

---

[footer: Product | Features | Pricing | Docs :: Company | About | Blog | Careers :: Support | Help Center | Contact | Status ::  2024 Company. All rights reserved.]

[social: twitter | github | linkedin | youtube]`},{id:"dashboard-wireframe",name:"Admin Dashboard",description:"Modern dashboard with stats, charts, and data tables",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{Admin Dashboard}
[[  Dashboard |  Users |  Products |  Orders |  Settings | (@Admin) ]]

>> Home > Dashboard Overview

---

## Key Metrics

[stat: 12,456 | Total Users | +12.5%]

[stat: $84,230 | Revenue | +8.2%]

[stat: 1,847 | Orders | +15.3%]

[stat: 94.2% | Satisfaction | +2.1%]

---

## Quick Actions

[widget: New Orders | 24 | ]

[widget: Pending Reviews | 8 | ]

[widget: Support Tickets | 12 | ]

[widget: Low Stock Items | 5 | ]

---

## Recent Activity

[activity: John Smith created a new order #1234 | 5 minutes ago]

[activity: Sarah Johnson updated product inventory | 12 minutes ago]

[activity: Mike Brown resolved support ticket #567 | 1 hour ago]

[activity: System backup completed successfully | 2 hours ago]

---

## Orders Overview

[data-table: 5 rows]

---

[toast: 3 new orders received | success]

[fab: +]`},{id:"auth-wireframe",name:"Authentication Pages",description:"Login and signup forms with modern styling",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{Authentication}

## Login Form

[login-form: Welcome Back]

---

## Sign Up Form

[signup-form: Create Your Account]

---

## Social Login Options

[social: google | github | microsoft | apple]

---

## Password Reset

<Card>
## Forgot Password?

Enter your email and we'll send you a reset link.

[text: Email address]

[Send Reset Link]

>> Remember your password? Sign in
</Card>

---

## Two-Factor Authentication

<Card>
## Verify Your Identity

Enter the 6-digit code from your authenticator app.

[text:      ]

[Verify Code]

[ ] Trust this device for 30 days

>> Didn't receive a code? Resend
</Card>`},{id:"mobile-app-wireframe",name:"Mobile App Screens",description:"Mobile UI with bottom nav, app bar, and FAB",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{Mobile App}

## Home Screen

[app-bar: Home |  | ]

[search: Search anything...]

---

## Stats Overview

[stat: 2,847 | Steps Today | +18%]

[stat: 6.2 | Hours Sleep | -5%]

[stat: 1,450 | Calories | +12%]

---

## Activity Feed

[activity: Morning workout completed | 8:30 AM]

[activity: Reached daily step goal | 2:15 PM]

[activity: Sleep score: Excellent | Last night]

---

[fab: +]

[bottom-nav:  Home |  Stats |  |  Goals |  Profile]

---

## Profile Screen

[app-bar: Profile | ]

[profile: Alex Johnson | @alexj | Health enthusiast and fitness lover. Building better habits one day at a time.]

---

## Empty State

[empty: No workouts yet | Start tracking your fitness journey by adding your first workout. | Add Workout]

---

## Error State

[error: Connection Lost | Unable to sync your data. Please check your internet connection. | Retry]

---

## Loading State

[loading: Syncing your data...]`},{id:"settings-wireframe",name:"Settings Page",description:"Comprehensive settings with accordions and toggles",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{Settings}
[[ Home | Profile | Settings ]]

>> Settings > Account

(( General | Security | Notifications | Billing | Integrations ))

---

## General Settings

[accordion: Profile Information | Privacy Settings | Language & Region]

---

## Profile

(@John Doe)

[text: Full Name]
[text: Email]
[text: Phone]
[textarea: Bio]

[upload: Upload profile picture]

---

## Preferences

[toggle: on] Dark Mode
[toggle: off] Compact View
[toggle: on] Show Online Status
[toggle: off] Auto-play Videos

---

[v Select Timezone]
[v Select Language]

---

## Notifications

[x] Email notifications
[x] Push notifications
[ ] SMS notifications
[x] Weekly digest

---

## Danger Zone

[!error] Delete Account
This action cannot be undone. All your data will be permanently deleted.
[Delete Account]

---

[Cancel] [Save Changes]

[toast: Settings saved successfully | success]`},{id:"product-wireframe",name:"E-Commerce Product Page",description:"Product listing with reviews and comments",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{Product Details}
[[  Home |  Products |  Cart (3) |  Wishlist | (@User) ]]

>> Electronics > Smartphones > iPhone 15 Pro

---

[image: Product Image]

## iPhone 15 Pro

 (4.8)  1,234 reviews

**$999.00** ~~$1,199.00~~ [!success] Save $200

[v Select Color: Space Black]
[v Select Storage: 256GB]
[v Quantity: 1]

[Add to Cart] [Buy Now]

---

## Key Features

[feature:  | ProMotion Display | 120Hz adaptive refresh rate]

[feature:  | 48MP Camera | Professional-grade photography]

[feature:  | A17 Pro Chip | Industry-leading performance]

[feature:  | All-Day Battery | Up to 29 hours video playback]

---

## Customer Reviews

[comment: techfan2024 | Absolutely love this phone! The camera quality is insane. | 2 days ago]

[comment: sarah_m | Great upgrade from my old phone. The display is beautiful. | 1 week ago]

[comment: johnsmith | Fast shipping, arrived earlier than expected. | 2 weeks ago]

---

## Technical Specs

[accordion: Display | Camera | Performance | Battery | Connectivity]

---

[code: json]

---

## You Might Also Like

<Card>
AirPods Pro
$249.00
[Add to Cart]
</Card>

<Card>
MagSafe Charger
$39.00
[Add to Cart]
</Card>

---

[footer: Shop | Mac | iPad | iPhone | Watch :: Support | Contact | Returns ::  2024 Store]`},{id:"blog-wireframe",name:"Blog Article",description:"Blog post with comments, social sharing, and related posts",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{Blog Article}
[[  Blog |  Categories |  Search | [Subscribe] ]]

>> Tech > Web Development > Building Scalable React Apps

---

# Building Scalable React Applications in 2024

[avatar-group: 3] By **John Doe**  Dec 15, 2024  8 min read

[chip: React] [chip: Architecture] [chip: Performance]

---

[image: Featured Image]

---

## Introduction

Building scalable React applications requires careful planning and adherence to best practices. In this article, we'll explore the key patterns and techniques...

---

## Code Example

[code: javascript]

---

## Key Takeaways

- Use proper state management
- Implement code splitting
- Optimize bundle size
- Write testable components

---

## Share This Article

[social: twitter | linkedin | facebook]

---

## Comments (24)

[comment: dev_sarah | Great article! The code splitting section was particularly helpful. | 2 hours ago]

[comment: react_pro | Would love to see a follow-up on testing strategies. | 5 hours ago]

[comment: newbie_dev | This helped me understand so much. Thank you! | 1 day ago]

---

## Related Articles

[feature:  | State Management Patterns | Learn about Redux, MobX, and Zustand]

[feature:  | Performance Optimization | Tips for faster React apps]

[feature:  | Testing Best Practices | Write reliable tests]

---

[cta: Want more articles? | Subscribe to our newsletter for weekly updates. | Subscribe]

---

[footer: Blog | About | Contact | Privacy ::  2024 TechBlog]`},{id:"saas-dashboard-wireframe",name:"SaaS Application",description:"Full SaaS app with sidebar, widgets, and notifications",category:Z.UI_DESIGN,type:"wireframe",thumbnail:"wireframe",source:`{SaaS Dashboard}
[[  ProjectHub | Projects | Team | Analytics | Settings | [Upgrade] | (@PM) ]]

>> Projects > Website Redesign > Tasks

---

## Project Stats

[stat: 67% | Completed | +5% this week]

[stat: 12 | In Progress | 3 due today]

[stat: 8 | Team Members | 2 online]

[stat: 5 | Days Left | On track]

---

## Quick Actions

[widget: Add Task | + | ]

[widget: Schedule Meeting | + | ]

[widget: Upload Files | + | ]

[widget: Invite Member | + | ]

---

## Task Board

[data-table: 5 rows]

---

## Recent Files

[upload: Drop files here to upload]

---

## Team Activity

[activity: Emma updated the design mockups | 10 min ago]

[activity: James completed "API Integration" | 1 hour ago]

[activity: Sarah commented on "Homepage Design" | 2 hours ago]

---

## Upcoming Deadlines

[toast: Sprint review meeting in 2 hours | warning]

[toast: Design approval deadline tomorrow | info]

---

## Need Help?

[accordion: Getting Started Guide | Keyboard Shortcuts | Contact Support]

---

[fab: +]

[toast: Changes saved automatically | success]`},{id:"ecommerce-home",name:" E-commerce: Home Page",description:"E-commerce app home page with featured products and categories",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"E-commerce App",bundleOrder:1,source:`{ShopFlow - Home}
[[  ShopFlow | Categories | Deals |  Search... |  |  (3) | [Sign In] ]]

>> Home

---

[hero: Summer Sale - Up to 50% Off | Discover amazing deals on thousands of products. Limited time offer! | Shop Now]

---

## Featured Categories

<card>
[feature:  | Fashion | Latest trends in clothing]

[feature:  | Electronics | Gadgets & devices]

[feature:  | Home & Living | Furniture & decor]

[feature:  | Gaming | Consoles & accessories]
</>

---

## Trending Products

<card>
|Product|Price|Rating|
|Wireless Earbuds|$79.99||
|Smart Watch Pro|$299.99||
|Laptop Stand|$49.99||
|USB-C Hub|$39.99||
</>

---

## Special Offers

[stat: 2,847 | Products on Sale | ]

[stat: 50% | Max Discount | ]

[stat: 24h | Flash Deal Ends | ]

---

[footer: Shop | Categories | Deals :: Account | Orders | Wishlist :: Help | Contact | Returns ::  2024 ShopFlow]`},{id:"ecommerce-product",name:" E-commerce: Product Page",description:"Product detail page with images, specs, and reviews",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"E-commerce App",bundleOrder:2,source:`{ShopFlow - Product}
[[  ShopFlow | Categories | Deals |  Search... |  |  (3) | [Sign In] ]]

>> Home > Electronics > Headphones > Wireless Earbuds Pro

---

<card>
## Product Images

[img: Main product image]

[img 1:1] [img 1:1] [img 1:1] [img 1:1]
</>

<Sidebar>
## Wireless Earbuds Pro

 (2,847 reviews)

### $79.99 ~~$129.99~~

{badge:sale} 38% OFF

---

**Color**
(( Black | White | Navy ))

**Quantity**
[v 1      ]

---

[Add to Cart]
[Buy Now]

---

-  Free shipping over $50
-  30-day return policy
-  2-year warranty
</>

---

## Product Details

<card>
(( Description | Specifications | Reviews ))

Premium wireless earbuds with active noise cancellation,
30-hour battery life, and crystal-clear audio quality.

- Active Noise Cancellation
- 30-hour total battery life
- IPX4 water resistance
- Touch controls
- Bluetooth 5.3
</>

---

## Customer Reviews

<card>
[testimonial: Amazing sound quality! | Sarah M. | ]

[testimonial: Best earbuds I've owned | John D. | ]

[testimonial: Great value for money | Mike R. | ]
</>

---

## You May Also Like

|Product|Price|
|Charging Case|$29.99|
|Ear Tips Pack|$12.99|
|Carry Pouch|$19.99|`},{id:"ecommerce-cart",name:" E-commerce: Cart Page",description:"Shopping cart with items, quantities, and order summary",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"E-commerce App",bundleOrder:3,source:`{ShopFlow - Cart}
[[  ShopFlow | Categories | Deals |  Search... |  |  (3) | [Sign In] ]]

>> Home > Shopping Cart

---

## Shopping Cart (3 items)

<card>
### Cart Items

---

|Product|Price|Qty|Total|
|Wireless Earbuds Pro|$79.99|[v 1]|$79.99|
|Smart Watch Pro|$299.99|[v 1]|$299.99|
|USB-C Hub|$39.99|[v 2]|$79.98|

---

[ Remove Selected]  [Continue Shopping]
</>

<Sidebar>
### Order Summary

---

Subtotal: **$459.96**

Shipping: **Free**

Tax: **$36.80**

---

[___Promo Code___] [Apply]

---

### Total: **$496.76**

---

[Proceed to Checkout]

---

[] I agree to terms and conditions

---

**We Accept**
 Visa | Mastercard | PayPal | Apple Pay
</>

---

## Recommended For You

<card>
[feature:  | Headphone Stand | $24.99]

[feature:  | Fast Charger | $19.99]

[feature:  | Phone Case | $14.99]
</>

---

[toast: Item added to cart | success]`},{id:"ecommerce-checkout",name:" E-commerce: Checkout Page",description:"Checkout flow with shipping, payment, and confirmation",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"E-commerce App",bundleOrder:4,source:`{ShopFlow - Checkout}
[[  ShopFlow |  Secure Checkout ]]

---

[step: 2/4]

## Checkout

---

<card>
### 1. Shipping Address 

John Doe
123 Main Street, Apt 4B
New York, NY 10001
 (555) 123-4567

[Edit]
</>

<card>
### 2. Payment Method

((  Credit Card | PayPal | Apple Pay ))

---

**Card Number**
[____1234 5678 9012 3456____]

**Expiry**          **CVV**
[__12/25__]         [__***__]

**Name on Card**
[____John Doe____]

---

[x] Save card for future purchases
</>

<card>
### 3. Review Order

|Item|Qty|Price|
|Wireless Earbuds Pro|1|$79.99|
|Smart Watch Pro|1|$299.99|
|USB-C Hub|2|$79.98|

---

Subtotal: $459.96
Shipping: Free
Tax: $36.80

---

**Total: $496.76**
</>

---

<Sidebar>
### Order Summary

3 items

---

**Subtotal:** $459.96
**Shipping:** Free
**Tax:** $36.80

---

### Total
## $496.76

---

[Place Order]

---

 Your payment info is secure

---

-  30-day returns
-  Free shipping
-  Secure payment
</>

---

[toast: Shipping address confirmed | success]`},{id:"ecommerce-confirmation",name:" E-commerce: Order Confirmation",description:"Order success page with details and tracking",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"E-commerce App",bundleOrder:5,source:`{ShopFlow - Order Confirmed}
[[  ShopFlow | Categories | Deals |  Search... |  |  | (@John) ]]

---

<card>
##  Order Confirmed!

Thank you for your purchase, John!

---

**Order Number:** #SHP-2024-78542

**Estimated Delivery:** Jan 5-7, 2025

---

[Track Order]  [View Order Details]
</>

---

## Order Summary

<card>
|Item|Qty|Price|
|Wireless Earbuds Pro|1|$79.99|
|Smart Watch Pro|1|$299.99|
|USB-C Hub|2|$79.98|

---

**Total Paid: $496.76**
</>

---

## Shipping To

<card>
**John Doe**
123 Main Street, Apt 4B
New York, NY 10001

 Standard Shipping (3-5 business days)
</>

---

## What's Next?

<card>
[feature:  | Confirmation Email | Check your inbox for order details]

[feature:  | Shipping Updates | We'll notify you when your order ships]

[feature:  | Track Anytime | Use your order number to track delivery]
</>

---

[Continue Shopping]

---

[toast: Order #SHP-2024-78542 placed successfully! | success]

---

[footer: Shop | My Orders | Help ::  2024 ShopFlow]`},{id:"ecommerce-user-journey",name:" E-commerce: User Journey",description:"Complete shopping flow from browsing to purchase",category:Z.APP_BUNDLES,type:"journey",thumbnail:"journey",bundle:"E-commerce App",bundleOrder:6,source:`[user] Customer

[screen:ecommerce-home] Home Page
[screen:ecommerce-product] Product Page
[screen:ecommerce-cart] Cart
[screen:ecommerce-checkout] Checkout
[success:ecommerce-confirmation] Order Confirmed

Customer -> Home Page
Home Page -browse-> Product Page
Product Page -add to cart-> Cart
Product Page -back-> Home Page
Cart -checkout-> Checkout
Cart -edit-> Cart
Cart -continue-> Home Page
Checkout -place order-> Order Confirmed
Checkout -back-> Cart`},{id:"saas-dashboard",name:" SaaS App: Dashboard",description:"Main dashboard with metrics and activity",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"SaaS App",bundleOrder:1,source:`{TaskFlow - Dashboard}
[[  TaskFlow | Dashboard | Projects | Team | Reports | [Upgrade] | (@PM) ]]

>> Dashboard

---

[hero: Welcome back, Sarah! | You have 5 tasks due today and 2 meetings scheduled. | View Tasks]

---

## Key Metrics

[stat: 24 | Active Projects | +3]

[stat: 156 | Tasks Completed | +12%]

[stat: 8 | Team Members | +1]

[stat: 94% | On-time Rate | +2%]

---

## Recent Projects

<card>
|Project|Status|Progress|Due Date|
|Website Redesign|{badge:In Progress}|[====----] 60%|Jan 15|
|Mobile App v2|{badge:On Track}|[=======--] 80%|Jan 10|
|API Integration|{badge:At Risk}|[===------] 35%|Jan 8|
|Documentation|{badge:Complete}|[=========] 100%|Done|
</>

---

## Recent Activity

[activity: Sarah completed "Design Review" | 10 min ago]

[activity: Mike commented on "API Endpoints" | 1 hour ago]

[activity: Team meeting scheduled for tomorrow | 2 hours ago]

[activity: New task assigned: "Update landing page" | 3 hours ago]

---

## Upcoming Deadlines

[toast: API Integration due in 2 days | warning]

[toast: Team standup in 30 minutes | info]

---

[fab: +]`},{id:"saas-projects",name:" SaaS App: Projects",description:"Projects list with filters and actions",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"SaaS App",bundleOrder:2,source:`{TaskFlow - Projects}
[[  TaskFlow | Dashboard | Projects | Team | Reports | [Upgrade] | (@PM) ]]

>> Projects

---

## All Projects

<card>
[___Search projects...___] [v All Status] [v All Teams] [+ New Project]
</>

---

<card>
### Website Redesign
**Team Alpha**  6 members

[====------] 60% Complete

12 tasks remaining  Due Jan 15

{badge:In Progress} {badge:High Priority}

[View] [Edit]
</>

<card>
### Mobile App v2
**Team Beta**  4 members

[========--] 80% Complete

5 tasks remaining  Due Jan 10

{badge:On Track} {badge:Medium Priority}

[View] [Edit]
</>

<card>
### API Integration
**Team Alpha**  3 members

[===-------] 35% Complete

18 tasks remaining  Due Jan 8

{badge:At Risk} {badge:High Priority}

[View] [Edit]
</>

---

[< 1 2 3 ... 5 >]

---

[fab: +]`},{id:"saas-settings",name:" SaaS App: Settings",description:"Account and app settings page",category:Z.APP_BUNDLES,type:"wireframe",thumbnail:"wireframe",bundle:"SaaS App",bundleOrder:3,source:`{TaskFlow - Settings}
[[  TaskFlow | Dashboard | Projects | Team | Reports | [Upgrade] | (@PM) ]]

>> Settings

---

<Sidebar>
## Settings

-  Profile
-  Notifications
-  Security
-  Billing
-  Appearance
-  Integrations
-  Team
</>

<card>
## Profile Settings

---

[img 1:1]

[Upload Photo]

---

**Full Name**
[____Sarah Johnson____]

**Email**
[____sarah@company.com____]

**Role**
[v Project Manager    ]

**Timezone**
[v UTC-5 (Eastern)    ]

---

**Bio**
[________________________________________]
[________________________________________]

---

[Save Changes]  [Cancel]
</>

---

<card>
## Notification Preferences

---

[x] Email notifications for task assignments
[x] Push notifications for mentions
[ ] Weekly summary email
[x] Desktop notifications
[ ] SMS alerts for urgent items

---

[Save Preferences]
</>

---

[toast: Settings saved successfully | success]`},{id:"saas-user-journey",name:" SaaS App: User Journey",description:"User flow through the SaaS application",category:Z.APP_BUNDLES,type:"journey",thumbnail:"journey",bundle:"SaaS App",bundleOrder:4,source:`[user] Project Manager

[screen:saas-dashboard] Dashboard
[screen:saas-projects] Projects
[screen:saas-settings] Settings
[success] Task Complete

Project Manager -> Dashboard
Dashboard -view projects-> Projects
Dashboard -settings-> Settings
Projects -select-> Projects
Projects -back-> Dashboard
Settings -save-> Dashboard
Projects -complete task-> Task Complete`},{id:"git-feature-flow",name:"Git Feature Branch Flow",description:"Feature branch workflow with code review",category:Z.SOFTWARE_DESIGN,type:"git",thumbnail:"git",source:`commit "Initial setup"
commit "Add project structure"
branch feature/user-auth
commit "Add user model"
commit "Add auth controller"
commit "Add login tests"
checkout main
commit "Update dependencies"
branch feature/dashboard
commit "Add dashboard layout"
commit "Add charts component"
checkout main
merge feature/user-auth
checkout feature/dashboard
commit "Fix responsive layout"
checkout main
merge feature/dashboard
commit "Release v1.0.0"`},{id:"deployment-k8s",name:"Kubernetes Deployment",description:"K8s cluster with pods and services",category:Z.ARCHITECTURE,type:"deployment",thumbnail:"deployment",source:`[cloud] AWS EKS
  [cluster] Production Cluster
    [namespace] default
      [container] nginx-ingress
      [container] cert-manager
    [namespace] app
      [container] api-deployment (3 replicas)
      [container] worker-deployment (2 replicas)
      [container] scheduler
    [namespace] monitoring
      [container] prometheus
      [container] grafana
      [container] alertmanager
  [database] RDS PostgreSQL
  [storage] S3 Bucket
  [cache] ElastiCache Redis
[device] Developer Workstation
[device] CI/CD Pipeline`},{id:"checkout-activity",name:"Checkout Activity Flow",description:"E-commerce checkout process with decisions",category:Z.FLOWCHARTS,type:"activity",thumbnail:"activity",source:`[start]
:View Cart;
:Enter Shipping;
<Address Valid?>
:Enter Payment;
<Payment Method?>
:Process Card;
:Process PayPal;
<Payment Success?>
:Create Order;
:Send Confirmation;
[end]
:Show Error;

start -> View Cart
View Cart -> Enter Shipping
Enter Shipping -> Address Valid?
Address Valid? -> Enter Payment: Yes
Address Valid? -> Enter Shipping: No
Enter Payment -> Payment Method?
Payment Method? -> Process Card: Card
Payment Method? -> Process PayPal: PayPal
Process Card -> Payment Success?
Process PayPal -> Payment Success?
Payment Success? -> Create Order: Yes
Payment Success? -> Show Error: No
Show Error -> Enter Payment
Create Order -> Send Confirmation
Send Confirmation -> end`},{id:"component-architecture",name:"Service Components",description:"Microservice component relationships",category:Z.ARCHITECTURE,type:"component",thumbnail:"component",source:`[component] Web Frontend
[component] Mobile App
[service] API Gateway
[service] Auth Service
[service] User Service
[service] Product Service
[service] Order Service
[service] Payment Service
[database] User DB
[database] Product DB
[database] Order DB
[cache] Redis
[queue] Message Queue

Web Frontend --> API Gateway
Mobile App --> API Gateway
API Gateway --> Auth Service
API Gateway --> User Service
API Gateway --> Product Service
API Gateway --> Order Service
Auth Service -- Redis
User Service --> User DB
Product Service --> Product DB
Order Service --> Order DB
Order Service --> Message Queue
Payment Service --> Message Queue`}];function Wh(){return Tc}function Z1(i){return Tc.find(t=>t.id===i)||St().find(t=>t.id===i)||null}function St(){try{const i=localStorage.getItem(Ac.CUSTOM_TEMPLATES);if(i)return JSON.parse(i)}catch(i){console.error("Failed to load custom templates:",i)}return[]}function J1(i){try{const t=St(),r={...i,id:`custom-${Date.now()}`,isCustom:!0,createdAt:new Date().toISOString()};return t.unshift(r),localStorage.setItem(Ac.CUSTOM_TEMPLATES,JSON.stringify(t)),r}catch(t){throw console.error("Failed to save custom template:",t),t}}function ev(i){try{const r=St().filter(n=>n.id!==i);return localStorage.setItem(Ac.CUSTOM_TEMPLATES,JSON.stringify(r)),!0}catch(t){return console.error("Failed to delete custom template:",t),!1}}function tv(){return[...St(),...Tc]}function rv(i){const t=i.toLowerCase();return tv().filter(r=>r.name.toLowerCase().includes(t)||r.description.toLowerCase().includes(t)||r.category.toLowerCase().includes(t)||r.type.toLowerCase().includes(t))}const je={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",orange:"#F59E0B",pink:"#EC4899",red:"#EF4444",cyan:"#06B6D4",violet:"#8B5CF6"},nv={flowchart:"",sequence:"",mindmap:"",wbs:"",erd:"",architecture:"",state:"",timeline:"",orgchart:"",network:"",gantt:"",class:"",usecase:"",pie:"",quadrant:"",git:"",deployment:"",wireframe:"",activity:"",component:"",c4:"",requirement:"",journey:""},iv={[Z.FLOWCHARTS]:"",[Z.ARCHITECTURE]:"",[Z.DATA_MODELING]:"",[Z.PROJECT_MANAGEMENT]:"",[Z.SOFTWARE_DESIGN]:"",[Z.BUSINESS]:"",[Z.NETWORK]:"",[Z.UI_DESIGN]:"",[Z.APP_BUNDLES]:"","My Templates":""},Nh={[Z.FLOWCHARTS]:je.blue,[Z.ARCHITECTURE]:je.purple,[Z.DATA_MODELING]:je.green,[Z.PROJECT_MANAGEMENT]:je.orange,[Z.SOFTWARE_DESIGN]:je.violet,[Z.BUSINESS]:je.pink,[Z.NETWORK]:je.cyan,[Z.UI_DESIGN]:je.red,[Z.APP_BUNDLES]:je.teal,"My Templates":je.orange};function ov({isOpen:i,onClose:t,onApplyTemplate:r,theme:n}){const[a,s]=M.useState(""),[e,l]=M.useState("All"),[h,d]=M.useState(null),[p,f]=M.useState(null),x=M.useRef(null),g=(n==null?void 0:n.name)==="dark";M.useEffect(()=>{i&&x.current&&setTimeout(()=>{var w;return(w=x.current)==null?void 0:w.focus()},100)},[i]);const m=M.useMemo(()=>{let w;if(a.trim())w=rv(a);else{const k=Wh();w=[...St(),...k]}return e==="All"?w:e==="My Templates"?w.filter(k=>k.isCustom):w.filter(k=>k.category===e)},[a,e]),c=M.useMemo(()=>{const w=St(),k=["All",...Object.values(Z)];return w.length>0&&k.splice(1,0,"My Templates"),k},[]),u=w=>{r(w.type,w.source),t()},b=w=>{ev(w),f(null)};if(!i)return null;const y={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",zIndex:1e3,display:"flex",justifyContent:"center",alignItems:"center"},modal:{width:"90vw",maxWidth:"1100px",height:"85vh",maxHeight:"800px",background:g?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(241,245,249,0.98))",borderRadius:"16px",border:`1px solid ${g?"rgba(124,58,237,0.3)":"rgba(124,58,237,0.2)"}`,display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},header:{padding:"20px 24px",borderBottom:`1px solid ${g?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:g?"rgba(124, 58, 237, 0.1)":"rgba(124, 58, 237, 0.05)"},headerTitle:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px"},titleText:{color:g?"#fff":"#1e293b",fontWeight:600,fontSize:"18px"},subtitle:{color:g?"#888":"#64748b",fontSize:"12px"},closeButton:{background:"transparent",border:"none",color:g?"#888":"#64748b",cursor:"pointer",fontSize:"24px",padding:"4px 8px",borderRadius:"6px",transition:"all 0.2s"},searchBar:{padding:"16px 24px",borderBottom:`1px solid ${g?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}`},searchInput:{width:"100%",padding:"12px 16px",paddingLeft:"44px",background:g?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",border:`1px solid ${g?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,borderRadius:"10px",color:g?"#fff":"#1e293b",fontSize:"14px",outline:"none",transition:"all 0.2s"},searchWrapper:{position:"relative"},searchIcon:{position:"absolute",left:"14px",top:"50%",transform:"translateY(-50%)",color:g?"#666":"#94a3b8",fontSize:"16px",pointerEvents:"none"},content:{display:"flex",flex:1,overflow:"hidden"},sidebar:{width:"200px",borderRight:`1px solid ${g?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,padding:"16px 0",overflowY:"auto"},categoryItem:(w,k)=>({display:"flex",alignItems:"center",gap:"10px",padding:"10px 20px",cursor:"pointer",background:w?g?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)":"transparent",borderLeft:w?`3px solid ${k||je.purple}`:"3px solid transparent",color:w?g?"#fff":"#1e293b":g?"#aaa":"#64748b",fontSize:"13px",fontWeight:w?600:400,transition:"all 0.2s"}),categoryIcon:{fontSize:"16px"},categoryCount:{marginLeft:"auto",fontSize:"11px",padding:"2px 6px",background:g?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",borderRadius:"10px",color:g?"#888":"#64748b"},grid:{flex:1,padding:"20px",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"16px",alignContent:"start"},card:(w,k)=>({background:g?"rgba(0,0,0,0.3)":"rgba(255,255,255,0.8)",borderRadius:"12px",border:`1px solid ${w?k||je.purple:g?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,overflow:"hidden",cursor:"pointer",transition:"all 0.2s",transform:w?"translateY(-2px)":"none",boxShadow:w?`0 8px 20px ${k}20`:"none"}),cardThumbnail:w=>({height:"100px",background:`linear-gradient(135deg, ${w}15, ${w}05)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",borderBottom:`1px solid ${g?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}`}),cardContent:{padding:"16px",minHeight:"100px"},cardTitle:{color:g?"#ffffff":"#1e293b",fontSize:"15px",fontWeight:700,marginBottom:"8px",lineHeight:1.3},cardDescription:{color:g?"#aaaaaa":"#64748b",fontSize:"13px",lineHeight:1.5,marginBottom:"12px",minHeight:"36px"},cardMeta:{display:"flex",alignItems:"center",gap:"8px",marginTop:"10px"},typeBadge:w=>({padding:"3px 8px",background:`${w}20`,color:w,borderRadius:"4px",fontSize:"10px",fontWeight:600,textTransform:"uppercase"}),customBadge:{padding:"3px 8px",background:`${je.orange}20`,color:je.orange,borderRadius:"4px",fontSize:"10px"},bundleBadge:{padding:"4px 10px",background:`${je.teal}25`,color:je.teal,borderRadius:"6px",fontSize:"10px",fontWeight:600,border:`1px solid ${je.teal}40`},deleteButton:{marginLeft:"auto",padding:"4px 8px",background:`${je.red}20`,color:je.red,border:"none",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},emptyState:{gridColumn:"1 / -1",textAlign:"center",padding:"60px 20px",color:g?"#666":"#94a3b8"},emptyIcon:{fontSize:"48px",marginBottom:"16px"},emptyTitle:{fontSize:"16px",color:g?"#888":"#64748b",marginBottom:"8px"},emptyText:{fontSize:"13px"},confirmOverlay:{position:"absolute",inset:0,background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"12px"},confirmBox:{background:g?"#1e293b":"#fff",padding:"16px",borderRadius:"8px",textAlign:"center"},confirmText:{color:g?"#fff":"#1e293b",fontSize:"13px",marginBottom:"12px"},confirmButtons:{display:"flex",gap:"8px",justifyContent:"center"},confirmButton:w=>({padding:"6px 14px",background:w?je.red:g?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",color:w||g?"#fff":"#1e293b",border:"none",borderRadius:"6px",fontSize:"12px",cursor:"pointer"})},S=w=>{const k=[...St(),...Wh()];return w==="All"?k.length:w==="My Templates"?St().length:k.filter(j=>j.category===w).length};return o.jsx("div",{style:y.overlay,onClick:t,children:o.jsxs("div",{style:y.modal,onClick:w=>w.stopPropagation(),children:[o.jsxs("div",{style:y.header,children:[o.jsxs("div",{style:y.headerTitle,children:[o.jsx("span",{style:y.headerIcon,children:""}),o.jsxs("div",{children:[o.jsx("div",{style:y.titleText,children:"Template Gallery"}),o.jsx("div",{style:y.subtitle,children:"Choose a template to get started quickly"})]})]}),o.jsx("button",{style:y.closeButton,onClick:t,onMouseEnter:w=>w.target.style.color=g?"#fff":"#1e293b",onMouseLeave:w=>w.target.style.color=g?"#888":"#64748b",children:""})]}),o.jsx("div",{style:y.searchBar,children:o.jsxs("div",{style:y.searchWrapper,children:[o.jsx("span",{style:y.searchIcon,children:""}),o.jsx("input",{ref:x,type:"text",placeholder:"Search templates by name, type, or category...",value:a,onChange:w=>s(w.target.value),style:y.searchInput})]})}),o.jsxs("div",{style:y.content,children:[o.jsx("div",{style:y.sidebar,children:c.map(w=>o.jsxs("div",{style:y.categoryItem(e===w,Nh[w]),onClick:()=>l(w),onMouseEnter:k=>{e!==w&&(k.currentTarget.style.background=g?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)")},onMouseLeave:k=>{e!==w&&(k.currentTarget.style.background="transparent")},children:[o.jsx("span",{style:y.categoryIcon,children:iv[w]||""}),o.jsx("span",{children:w}),o.jsx("span",{style:y.categoryCount,children:S(w)})]},w))}),o.jsx("div",{style:y.grid,children:m.length===0?o.jsxs("div",{style:y.emptyState,children:[o.jsx("div",{style:y.emptyIcon,children:""}),o.jsx("div",{style:y.emptyTitle,children:"No templates found"}),o.jsx("div",{style:y.emptyText,children:"Try a different search term or category"})]}):m.map(w=>{var E;const k=Nh[w.category]||je.purple,j=h===w.id,C=p===w.id;return o.jsxs("div",{style:{...y.card(j,k),position:"relative"},onMouseEnter:()=>d(w.id),onMouseLeave:()=>d(null),onClick:()=>!C&&u(w),children:[o.jsx("div",{style:y.cardThumbnail(k),children:nv[w.type]||""}),o.jsxs("div",{style:y.cardContent,children:[o.jsx("div",{style:y.cardTitle,children:w.name||"Untitled"}),o.jsx("div",{style:y.cardDescription,children:w.description||"No description"}),o.jsxs("div",{style:y.cardMeta,children:[o.jsx("span",{style:y.typeBadge(k),children:(E=w.type)==null?void 0:E.toUpperCase()}),w.bundle&&o.jsx("span",{style:y.bundleBadge,children:w.bundle}),w.isCustom&&o.jsxs(o.Fragment,{children:[o.jsx("span",{style:y.customBadge,children:"Custom"}),o.jsx("button",{style:y.deleteButton,onClick:R=>{R.stopPropagation(),f(w.id)},children:"Delete"})]})]})]}),C&&o.jsx("div",{style:y.confirmOverlay,onClick:R=>R.stopPropagation(),children:o.jsxs("div",{style:y.confirmBox,children:[o.jsx("div",{style:y.confirmText,children:"Delete this template?"}),o.jsxs("div",{style:y.confirmButtons,children:[o.jsx("button",{style:y.confirmButton(!1),onClick:()=>f(null),children:"Cancel"}),o.jsx("button",{style:y.confirmButton(!0),onClick:()=>b(w.id),children:"Delete"})]})]})})]},w.id)})})]})]})})}const dt={purple:"#7C3AED",green:"#10B981",red:"#EF4444"};function av({isOpen:i,onClose:t,diagramType:r,diagramSource:n,theme:a}){const[s,e]=M.useState(""),[l,h]=M.useState(""),[d,p]=M.useState(Z.FLOWCHARTS),[f,x]=M.useState(""),[g,m]=M.useState(!1),c=M.useRef(null),u=(a==null?void 0:a.name)==="dark";M.useEffect(()=>{i&&(e(""),h(""),p(Z.FLOWCHARTS),x(""),m(!1),setTimeout(()=>{var S;return(S=c.current)==null?void 0:S.focus()},100))},[i]);const b=()=>{if(!s.trim()){x("Please enter a template name");return}if(!(n!=null&&n.trim())){x("No diagram content to save");return}try{J1({name:s.trim(),description:l.trim()||"Custom template",category:d,type:r,source:n}),m(!0),setTimeout(()=>{t()},1500)}catch(S){x("Failed to save template: "+S.message)}};if(!i)return null;const y={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",zIndex:1001,display:"flex",justifyContent:"center",alignItems:"center"},modal:{width:"90vw",maxWidth:"450px",background:u?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(241,245,249,0.98))",borderRadius:"16px",border:`1px solid ${u?"rgba(124,58,237,0.3)":"rgba(124,58,237,0.2)"}`,overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},header:{padding:"20px 24px",borderBottom:`1px solid ${u?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:u?"rgba(124, 58, 237, 0.1)":"rgba(124, 58, 237, 0.05)"},headerTitle:{display:"flex",alignItems:"center",gap:"12px"},headerIcon:{fontSize:"24px"},titleText:{color:u?"#fff":"#1e293b",fontWeight:600,fontSize:"18px"},closeButton:{background:"transparent",border:"none",color:u?"#888":"#64748b",cursor:"pointer",fontSize:"24px",padding:"4px 8px",borderRadius:"6px"},content:{padding:"24px"},formGroup:{marginBottom:"20px"},label:{display:"block",color:u?"#aaa":"#64748b",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},input:{width:"100%",padding:"12px 14px",background:u?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",border:`1px solid ${u?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,borderRadius:"8px",color:u?"#fff":"#1e293b",fontSize:"14px",outline:"none",boxSizing:"border-box"},textarea:{width:"100%",padding:"12px 14px",background:u?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",border:`1px solid ${u?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,borderRadius:"8px",color:u?"#fff":"#1e293b",fontSize:"14px",outline:"none",minHeight:"80px",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box"},select:{width:"100%",padding:"12px 14px",background:u?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",border:`1px solid ${u?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,borderRadius:"8px",color:u?"#fff":"#1e293b",fontSize:"14px",outline:"none",cursor:"pointer",boxSizing:"border-box"},typeInfo:{display:"flex",alignItems:"center",gap:"10px",padding:"12px 14px",background:u?"rgba(124,58,237,0.1)":"rgba(124,58,237,0.05)",borderRadius:"8px",border:`1px solid ${u?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)"}`},typeLabel:{color:u?"#888":"#64748b",fontSize:"12px"},typeBadge:{padding:"4px 10px",background:`${dt.purple}20`,color:dt.purple,borderRadius:"4px",fontSize:"12px",fontWeight:600,textTransform:"uppercase"},error:{padding:"10px 14px",background:`${dt.red}15`,border:`1px solid ${dt.red}40`,borderRadius:"8px",color:dt.red,fontSize:"13px",marginBottom:"16px"},success:{padding:"10px 14px",background:`${dt.green}15`,border:`1px solid ${dt.green}40`,borderRadius:"8px",color:dt.green,fontSize:"13px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},footer:{padding:"16px 24px",borderTop:`1px solid ${u?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,display:"flex",justifyContent:"flex-end",gap:"12px"},button:S=>({padding:"10px 20px",background:S?dt.purple:u?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",color:S||u?"#fff":"#1e293b",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s"})};return o.jsx("div",{style:y.overlay,onClick:t,children:o.jsxs("div",{style:y.modal,onClick:S=>S.stopPropagation(),children:[o.jsxs("div",{style:y.header,children:[o.jsxs("div",{style:y.headerTitle,children:[o.jsx("span",{style:y.headerIcon,children:""}),o.jsx("span",{style:y.titleText,children:"Save as Template"})]}),o.jsx("button",{style:y.closeButton,onClick:t,children:""})]}),o.jsxs("div",{style:y.content,children:[f&&o.jsx("div",{style:y.error,children:f}),g&&o.jsxs("div",{style:y.success,children:[o.jsx("span",{children:""}),"Template saved successfully!"]}),o.jsxs("div",{style:y.formGroup,children:[o.jsx("label",{style:y.label,children:"Template Name"}),o.jsx("input",{ref:c,type:"text",placeholder:"Enter template name...",value:s,onChange:S=>e(S.target.value),style:y.input,disabled:g})]}),o.jsxs("div",{style:y.formGroup,children:[o.jsx("label",{style:y.label,children:"Description"}),o.jsx("textarea",{placeholder:"Describe what this template is for...",value:l,onChange:S=>h(S.target.value),style:y.textarea,disabled:g})]}),o.jsxs("div",{style:y.formGroup,children:[o.jsx("label",{style:y.label,children:"Category"}),o.jsx("select",{value:d,onChange:S=>p(S.target.value),style:y.select,disabled:g,children:Object.values(Z).map(S=>o.jsx("option",{value:S,children:S},S))})]}),o.jsxs("div",{style:y.formGroup,children:[o.jsx("label",{style:y.label,children:"Diagram Type"}),o.jsxs("div",{style:y.typeInfo,children:[o.jsx("span",{style:y.typeLabel,children:"This template will be saved as:"}),o.jsx("span",{style:y.typeBadge,children:r})]})]})]}),o.jsxs("div",{style:y.footer,children:[o.jsx("button",{style:y.button(!1),onClick:t,children:"Cancel"}),o.jsx("button",{style:y.button(!0),onClick:b,disabled:g,children:g?"Saved!":"Save Template"})]})]})})}const oc={purple:"#7C3AED",green:"#10B981"};function kr({label:i,icon:t,items:r,theme:n,color:a=oc.purple,disabled:s=!1,showCaret:e=!0}){const[l,h]=M.useState(!1),d=M.useRef(null),p=(n==null?void 0:n.name)==="dark";M.useEffect(()=>{function b(y){d.current&&!d.current.contains(y.target)&&h(!1)}return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const f=b=>{b.onClick&&!b.disabled&&(b.onClick(),h(!1))},x={container:{position:"relative",display:"inline-block"},button:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 12px",background:l?`${a}30`:`${a}20`,border:`1px solid ${l?a:`${a}50`}`,borderRadius:6,color:a,fontSize:"0.8rem",fontWeight:500,cursor:s?"not-allowed":"pointer",opacity:s?.5:1,transition:"all 0.15s ease",whiteSpace:"nowrap"},caret:{fontSize:"0.65rem",transition:"transform 0.15s ease",transform:l?"rotate(180deg)":"rotate(0deg)"},dropdown:{position:"absolute",top:"calc(100% + 4px)",left:0,minWidth:"180px",background:p?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))",border:`1px solid ${p?"rgba(124,58,237,0.3)":"rgba(124,58,237,0.2)"}`,borderRadius:8,boxShadow:"0 10px 40px rgba(0,0,0,0.3)",zIndex:1e3,overflow:"hidden",backdropFilter:"blur(10px)"},section:{padding:"6px 0",borderBottom:`1px solid ${p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`},sectionLast:{padding:"6px 0"},sectionLabel:{padding:"4px 12px",fontSize:"0.7rem",fontWeight:600,color:p?"#666":"#94a3b8",textTransform:"uppercase",letterSpacing:"0.5px"},item:(b,y)=>({display:"flex",alignItems:"center",gap:"10px",padding:"8px 12px",fontSize:"0.85rem",color:b.disabled?p?"#555":"#cbd5e1":p?"#e2e8f0":"#334155",cursor:b.disabled?"not-allowed":"pointer",background:y&&!b.disabled?p?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)":"transparent",opacity:b.disabled?.5:1,transition:"background 0.1s ease"}),itemIcon:{fontSize:"0.9rem",width:"20px",textAlign:"center"},itemContent:{flex:1,display:"flex",flexDirection:"column"},itemLabel:{fontWeight:500},itemDescription:{fontSize:"0.75rem",color:p?"#666":"#94a3b8",marginTop:"2px"},itemShortcut:{fontSize:"0.7rem",color:p?"#555":"#94a3b8",fontFamily:"monospace",background:p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",padding:"2px 5px",borderRadius:3},itemBadge:b=>({fontSize:"0.65rem",padding:"2px 6px",background:`${b}20`,color:b,borderRadius:4,fontWeight:600}),divider:{height:1,background:p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",margin:"4px 0"}},g=[];let m={label:null,items:[]};r.forEach((b,y)=>{b.type==="divider"?m.items.length>0&&(g.push(m),m={label:null,items:[]}):b.type==="section"?(m.items.length>0&&g.push(m),m={label:b.label,items:[]}):m.items.push(b)}),m.items.length>0&&g.push(m);const[c,u]=M.useState(null);return o.jsxs("div",{ref:d,style:x.container,children:[o.jsxs("button",{style:x.button,onClick:()=>!s&&h(!l),onMouseEnter:b=>{s||(b.currentTarget.style.background=`${a}30`)},onMouseLeave:b=>{!s&&!l&&(b.currentTarget.style.background=`${a}20`)},children:[t&&o.jsx("span",{children:t}),o.jsx("span",{children:i}),e&&o.jsx("span",{style:x.caret,children:""})]}),l&&o.jsx("div",{style:x.dropdown,children:g.map((b,y)=>o.jsxs("div",{style:y<g.length-1?x.section:x.sectionLast,children:[b.label&&o.jsx("div",{style:x.sectionLabel,children:b.label}),b.items.map((S,w)=>o.jsxs("div",{style:x.item(S,c===`${y}-${w}`),onClick:()=>f(S),onMouseEnter:()=>u(`${y}-${w}`),onMouseLeave:()=>u(null),children:[S.icon&&o.jsx("span",{style:x.itemIcon,children:S.icon}),o.jsxs("div",{style:x.itemContent,children:[o.jsx("span",{style:x.itemLabel,children:S.label}),S.description&&o.jsx("span",{style:x.itemDescription,children:S.description})]}),S.shortcut&&o.jsx("span",{style:x.itemShortcut,children:S.shortcut}),S.badge&&o.jsx("span",{style:x.itemBadge(S.badgeColor||oc.purple),children:S.badge}),S.active&&o.jsx("span",{style:{color:oc.green},children:""})]},w))]},y))})]})}const it={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",orange:"#F59E0B",pink:"#EC4899",cyan:"#06B6D4"},sv={"Flow & Process":{icon:"",color:it.blue,types:["flowchart","activity","state","journey","swimlane","sankey"]},Architecture:{icon:"",color:it.purple,types:["architecture","deployment","component","c4","network"]},"Data & Structure":{icon:"",color:it.green,types:["erd","class","mindmap","orgchart"]},Planning:{icon:"",color:it.orange,types:["gantt","timeline","requirement"]},Interaction:{icon:"",color:it.cyan,types:["sequence","usecase"]},Visualization:{icon:"",color:it.pink,types:["pie","quadrant","wireframe","git"]}},qh={flowchart:{icon:"",name:"Flowchart",desc:"Process flows"},activity:{icon:"",name:"Activity",desc:"UML activity"},state:{icon:"",name:"State Machine",desc:"State transitions"},journey:{icon:"",name:"User Journey",desc:"User experience"},architecture:{icon:"",name:"Architecture",desc:"System design"},deployment:{icon:"",name:"Deployment",desc:"Infrastructure"},component:{icon:"",name:"Component",desc:"Components"},c4:{icon:"",name:"C4 Model",desc:"C4 architecture"},network:{icon:"",name:"Network",desc:"Network topology"},erd:{icon:"",name:"ERD",desc:"Database schema"},class:{icon:"",name:"Class Diagram",desc:"OOP classes"},mindmap:{icon:"",name:"Mind Map",desc:"Ideas hierarchy"},orgchart:{icon:"",name:"Org Chart",desc:"Organization"},gantt:{icon:"",name:"Gantt Chart",desc:"Project timeline"},timeline:{icon:"",name:"Timeline",desc:"Events timeline"},requirement:{icon:"",name:"Requirements",desc:"Specifications"},sequence:{icon:"",name:"Sequence",desc:"Message flow"},usecase:{icon:"",name:"Use Case",desc:"Actor interactions"},pie:{icon:"",name:"Pie Chart",desc:"Data distribution"},quadrant:{icon:"",name:"Quadrant",desc:"Priority matrix"},wireframe:{icon:"",name:"Wireframe",desc:"UI mockups"},git:{icon:"",name:"Git Graph",desc:"Branch history"},swimlane:{icon:"",name:"Swimlane",desc:"Process with roles"},sankey:{icon:"",name:"Sankey",desc:"Flow visualization"}};function cv({activeType:i,onTypeChange:t,theme:r}){const[n,a]=M.useState(!1),[s,e]=M.useState(null),l=M.useRef(null),h=(r==null?void 0:r.name)==="dark";M.useEffect(()=>{function x(g){l.current&&!l.current.contains(g.target)&&a(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const d=qh[i]||{icon:"",name:i},p={container:{position:"relative"},trigger:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",background:n?h?"rgba(124,58,237,0.3)":"rgba(124,58,237,0.2)":h?"rgba(124,58,237,0.15)":"rgba(124,58,237,0.1)",border:`1px solid ${n?it.purple:"rgba(124,58,237,0.3)"}`,borderRadius:8,cursor:"pointer",transition:"all 0.15s ease"},triggerIcon:{fontSize:"1rem"},triggerText:{color:h?"#fff":"#1e293b",fontSize:"0.9rem",fontWeight:600},triggerDesc:{color:h?"#888":"#64748b",fontSize:"0.75rem"},caret:{color:h?"#888":"#64748b",fontSize:"0.65rem",marginLeft:"4px",transition:"transform 0.15s ease",transform:n?"rotate(180deg)":"rotate(0deg)"},dropdown:{position:"absolute",top:"calc(100% + 6px)",left:0,width:"320px",maxHeight:"70vh",overflowY:"auto",background:h?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))",border:`1px solid ${h?"rgba(124,58,237,0.3)":"rgba(124,58,237,0.2)"}`,borderRadius:12,boxShadow:"0 15px 50px rgba(0,0,0,0.3)",zIndex:1e3,backdropFilter:"blur(10px)"},category:{padding:"8px 0",borderBottom:`1px solid ${h?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}`},categoryLast:{padding:"8px 0"},categoryHeader:x=>({display:"flex",alignItems:"center",gap:"8px",padding:"6px 14px",fontSize:"0.75rem",fontWeight:600,color:x,textTransform:"uppercase",letterSpacing:"0.5px"}),typeGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px",padding:"0 8px"},typeItem:(x,g)=>({display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",borderRadius:6,cursor:"pointer",background:x?h?"rgba(124,58,237,0.3)":"rgba(124,58,237,0.15)":g?h?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)":"transparent",border:x?`1px solid ${it.purple}`:"1px solid transparent",transition:"all 0.1s ease"}),typeIcon:{fontSize:"1rem"},typeContent:{flex:1,minWidth:0},typeName:x=>({fontSize:"0.85rem",fontWeight:x?600:500,color:x?it.purple:h?"#e2e8f0":"#334155",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),typeDesc:{fontSize:"0.7rem",color:h?"#666":"#94a3b8"},checkmark:{color:it.green,fontSize:"0.8rem"}},f=Object.entries(sv);return o.jsxs("div",{ref:l,style:p.container,children:[o.jsxs("div",{style:p.trigger,onClick:()=>a(!n),onMouseEnter:x=>{n||(x.currentTarget.style.background=h?"rgba(124,58,237,0.25)":"rgba(124,58,237,0.15)")},onMouseLeave:x=>{n||(x.currentTarget.style.background=h?"rgba(124,58,237,0.15)":"rgba(124,58,237,0.1)")},children:[o.jsx("span",{style:p.triggerIcon,children:d.icon}),o.jsxs("div",{children:[o.jsx("div",{style:p.triggerText,children:d.name}),o.jsx("div",{style:p.triggerDesc,children:d.desc})]}),o.jsx("span",{style:p.caret,children:""})]}),n&&o.jsx("div",{style:p.dropdown,children:f.map(([x,g],m)=>o.jsxs("div",{style:m<f.length-1?p.category:p.categoryLast,children:[o.jsxs("div",{style:p.categoryHeader(g.color),children:[o.jsx("span",{children:g.icon}),o.jsx("span",{children:x})]}),o.jsx("div",{style:p.typeGrid,children:g.types.map(c=>{const u=qh[c],b=c===i,y=s===c;return o.jsxs("div",{style:p.typeItem(b,y),onClick:()=>{t(c),a(!1)},onMouseEnter:()=>e(c),onMouseLeave:()=>e(null),children:[o.jsx("span",{style:p.typeIcon,children:u.icon}),o.jsxs("div",{style:p.typeContent,children:[o.jsx("div",{style:p.typeName(b),children:u.name}),o.jsx("div",{style:p.typeDesc,children:u.desc})]}),b&&o.jsx("span",{style:p.checkmark,children:""})]},c)})})]},x))})]})}const V={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",orange:"#F59E0B",pink:"#EC4899",red:"#EF4444",cyan:"#06B6D4",violet:"#8B5CF6",teal:"#14B8A6",amber:"#D97706",emerald:"#059669",sky:"#0284C7"},lv={flowchart:{name:"Flowchart",categories:[{name:"Flow Control",nodes:[{type:"start",icon:"",label:"Start",color:V.green,dsl:"(start) Start"},{type:"end",icon:"",label:"End",color:V.red,dsl:"(end) End"},{type:"decision",icon:"",label:"Decision",color:V.orange,dsl:"(decision) Decision?"}]},{name:"Actions",nodes:[{type:"process",icon:"",label:"Process",color:V.blue,dsl:"(process) Process"},{type:"action",icon:"",label:"Action",color:V.purple,dsl:"(action) Action"},{type:"io",icon:"",label:"Input/Output",color:V.cyan,dsl:"(io) Input/Output"}]}]},architecture:{name:"Architecture",categories:[{name:"Frontend",nodes:[{type:"clients",icon:"",label:"Client",color:V.pink,dsl:"[clients] Client"},{type:"gateway",icon:"",label:"Gateway",color:V.orange,dsl:"[gateway] API Gateway"}]},{name:"Backend",nodes:[{type:"services",icon:"",label:"Service",color:V.blue,dsl:"[services] Service"},{type:"data",icon:"",label:"Database",color:V.emerald,dsl:"[data] Database"},{type:"cache",icon:"",label:"Cache",color:V.red,dsl:"[cache] Redis"},{type:"queue",icon:"",label:"Queue",color:V.amber,dsl:"[queue] Message Queue"},{type:"storage",icon:"",label:"Storage",color:V.teal,dsl:"[storage] S3 Bucket"}]}]},journey:{name:"User Journey",categories:[{name:"People",nodes:[{type:"actor",icon:"",label:"Actor",color:V.pink,dsl:"[actor] User"},{type:"user",icon:"",label:"User",color:V.pink,dsl:"[user] Customer"}]},{name:"Touchpoints",nodes:[{type:"page",icon:"",label:"Page",color:V.cyan,dsl:"[page] Landing Page"},{type:"screen",icon:"",label:"Screen",color:V.cyan,dsl:"[screen] Dashboard"},{type:"action",icon:"",label:"Action",color:V.purple,dsl:"[action] Click Button"},{type:"form",icon:"",label:"Form",color:V.orange,dsl:"[form] Sign Up Form"}]},{name:"Communication",nodes:[{type:"email",icon:"",label:"Email",color:V.amber,dsl:"[email] Welcome Email"},{type:"notification",icon:"",label:"Notification",color:V.red,dsl:"[notification] Alert"}]},{name:"Outcomes",nodes:[{type:"success",icon:"",label:"Success",color:V.green,dsl:"[success] Completed"},{type:"error",icon:"",label:"Error",color:V.red,dsl:"[error] Failed"},{type:"milestone",icon:"",label:"Milestone",color:V.green,dsl:"[milestone] Goal Reached"},{type:"decision",icon:"",label:"Decision",color:V.orange,dsl:"[decision] Choose Path"}]}]},state:{name:"State Machine",categories:[{name:"States",nodes:[{type:"initial",icon:"",label:"Initial",color:V.green,dsl:"(initial) Initial"},{type:"state",icon:"",label:"State",color:V.blue,dsl:"State"},{type:"final",icon:"",label:"Final",color:V.red,dsl:"(final) Final"}]}]},erd:{name:"ERD",categories:[{name:"Tables",nodes:[{type:"table",icon:"",label:"Table",color:V.blue,dsl:`CREATE TABLE table_name (
  id UUID PRIMARY KEY,
  name VARCHAR(255)
);`},{type:"pk",icon:"",label:"Primary Key",color:V.amber,dsl:"  id UUID PRIMARY KEY,"},{type:"fk",icon:"",label:"Foreign Key",color:V.purple,dsl:"  ref_id UUID REFERENCES other_table(id),"},{type:"column",icon:"",label:"Column",color:V.cyan,dsl:"  column_name VARCHAR(255),"}]}]},sequence:{name:"Sequence",categories:[{name:"Participants",nodes:[{type:"participant",icon:"",label:"Participant",color:V.blue,dsl:"participant Actor"}]},{name:"Messages",nodes:[{type:"request",icon:"",label:"Request",color:V.green,dsl:"A -> B: Request"},{type:"response",icon:"",label:"Response",color:V.orange,dsl:"B --> A: Response"}]}]},mindmap:{name:"Mind Map",categories:[{name:"Nodes",nodes:[{type:"root",icon:"",label:"Root",color:V.purple,dsl:"Root Topic"},{type:"branch",icon:"",label:"Branch",color:V.blue,dsl:"  Branch"},{type:"leaf",icon:"",label:"Leaf",color:V.green,dsl:"    Leaf"}]}]},class:{name:"Class Diagram",categories:[{name:"Classes",nodes:[{type:"class",icon:"",label:"Class",color:V.blue,dsl:`class ClassName
  + property: type
  + method(): void`},{type:"interface",icon:"",label:"Interface",color:V.purple,dsl:`interface IName
  + method(): void`}]},{name:"Members",nodes:[{type:"public",icon:"",label:"Public",color:V.green,dsl:"  + publicMember: type"},{type:"private",icon:"",label:"Private",color:V.red,dsl:"  - privateMember: type"},{type:"protected",icon:"#",label:"Protected",color:V.orange,dsl:"  # protectedMember: type"}]}]},deployment:{name:"Deployment",categories:[{name:"Infrastructure",nodes:[{type:"cloud",icon:"",label:"Cloud",color:V.sky,dsl:"[cloud] AWS"},{type:"cluster",icon:"",label:"Cluster",color:V.teal,dsl:"  [cluster] Kubernetes"},{type:"container",icon:"",label:"Container",color:V.cyan,dsl:"    [container] Service"}]},{name:"Data",nodes:[{type:"database",icon:"",label:"Database",color:V.green,dsl:"  [database] PostgreSQL"},{type:"storage",icon:"",label:"Storage",color:V.emerald,dsl:"  [storage] S3"}]},{name:"Clients",nodes:[{type:"device",icon:"",label:"Device",color:V.pink,dsl:"[device] Browser"},{type:"server",icon:"",label:"Server",color:V.violet,dsl:"[server] Web Server"}]}]},network:{name:"Network",categories:[{name:"Devices",nodes:[{type:"cloud",icon:"",label:"Cloud",color:V.sky,dsl:"[cloud] Internet"},{type:"firewall",icon:"",label:"Firewall",color:V.red,dsl:"[firewall] Firewall (10.0.0.1)"},{type:"router",icon:"",label:"Router",color:V.orange,dsl:"[router] Router (10.0.0.2)"},{type:"switch",icon:"",label:"Switch",color:V.blue,dsl:"[switch] Switch (10.0.0.3)"},{type:"server",icon:"",label:"Server",color:V.purple,dsl:"[server] Server (10.0.0.10)"},{type:"computer",icon:"",label:"Computer",color:V.green,dsl:"[computer] Workstation"}]}]},usecase:{name:"Use Case",categories:[{name:"Elements",nodes:[{type:"actor",icon:"",label:"Actor",color:V.blue,dsl:"actor User"},{type:"usecase",icon:"",label:"Use Case",color:V.purple,dsl:"(Use Case Name)"}]}]},component:{name:"Component",categories:[{name:"Components",nodes:[{type:"component",icon:"",label:"Component",color:V.purple,dsl:"[component] Component"},{type:"service",icon:"",label:"Service",color:V.blue,dsl:"[service] Service"},{type:"api",icon:"",label:"API",color:V.orange,dsl:"[api] API Gateway"},{type:"database",icon:"",label:"Database",color:V.green,dsl:"[database] Database"},{type:"cache",icon:"",label:"Cache",color:V.red,dsl:"[cache] Redis"}]}]},c4:{name:"C4 Model",categories:[{name:"Elements",nodes:[{type:"person",icon:"",label:"Person",color:V.blue,dsl:"[person] User: Description"},{type:"system",icon:"",label:"System",color:V.purple,dsl:"[system] System: Description"},{type:"container",icon:"",label:"Container",color:V.cyan,dsl:"[container] Container: Description"},{type:"component",icon:"",label:"Component",color:V.green,dsl:"[component] Component: Description"},{type:"external",icon:"",label:"External",color:V.orange,dsl:"[external] External: Description"}]}]},activity:{name:"Activity",categories:[{name:"Control",nodes:[{type:"start",icon:"",label:"Start",color:V.green,dsl:"[start]"},{type:"end",icon:"",label:"End",color:V.red,dsl:"[end]"},{type:"decision",icon:"",label:"Decision",color:V.orange,dsl:"<Decision?>"}]},{name:"Actions",nodes:[{type:"action",icon:"",label:"Action",color:V.blue,dsl:":Action;"}]}]},gantt:{name:"Gantt",categories:[{name:"Tasks",nodes:[{type:"task",icon:"",label:"Task",color:V.blue,dsl:"Task Name, 0, 3"},{type:"milestone",icon:"",label:"Milestone",color:V.green,dsl:"Milestone, 5, 0"}]}]},timeline:{name:"Timeline",categories:[{name:"Events",nodes:[{type:"event",icon:"",label:"Event",color:V.blue,dsl:"[Date] Event Title | Description"},{type:"milestone",icon:"",label:"Milestone",color:V.green,dsl:"[Date] *Milestone | Description"}]}]},wireframe:{name:"Wireframe",categories:[{name:"Layout",nodes:[{type:"window",icon:"",label:"Window",color:V.blue,dsl:"{Window Title}"},{type:"navbar",icon:"",label:"Navbar",color:V.purple,dsl:"[[ Home | About | Contact ]]"},{type:"tabs",icon:"",label:"Tabs",color:V.cyan,dsl:"(( Tab1 | Tab2 | Tab3 ))"},{type:"card",icon:"",label:"Card",color:V.orange,dsl:`<Card Title>
Content here
</Card>`}]},{name:"Elements",nodes:[{type:"button",icon:"",label:"Button",color:V.green,dsl:"[Button Text]"},{type:"input",icon:"",label:"Input",color:V.blue,dsl:"[text: Placeholder...]"},{type:"search",icon:"",label:"Search",color:V.purple,dsl:"[search: Search...]"},{type:"dropdown",icon:"",label:"Dropdown",color:V.orange,dsl:"[v Select Option]"}]},{name:"Content",nodes:[{type:"heading",icon:"",label:"Heading",color:V.blue,dsl:"# Heading Text"},{type:"divider",icon:"",label:"Divider",color:V.cyan,dsl:"---"},{type:"table",icon:"",label:"Table",color:V.purple,dsl:`|Col1|Col2|Col3|
|Data|Data|Data|`},{type:"progress",icon:"",label:"Progress",color:V.green,dsl:"[progress: 75%]"}]}]}},dv={name:"Generic",categories:[{name:"Basic",nodes:[{type:"node",icon:"",label:"Node",color:V.blue,dsl:"Node"}]}]};function uv({isOpen:i,diagramType:t,onDragStart:r,onClose:n,onAddNode:a,theme:s}){const[e,l]=M.useState(""),[h,d]=M.useState({}),p=(s==null?void 0:s.name)==="dark",f=lv[t]||dv,x=M.useMemo(()=>{if(!e.trim())return f.categories;const b=e.toLowerCase();return f.categories.map(y=>({...y,nodes:y.nodes.filter(S=>S.label.toLowerCase().includes(b)||S.type.toLowerCase().includes(b))})).filter(y=>y.nodes.length>0)},[f.categories,e]),g=b=>{d(y=>({...y,[b]:!y[b]}))},m=(b,y)=>{b.dataTransfer.setData("text/plain",y.dsl),b.dataTransfer.effectAllowed="copy",r&&r(y)},c=b=>{a&&a(b.dsl)};if(!i)return null;const u={sidebar:{position:"fixed",left:0,top:105,width:260,height:"calc(100vh - 105px)",background:p?"linear-gradient(180deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(180deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))",borderRight:`1px solid ${p?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)"}`,display:"flex",flexDirection:"column",overflow:"hidden",zIndex:100,boxShadow:"4px 0 20px rgba(0,0,0,0.2)"},header:{padding:"12px 14px",borderBottom:`1px solid ${p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:p?"rgba(124,58,237,0.1)":"rgba(124,58,237,0.05)"},headerTitle:{display:"flex",alignItems:"center",gap:8},headerIcon:{fontSize:"1rem"},title:{fontSize:"0.8rem",fontWeight:600,color:p?"#fff":"#1e293b"},subtitle:{fontSize:"0.65rem",color:p?"#888":"#64748b"},closeBtn:{background:"transparent",border:"none",color:p?"#888":"#64748b",cursor:"pointer",fontSize:"1rem",padding:4,borderRadius:4},search:{padding:"10px 14px",borderBottom:`1px solid ${p?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}`},searchInput:{width:"100%",padding:"8px 12px",background:p?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",border:`1px solid ${p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,borderRadius:6,color:p?"#fff":"#1e293b",fontSize:"0.75rem",outline:"none"},content:{flex:1,overflowY:"auto",padding:"8px 0"},category:{marginBottom:4},categoryHeader:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",cursor:"pointer",color:p?"#aaa":"#64748b",fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},categoryArrow:b=>({transition:"transform 0.2s",transform:b?"rotate(90deg)":"rotate(0deg)",fontSize:"0.6rem"}),nodesGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:6,padding:"4px 10px 12px"},nodeItem:b=>({display:"flex",flexDirection:"column",alignItems:"center",padding:"10px 6px",background:p?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.03)",border:`1px solid ${p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)"}`,borderRadius:8,cursor:"grab",transition:"all 0.15s"}),nodeIcon:{fontSize:"1.2rem",marginBottom:4},nodeLabel:{fontSize:"0.65rem",color:p?"#ccc":"#334155",textAlign:"center",fontWeight:500},emptyState:{padding:"20px 14px",textAlign:"center",color:p?"#666":"#94a3b8",fontSize:"0.75rem"},tip:{padding:"10px 14px",borderTop:`1px solid ${p?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}`,background:p?"rgba(124,58,237,0.05)":"rgba(124,58,237,0.03)"},tipText:{fontSize:"0.65rem",color:p?"#888":"#64748b",textAlign:"center"}};return o.jsxs("div",{style:u.sidebar,children:[o.jsxs("div",{style:u.header,children:[o.jsxs("div",{style:u.headerTitle,children:[o.jsx("span",{style:u.headerIcon,children:""}),o.jsxs("div",{children:[o.jsx("div",{style:u.title,children:"Node Library"}),o.jsx("div",{style:u.subtitle,children:f.name})]})]}),o.jsx("button",{style:u.closeBtn,onClick:n,title:"Close library",children:""})]}),o.jsx("div",{style:u.search,children:o.jsx("input",{type:"text",placeholder:"Search nodes...",value:e,onChange:b=>l(b.target.value),style:u.searchInput})}),o.jsx("div",{style:u.content,children:x.length===0?o.jsx("div",{style:u.emptyState,children:"No nodes match your search"}):x.map(b=>{const y=h[b.name]!==!1;return o.jsxs("div",{style:u.category,children:[o.jsxs("div",{style:u.categoryHeader,onClick:()=>g(b.name),children:[o.jsx("span",{style:u.categoryArrow(y),children:""}),o.jsx("span",{children:b.name}),o.jsx("span",{style:{marginLeft:"auto",opacity:.6},children:b.nodes.length})]}),y&&o.jsx("div",{style:u.nodesGrid,children:b.nodes.map(S=>o.jsxs("div",{style:u.nodeItem(S.color),draggable:!0,onClick:()=>c(S),onDragStart:w=>m(w,S),onMouseEnter:w=>{w.currentTarget.style.borderColor=S.color,w.currentTarget.style.transform="translateY(-2px)",w.currentTarget.style.boxShadow=`0 4px 12px ${S.color}30`},onMouseLeave:w=>{w.currentTarget.style.borderColor=p?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",w.currentTarget.style.transform="none",w.currentTarget.style.boxShadow="none"},title:`Click or drag to add ${S.label}`,children:[o.jsx("span",{style:u.nodeIcon,children:S.icon}),o.jsx("span",{style:u.nodeLabel,children:S.label})]},S.type))})]},b.name)})}),o.jsx("div",{style:u.tip,children:o.jsx("div",{style:u.tipText,children:"Click or drag nodes to add them to your diagram"})})]})}const st={CURRENT_DIAGRAM:"ddflow_current_diagram",RECENT_FILES:"ddflow_recent_files",AUTO_SAVE_ENABLED:"ddflow_autosave_enabled",COLOR_SETTINGS:"ddflow_color_settings"},pv=10;function hv(){try{const i=localStorage.getItem(st.CURRENT_DIAGRAM);if(i)return JSON.parse(i)}catch(i){console.error("Failed to load diagram from localStorage:",i)}return null}function Oh(i,t,r="Untitled Diagram"){try{const n={type:i,source:t,name:r,savedAt:new Date().toISOString(),version:"1.0"};return localStorage.setItem(st.CURRENT_DIAGRAM,JSON.stringify(n)),!0}catch(n){return console.error("Failed to save diagram to localStorage:",n),!1}}function Pc(){try{const i=localStorage.getItem(st.RECENT_FILES);if(i)return JSON.parse(i)}catch(i){console.error("Failed to load recent files:",i)}return[]}function lg(i){try{let t=Pc();t=t.filter(r=>r.name!==i.name),t.unshift({...i,savedAt:new Date().toISOString()}),t=t.slice(0,pv),localStorage.setItem(st.RECENT_FILES,JSON.stringify(t))}catch(t){console.error("Failed to add to recent files:",t)}}function fv(i){try{let t=Pc();t=t.filter(r=>r.name!==i),localStorage.setItem(st.RECENT_FILES,JSON.stringify(t))}catch(t){console.error("Failed to remove from recent files:",t)}}function gv(i,t,r="diagram"){const n={type:i,source:t,name:r,exportedAt:new Date().toISOString(),version:"1.0",format:"ddflow"},a=JSON.stringify(n,null,2),s=new Blob([a],{type:"application/json"}),e=URL.createObjectURL(s),l=document.createElement("a");l.href=e,l.download=`${r}.ddflow`,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>URL.revokeObjectURL(e),100),lg({name:r,type:i,source:t})}function xv(){return new Promise((i,t)=>{const r=document.createElement("input");r.type="file",r.accept=".ddflow,.json",r.style.display="none",r.onchange=async n=>{var s;const a=(s=n.target.files)==null?void 0:s[0];if(!a){t(new Error("No file selected"));return}try{const e=await a.text(),l=JSON.parse(e);if(!l.type||!l.source)throw new Error("Invalid diagram file: missing type or source");l.name||(l.name=a.name.replace(/\.(ddflow|json)$/i,"")),lg({name:l.name,type:l.type,source:l.source}),i(l)}catch(e){t(new Error(`Failed to parse file: ${e.message}`))}},r.onerror=()=>{t(new Error("Failed to open file"))},document.body.appendChild(r),r.click(),document.body.removeChild(r)})}function mv(){try{return localStorage.getItem(st.AUTO_SAVE_ENABLED)!=="false"}catch{return!0}}function yv(i){try{localStorage.setItem(st.AUTO_SAVE_ENABLED,String(i))}catch(t){console.error("Failed to save auto-save setting:",t)}}function bv(i){try{const t=new Date(i),n=new Date-t,a=Math.floor(n/6e4),s=Math.floor(n/36e5),e=Math.floor(n/864e5);return a<1?"Just now":a<60?`${a}m ago`:s<24?`${s}h ago`:e<7?`${e}d ago`:t.toLocaleDateString()}catch{return"Unknown"}}const Ir={accentPrimary:"#7C3AED",accentSecondary:"#6366F1",selection:"#0EA5E9",success:"#10B981",warning:"#F59E0B",error:"#EF4444"},ac={purple:{name:"Purple (Default)",icon:"",accentPrimary:"#7C3AED",accentSecondary:"#6366F1"},blue:{name:"Ocean Blue",icon:"",accentPrimary:"#0EA5E9",accentSecondary:"#3B82F6"},green:{name:"Forest Green",icon:"",accentPrimary:"#10B981",accentSecondary:"#059669"},orange:{name:"Sunset Orange",icon:"",accentPrimary:"#F59E0B",accentSecondary:"#D97706"},pink:{name:"Rose Pink",icon:"",accentPrimary:"#EC4899",accentSecondary:"#DB2777"},cyan:{name:"Teal Cyan",icon:"",accentPrimary:"#06B6D4",accentSecondary:"#14B8A6"},red:{name:"Ruby Red",icon:"",accentPrimary:"#EF4444",accentSecondary:"#DC2626"}};function dg(){try{const i=localStorage.getItem(st.COLOR_SETTINGS);if(i)return{...Ir,...JSON.parse(i)}}catch(i){console.error("Failed to load color settings:",i)}return{...Ir}}function vv(i){try{return localStorage.setItem(st.COLOR_SETTINGS,JSON.stringify(i)),!0}catch(t){return console.error("Failed to save color settings:",t),!1}}function wv(){try{localStorage.removeItem(st.COLOR_SETTINGS)}catch(i){console.error("Failed to reset color settings:",i)}}function Sv({isOpen:i,onClose:t,onApply:r,theme:n}){const[a,s]=M.useState(()=>dg()),[e,l]=M.useState(null),h=(n==null?void 0:n.name)==="dark";M.useEffect(()=>{const c=Object.entries(ac).find(([u,b])=>b.accentPrimary===a.accentPrimary&&b.accentSecondary===a.accentSecondary);l(c?c[0]:null)},[a]);const d=c=>{const u=ac[c],b={...a,accentPrimary:u.accentPrimary,accentSecondary:u.accentSecondary};s(b)},p=(c,u)=>{s(b=>({...b,[c]:u}))},f=()=>{vv(a),r&&r(a),t()},x=()=>{wv(),s({...Ir}),r&&r(Ir)};if(!i)return null;const g={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},modal:{background:(n==null?void 0:n.modalBg)||(h?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))"),borderRadius:16,border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,width:"100%",maxWidth:480,overflow:"hidden",boxShadow:"0 25px 50px rgba(0,0,0,0.4)"},header:{padding:"16px 20px",borderBottom:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:`${a.accentPrimary}15`},headerTitle:{display:"flex",alignItems:"center",gap:10},headerIcon:{fontSize:"1.2rem"},title:{fontWeight:600,color:(n==null?void 0:n.textPrimary)||"#fff"},closeBtn:{background:"transparent",border:"none",color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"1.2rem",cursor:"pointer",padding:4},content:{padding:20,maxHeight:"calc(80vh - 140px)",overflowY:"auto"},section:{marginBottom:24},sectionTitle:{fontSize:"0.75rem",fontWeight:600,color:(n==null?void 0:n.textSecondary)||"#888",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:12},presetsGrid:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},presetItem:(c,u)=>({display:"flex",flexDirection:"column",alignItems:"center",gap:6,padding:"12px 8px",background:c?`${u}20`:h?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",border:`2px solid ${c?u:"transparent"}`,borderRadius:10,cursor:"pointer",transition:"all 0.15s"}),presetIcon:{fontSize:"1.4rem"},presetName:{fontSize:"0.65rem",color:(n==null?void 0:n.textPrimary)||"#fff",textAlign:"center",fontWeight:500},colorRow:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:`1px solid ${h?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}`},colorLabel:{display:"flex",flexDirection:"column",gap:2},colorName:{fontSize:"0.85rem",fontWeight:500,color:(n==null?void 0:n.textPrimary)||"#fff"},colorDesc:{fontSize:"0.7rem",color:(n==null?void 0:n.textSecondary)||"#888"},colorInput:{display:"flex",alignItems:"center",gap:8},colorPicker:{width:36,height:36,border:"none",borderRadius:8,cursor:"pointer",padding:0},colorHex:{fontSize:"0.75rem",fontFamily:"Monaco, monospace",color:(n==null?void 0:n.textSecondary)||"#888",background:h?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",padding:"4px 8px",borderRadius:4},preview:{padding:16,background:h?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",borderRadius:10,display:"flex",flexWrap:"wrap",gap:8},previewItem:c=>({padding:"6px 12px",background:`${c}20`,border:`1px solid ${c}`,borderRadius:6,color:c,fontSize:"0.75rem",fontWeight:500}),footer:{padding:"12px 20px",borderTop:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,display:"flex",justifyContent:"space-between",alignItems:"center"},resetBtn:{padding:"8px 16px",background:"transparent",border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"0.8rem",cursor:"pointer"},buttonGroup:{display:"flex",gap:10},cancelBtn:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"0.8rem",cursor:"pointer"},applyBtn:{padding:"8px 16px",background:`linear-gradient(135deg, ${a.accentPrimary}, ${a.accentSecondary})`,border:"none",borderRadius:6,color:"#fff",fontSize:"0.8rem",fontWeight:600,cursor:"pointer"}},m=[{key:"accentPrimary",name:"Primary Accent",desc:"Main brand color for buttons, links"},{key:"accentSecondary",name:"Secondary Accent",desc:"Gradients and hover states"},{key:"selection",name:"Selection",desc:"Selected items highlight"},{key:"success",name:"Success",desc:"Success messages and states"},{key:"warning",name:"Warning",desc:"Warning messages and states"},{key:"error",name:"Error",desc:"Error messages and states"}];return o.jsx("div",{style:g.overlay,onClick:t,children:o.jsxs("div",{style:g.modal,onClick:c=>c.stopPropagation(),children:[o.jsxs("div",{style:g.header,children:[o.jsxs("div",{style:g.headerTitle,children:[o.jsx("span",{style:g.headerIcon,children:""}),o.jsx("span",{style:g.title,children:"Color Settings"})]}),o.jsx("button",{style:g.closeBtn,onClick:t,children:""})]}),o.jsxs("div",{style:g.content,children:[o.jsxs("div",{style:g.section,children:[o.jsx("div",{style:g.sectionTitle,children:"Color Presets"}),o.jsx("div",{style:g.presetsGrid,children:Object.entries(ac).map(([c,u])=>o.jsxs("div",{style:g.presetItem(e===c,u.accentPrimary),onClick:()=>d(c),onMouseEnter:b=>{e!==c&&(b.currentTarget.style.borderColor=u.accentPrimary+"50")},onMouseLeave:b=>{e!==c&&(b.currentTarget.style.borderColor="transparent")},children:[o.jsx("span",{style:g.presetIcon,children:u.icon}),o.jsx("span",{style:g.presetName,children:u.name.split(" ")[0]})]},c))})]}),o.jsxs("div",{style:g.section,children:[o.jsx("div",{style:g.sectionTitle,children:"Custom Colors"}),m.map(({key:c,name:u,desc:b})=>o.jsxs("div",{style:g.colorRow,children:[o.jsxs("div",{style:g.colorLabel,children:[o.jsx("span",{style:g.colorName,children:u}),o.jsx("span",{style:g.colorDesc,children:b})]}),o.jsxs("div",{style:g.colorInput,children:[o.jsx("input",{type:"color",value:a[c],onChange:y=>p(c,y.target.value),style:g.colorPicker}),o.jsx("span",{style:g.colorHex,children:a[c]})]})]},c))]}),o.jsxs("div",{style:g.section,children:[o.jsx("div",{style:g.sectionTitle,children:"Preview"}),o.jsxs("div",{style:g.preview,children:[o.jsx("span",{style:g.previewItem(a.accentPrimary),children:"Primary"}),o.jsx("span",{style:g.previewItem(a.accentSecondary),children:"Secondary"}),o.jsx("span",{style:g.previewItem(a.selection),children:"Selected"}),o.jsx("span",{style:g.previewItem(a.success),children:"Success"}),o.jsx("span",{style:g.previewItem(a.warning),children:"Warning"}),o.jsx("span",{style:g.previewItem(a.error),children:"Error"})]})]})]}),o.jsxs("div",{style:g.footer,children:[o.jsx("button",{style:g.resetBtn,onClick:x,children:"Reset to Default"}),o.jsxs("div",{style:g.buttonGroup,children:[o.jsx("button",{style:g.cancelBtn,onClick:t,children:"Cancel"}),o.jsx("button",{style:g.applyBtn,onClick:f,children:"Apply Colors"})]})]})]})})}const we={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",red:"#EF4444",indigo:"#6366F1"},kv=10*1024*1024,Fh=["image/png","image/jpeg","image/jpg","image/webp","image/gif"];function jv({isOpen:i,onClose:t,onImport:r,theme:n}){const[a,s]=M.useState(null),[e,l]=M.useState(!1),[h,d]=M.useState(!1),[p,f]=M.useState(null),[x,g]=M.useState(null),m=M.useRef(null),c=M.useRef(null),u=(n==null?void 0:n.name)==="dark";M.useEffect(()=>{i||(s(null),f(null),g(null),d(!1))},[i]),M.useEffect(()=>{if(!i)return;const D=async U=>{var H;const N=(H=U.clipboardData)==null?void 0:H.items;if(N){for(const ee of N)if(ee.type.startsWith("image/")){U.preventDefault();const ne=ee.getAsFile();ne&&await b(ne);break}}};return document.addEventListener("paste",D),()=>document.removeEventListener("paste",D)},[i]);const b=async D=>{if(g(null),f(null),!Fh.includes(D.type)){g(`Unsupported file type: ${D.type}. Please use PNG, JPG, WEBP, or GIF.`);return}if(D.size>kv){g(`File too large (${(D.size/1024/1024).toFixed(1)}MB). Maximum size is 10MB.`);return}const U=new FileReader;U.onload=N=>{const H=N.target.result,ee=H.split(",")[1];s({base64:ee,mimeType:D.type,name:D.name,size:D.size,preview:H})},U.onerror=()=>{g("Failed to read file. Please try again.")},U.readAsDataURL(D)},y=M.useCallback(D=>{D.preventDefault(),D.stopPropagation(),l(!0)},[]),S=M.useCallback(D=>{D.preventDefault(),D.stopPropagation(),l(!1)},[]),w=M.useCallback(async D=>{var N;D.preventDefault(),D.stopPropagation(),l(!1);const U=(N=D.dataTransfer)==null?void 0:N.files;U&&U.length>0&&await b(U[0])},[]),k=async D=>{var N;const U=(N=D.target.files)==null?void 0:N[0];U&&await b(U)},[j,C]=M.useState(null),E=async()=>{if(!(!a||!Dt())){d(!0),g(null),f(null),C(null);try{const D=await K1(a.base64,a.mimeType);f(D),C(D.type)}catch(D){g(D.message||"Failed to analyze image. Please try again.")}finally{d(!1)}}},R=()=>{p&&r&&r(j||p.type,p.dsl,p.name)},T=D=>{C(D)},I=()=>{s(null),f(null),g(null),m.current&&(m.current.value="")};if(!i)return null;const B=D=>D<1024?`${D} B`:D<1024*1024?`${(D/1024).toFixed(1)} KB`:`${(D/1024/1024).toFixed(1)} MB`,z={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},modal:{background:(n==null?void 0:n.modalBg)||(u?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))"),borderRadius:16,border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,width:"100%",maxWidth:600,maxHeight:"90vh",overflow:"hidden",boxShadow:"0 25px 50px rgba(0,0,0,0.4)",display:"flex",flexDirection:"column"},header:{padding:"16px 20px",borderBottom:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:`${we.purple}15`},headerTitle:{display:"flex",alignItems:"center",gap:10},headerIcon:{fontSize:"1.2rem"},title:{fontWeight:600,color:(n==null?void 0:n.textPrimary)||"#fff"},subtitle:{fontSize:"0.7rem",color:(n==null?void 0:n.textSecondary)||"#888"},closeBtn:{background:"transparent",border:"none",color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"1.2rem",cursor:"pointer",padding:4},content:{padding:20,flex:1,overflowY:"auto"},dropZone:{border:`2px dashed ${e?we.purple:u?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"}`,borderRadius:12,padding:40,textAlign:"center",cursor:"pointer",transition:"all 0.2s",background:e?`${we.purple}10`:"transparent"},dropIcon:{fontSize:"3rem",marginBottom:16,opacity:.7},dropText:{fontSize:"1rem",fontWeight:500,color:(n==null?void 0:n.textPrimary)||"#fff",marginBottom:8},dropSubtext:{fontSize:"0.8rem",color:(n==null?void 0:n.textSecondary)||"#888",marginBottom:16},browseBtn:{padding:"8px 20px",background:`${we.purple}20`,border:`1px solid ${we.purple}`,borderRadius:8,color:we.purple,fontSize:"0.85rem",fontWeight:500,cursor:"pointer"},pasteHint:{fontSize:"0.7rem",color:(n==null?void 0:n.textMuted)||"#666",marginTop:16},imagePreview:{marginTop:20,padding:16,background:u?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",borderRadius:12},previewHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},previewInfo:{display:"flex",alignItems:"center",gap:8},previewName:{fontSize:"0.85rem",fontWeight:500,color:(n==null?void 0:n.textPrimary)||"#fff"},previewSize:{fontSize:"0.75rem",color:(n==null?void 0:n.textSecondary)||"#888"},clearBtn:{padding:"4px 10px",background:"transparent",border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"0.75rem",cursor:"pointer"},previewImage:{width:"100%",maxHeight:300,objectFit:"contain",borderRadius:8,background:u?"rgba(0,0,0,0.5)":"#fff"},analyzeBtn:{width:"100%",padding:"12px 20px",background:`linear-gradient(135deg, ${we.purple}, ${we.indigo})`,border:"none",borderRadius:8,color:"#fff",fontSize:"0.9rem",fontWeight:600,cursor:"pointer",marginTop:16,display:"flex",alignItems:"center",justifyContent:"center",gap:8},analyzingBtn:{width:"100%",padding:"12px 20px",background:`${we.purple}50`,border:"none",borderRadius:8,color:"#fff",fontSize:"0.9rem",fontWeight:600,cursor:"not-allowed",marginTop:16,display:"flex",alignItems:"center",justifyContent:"center",gap:8},error:{marginTop:16,padding:"12px 16px",background:`${we.red}15`,border:`1px solid ${we.red}40`,borderRadius:8,color:we.red,fontSize:"0.85rem"},result:{marginTop:20,padding:16,background:u?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",borderRadius:12},resultHeader:{display:"flex",alignItems:"center",gap:8,marginBottom:12},resultIcon:{fontSize:"1rem"},resultTitle:{fontSize:"0.9rem",fontWeight:600,color:we.green},dslPreview:{background:(n==null?void 0:n.inputBg)||(u?"rgba(0,0,0,0.4)":"#fff"),padding:12,borderRadius:8,maxHeight:200,overflow:"auto",fontFamily:"Monaco, monospace",fontSize:"0.75rem",color:(n==null?void 0:n.editorText)||we.purple,whiteSpace:"pre-wrap",lineHeight:1.5},footer:{padding:"12px 20px",borderTop:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,display:"flex",justifyContent:"flex-end",gap:10},cancelBtn:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"0.8rem",cursor:"pointer"},applyBtn:{padding:"8px 20px",background:`linear-gradient(135deg, ${we.green}, ${we.blue})`,border:"none",borderRadius:6,color:"#fff",fontSize:"0.8rem",fontWeight:600,cursor:"pointer"},disabledBtn:{padding:"8px 20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:6,color:"#666",fontSize:"0.8rem",cursor:"not-allowed"},notConfigured:{textAlign:"center",padding:40,color:(n==null?void 0:n.textSecondary)||"#888"}};return o.jsx("div",{style:z.overlay,onClick:t,children:o.jsxs("div",{style:z.modal,onClick:D=>D.stopPropagation(),children:[o.jsxs("div",{style:z.header,children:[o.jsxs("div",{style:z.headerTitle,children:[o.jsx("span",{style:z.headerIcon,children:""}),o.jsxs("div",{children:[o.jsx("div",{style:z.title,children:"Import from Image"}),o.jsx("div",{style:z.subtitle,children:"AI-powered diagram extraction"})]})]}),o.jsx("button",{style:z.closeBtn,onClick:t,children:""})]}),o.jsx("div",{style:z.content,children:Dt()?o.jsxs(o.Fragment,{children:[!a&&o.jsxs("div",{ref:c,style:z.dropZone,onDragOver:y,onDragLeave:S,onDrop:w,onClick:()=>{var D;return(D=m.current)==null?void 0:D.click()},children:[o.jsx("div",{style:z.dropIcon,children:""}),o.jsx("div",{style:z.dropText,children:e?"Drop image here":"Drag & drop an image"}),o.jsx("div",{style:z.dropSubtext,children:"or click to browse files"}),o.jsx("button",{style:z.browseBtn,onClick:D=>{var U;D.stopPropagation(),(U=m.current)==null||U.click()},children:"Browse Files"}),o.jsx("div",{style:z.pasteHint,children:" Tip: You can also paste an image from clipboard (Ctrl+V / Cmd+V)"}),o.jsx("input",{ref:m,type:"file",accept:Fh.join(","),onChange:k,style:{display:"none"}})]}),a&&o.jsxs("div",{style:z.imagePreview,children:[o.jsxs("div",{style:z.previewHeader,children:[o.jsxs("div",{style:z.previewInfo,children:[o.jsx("span",{style:z.previewName,children:a.name}),o.jsxs("span",{style:z.previewSize,children:["(",B(a.size),")"]})]}),o.jsx("button",{style:z.clearBtn,onClick:I,children:"Clear"})]}),o.jsx("img",{src:a.preview,alt:"Preview",style:z.previewImage}),!p&&o.jsx("button",{style:h?z.analyzingBtn:z.analyzeBtn,onClick:E,disabled:h,children:h?o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Analyzing with AI..."]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""})," Extract Diagram with AI"]})})]}),x&&o.jsxs("div",{style:z.error,children:[" ",x]}),p&&o.jsxs("div",{style:z.result,children:[o.jsxs("div",{style:z.resultHeader,children:[o.jsx("span",{style:z.resultIcon,children:""}),o.jsx("span",{style:z.resultTitle,children:"Diagram Extracted Successfully"})]}),o.jsxs("div",{style:{marginBottom:12,padding:"8px 12px",background:`${we.purple}15`,borderRadius:8,border:`1px solid ${we.purple}30`},children:[o.jsx("div",{style:{fontSize:"0.7rem",color:(n==null?void 0:n.textSecondary)||"#888",marginBottom:4},children:"DIAGRAM NAME"}),o.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:(n==null?void 0:n.textPrimary)||"#fff"},children:p.name})]}),o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("div",{style:{fontSize:"0.7rem",color:(n==null?void 0:n.textSecondary)||"#888",marginBottom:8},children:"DIAGRAM TYPE"}),o.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:[o.jsxs("button",{onClick:()=>T(p.type),style:{padding:"6px 14px",background:j===p.type?`${we.green}20`:"transparent",border:`2px solid ${j===p.type?we.green:u?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"}`,borderRadius:8,color:j===p.type?we.green:(n==null?void 0:n.textPrimary)||"#fff",fontSize:"0.85rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[j===p.type&&o.jsx("span",{children:""}),p.type,o.jsx("span",{style:{fontSize:"0.65rem",opacity:.7},children:"(detected)"})]}),p.alternatives&&p.alternatives.length>0&&p.alternatives.map(D=>o.jsxs("button",{onClick:()=>T(D),style:{padding:"6px 14px",background:j===D?`${we.blue}20`:"transparent",border:`2px solid ${j===D?we.blue:u?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.15)"}`,borderRadius:8,color:j===D?we.blue:(n==null?void 0:n.textSecondary)||"#888",fontSize:"0.85rem",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[j===D&&o.jsx("span",{children:""}),D]},D))]}),p.alternatives&&p.alternatives.length>0&&o.jsx("div",{style:{fontSize:"0.7rem",color:(n==null?void 0:n.textMuted)||"#666",marginTop:6},children:" Alternative types may render this data differently"})]}),o.jsx("div",{style:{fontSize:"0.7rem",color:(n==null?void 0:n.textSecondary)||"#888",marginBottom:6},children:"DSL PREVIEW"}),o.jsx("div",{style:z.dslPreview,children:p.dsl})]})]}):o.jsxs("div",{style:z.notConfigured,children:[o.jsx("div",{style:{fontSize:"3rem",marginBottom:16},children:""}),o.jsx("div",{style:{fontSize:"1rem",fontWeight:500,marginBottom:8,color:n==null?void 0:n.textPrimary},children:"AI Not Configured"}),o.jsx("div",{style:{fontSize:"0.85rem"},children:"Please configure your AI provider in the .env file to use this feature."})]})}),o.jsxs("div",{style:z.footer,children:[o.jsx("button",{style:z.cancelBtn,onClick:t,children:"Cancel"}),p?o.jsx("button",{style:z.applyBtn,onClick:R,children:"Apply Diagram"}):o.jsx("button",{style:z.disabledBtn,disabled:!0,children:"Apply Diagram"})]})]})})}function ug(i){const t=i.toLowerCase();if(t.includes("@startmindmap")||t.includes("@startwbs"))return"mindmap";if(t.includes("@startgantt"))return"gantt";if(t.includes("@startjson")||t.includes("@startyaml"))return"unsupported";const r=i.replace(/@startuml.*|@enduml.*/gi,"").trim();return/\b(Person|System|Container|Component|System_Ext|Container_Ext|Boundary|Enterprise_Boundary|System_Boundary|Container_Boundary)\s*\(/i.test(r)||/\b(Rel|Rel_R|Rel_L|Rel_U|Rel_D)\s*\(/i.test(r)?"c4":/\b(node|device|artifact|file|folder|frame|rectangle|card)\s+"?[^"]*"?\s*(<<|as|\{|$)/im.test(r)&&/\b(node|device|artifact)\b/i.test(r)?"deployment":/\bactor\b/i.test(r)&&(/\busecase\b/i.test(r)||/\([^)]+\)/i.test(r))?"usecase":/\b(class|interface|abstract\s+class|enum)\s+\w+/i.test(r)?"class":/\[\*\]\s*(-->|->)/.test(r)||/(-->|->)\s*\[\*\]/.test(r)||/\bstate\s+\w+/i.test(r)&&!r.includes("component")?"state":(/\bparticipant\b/i.test(r)||/\bactor\b.*->/.test(r))&&/->>|-->>|->|-->/.test(r)&&/:/.test(r)?"sequence":/\bstart\b/i.test(r)&&/\bstop\b/i.test(r)||/:[^;]+;/.test(r)||/\bif\s*\(/.test(r)&&/\bthen\b/.test(r)?"flowchart":/\b(component|package|node|folder|frame|cloud|database)\b/i.test(r)?"architecture":/\bentity\b/i.test(r)?"erd":/\bobject\b/i.test(r)?"class":/->>|-->>|->|-->/.test(r)&&/:/.test(r)?"sequence":"flowchart"}function Cv(i){let t=ug(i),r;switch(t){case"sequence":r=Ev(i);break;case"class":r=Mv(i);break;case"state":r=$v(i);break;case"flowchart":r=Rv(i);break;case"usecase":r=_v(i);break;case"architecture":r=Iv(i);break;case"mindmap":r=Av(i);break;case"gantt":r=Tv(i);break;case"erd":r=Pv(i);break;case"c4":r=Dv(i),t="architecture";break;case"deployment":r=Lv(i);break;default:throw new Error(`Unsupported PlantUML diagram type: ${t}`)}return{type:t,source:r}}function tt(i){return i.replace(/@startuml.*\n?/gi,"").replace(/@enduml.*\n?/gi,"").replace(/@startmindmap.*\n?/gi,"").replace(/@endmindmap.*\n?/gi,"").replace(/@startwbs.*\n?/gi,"").replace(/@endwbs.*\n?/gi,"").replace(/@startgantt.*\n?/gi,"").replace(/@endgantt.*\n?/gi,"").replace(/^\s*title\s+.+$/gim,"").replace(/^\s*skinparam\s+.+$/gim,"").replace(/^\s*hide\s+.+$/gim,"").replace(/^\s*'.*$/gim,"").trim()}function Ev(i){const r=tt(i).split(`
`).filter(e=>e.trim()),n=[],a=[];r.forEach(e=>{const l=e.trim(),h=l.match(/^(participant|actor)\s+"?([^"]+)"?(\s+as\s+(\w+))?/i);if(h){const f=h[4]||h[2];a.includes(f)||a.push(f);return}const d=l.match(/^(\w+)\s*(->>|-->>|->|-->)\s*(\w+)\s*:\s*(.+)$/);if(d){const[,f,x,g,m]=d;a.includes(f)||a.push(f),a.includes(g)||a.push(g);const c=x.replace(">>",">");n.push(`${f} ${c} ${g}: ${m}`);return}l.match(/^note\s+(left|right|over)\s*:?\s*(.+)$/i)});const s=[];return a.length>0&&(s.push(`participant ${a.join(", ")}`),s.push("")),s.push(...n),s.join(`
`)}function Mv(i){const r=tt(i).split(`
`),n=[];let a=null,s=!1,e=0;return r.forEach(l=>{const h=l.trim(),d=h.match(/^(class|interface|abstract\s+class|enum)\s+(\w+)(\s*\{)?/i);if(d){a&&n.push(""),a=d[2],n.push(`class ${a}`),h.includes("{")&&(s=!0,e=1);return}const p=h.match(/^object\s+"?([^"]+)"?/i);if(p){a&&n.push(""),a=p[1].replace(/\s+/g,"_"),n.push(`class ${a}`),h.includes("{")&&(s=!0,e=1);return}if(h==="{"&&a){s=!0,e=1;return}if(h==="}"&&s){e--,e<=0&&(s=!1,a=null);return}if(s&&a&&h&&h!=="{"&&h!=="}"){const f=h.match(/^([+\-#~])?\s*(\w+)\s*\(([^)]*)\)\s*:?\s*(\w+)?/);if(f){const[,m="+",c,u,b]=f,y=b?`: ${b}`:"";n.push(`  ${m} ${c}(${u})${y}`);return}const x=h.match(/^([+\-#~])?\s*(\w+)\s*:\s*(.+)/);if(x){const[,m="+",c,u]=x;n.push(`  ${m} ${c}: ${u}`);return}const g=h.match(/^([+\-#~])?\s*(\w+)$/);if(g){const[,m="+",c]=g;n.push(`  ${m} ${c}`);return}}if(!s){const f=h.match(/^(\w+)\s*(<\|--|--\|>)\s*(\w+)/);if(f){const[,g,m,c]=f;m==="<|--"?n.push(`${c} extends ${g}`):n.push(`${g} extends ${c}`);return}if(h.match(/^(\w+)\s*(--|-->|<--)\s*(\w+)/))return}}),n.join(`
`)}function $v(i){const r=tt(i).split(`
`).filter(s=>s.trim()),n=[],a=new Set;return r.forEach(s=>{const e=s.trim(),l=e.match(/^state\s+"([^"]+)"\s+as\s+(\w+)/i);if(l){const[,,p]=l;a.add(p);return}const h=e.match(/^state\s+(\w+)$/i);if(h){a.add(h[1]);return}const d=e.match(/^(\[\*\]|\w+)\s*(-->|->)\s*(\[\*\]|\w+)(\s*:\s*(.+))?$/);if(d){let[,p,,f,,x]=d,g=p,m=f;if(p==="[*]"&&!a.has("__initial__")&&(n.unshift(`(initial) ${f}`),a.add("__initial__"),g=f,!x))return;if(f==="[*]"&&(a.has("__final__")||(n.push("(final) End"),a.add("__final__")),m="End"),p!=="[*]"){const c=x?`: ${x.trim()}`:"";n.push(`${g} -> ${m}${c}`)}return}}),n.join(`
`)}function Rv(i){const r=tt(i).split(`
`).filter(p=>p.trim()),n=[],a=[];let s=0,e=null;const l=[],h=(p,f)=>{const x=`node${s++}`;return n.push({id:x,type:p,label:f}),x};r.forEach(p=>{const f=p.trim();if(/^start$/i.test(f)){e=h("start","Start");return}if(/^(stop|end)$/i.test(f)){const c=h("end","End");e&&a.push({from:e,to:c}),e=c;return}const x=f.match(/^:([^;]+);?$/);if(x){const c=x[1].trim(),u=h("process",c);e&&a.push({from:e,to:u}),e=u;return}const g=f.match(/^if\s*\(([^)]+)\)\s*then\s*\(([^)]+)\)/i);if(g){const c=g[1].trim(),u=g[2].trim(),b=h("decision",c);e&&a.push({from:e,to:b}),l.push({type:"if",decisionId:b,yesLabel:u,noLabel:null,mergePoint:null}),e=b;return}const m=f.match(/^else\s*\(([^)]+)\)/i);if(m&&l.length>0){const c=l[l.length-1];c.noLabel=m[1].trim(),c.lastYesNode=e,e=c.decisionId;return}if(/^endif$/i.test(f)&&l.length>0){const c=l.pop();c.lastNoNode=e;return}});const d=[];return n.forEach(p=>{d.push(`(${p.type}) ${p.label}`)}),d.push(""),a.forEach(p=>{const f=n.find(g=>g.id===p.from),x=n.find(g=>g.id===p.to);if(f&&x){const g=p.label?`: ${p.label}`:"";d.push(`${f.label} -> ${x.label}${g}`)}}),d.join(`
`)}function _v(i){const r=tt(i).split(`
`).filter(l=>l.trim()),n=[],a=[],s=[],e=[];return r.forEach(l=>{const h=l.trim(),d=h.match(/^actor\s+"?([^"]+)"?(\s+as\s+(\w+))?/i);if(d){const g=d[3]||d[1];a.includes(g)||(a.push(g),n.push(`actor ${g}`));return}const p=h.match(/^usecase\s+"?([^"]+)"?(\s+as\s+(\w+))?/i);if(p){const g=p[3]||p[1];s.includes(g)||(s.push(g),n.push(`(${g})`));return}const f=h.match(/^\(([^)]+)\)$/);if(f){const g=f[1];s.includes(g)||(s.push(g),n.push(`(${g})`));return}const x=h.match(/^(\w+)\s*(-->|->|--)\s*\(?([^)]+)\)?$/);if(x){const[,g,,m]=x,c=m.replace(/[()]/g,"");e.push(`${g} -> ${c}`);return}}),n.push(""),n.push(...e),n.join(`
`)}function Iv(i){const r=tt(i).split(`
`).filter(e=>e.trim()),n={clients:[],gateway:[],services:[],data:[],storage:[],other:[]},a=[];r.forEach(e=>{const l=e.trim(),h=l.match(/^(component|node|package|folder|frame|cloud|database|storage|queue)\s+"?([^"]+)"?(\s+as\s+(\w+))?/i);if(h){const[,f,x,,g]=h,m=g||x,c=f.toLowerCase();c==="database"||c==="storage"?n.data.push(m):c==="cloud"?n.clients.push(m):n.services.push(m);return}const d=l.match(/^\[([^\]]+)\]$/);if(d){n.services.push(d[1]);return}const p=l.match(/^(\[?[^\]]+\]?)\s*(-->|->|--)\s*(\[?[^\]]+\]?)(\s*:\s*(.+))?$/);if(p){let[,f,,x]=p;f=f.replace(/[\[\]]/g,"").trim(),x=x.replace(/[\[\]]/g,"").trim(),a.push(`${f} -> ${x}`);return}});const s=[];return n.clients.length>0&&s.push(`[clients] ${n.clients.join(", ")}`),n.gateway.length>0&&s.push(`[gateway] ${n.gateway.join(", ")}`),n.services.length>0&&s.push(`[services] ${n.services.join(", ")}`),n.data.length>0&&s.push(`[data] ${n.data.join(", ")}`),n.storage.length>0&&s.push(`[storage] ${n.storage.join(", ")}`),n.other.length>0&&s.push(`[services] ${n.other.join(", ")}`),a.length>0&&(s.push(""),s.push(...a)),s.join(`
`)}function Av(i){const r=tt(i).split(`
`).filter(a=>a.trim()),n=[];return r.forEach(a=>{const s=a.match(/^(\*+)\s*(.+)$/);if(s){const e=s[1].length-1,l=s[2].trim(),h="  ".repeat(e);n.push(`${h}${l}`)}}),n.join(`
`)}function Tv(i){const r=tt(i).split(`
`).filter(s=>s.trim()),n=[];let a=0;return r.forEach(s=>{const e=s.trim(),l=e.match(/^\[([^\]]+)\]\s+lasts\s+(\d+)\s+days?/i);if(l){const[,p,f]=l;n.push(`${p}, ${a}, ${f}`),a+=parseInt(f);return}const h=e.match(/^\[([^\]]+)\]\s+starts\s+at\s+day\s+(\d+)/i);if(h){a=parseInt(h[2]);return}e.match(/^project\s+starts\s+/i)}),n.join(`
`)}function Pv(i){const r=tt(i).split(`
`),n=[];let a=null,s=!1;return r.forEach(e=>{const l=e.trim(),h=l.match(/^entity\s+"?([^"{\s]+)"?\s*(\{)?/i);if(h){a&&(n.push(");"),n.push("")),a=h[1],n.push(`CREATE TABLE ${a} (`),s=l.includes("{");return}if(l==="{"&&a){s=!0;return}if(l==="}"&&s){n.push(");"),s=!1,a=null;return}if(s&&a&&l&&!l.startsWith("--")){const d=l.match(/^(\*?)?\s*(\w+)\s*:\s*(.+)$/);if(d){const[,p,f,x]=d,g=p==="*"?" PRIMARY KEY":"",m=x.trim().toUpperCase();n.push(`  ${f} ${m}${g},`)}}}),s&&n.push(");"),n.join(`
`).replace(/,\n\);/g,`
);`)}function Dv(i){const r=tt(i).split(`
`).filter(p=>p.trim()),n=new Map,a=[],s=[],e=new Map;r.forEach(p=>{const f=p.trim();if(f.startsWith("!include")||f.startsWith("'"))return;const x=f.match(/^(Enterprise_Boundary|System_Boundary|Container_Boundary|Boundary)\s*\(\s*(\w+)\s*,\s*["']([^"']+)["']/i);if(x){const y=s.length>0?s[s.length-1]:null;e.set(x[2],{label:x[3],type:x[1],parent:y}),s.push(x[2]);return}if(f==="}"&&s.length>0){s.pop();return}const g=f.match(/^Person(?:_Ext)?\s*\(\s*(\w+)\s*,\s*["']([^"']+)["'](?:\s*,\s*["']([^"']+)["'])?\)/i);if(g){const y=s.length>0?s[s.length-1]:null;n.set(g[1],{type:"user",label:g[2],description:g[3]||"",boundary:y});return}const m=f.match(/^System(?:_Ext)?\s*\(\s*(\w+)\s*,\s*["']([^"']+)["'](?:\s*,\s*["']([^"']+)["'])?\)/i);if(m){const y=s.length>0?s[s.length-1]:null;n.set(m[1],{type:f.includes("_Ext")?"external":"services",label:m[2],description:m[3]||"",boundary:y});return}const c=f.match(/^Container(?:_Ext|Db|Queue)?\s*\(\s*(\w+)\s*,\s*["']([^"']+)["'](?:\s*,\s*["']([^"']+)["'])?(?:\s*,\s*["']([^"']+)["'])?\)/i);if(c){const y=s.length>0?s[s.length-1]:null;let S="services";/ContainerDb/i.test(f)?S="data":/ContainerQueue/i.test(f)?S="queue":/_Ext/i.test(f)&&(S="external"),n.set(c[1],{type:S,label:c[2],technology:c[3]||"",description:c[4]||"",boundary:y});return}const u=f.match(/^Component(?:_Ext|Db|Queue)?\s*\(\s*(\w+)\s*,\s*["']([^"']+)["'](?:\s*,\s*["']([^"']+)["'])?(?:\s*,\s*["']([^"']+)["'])?\)/i);if(u){const y=s.length>0?s[s.length-1]:null;let S="services";/ComponentDb/i.test(f)&&(S="data"),/_Ext/i.test(f)&&(S="external"),n.set(u[1],{type:S,label:u[2],technology:u[3]||"",description:u[4]||"",boundary:y});return}const b=f.match(/^(?:Bi)?Rel(?:_[RLUD])?\s*\(\s*(\w+)\s*,\s*(\w+)\s*,\s*["']([^"']+)["'](?:\s*,\s*["']([^"']+)["'])?\)/i);b&&a.push({from:b[1],to:b[2],label:b[3],tech:b[4]||""})});const l=[],h={user:[],clients:[],services:[],data:[],external:[],queue:[]};n.forEach((p,f)=>{const x=p.type||"services";h[x]||(h[x]=[]),h[x].push(p.label)}),Object.entries(h).forEach(([p,f])=>{f.length>0&&l.push(`[${p}] ${f.join(", ")}`)});const d=(p,f="")=>{const x=e.get(p);x&&(l.push(`${f}group "${x.label}" {`),n.forEach((g,m)=>{g.boundary===p&&l.push(`${f}  ${g.label}`)}),e.forEach((g,m)=>{g.parent===p&&d(m,f+"  ")}),l.push(`${f}}`))};return e.forEach((p,f)=>{p.parent||d(f)}),l.push(""),a.forEach(p=>{const f=n.get(p.from),x=n.get(p.to);f&&x&&l.push(`${f.label} -> ${x.label}`)}),l.join(`
`)}function Lv(i){const r=tt(i).split(`
`).filter(h=>h.trim()),n=[],a=new Map,s=[];let e=null,l=!1;return r.forEach(h=>{const d=h.trim(),p=d.match(/^(node|device|artifact|file|folder|frame|rectangle|card)\s+"?([^"{]+)"?(?:\s+as\s+(\w+))?(?:\s*\{)?/i);if(p){const x=p[1].toLowerCase(),g=p[2].trim(),m=p[3]||g.replace(/\s+/g,"_");a.set(m,{type:x,label:g,children:[]}),e=m,d.includes("{")&&(l=!0);return}if(l&&e){const x=d.match(/^(node|device|artifact|component|database)\s+"?([^"{]+)"?(?:\s+as\s+(\w+))?/i);if(x){const g=x[3]||x[2].replace(/\s+/g,"_");a.set(g,{type:x[1].toLowerCase(),label:x[2].trim(),parent:e});const m=a.get(e);m&&m.children.push(g);return}}if(d==="}"){l=!1,e=null;return}const f=d.match(/^(\w+)\s*(-->|->|--)\s*(\w+)(?:\s*:\s*(.+))?$/);f&&s.push({from:f[1],to:f[3],label:f[4]||""})}),a.forEach((h,d)=>{if(!h.parent){let p=`(${h.type}) ${h.label}`;n.push(p),h.children.length>0&&h.children.forEach(f=>{const x=a.get(f);x&&n.push(`  (${x.type}) ${x.label}`)})}}),n.push(""),s.forEach(h=>{const d=a.get(h.from),p=a.get(h.to);if(d&&p){const f=h.label?`: ${h.label}`:"";n.push(`${d.label} -> ${p.label}${f}`)}}),n.join(`
`)}function zv(i,t){switch(i){case"sequence":return Bv(t);case"class":return Wv(t);case"state":return Nv(t);case"flowchart":return qv(t);case"usecase":return Ov(t);case"architecture":case"component":return Fv(t);case"mindmap":case"wbs":return pg(t);case"gantt":return Uv(t);case"erd":return Gv(t);case"orgchart":return Yv(t);default:throw new Error(`Export to PlantUML not supported for diagram type: ${i}`)}}function Bv(i){const t=i.split(`
`).filter(n=>n.trim()),r=["@startuml"];return t.forEach(n=>{const a=n.trim();if(a.startsWith("participant ")){r.push(a);return}if(a.match(/^(\w+)\s*(->|-->)\s*(\w+)\s*:\s*(.+)$/)){r.push(a);return}}),r.push("@enduml"),r.join(`
`)}function Wv(i){const t=i.split(`
`),r=["@startuml"];let n=null;return t.forEach(a=>{const s=a.trim();if(s.startsWith("class ")){n&&(r.push("}"),r.push("")),n=s.replace("class ",""),r.push(`class ${n} {`);return}if(s.match(/^([+\-#~])\s*(.+)$/)&&n){r.push(`  ${s}`);return}const l=s.match(/^(\w+)\s+extends\s+(\w+)$/);if(l){n&&(r.push("}"),n=null),r.push(`${l[2]} <|-- ${l[1]}`);return}}),n&&r.push("}"),r.push("@enduml"),r.join(`
`)}function Nv(i){const t=i.split(`
`).filter(a=>a.trim()),r=["@startuml"];let n=!1;return t.forEach(a=>{const s=a.trim(),e=s.match(/^\(initial\)\s+(\w+)$/);if(e){n||(r.push(`[*] --> ${e[1]}`),n=!0);return}if(s.match(/^\(final\)\s+(\w+)$/))return;const h=s.match(/^(\w+)\s*->\s*(\w+)(\s*:\s*(.+))?$/);if(h){const[,d,p,,f]=h,x=f?` : ${f}`:"";p.toLowerCase()==="end"||p.toLowerCase()==="final"?r.push(`${d} --> [*]${x}`):r.push(`${d} --> ${p}${x}`);return}}),r.push("@enduml"),r.join(`
`)}function qv(i){const t=i.split(`
`).filter(e=>e.trim()),r=["@startuml"],n=new Map,a=[];t.forEach(e=>{var p;const l=e.trim(),h=l.match(/^\((\w+)\)\s+(.+)$/);h&&n.set(h[2],h[1]);const d=l.match(/^(.+?)\s*->\s*(.+?)(\s*:\s*(.+))?$/);d&&!l.startsWith("(")&&a.push({from:d[1].trim(),to:d[2].trim(),label:(p=d[4])==null?void 0:p.trim()})});const s=new Set;return a.forEach(e=>{const l=n.get(e.from)||"process",h=n.get(e.to)||"process";l==="start"&&!s.has("__start__")&&(r.push("start"),s.add("__start__")),l!=="start"&&l!=="end"&&!s.has(e.from)&&(l==="decision"?r.push(`if (${e.from}?) then (${e.label||"yes"})`):r.push(`:${e.from};`),s.add(e.from)),h==="end"&&!s.has("__end__")?(r.push("stop"),s.add("__end__")):h!=="start"&&!s.has(e.to)&&(h==="decision"?r.push(`if (${e.to}?) then (yes)`):h!=="end"&&r.push(`:${e.to};`),s.add(e.to))}),!s.has("__end__")&&n.has("End")&&r.push("stop"),r.push("@enduml"),r.join(`
`)}function Ov(i){const t=i.split(`
`).filter(n=>n.trim()),r=["@startuml"];return t.forEach(n=>{const a=n.trim();if(a.startsWith("actor ")){r.push(a);return}const s=a.match(/^\(([^)]+)\)$/);if(s){r.push(`usecase "${s[1]}"`);return}const e=a.match(/^(\w+)\s*->\s*(\w+)$/);if(e){r.push(`${e[1]} --> (${e[2]})`);return}}),r.push("@enduml"),r.join(`
`)}function Fv(i){const t=i.split(`
`).filter(n=>n.trim()),r=["@startuml"];return t.forEach(n=>{const a=n.trim(),s=a.match(/^\[(\w+)\]\s+(.+)$/);if(s){const[,l,h]=s,d=h.split(",").map(p=>p.trim());r.push(`package "${l}" {`),d.forEach(p=>{l==="data"||l==="databases"?r.push(`  database "${p}"`):l==="clients"?r.push(`  node "${p}"`):r.push(`  component "${p}"`)}),r.push("}"),r.push("");return}const e=a.match(/^(.+?)\s*->\s*(.+)$/);if(e&&!a.startsWith("[")){r.push(`[${e[1].trim()}] --> [${e[2].trim()}]`);return}}),r.push("@enduml"),r.join(`
`)}function pg(i){const t=i.split(`
`),r=["@startmindmap"];return t.forEach(n=>{if(!n.trim())return;const a=n.match(/^(\s*)/)[1].length,s=Math.floor(a/2)+1,e=n.trim();e&&r.push("*".repeat(s)+" "+e)}),r.push("@endmindmap"),r.join(`
`)}function Uv(i){const t=i.split(`
`).filter(n=>n.trim()),r=["@startgantt"];return t.forEach(n=>{const s=n.trim().match(/^([^,]+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?$/);if(s){const[,e,l,h]=s;r.push(`[${e.trim()}] lasts ${h} days`),parseInt(l)>0&&r.push(`[${e.trim()}] starts at day ${l}`);return}}),r.push("@endgantt"),r.join(`
`)}function Gv(i){const t=i.split(`
`),r=["@startuml"];let n=null;return t.forEach(a=>{const s=a.trim(),e=s.match(/^CREATE\s+TABLE\s+(\w+)/i);if(e){n&&(r.push("}"),r.push("")),n=e[1],r.push(`entity "${n}" {`);return}const l=s.match(/^(\w+)\s+(\w+)(.*)$/);if(l&&n&&!s.startsWith("CREATE")&&!s.startsWith(")")){const[,h,d,p]=l,x=/PRIMARY\s+KEY/i.test(p)?"*":"";r.push(`  ${x}${h} : ${d}`);return}if(s===");"&&n){r.push("}"),n=null;return}}),n&&r.push("}"),r.push("@enduml"),r.join(`
`)}function Yv(i){return pg(i)}function Hv(i,t="diagram"){const r=new Blob([i],{type:"text/plain"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=`${t}.puml`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}async function Vv(i){try{return await navigator.clipboard.writeText(i),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}const Me={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",red:"#EF4444",indigo:"#6366F1"};function Xv({isOpen:i,onClose:t,onImport:r,theme:n}){const[a,s]=M.useState(""),[e,l]=M.useState(null),[h,d]=M.useState(""),[p,f]=M.useState(null),x=M.useRef(null),g=(n==null?void 0:n.name)==="dark";M.useEffect(()=>{i||(s(""),l(null),d(""),f(null))},[i]),M.useEffect(()=>{if(a.trim())try{const y=ug(a);f(y)}catch{f(null)}else f(null)},[a]);const m=y=>{var k;const S=(k=y.target.files)==null?void 0:k[0];if(!S)return;const w=new FileReader;w.onload=j=>{s(j.target.result),l(null),d("")},w.onerror=()=>{d("Failed to read file")},w.readAsText(S)},c=()=>{if(d(""),l(null),!a.trim()){d("Please enter PlantUML source code");return}try{const y=Cv(a);l(y)}catch(y){d(y.message||"Failed to convert PlantUML")}},u=()=>{e&&r(e.type,e.source)};if(!i)return null;const b={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},modal:{background:(n==null?void 0:n.modalBg)||(g?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))"),borderRadius:16,border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,width:"100%",maxWidth:700,maxHeight:"90vh",overflow:"hidden",boxShadow:"0 25px 50px rgba(0,0,0,0.4)",display:"flex",flexDirection:"column"},header:{padding:"16px 20px",borderBottom:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:`${Me.green}15`},headerTitle:{display:"flex",alignItems:"center",gap:10},headerIcon:{fontSize:"1.2rem"},title:{fontWeight:600,color:(n==null?void 0:n.textPrimary)||"#fff"},subtitle:{fontSize:"0.7rem",color:(n==null?void 0:n.textSecondary)||"#888"},closeBtn:{background:"transparent",border:"none",color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"1.2rem",cursor:"pointer",padding:4},content:{padding:20,flex:1,overflowY:"auto"},inputSection:{marginBottom:16},label:{display:"block",fontSize:"0.8rem",fontWeight:500,color:(n==null?void 0:n.textSecondary)||"#888",marginBottom:8},textarea:{width:"100%",height:200,padding:12,background:(n==null?void 0:n.inputBg)||(g?"rgba(0,0,0,0.3)":"#fff"),border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,borderRadius:8,color:(n==null?void 0:n.textPrimary)||"#fff",fontFamily:"Monaco, Consolas, monospace",fontSize:"0.85rem",resize:"vertical",outline:"none"},fileRow:{display:"flex",alignItems:"center",gap:12,marginTop:12},uploadBtn:{padding:"8px 16px",background:`${Me.blue}20`,border:`1px solid ${Me.blue}`,borderRadius:6,color:Me.blue,fontSize:"0.8rem",fontWeight:500,cursor:"pointer"},fileHint:{fontSize:"0.75rem",color:(n==null?void 0:n.textMuted)||"#666"},typeIndicator:{display:"inline-flex",alignItems:"center",gap:6,padding:"4px 10px",background:`${Me.purple}20`,borderRadius:6,fontSize:"0.75rem",color:Me.purple,marginTop:8},previewBtn:{width:"100%",padding:"12px 20px",background:`linear-gradient(135deg, ${Me.purple}, ${Me.indigo})`,border:"none",borderRadius:8,color:"#fff",fontSize:"0.9rem",fontWeight:600,cursor:"pointer",marginTop:16},previewBtnDisabled:{width:"100%",padding:"12px 20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#666",fontSize:"0.9rem",fontWeight:600,cursor:"not-allowed",marginTop:16},error:{marginTop:16,padding:"12px 16px",background:`${Me.red}15`,border:`1px solid ${Me.red}40`,borderRadius:8,color:Me.red,fontSize:"0.85rem"},previewSection:{marginTop:20,padding:16,background:g?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",borderRadius:12},previewHeader:{display:"flex",alignItems:"center",gap:8,marginBottom:12},previewIcon:{fontSize:"1rem"},previewTitle:{fontSize:"0.9rem",fontWeight:600,color:Me.green},previewType:{display:"inline-block",padding:"4px 10px",background:`${Me.green}20`,borderRadius:6,color:Me.green,fontSize:"0.8rem",fontWeight:500,marginBottom:12},dslPreview:{background:(n==null?void 0:n.inputBg)||(g?"rgba(0,0,0,0.4)":"#fff"),padding:12,borderRadius:8,maxHeight:200,overflow:"auto",fontFamily:"Monaco, Consolas, monospace",fontSize:"0.75rem",color:(n==null?void 0:n.editorText)||Me.purple,whiteSpace:"pre-wrap",lineHeight:1.5},footer:{padding:"12px 20px",borderTop:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,display:"flex",justifyContent:"flex-end",gap:10},cancelBtn:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:`1px solid ${(n==null?void 0:n.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(n==null?void 0:n.textSecondary)||"#888",fontSize:"0.8rem",cursor:"pointer"},importBtn:{padding:"8px 20px",background:`linear-gradient(135deg, ${Me.green}, ${Me.blue})`,border:"none",borderRadius:6,color:"#fff",fontSize:"0.8rem",fontWeight:600,cursor:"pointer"},importBtnDisabled:{padding:"8px 20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:6,color:"#666",fontSize:"0.8rem",cursor:"not-allowed"},exampleHint:{marginTop:12,padding:12,background:`${Me.blue}10`,borderRadius:8,fontSize:"0.75rem",color:(n==null?void 0:n.textSecondary)||"#888"},exampleCode:{fontFamily:"Monaco, Consolas, monospace",fontSize:"0.7rem",color:Me.blue,marginTop:8,whiteSpace:"pre"}};return o.jsx("div",{style:b.overlay,onClick:t,children:o.jsxs("div",{style:b.modal,onClick:y=>y.stopPropagation(),children:[o.jsxs("div",{style:b.header,children:[o.jsxs("div",{style:b.headerTitle,children:[o.jsx("span",{style:b.headerIcon,children:""}),o.jsxs("div",{children:[o.jsx("div",{style:b.title,children:"Import from PlantUML"}),o.jsx("div",{style:b.subtitle,children:"Convert PlantUML diagrams to DDFlow"})]})]}),o.jsx("button",{style:b.closeBtn,onClick:t,children:""})]}),o.jsxs("div",{style:b.content,children:[o.jsxs("div",{style:b.inputSection,children:[o.jsx("label",{style:b.label,children:"PLANTUML SOURCE"}),o.jsx("textarea",{style:b.textarea,value:a,onChange:y=>{s(y.target.value),l(null),d("")},placeholder:`@startuml
participant Client
participant Server
Client -> Server: Request
Server --> Client: Response
@enduml`,spellCheck:!1}),o.jsxs("div",{style:b.fileRow,children:[o.jsx("button",{style:b.uploadBtn,onClick:()=>{var y;return(y=x.current)==null?void 0:y.click()},children:"Upload .puml File"}),o.jsx("span",{style:b.fileHint,children:"Supports .puml, .plantuml, .txt files"}),o.jsx("input",{ref:x,type:"file",accept:".puml,.plantuml,.txt",onChange:m,style:{display:"none"}})]}),p&&o.jsxs("div",{style:b.typeIndicator,children:[o.jsx("span",{children:"Detected type:"}),o.jsx("strong",{children:p})]})]}),!a&&o.jsxs("div",{style:b.exampleHint,children:[o.jsx("strong",{children:"Supported diagram types:"})," Sequence, Class, State, Activity (Flowchart), Use Case, Component (Architecture), Mind Map, Gantt, ERD",o.jsx("div",{style:b.exampleCode,children:`@startuml
class User {
  +id: string
  +login(): boolean
}
@enduml`})]}),o.jsx("button",{style:a.trim()?b.previewBtn:b.previewBtnDisabled,onClick:c,disabled:!a.trim(),children:"Preview Conversion"}),h&&o.jsxs("div",{style:b.error,children:[" ",h]}),e&&o.jsxs("div",{style:b.previewSection,children:[o.jsxs("div",{style:b.previewHeader,children:[o.jsx("span",{style:b.previewIcon,children:""}),o.jsx("span",{style:b.previewTitle,children:"Conversion Successful"})]}),o.jsx("div",{style:b.previewType,children:e.type}),o.jsx("div",{style:b.dslPreview,children:e.source})]})]}),o.jsxs("div",{style:b.footer,children:[o.jsx("button",{style:b.cancelBtn,onClick:t,children:"Cancel"}),o.jsx("button",{style:e?b.importBtn:b.importBtnDisabled,onClick:u,disabled:!e,children:"Import Diagram"})]})]})})}const Ie={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",red:"#EF4444",indigo:"#6366F1"},Uh=["sequence","class","state","flowchart","usecase","architecture","component","mindmap","wbs","gantt","erd","orgchart"];function Kv({isOpen:i,onClose:t,diagramType:r,diagramSource:n,theme:a}){const[s,e]=M.useState(""),[l,h]=M.useState(""),[d,p]=M.useState(!1),f=(a==null?void 0:a.name)==="dark";M.useEffect(()=>{if(i&&r&&n){if(h(""),p(!1),!Uh.includes(r)){h(`Export to PlantUML is not supported for "${r}" diagrams.

Supported types: ${Uh.join(", ")}`),e("");return}try{const c=zv(r,n);e(c)}catch(c){h(c.message||"Failed to convert to PlantUML"),e("")}}},[i,r,n]),M.useEffect(()=>{i||(e(""),h(""),p(!1))},[i]);const x=async()=>{await Vv(s)&&(p(!0),setTimeout(()=>p(!1),2e3))},g=()=>{const c=`diagram-${r}`;Hv(s,c)};if(!i)return null;const m={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},modal:{background:(a==null?void 0:a.modalBg)||(f?"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(248,250,252,0.98))"),borderRadius:16,border:`1px solid ${(a==null?void 0:a.border)||"rgba(255,255,255,0.1)"}`,width:"100%",maxWidth:700,maxHeight:"90vh",overflow:"hidden",boxShadow:"0 25px 50px rgba(0,0,0,0.4)",display:"flex",flexDirection:"column"},header:{padding:"16px 20px",borderBottom:`1px solid ${(a==null?void 0:a.border)||"rgba(255,255,255,0.1)"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:`${Ie.green}15`},headerTitle:{display:"flex",alignItems:"center",gap:10},headerIcon:{fontSize:"1.2rem"},title:{fontWeight:600,color:(a==null?void 0:a.textPrimary)||"#fff"},subtitle:{fontSize:"0.7rem",color:(a==null?void 0:a.textSecondary)||"#888"},closeBtn:{background:"transparent",border:"none",color:(a==null?void 0:a.textSecondary)||"#888",fontSize:"1.2rem",cursor:"pointer",padding:4},content:{padding:20,flex:1,overflowY:"auto"},typeInfo:{display:"flex",alignItems:"center",gap:12,marginBottom:16},typeBadge:{display:"inline-block",padding:"6px 14px",background:`${Ie.purple}20`,borderRadius:8,color:Ie.purple,fontSize:"0.85rem",fontWeight:600},conversionArrow:{fontSize:"1.2rem",color:(a==null?void 0:a.textMuted)||"#666"},outputBadge:{display:"inline-block",padding:"6px 14px",background:`${Ie.green}20`,borderRadius:8,color:Ie.green,fontSize:"0.85rem",fontWeight:600},label:{display:"block",fontSize:"0.8rem",fontWeight:500,color:(a==null?void 0:a.textSecondary)||"#888",marginBottom:8},textarea:{width:"100%",height:300,padding:12,background:(a==null?void 0:a.inputBg)||(f?"rgba(0,0,0,0.3)":"#fff"),border:`1px solid ${(a==null?void 0:a.border)||"rgba(255,255,255,0.1)"}`,borderRadius:8,color:(a==null?void 0:a.textPrimary)||"#fff",fontFamily:"Monaco, Consolas, monospace",fontSize:"0.85rem",resize:"vertical",outline:"none"},actions:{display:"flex",gap:10,marginTop:16},copyBtn:{flex:1,padding:"12px 20px",background:d?`${Ie.green}20`:`${Ie.blue}20`,border:`1px solid ${d?Ie.green:Ie.blue}`,borderRadius:8,color:d?Ie.green:Ie.blue,fontSize:"0.85rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8},downloadBtn:{flex:1,padding:"12px 20px",background:`linear-gradient(135deg, ${Ie.purple}, ${Ie.indigo})`,border:"none",borderRadius:8,color:"#fff",fontSize:"0.85rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8},error:{padding:"20px",background:`${Ie.red}10`,border:`1px solid ${Ie.red}30`,borderRadius:12,textAlign:"center"},errorIcon:{fontSize:"2rem",marginBottom:12},errorText:{color:Ie.red,fontSize:"0.9rem",whiteSpace:"pre-wrap"},footer:{padding:"12px 20px",borderTop:`1px solid ${(a==null?void 0:a.border)||"rgba(255,255,255,0.1)"}`,display:"flex",justifyContent:"flex-end"},closeFooterBtn:{padding:"8px 20px",background:"rgba(255,255,255,0.1)",border:`1px solid ${(a==null?void 0:a.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(a==null?void 0:a.textSecondary)||"#888",fontSize:"0.8rem",cursor:"pointer"},hint:{marginTop:12,padding:12,background:`${Ie.blue}10`,borderRadius:8,fontSize:"0.75rem",color:(a==null?void 0:a.textSecondary)||"#888"}};return o.jsx("div",{style:m.overlay,onClick:t,children:o.jsxs("div",{style:m.modal,onClick:c=>c.stopPropagation(),children:[o.jsxs("div",{style:m.header,children:[o.jsxs("div",{style:m.headerTitle,children:[o.jsx("span",{style:m.headerIcon,children:""}),o.jsxs("div",{children:[o.jsx("div",{style:m.title,children:"Export to PlantUML"}),o.jsx("div",{style:m.subtitle,children:"Convert DDFlow diagram to PlantUML format"})]})]}),o.jsx("button",{style:m.closeBtn,onClick:t,children:""})]}),o.jsxs("div",{style:m.content,children:[o.jsxs("div",{style:m.typeInfo,children:[o.jsx("span",{style:m.typeBadge,children:r}),o.jsx("span",{style:m.conversionArrow,children:""}),o.jsx("span",{style:m.outputBadge,children:"PlantUML"})]}),l?o.jsxs("div",{style:m.error,children:[o.jsx("div",{style:m.errorIcon,children:""}),o.jsx("div",{style:m.errorText,children:l})]}):o.jsxs(o.Fragment,{children:[o.jsx("label",{style:m.label,children:"PLANTUML OUTPUT"}),o.jsx("textarea",{style:m.textarea,value:s,readOnly:!0,spellCheck:!1}),o.jsxs("div",{style:m.actions,children:[o.jsx("button",{style:m.copyBtn,onClick:x,children:d?" Copied!":" Copy to Clipboard"}),o.jsx("button",{style:m.downloadBtn,onClick:g,children:" Download .puml"})]}),o.jsxs("div",{style:m.hint,children:[o.jsx("strong",{children:"Tip:"})," You can use this PlantUML code with online renderers like"," ",o.jsx("a",{href:"https://www.plantuml.com/plantuml/uml/",target:"_blank",rel:"noopener noreferrer",style:{color:Ie.blue},children:"plantuml.com"})," ","or in VS Code with the PlantUML extension."]})]})]}),o.jsx("div",{style:m.footer,children:o.jsx("button",{style:m.closeFooterBtn,onClick:t,children:"Close"})})]})})}const A={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",orange:"#F59E0B",red:"#EF4444",pink:"#EC4899",teal:"#14B8A6"},Gh={process:{label:"Process",shapes:[{id:"flowchart",label:"Flowchart",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"8",width:"16",height:"10",rx:"2",fill:`${A.orange}40`,stroke:A.orange,strokeWidth:"1.5"}),o.jsx("rect",{x:"24",y:"8",width:"16",height:"10",rx:"2",fill:`${A.red}40`,stroke:A.red,strokeWidth:"1.5"}),o.jsx("rect",{x:"44",y:"8",width:"16",height:"10",rx:"2",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1.5"}),o.jsx("rect",{x:"14",y:"28",width:"16",height:"10",rx:"2",fill:`${A.pink}40`,stroke:A.pink,strokeWidth:"1.5"}),o.jsx("rect",{x:"34",y:"28",width:"16",height:"10",rx:"2",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("path",{d:"M20 18 L22 28",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"}),o.jsx("path",{d:"M32 18 L32 28",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"}),o.jsx("path",{d:"M44 18 L42 28",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"})]}),template:"flowchart",dsl:`(start) Start -> (process) Step 1 -> (decision) Check?
(decision) Check? -> |yes| (process) Step 2 -> (end) End
(decision) Check? -> |no| (process) Step 3 -> (end) End`},{id:"orgchart",label:"Org Chart",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"22",y:"4",width:"20",height:"10",rx:"2",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("rect",{x:"4",y:"34",width:"16",height:"10",rx:"2",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1.5"}),o.jsx("rect",{x:"24",y:"34",width:"16",height:"10",rx:"2",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1.5"}),o.jsx("rect",{x:"44",y:"34",width:"16",height:"10",rx:"2",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1.5"}),o.jsx("path",{d:"M32 14 L32 24 M12 24 L52 24 M12 24 L12 34 M32 24 L32 34 M52 24 L52 34",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"})]}),template:"orgchart",dsl:`CEO
  VP Engineering
    Team Lead
    Senior Dev
  VP Sales
    Sales Manager`},{id:"cycle",label:"Cycle",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("circle",{cx:"32",cy:"24",r:"16",fill:"none",stroke:"#ddd",strokeWidth:"1"}),o.jsx("circle",{cx:"32",cy:"8",r:"6",fill:`${A.orange}40`,stroke:A.orange,strokeWidth:"1.5"}),o.jsx("circle",{cx:"46",cy:"24",r:"6",fill:`${A.red}40`,stroke:A.red,strokeWidth:"1.5"}),o.jsx("circle",{cx:"32",cy:"40",r:"6",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1.5"}),o.jsx("circle",{cx:"18",cy:"24",r:"6",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("path",{d:"M38 10 L44 18",stroke:"#666",strokeWidth:"1",strokeLinecap:"round",markerEnd:"url(#arrow)"}),o.jsx("path",{d:"M44 30 L38 38",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"}),o.jsx("path",{d:"M26 38 L20 30",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"}),o.jsx("path",{d:"M20 18 L26 10",stroke:"#666",strokeWidth:"1",strokeLinecap:"round"})]}),template:"state",dsl:`[*] -> Planning
Planning -> Development : start
Development -> Testing : complete
Testing -> Review : pass
Review -> Planning : iterate
Review -> [*] : done`},{id:"sequence",label:"Sequence",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"4",width:"12",height:"8",rx:"2",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("rect",{x:"26",y:"4",width:"12",height:"8",rx:"2",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1.5"}),o.jsx("rect",{x:"48",y:"4",width:"12",height:"8",rx:"2",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1.5"}),o.jsx("line",{x1:"10",y1:"12",x2:"10",y2:"44",stroke:"#666",strokeWidth:"1",strokeDasharray:"2,2"}),o.jsx("line",{x1:"32",y1:"12",x2:"32",y2:"44",stroke:"#666",strokeWidth:"1",strokeDasharray:"2,2"}),o.jsx("line",{x1:"54",y1:"12",x2:"54",y2:"44",stroke:"#666",strokeWidth:"1",strokeDasharray:"2,2"}),o.jsx("path",{d:"M10 20 L32 20",stroke:A.orange,strokeWidth:"1.5"}),o.jsx("path",{d:"M32 28 L54 28",stroke:A.pink,strokeWidth:"1.5"}),o.jsx("path",{d:"M54 36 L32 36",stroke:A.teal,strokeWidth:"1.5",strokeDasharray:"3,2"})]}),template:"sequence",dsl:`participant Client
participant Server
participant Database

Client -> Server: Request
Server -> Database: Query
Database --> Server: Result
Server --> Client: Response`},{id:"network",label:"Network",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("circle",{cx:"32",cy:"24",r:"8",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1.5"}),o.jsx("circle",{cx:"12",cy:"12",r:"6",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("circle",{cx:"52",cy:"12",r:"6",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1.5"}),o.jsx("circle",{cx:"12",cy:"36",r:"6",fill:`${A.orange}40`,stroke:A.orange,strokeWidth:"1.5"}),o.jsx("circle",{cx:"52",cy:"36",r:"6",fill:`${A.red}40`,stroke:A.red,strokeWidth:"1.5"}),o.jsx("path",{d:"M24 20 L16 14",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M40 20 L48 14",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M24 28 L16 34",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M40 28 L48 34",stroke:"#666",strokeWidth:"1"})]}),template:"network",dsl:`router: Router [router]
server: Web Server [server] 192.168.1.10
db: Database [database] 192.168.1.20
client1: Client 1 [desktop]
client2: Client 2 [laptop]

router -- server
router -- db
router -- client1
router -- client2`},{id:"kanban",label:"Kanban",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"4",width:"16",height:"40",rx:"2",fill:"#f5f5f5",stroke:"#ddd",strokeWidth:"1"}),o.jsx("rect",{x:"24",y:"4",width:"16",height:"40",rx:"2",fill:"#f5f5f5",stroke:"#ddd",strokeWidth:"1"}),o.jsx("rect",{x:"44",y:"4",width:"16",height:"40",rx:"2",fill:"#f5f5f5",stroke:"#ddd",strokeWidth:"1"}),o.jsx("rect",{x:"6",y:"12",width:"12",height:"6",rx:"1",fill:`${A.orange}60`}),o.jsx("rect",{x:"6",y:"20",width:"12",height:"6",rx:"1",fill:`${A.orange}60`}),o.jsx("rect",{x:"26",y:"12",width:"12",height:"6",rx:"1",fill:`${A.blue}60`}),o.jsx("rect",{x:"46",y:"12",width:"12",height:"6",rx:"1",fill:`${A.green}60`}),o.jsx("rect",{x:"46",y:"20",width:"12",height:"6",rx:"1",fill:`${A.green}60`})]}),template:"gantt",dsl:`Task 1: 2024-01-01, 5d
Task 2: 2024-01-03, 3d
Task 3: 2024-01-06, 4d
Task 4: 2024-01-08, 2d`}]},data:{label:"Data",shapes:[{id:"barchart",label:"Bar Chart",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"8",y:"28",width:"10",height:"16",rx:"1",fill:`${A.blue}60`}),o.jsx("rect",{x:"22",y:"18",width:"10",height:"26",rx:"1",fill:`${A.purple}60`}),o.jsx("rect",{x:"36",y:"8",width:"10",height:"36",rx:"1",fill:`${A.green}60`}),o.jsx("rect",{x:"50",y:"22",width:"10",height:"22",rx:"1",fill:`${A.orange}60`}),o.jsx("line",{x1:"4",y1:"44",x2:"60",y2:"44",stroke:"#666",strokeWidth:"1"})]}),template:"pie",dsl:`Sales: 45
Marketing: 30
Engineering: 50
Support: 25`},{id:"piechart",label:"Pie Chart",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("circle",{cx:"32",cy:"24",r:"18",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1"}),o.jsx("path",{d:"M32 24 L32 6 A18 18 0 0 1 48 16 Z",fill:`${A.purple}60`}),o.jsx("path",{d:"M32 24 L48 16 A18 18 0 0 1 44 40 Z",fill:`${A.green}60`}),o.jsx("path",{d:"M32 24 L44 40 A18 18 0 0 1 20 40 Z",fill:`${A.orange}60`})]}),template:"pie",dsl:`Revenue: 35
Costs: 25
Profit: 20
Other: 20`},{id:"erd",label:"ERD",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"4",width:"24",height:"18",rx:"2",fill:"#f8f8f8",stroke:A.blue,strokeWidth:"1.5"}),o.jsx("rect",{x:"4",y:"4",width:"24",height:"6",rx:"2",fill:`${A.blue}30`}),o.jsx("rect",{x:"36",y:"26",width:"24",height:"18",rx:"2",fill:"#f8f8f8",stroke:A.green,strokeWidth:"1.5"}),o.jsx("rect",{x:"36",y:"26",width:"24",height:"6",rx:"2",fill:`${A.green}30`}),o.jsx("path",{d:"M28 13 L36 35",stroke:"#666",strokeWidth:"1"}),o.jsx("circle",{cx:"28",cy:"13",r:"2",fill:"#666"}),o.jsx("circle",{cx:"36",cy:"35",r:"2",fill:"none",stroke:"#666",strokeWidth:"1"})]}),template:"erd",dsl:`CREATE TABLE users (
  id INT PRIMARY KEY,
  name VARCHAR(100),
  email VARCHAR(255)
);

CREATE TABLE orders (
  id INT PRIMARY KEY,
  user_id INT REFERENCES users(id),
  total DECIMAL
);`},{id:"class",label:"Class Diagram",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"8",y:"4",width:"22",height:"20",rx:"2",fill:"#f8f8f8",stroke:A.purple,strokeWidth:"1.5"}),o.jsx("line",{x1:"8",y1:"10",x2:"30",y2:"10",stroke:A.purple,strokeWidth:"1"}),o.jsx("line",{x1:"8",y1:"16",x2:"30",y2:"16",stroke:A.purple,strokeWidth:"0.5"}),o.jsx("rect",{x:"34",y:"24",width:"22",height:"20",rx:"2",fill:"#f8f8f8",stroke:A.orange,strokeWidth:"1.5"}),o.jsx("line",{x1:"34",y1:"30",x2:"56",y2:"30",stroke:A.orange,strokeWidth:"1"}),o.jsx("line",{x1:"34",y1:"36",x2:"56",y2:"36",stroke:A.orange,strokeWidth:"0.5"}),o.jsx("path",{d:"M19 24 L45 24",stroke:"#666",strokeWidth:"1"}),o.jsx("polygon",{points:"19,24 23,22 23,26",fill:"#666"})]}),template:"class",dsl:`class User {
  +id: int
  +name: string
  +login(): boolean
}

class Order {
  +id: int
  +total: decimal
  +process(): void
}

User "1" -- "*" Order`},{id:"linechart",label:"Line Chart",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("line",{x1:"8",y1:"40",x2:"56",y2:"40",stroke:"#666",strokeWidth:"1"}),o.jsx("line",{x1:"8",y1:"8",x2:"8",y2:"40",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M12 32 L22 24 L32 28 L42 16 L52 20",stroke:A.blue,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:"M12 36 L22 30 L32 34 L42 26 L52 30",stroke:A.green,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("circle",{cx:"12",cy:"32",r:"2",fill:A.blue}),o.jsx("circle",{cx:"32",cy:"28",r:"2",fill:A.blue}),o.jsx("circle",{cx:"52",cy:"20",r:"2",fill:A.blue})]}),template:"quadrant",dsl:`title: Performance Analysis
x-axis: Time
y-axis: Value

Q1: Low Risk, High Value
Q2: High Risk, High Value
Q3: High Risk, Low Value
Q4: Low Risk, Low Value`},{id:"radar",label:"Radar",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("polygon",{points:"32,8 52,20 48,40 16,40 12,20",fill:"none",stroke:"#ddd",strokeWidth:"1"}),o.jsx("polygon",{points:"32,14 46,22 43,36 21,36 18,22",fill:"none",stroke:"#ddd",strokeWidth:"1"}),o.jsx("polygon",{points:"32,20 40,25 38,32 26,32 24,25",fill:"none",stroke:"#ddd",strokeWidth:"1"}),o.jsx("polygon",{points:"32,12 48,21 44,38 20,38 16,21",fill:`${A.blue}30`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("circle",{cx:"32",cy:"12",r:"2",fill:A.blue}),o.jsx("circle",{cx:"48",cy:"21",r:"2",fill:A.blue}),o.jsx("circle",{cx:"44",cy:"38",r:"2",fill:A.blue})]}),template:"pie",dsl:`Performance: 85
Quality: 70
Speed: 90
Reliability: 75
Cost: 60`}]},diagrams:{label:"Diagrams",shapes:[{id:"mindmap",label:"Mind Map",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("ellipse",{cx:"32",cy:"24",rx:"12",ry:"8",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1.5"}),o.jsx("ellipse",{cx:"10",cy:"12",rx:"8",ry:"5",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1"}),o.jsx("ellipse",{cx:"54",cy:"12",rx:"8",ry:"5",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1"}),o.jsx("ellipse",{cx:"10",cy:"36",rx:"8",ry:"5",fill:`${A.orange}40`,stroke:A.orange,strokeWidth:"1"}),o.jsx("ellipse",{cx:"54",cy:"36",rx:"8",ry:"5",fill:`${A.red}40`,stroke:A.red,strokeWidth:"1"}),o.jsx("path",{d:"M20 20 L14 15",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M44 20 L50 15",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M20 28 L14 33",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M44 28 L50 33",stroke:"#666",strokeWidth:"1"})]}),template:"mindmap",dsl:`Central Topic
  Branch 1
    Sub-topic A
    Sub-topic B
  Branch 2
    Sub-topic C
  Branch 3
    Sub-topic D
    Sub-topic E`},{id:"architecture",label:"Architecture",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"4",width:"56",height:"10",rx:"2",fill:`${A.blue}20`,stroke:A.blue,strokeWidth:"1",strokeDasharray:"3,2"}),o.jsx("rect",{x:"8",y:"6",width:"14",height:"6",rx:"1",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1"}),o.jsx("rect",{x:"25",y:"6",width:"14",height:"6",rx:"1",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1"}),o.jsx("rect",{x:"42",y:"6",width:"14",height:"6",rx:"1",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1"}),o.jsx("rect",{x:"4",y:"18",width:"56",height:"10",rx:"2",fill:`${A.green}20`,stroke:A.green,strokeWidth:"1",strokeDasharray:"3,2"}),o.jsx("rect",{x:"8",y:"20",width:"22",height:"6",rx:"1",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1"}),o.jsx("rect",{x:"34",y:"20",width:"22",height:"6",rx:"1",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1"}),o.jsx("rect",{x:"4",y:"32",width:"56",height:"10",rx:"2",fill:`${A.purple}20`,stroke:A.purple,strokeWidth:"1",strokeDasharray:"3,2"}),o.jsx("rect",{x:"18",y:"34",width:"28",height:"6",rx:"1",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1"})]}),template:"architecture",dsl:`[clients] Web App, Mobile App, CLI
[services] API Gateway, Auth Service, User Service
[data] PostgreSQL, Redis, S3

Web App -> API Gateway
Mobile App -> API Gateway
API Gateway -> Auth Service
API Gateway -> User Service
User Service -> PostgreSQL
Auth Service -> Redis`},{id:"usecase",label:"Use Case",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"18",y:"4",width:"40",height:"40",rx:"4",fill:"#f8f8f8",stroke:"#ddd",strokeWidth:"1"}),o.jsx("ellipse",{cx:"38",cy:"14",rx:"12",ry:"6",fill:`${A.blue}30`,stroke:A.blue,strokeWidth:"1"}),o.jsx("ellipse",{cx:"38",cy:"28",rx:"12",ry:"6",fill:`${A.green}30`,stroke:A.green,strokeWidth:"1"}),o.jsx("ellipse",{cx:"38",cy:"42",rx:"12",ry:"6",fill:`${A.orange}30`,stroke:A.orange,strokeWidth:"1"}),o.jsx("circle",{cx:"8",cy:"14",r:"4",fill:"none",stroke:"#666",strokeWidth:"1"}),o.jsx("line",{x1:"8",y1:"18",x2:"8",y2:"28",stroke:"#666",strokeWidth:"1"}),o.jsx("line",{x1:"4",y1:"22",x2:"12",y2:"22",stroke:"#666",strokeWidth:"1"}),o.jsx("line",{x1:"8",y1:"28",x2:"4",y2:"36",stroke:"#666",strokeWidth:"1"}),o.jsx("line",{x1:"8",y1:"28",x2:"12",y2:"36",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M12 14 L26 14",stroke:"#666",strokeWidth:"1"})]}),template:"usecase",dsl:`actor User
actor Admin

User -> Login
User -> View Dashboard
User -> Update Profile

Admin -> Manage Users
Admin -> View Reports`},{id:"timeline",label:"Timeline",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("line",{x1:"8",y1:"24",x2:"56",y2:"24",stroke:"#666",strokeWidth:"2"}),o.jsx("circle",{cx:"16",cy:"24",r:"4",fill:A.blue}),o.jsx("circle",{cx:"32",cy:"24",r:"4",fill:A.green}),o.jsx("circle",{cx:"48",cy:"24",r:"4",fill:A.purple}),o.jsx("rect",{x:"10",y:"8",width:"12",height:"8",rx:"2",fill:`${A.blue}30`,stroke:A.blue,strokeWidth:"1"}),o.jsx("rect",{x:"26",y:"32",width:"12",height:"8",rx:"2",fill:`${A.green}30`,stroke:A.green,strokeWidth:"1"}),o.jsx("rect",{x:"42",y:"8",width:"12",height:"8",rx:"2",fill:`${A.purple}30`,stroke:A.purple,strokeWidth:"1"})]}),template:"timeline",dsl:`2024-01: Project Start
2024-03: Phase 1 Complete
2024-06: Beta Release
2024-09: v1.0 Launch
2024-12: Year Review`},{id:"journey",label:"User Journey",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("circle",{cx:"8",cy:"24",r:"4",fill:A.green}),o.jsx("circle",{cx:"22",cy:"16",r:"4",fill:A.blue}),o.jsx("circle",{cx:"36",cy:"28",r:"4",fill:A.orange}),o.jsx("circle",{cx:"50",cy:"20",r:"4",fill:A.purple}),o.jsx("path",{d:"M12 24 Q17 16, 18 16",stroke:"#666",strokeWidth:"1",fill:"none"}),o.jsx("path",{d:"M26 16 Q31 16, 32 28",stroke:"#666",strokeWidth:"1",fill:"none"}),o.jsx("path",{d:"M40 28 Q45 28, 46 20",stroke:"#666",strokeWidth:"1",fill:"none"}),o.jsx("path",{d:"M8 34 Q22 42, 36 38 Q50 34, 56 36",stroke:A.green,strokeWidth:"2",fill:"none",strokeDasharray:"4,2"})]}),template:"journey",dsl:`[start] Discover
[action] Sign Up
[action] Explore
[decision] Subscribe?
[success] Premium User
[end] Loyal Customer

Discover -> Sign Up -> Explore -> Subscribe?
Subscribe? -yes-> Premium User -> Loyal Customer
Subscribe? -no-> Explore`},{id:"git",label:"Git Graph",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("line",{x1:"16",y1:"8",x2:"16",y2:"40",stroke:A.blue,strokeWidth:"2"}),o.jsx("line",{x1:"32",y1:"16",x2:"32",y2:"40",stroke:A.green,strokeWidth:"2"}),o.jsx("line",{x1:"48",y1:"24",x2:"48",y2:"40",stroke:A.purple,strokeWidth:"2"}),o.jsx("circle",{cx:"16",cy:"12",r:"3",fill:A.blue}),o.jsx("circle",{cx:"16",cy:"24",r:"3",fill:A.blue}),o.jsx("circle",{cx:"16",cy:"36",r:"3",fill:A.blue}),o.jsx("circle",{cx:"32",cy:"20",r:"3",fill:A.green}),o.jsx("circle",{cx:"32",cy:"32",r:"3",fill:A.green}),o.jsx("circle",{cx:"48",cy:"28",r:"3",fill:A.purple}),o.jsx("path",{d:"M16 12 Q24 12, 32 20",stroke:"#666",strokeWidth:"1",fill:"none"}),o.jsx("path",{d:"M32 20 Q40 20, 48 28",stroke:"#666",strokeWidth:"1",fill:"none"}),o.jsx("path",{d:"M32 32 L16 36",stroke:"#666",strokeWidth:"1"})]}),template:"gitgraph",dsl:`commit: Initial commit
branch: feature
commit: Add feature
checkout: main
commit: Fix bug
merge: feature
commit: Release v1.0`}]},components:{label:"Components",shapes:[{id:"deployment",label:"Deployment",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"4",width:"26",height:"18",rx:"3",fill:`${A.blue}20`,stroke:A.blue,strokeWidth:"1.5",strokeDasharray:"4,2"}),o.jsx("rect",{x:"8",y:"8",width:"8",height:"6",rx:"1",fill:`${A.blue}50`}),o.jsx("rect",{x:"18",y:"8",width:"8",height:"6",rx:"1",fill:`${A.blue}50`}),o.jsx("rect",{x:"34",y:"26",width:"26",height:"18",rx:"3",fill:`${A.green}20`,stroke:A.green,strokeWidth:"1.5",strokeDasharray:"4,2"}),o.jsx("rect",{x:"38",y:"30",width:"8",height:"6",rx:"1",fill:`${A.green}50`}),o.jsx("rect",{x:"48",y:"30",width:"8",height:"6",rx:"1",fill:`${A.green}50`}),o.jsx("path",{d:"M30 13 L34 35",stroke:"#666",strokeWidth:"1",strokeDasharray:"3,2"})]}),template:"deployment",dsl:`node: AWS Cloud {
  node: EC2 Instance {
    component: Web Server
    component: API Server
  }
  node: RDS {
    component: PostgreSQL
  }
}`},{id:"component",label:"Component",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"16",y:"8",width:"32",height:"32",rx:"4",fill:`${A.purple}20`,stroke:A.purple,strokeWidth:"1.5"}),o.jsx("rect",{x:"10",y:"14",width:"8",height:"6",rx:"1",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1"}),o.jsx("rect",{x:"10",y:"28",width:"8",height:"6",rx:"1",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1"}),o.jsx("rect",{x:"46",y:"14",width:"8",height:"6",rx:"1",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1"}),o.jsx("rect",{x:"46",y:"28",width:"8",height:"6",rx:"1",fill:`${A.purple}40`,stroke:A.purple,strokeWidth:"1"}),o.jsx("text",{x:"32",y:"28",textAnchor:"middle",fontSize:"8",fill:A.purple,children:"API"})]}),template:"component",dsl:`component: Auth Service [auth]
component: User Service [user]
component: Order Service [order]
component: Payment Gateway [payment]

Auth Service -> User Service
User Service -> Order Service
Order Service -> Payment Gateway`},{id:"c4",label:"C4 Model",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("rect",{x:"4",y:"4",width:"56",height:"40",rx:"4",fill:"#f5f5f5",stroke:"#ddd",strokeWidth:"1"}),o.jsx("rect",{x:"8",y:"8",width:"18",height:"14",rx:"2",fill:`${A.blue}30`,stroke:A.blue,strokeWidth:"1"}),o.jsx("circle",{cx:"38",cy:"8",r:"6",fill:"none",stroke:A.orange,strokeWidth:"1.5"}),o.jsx("circle",{cx:"38",cy:"4",r:"2",fill:`${A.orange}40`,stroke:A.orange,strokeWidth:"1"}),o.jsx("rect",{x:"48",y:"8",width:"10",height:"14",rx:"2",fill:`${A.green}30`,stroke:A.green,strokeWidth:"1"}),o.jsx("rect",{x:"8",y:"28",width:"22",height:"14",rx:"2",fill:`${A.purple}30`,stroke:A.purple,strokeWidth:"1"}),o.jsx("rect",{x:"34",y:"28",width:"22",height:"14",rx:"2",fill:`${A.pink}30`,stroke:A.pink,strokeWidth:"1"})]}),template:"c4",dsl:`person: User [User accesses the system]
system: Web Application [Main application]
container: API Backend [Handles requests]
container: Database [Stores data]

User -> Web Application: Uses
Web Application -> API Backend: Calls
API Backend -> Database: Reads/Writes`},{id:"state",label:"State Machine",icon:o.jsxs("svg",{viewBox:"0 0 64 48",fill:"none",children:[o.jsx("circle",{cx:"12",cy:"24",r:"6",fill:"none",stroke:"#666",strokeWidth:"2"}),o.jsx("circle",{cx:"12",cy:"24",r:"4",fill:"#666"}),o.jsx("circle",{cx:"32",cy:"12",r:"6",fill:`${A.blue}40`,stroke:A.blue,strokeWidth:"1.5"}),o.jsx("circle",{cx:"52",cy:"24",r:"6",fill:`${A.green}40`,stroke:A.green,strokeWidth:"1.5"}),o.jsx("circle",{cx:"32",cy:"36",r:"6",fill:`${A.orange}40`,stroke:A.orange,strokeWidth:"1.5"}),o.jsx("path",{d:"M18 22 L26 14",stroke:"#666",strokeWidth:"1",markerEnd:"url(#arrow)"}),o.jsx("path",{d:"M38 12 L46 20",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M52 30 L52 36 L38 36",stroke:"#666",strokeWidth:"1"}),o.jsx("path",{d:"M26 36 L18 28",stroke:"#666",strokeWidth:"1"})]}),template:"state",dsl:`[*] -> Idle
Idle -> Processing : start
Processing -> Complete : success
Processing -> Error : fail
Error -> Idle : retry
Complete -> [*]`}]}};function Qv({isOpen:i,onClose:t,onSelectShape:r,theme:n}){const[a,s]=M.useState(Object.keys(Gh).reduce((d,p)=>({...d,[p]:!0}),{})),e=(n==null?void 0:n.name)==="dark",l=d=>{s(p=>({...p,[d]:!p[d]}))};if(!i)return null;const h={overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",backdropFilter:"blur(4px)",display:"flex",justifyContent:"flex-end",zIndex:1e3},panel:{width:320,maxWidth:"90vw",height:"100vh",background:e?"linear-gradient(180deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))":"linear-gradient(180deg, #ffffff, #f8fafc)",borderLeft:`1px solid ${e?"rgba(255,255,255,0.1)":"#e2e8f0"}`,display:"flex",flexDirection:"column",boxShadow:"-10px 0 30px rgba(0,0,0,0.2)"},header:{padding:"16px 20px",borderBottom:`1px solid ${e?"rgba(255,255,255,0.1)":"#e2e8f0"}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:e?"rgba(0,0,0,0.2)":"#f1f5f9"},headerTitle:{display:"flex",alignItems:"center",gap:10},headerIcon:{width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"},title:{fontWeight:600,fontSize:"1rem",color:e?"#fff":"#1e293b"},closeBtn:{background:"transparent",border:"none",color:e?"#94a3b8":"#64748b",fontSize:"1.2rem",cursor:"pointer",padding:4,borderRadius:4},content:{flex:1,overflowY:"auto",padding:"8px 0"},category:{marginBottom:4},categoryHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 20px",cursor:"pointer",background:e?"rgba(255,255,255,0.02)":"rgba(0,0,0,0.02)",borderBottom:`1px solid ${e?"rgba(255,255,255,0.05)":"#f1f5f9"}`,transition:"background 0.2s"},categoryLabel:{fontWeight:600,fontSize:"0.9rem",color:e?"#e2e8f0":"#334155"},categoryArrow:{fontSize:"0.8rem",color:e?"#64748b":"#94a3b8",transition:"transform 0.2s"},shapesGrid:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,padding:"16px 20px"},shapeItem:{display:"flex",flexDirection:"column",alignItems:"center",gap:6,padding:10,background:e?"rgba(255,255,255,0.05)":"#fff",borderRadius:12,border:`1px solid ${e?"rgba(255,255,255,0.1)":"#e2e8f0"}`,cursor:"pointer",transition:"all 0.2s"},shapeIcon:{width:64,height:48},shapeLabel:{fontSize:"0.7rem",color:e?"#94a3b8":"#64748b",textAlign:"center",fontWeight:500},footer:{padding:"12px 20px",borderTop:`1px solid ${e?"rgba(255,255,255,0.1)":"#e2e8f0"}`,background:e?"rgba(0,0,0,0.2)":"#f1f5f9"},hint:{fontSize:"0.75rem",color:e?"#64748b":"#94a3b8",textAlign:"center"}};return o.jsx("div",{style:h.overlay,onClick:t,children:o.jsxs("div",{style:h.panel,onClick:d=>d.stopPropagation(),children:[o.jsxs("div",{style:h.header,children:[o.jsxs("div",{style:h.headerTitle,children:[o.jsx("div",{style:h.headerIcon,children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})]})}),o.jsx("span",{style:h.title,children:"Categories"})]}),o.jsx("button",{style:h.closeBtn,onClick:t,children:""})]}),o.jsx("div",{style:h.content,children:Object.entries(Gh).map(([d,p])=>o.jsxs("div",{style:h.category,children:[o.jsxs("div",{style:h.categoryHeader,onClick:()=>l(d),onMouseEnter:f=>f.currentTarget.style.background=e?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.04)",onMouseLeave:f=>f.currentTarget.style.background=e?"rgba(255,255,255,0.02)":"rgba(0,0,0,0.02)",children:[o.jsx("span",{style:h.categoryLabel,children:p.label}),o.jsx("span",{style:{...h.categoryArrow,transform:a[d]?"rotate(180deg)":"rotate(0deg)"},children:""})]}),a[d]&&o.jsx("div",{style:h.shapesGrid,children:p.shapes.map(f=>o.jsxs("div",{style:h.shapeItem,onClick:()=>r(f),onMouseEnter:x=>{x.currentTarget.style.background=e?"rgba(124,58,237,0.2)":"rgba(124,58,237,0.1)",x.currentTarget.style.borderColor=A.purple,x.currentTarget.style.transform="scale(1.05)"},onMouseLeave:x=>{x.currentTarget.style.background=e?"rgba(255,255,255,0.05)":"#fff",x.currentTarget.style.borderColor=e?"rgba(255,255,255,0.1)":"#e2e8f0",x.currentTarget.style.transform="scale(1)"},children:[o.jsx("div",{style:h.shapeIcon,children:f.icon}),o.jsx("span",{style:h.shapeLabel,children:f.label})]},f.id))})]},d))}),o.jsx("div",{style:h.footer,children:o.jsx("p",{style:h.hint,children:"Click a shape to use it as a diagram template"})})]})})}async function hg(i,t=2){const r=i.getBoundingClientRect(),n=Math.ceil(r.width),a=Math.ceil(r.height),s=document.createElement("canvas");s.width=n*t,s.height=a*t;const e=s.getContext("2d");e.scale(t,t),e.fillStyle="#1a1a2e",e.fillRect(0,0,n,a);const l=i.querySelectorAll("svg");for(const h of l)await Zv(h,e,i);return await Jv(i,e),s}async function Zv(i,t,r){const n=i.getBoundingClientRect(),a=r.getBoundingClientRect(),s=n.left-a.left,e=n.top-a.top,l=i.cloneNode(!0),h=i.querySelectorAll("*"),d=l.querySelectorAll("*");h.forEach((x,g)=>{const m=d[g];if(m)try{const c=window.getComputedStyle(x);["fill","stroke","stroke-width","stroke-dasharray","opacity","font-size","font-family"].forEach(u=>{const b=c.getPropertyValue(u);b&&b!=="none"&&m.setAttribute(u,b)}),m.style.animation="none"}catch{}}),l.setAttribute("width",n.width),l.setAttribute("height",n.height),l.setAttribute("xmlns","http://www.w3.org/2000/svg");const p=new XMLSerializer().serializeToString(l),f=new Blob([p],{type:"image/svg+xml;charset=utf-8"});return new Promise(x=>{const g=new Image;g.onload=()=>{t.drawImage(g,s,e,n.width,n.height),URL.revokeObjectURL(g.src),x()},g.onerror=()=>{URL.revokeObjectURL(g.src),x()},g.src=URL.createObjectURL(f)})}async function Jv(i,t){const r=i.getBoundingClientRect(),n=i.querySelectorAll("*"),a=new Set;for(const e of n){if(e.classList.contains("canvas-bg")||e.tagName==="SVG"||e.tagName==="svg"||e.closest("svg"))continue;const l=e.getBoundingClientRect();if(l.width<5||l.height<5)continue;const h=window.getComputedStyle(e);if(h.display==="none"||h.visibility==="hidden")continue;const d=l.left-r.left,p=l.top-r.top;if(d<-50||p<-50||d>r.width+50||p>r.height+50)continue;const f=h.backgroundColor,x=h.borderColor,g=f&&f!=="rgba(0, 0, 0, 0)"&&f!=="transparent",m=x&&x!=="rgba(0, 0, 0, 0)"&&parseInt(h.borderWidth)>0,c=`${Math.round(d)},${Math.round(p)},${Math.round(l.width)},${Math.round(l.height)}`;if((g||m)&&!a.has(c)){a.add(c);const u=parseInt(h.borderRadius)||0;g&&(t.fillStyle=f,u>0?(Yh(t,d,p,l.width,l.height,u),t.fill()):t.fillRect(d,p,l.width,l.height)),m&&(t.strokeStyle=x,t.lineWidth=parseInt(h.borderWidth)||1,u>0?(Yh(t,d,p,l.width,l.height,u),t.stroke()):t.strokeRect(d,p,l.width,l.height))}}const s=new Set;for(const e of n){if(e.closest("svg")||e.classList.contains("canvas-bg"))continue;const l=window.getComputedStyle(e);if(l.display==="none"||l.visibility==="hidden")continue;let h="";for(const S of e.childNodes)S.nodeType===Node.TEXT_NODE&&(h+=S.textContent);if(!h&&e.children.length===0&&(h=e.textContent||""),h=h.trim(),!h)continue;const d=e.getBoundingClientRect();let p=d.left-r.left,f=d.top-r.top,x,g;if(d.width>1&&d.height>1?(x=p+d.width/2,g=f+d.height/2):(x=p,g=f),x<-200||g<-200||x>r.width+200||g>r.height+200)continue;const m=`${h}@${Math.round(x)},${Math.round(g)}`;if(s.has(m))continue;s.add(m);const c=l.fontSize||"14px",u=l.fontWeight||"400",b=l.fontFamily||"system-ui, -apple-system, sans-serif",y=l.color||"#ffffff";t.fillStyle=y,t.font=`${u} ${c} ${b}`,t.textAlign="center",t.textBaseline="middle",t.fillText(h,x,g)}}function Yh(i,t,r,n,a,s){i.beginPath(),i.moveTo(t+s,r),i.lineTo(t+n-s,r),i.quadraticCurveTo(t+n,r,t+n,r+s),i.lineTo(t+n,r+a-s),i.quadraticCurveTo(t+n,r+a,t+n-s,r+a),i.lineTo(t+s,r+a),i.quadraticCurveTo(t,r+a,t,r+a-s),i.lineTo(t,r+s),i.quadraticCurveTo(t,r,t+s,r),i.closePath()}function fg(i,t){const r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(r),100)}async function e2(i,t="diagram",r=2){var a;if(!i)throw new Error("No container element provided");const n=((a=i.querySelector('[class*="canvas"]'))==null?void 0:a.parentElement)||i.firstElementChild||i;try{const s=await hg(n,r);return new Promise((e,l)=>{s.toBlob(h=>{if(!h){l(new Error("Failed to create PNG"));return}fg(h,`${t}.png`),e()},"image/png",1)})}catch(s){throw console.error("Export failed:",s),new Error(`Export failed: ${s.message}`)}}function t2(i,t="diagram"){if(!i)throw new Error("No container element provided");const r=i.querySelector("svg");if(!r)throw new Error("No SVG element found in the diagram");const n=r.cloneNode(!0),a=r.getBoundingClientRect(),s=r.querySelectorAll("*"),e=n.querySelectorAll("*");s.forEach((d,p)=>{const f=e[p];if(f)try{const x=window.getComputedStyle(d);["fill","stroke","stroke-width","stroke-dasharray","opacity","font-size","font-family","font-weight"].forEach(g=>{const m=x.getPropertyValue(g);m&&m!=="none"&&m!=="normal"&&f.setAttribute(g,m)}),f.style.animation="none"}catch{}}),n.setAttribute("width",a.width),n.setAttribute("height",a.height),n.setAttribute("xmlns","http://www.w3.org/2000/svg");const l=`<?xml version="1.0" encoding="UTF-8"?>
`+new XMLSerializer().serializeToString(n),h=new Blob([l],{type:"image/svg+xml;charset=utf-8"});fg(h,`${t}.svg`)}async function r2(i,t=2){var n;if(!i)throw new Error("No container element provided");const r=((n=i.querySelector('[class*="canvas"]'))==null?void 0:n.parentElement)||i.firstElementChild||i;try{const a=await hg(r,t);return new Promise((s,e)=>{a.toBlob(async l=>{if(!l){e(new Error("Failed to create image"));return}try{await navigator.clipboard.write([new ClipboardItem({"image/png":l})]),s()}catch(h){console.error("Clipboard error:",h),e(new Error("Clipboard access denied. Try using HTTPS."))}},"image/png",1)})}catch(a){throw new Error(`Copy failed: ${a.message}`)}}function n2(i){if(!i)throw new Error("No container element provided");const t=i.cloneNode(!0),r=i.getBoundingClientRect(),n=r.width+100,a=r.height+100,s=window.open("","_blank",`width=${n},height=${a}`);if(!s)throw new Error("Pop-up blocked. Please allow pop-ups.");let e="";for(const l of document.styleSheets)try{for(const h of l.cssRules)e+=h.cssText+`
`}catch{}s.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>DDFlow Diagram</title>
      <style>
        ${e}
        * { margin: 0; padding: 0; box-sizing: border-box; }
        @page { size: auto; margin: 10mm; }
        @media print {
          body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
        body {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          background: #1a1a2e;
          padding: 20px;
        }
        .diagram-container {
          transform-origin: top left;
        }
      </style>
    </head>
    <body>
      <div class="diagram-container">${t.innerHTML}</div>
      <script>
        window.onload = function() { setTimeout(function() { window.print(); }, 500); };
        window.onafterprint = function() { window.close(); };
      <\/script>
    </body>
    </html>
  `),s.document.close()}const gg={UNDO:{key:"z",meta:!0,description:"Undo",category:"Edit"},REDO:{key:"z",meta:!0,shift:!0,description:"Redo",category:"Edit"},ZOOM_IN:{key:"=",keyAlt:"+",description:"Zoom in",category:"View"},ZOOM_OUT:{key:"-",description:"Zoom out",category:"View"},RESET_VIEW:{key:"r",description:"Reset view",category:"View"},RESET_VIEW_ALT:{key:"Home",description:"Reset view (alt)",category:"View"},PAN_UP:{key:"ArrowUp",description:"Pan up",category:"Navigation"},PAN_DOWN:{key:"ArrowDown",description:"Pan down",category:"Navigation"},PAN_LEFT:{key:"ArrowLeft",description:"Pan left",category:"Navigation"},PAN_RIGHT:{key:"ArrowRight",description:"Pan right",category:"Navigation"},TOGGLE_EDITOR:{key:"e",meta:!0,description:"Toggle editor",category:"Editor"},TOGGLE_AI_CHAT:{key:"k",meta:!0,description:"Toggle AI chat",category:"Editor"},HELP:{key:"?",description:"Show keyboard shortcuts",category:"Help"},HELP_ALT:{key:"/",shift:!0,description:"Show keyboard shortcuts (alt)",category:"Help"},EXPORT_PNG:{key:"p",meta:!0,shift:!0,description:"Export as PNG",category:"Export"},EXPORT_SVG:{key:"s",meta:!0,shift:!0,description:"Export as SVG",category:"Export"},COPY_CLIPBOARD:{key:"c",meta:!0,shift:!0,description:"Copy to clipboard",category:"Export"}};function i2(i){const t=[],r=typeof navigator<"u"&&/Mac|iPhone|iPad|iPod/.test(navigator.platform);i.meta&&t.push(r?"":"Ctrl"),i.shift&&t.push(r?"":"Shift"),i.alt&&t.push(r?"":"Alt");let n=i.key;return n==="ArrowUp"?n="":n==="ArrowDown"?n="":n==="ArrowLeft"?n="":n==="ArrowRight"?n="":n==="Home"?n="Home":n==="="?n="+":n==="/"?n="/":n=n.toUpperCase(),t.push(n),t.join(r?"":"+")}function o2(){const i={};return Object.entries(gg).forEach(([t,r])=>{if(t.endsWith("_ALT"))return;const n=r.category||"Other";i[n]||(i[n]=[]),i[n].push({name:t,...r,formatted:i2(r)})}),i}function a2(i,t){var l;const n=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?i.metaKey:i.ctrlKey;if(t.meta&&!n||!t.meta&&n||t.shift&&!i.shiftKey||!t.shift&&i.shiftKey&&t.key!=="?"||t.alt&&!i.altKey||!t.alt&&i.altKey)return!1;const a=i.key.toLowerCase(),s=t.key.toLowerCase(),e=(l=t.keyAlt)==null?void 0:l.toLowerCase();return a===s||e&&a===e}function s2(i,t=!0){const r=M.useCallback(n=>{if(!t)return;const a=n.target;if(!(a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable)){for(const[s,e]of Object.entries(gg))if(a2(n,e)){const l=i[s];if(l){n.preventDefault(),l(n);return}}}},[i,t]);M.useEffect(()=>(window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)),[r])}function c2(i){const t=i.trim().toLowerCase();return t.startsWith("flowchart")||t.startsWith("graph")?"flowchart":t.startsWith("sequencediagram")?"sequence":t.startsWith("classdiagram")?"class":t.startsWith("statediagram")?"state":t.startsWith("erdiagram")?"erd":t.startsWith("gantt")?"gantt":t.startsWith("pie")?"pie":t.startsWith("gitgraph")?"git":t.startsWith("journey")?"journey":t.startsWith("mindmap")?"mindmap":t.startsWith("c4context")||t.startsWith("c4container")||t.startsWith("c4component")||t.startsWith("c4dynamic")||t.startsWith("c4deployment")?"c4":t.startsWith("timeline")?"timeline":t.startsWith("quadrantchart")?"quadrant":t.startsWith("sankey")?"sankey":t.startsWith("requirementdiagram")?"requirement":null}function Le(i){return i.replace(/<br\s*\/?>/gi," ").replace(/<[^>]+>/g,"").replace(/\s+/g," ").trim()}function l2(i){const t=i.split(`
`),r=t[0].trim().toLowerCase(),n=t.slice(1);let a="TB";const s=r.match(/(?:flowchart|graph)\s+(td|tb|lr|rl|bt)/i);s&&(a=s[1].toUpperCase(),a==="TD"&&(a="TB"));const e=new Map,l=new Map,h=new Map,d=new Map,p=[];let f=!1,x=null;const g=C=>{C=C.trim();let E=C.match(/^(\w+)\(\(\((.+)\)\)\)$/);return E?{id:E[1],label:Le(E[2]),type:"start"}:(E=C.match(/^(\w+)\{\{(.+)\}\}$/),E?{id:E[1],label:Le(E[2]),type:"hexagon"}:(E=C.match(/^(\w+)\[\[(.+)\]\]$/),E?{id:E[1],label:Le(E[2]),type:"subroutine"}:(E=C.match(/^(\w+)\[\/(.+)\/\]$/),E?{id:E[1],label:Le(E[2]),type:"io"}:(E=C.match(/^(\w+)\[\\(.+)\\\]$/),E?{id:E[1],label:Le(E[2]),type:"io"}:(E=C.match(/^(\w+)\[\/(.+)\\\]$/),E?{id:E[1],label:Le(E[2]),type:"trapezoid"}:(E=C.match(/^(\w+)\[\\(.+)\/\]$/),E?{id:E[1],label:Le(E[2]),type:"trapezoid"}:(E=C.match(/^(\w+)>(.+)\]$/),E?{id:E[1],label:Le(E[2]),type:"flag"}:(E=C.match(/^(\w+)\(\(([^)]+)\)\)$/),E?{id:E[1],label:Le(E[2]),type:"start"}:(E=C.match(/^(\w+)\(\[([^\]]+)\]\)$/),E?{id:E[1],label:Le(E[2]),type:"process"}:(E=C.match(/^(\w+)\[\(([^)]+)\)\]$/),E?{id:E[1],label:Le(E[2]),type:"database"}:(E=C.match(/^(\w+)\{([^}]+)\}$/),E?{id:E[1],label:Le(E[2]),type:"decision"}:(E=C.match(/^(\w+)\[([^\]]+)\]$/),E?{id:E[1],label:Le(E[2]),type:"process"}:(E=C.match(/^(\w+)\(([^)]+)\)$/),E?{id:E[1],label:Le(E[2]),type:"process"}:(E=C.match(/^(\w+)$/),E?{id:E[1],label:E[1],type:"process"}:null))))))))))))))},m=C=>C.replace(/fa:fa-[\w-]+\s*/g,"").trim()||C;n.forEach(C=>{if(C=C.trim(),!C||C.startsWith("%%"))return;const E=C.match(/^subgraph\s+(.+)/i);if(E){x=Le(E[1]),d.has(x)||d.set(x,[]);return}if(C==="end"){x=null;return}const R=/^(.+?)\s*(--+>|==+>|-\.+->?|--+o|--+x|~~~|--+)\s*(?:\|([^|]*)\|)?\s*(.+)$/;let T=C.match(R);if(!T){const B=/^(.+?)\s*--\s+([^-]+?)\s+-->\s*(.+)$/,z=C.match(B);z&&(T=[C,z[1],"-->",z[2].trim(),z[3]])}if(T){const[,B,z,D,U]=T,N=g(B.trim());if(N){const ee=m(N.label),ne=N.label!==N.id;(ne||!e.has(N.id))&&e.set(N.id,ee),(ne||!l.has(N.id))&&l.set(N.id,N.type),N.type==="decision"&&(f=!0),x&&(h.set(N.id,x),d.get(x).includes(N.id)||d.get(x).push(N.id))}const H=g(U.trim());if(H){const ee=m(H.label),ne=H.label!==H.id;(ne||!e.has(H.id))&&e.set(H.id,ee),(ne||!l.has(H.id))&&l.set(H.id,H.type),H.type==="decision"&&(f=!0),x&&(h.set(H.id,x),d.get(x).includes(H.id)||d.get(x).push(H.id))}N&&H&&p.push({from:N.id,to:H.id,label:D?Le(D):""});return}const I=g(C);if(I){const B=m(I.label),z=I.label!==I.id;(z||!e.has(I.id))&&e.set(I.id,B),(z||!l.has(I.id))&&l.set(I.id,I.type),I.type==="decision"&&(f=!0),x&&(h.set(I.id,x),d.get(x).includes(I.id)||d.get(x).push(I.id))}});const c=[];p.forEach(({from:C,to:E})=>{c.includes(C)||c.push(C),c.includes(E)||c.push(E)}),e.forEach((C,E)=>{c.includes(E)||c.push(E)});const u=new Map;let b=!1;p.forEach(({from:C,label:E})=>{u.set(C,(u.get(C)||0)+1),E&&/interact|fetch|cache|call|send|use|connect|query|read|write|get|post|create|update|webhook|event/i.test(E)&&(b=!0)});const y=[...u.values()].some(C=>C>1),S=d.size>0;if(!f&&(S||y&&b||b||e.size>=8&&y))return{type:"architecture",source:d2(e,p,c,h,d,l)};const k=[],j=new Set;if(a!=="TB"&&k.push(`direction: ${a}`),c.length>0){const C=c[0],E=e.get(C)||C,R=l.get(C)||"process";k.push(`(${R}) ${E}`),j.add(C)}return p.forEach(({from:C,to:E,label:R})=>{const T=e.get(C)||C,I=e.get(E)||E,B=l.get(E)||"process";R?k.push(`${T} -> (${B}) ${I}: ${R}`):k.push(`${T} -> (${B}) ${I}`),j.add(E)}),{type:"flowchart",source:k.join(`
`)}}function d2(i,t,r,n=new Map,a=new Map,s=new Map){const e=[],l={clients:/^(fe|ui|frontend|user|client|browser|mobile|app)\b/i,gateway:/gateway|proxy|load.?balancer|nginx|router|ingress|kong|traefik|envoy/i,service:/(api|service|server|backend|engine|controller|handler|processor)\b/i,database:/database|db|mysql|postgres|mongo|redis|cache|storage|sql|queue|index|store|elastic|dynamo|s3|bucket/i,external:/external|third.?party|vendor|saas|stripe|twilio|sendgrid|aws|gcp|azure/i},h=(y,S)=>{const w=`${y} ${S}`.toLowerCase();return l.clients.test(w)?"clients":l.gateway.test(w)?"gateway":l.database.test(w)?"database":l.external.test(w)?"external":(l.service.test(w),"service")},d=new Map,p=new Map;r.forEach(y=>{d.set(y,[]),p.set(y,[])}),t.forEach(({from:y,to:S})=>{d.has(y)&&d.get(y).push(S),p.has(S)&&p.get(S).push(y)});const f=new Set;r.forEach(y=>{const S=i.get(y)||y;((p.get(y)||[]).length===0||l.clients.test(S)||l.clients.test(y))&&f.add(y)}),f.size===0&&r.length>0&&f.add(r[0]);const x=new Set;t.forEach(({from:y,to:S},w)=>{f.has(S)&&!f.has(y)&&x.add(w)});const g=new Map;f.forEach(y=>g.set(y,0));const m=[...f];for(;m.length>0;){const y=m.shift(),S=g.get(y);(d.get(y)||[]).forEach(k=>{const j=t.findIndex(R=>R.from===y&&R.to===k);if(x.has(j))return;const C=g.get(k),E=S+1;(C===void 0||C<E)&&(g.set(k,E),m.includes(k)||m.push(k))})}a.size>0&&a.forEach((y,S)=>{if(y.filter(k=>(p.get(k)||[]).filter(C=>!y.includes(C)).length===0).length===y.length){Math.max(0,...g.values()),y.forEach((j,C)=>{g.has(j)||g.set(j,0)});const k=y.filter(j=>g.has(j));for(;k.length>0;){const j=k.shift(),C=g.get(j);(d.get(j)||[]).filter(R=>y.includes(R)||!g.has(R)).forEach(R=>{const T=C+1;(!g.has(R)||g.get(R)<T)&&(g.set(R,T),k.includes(R)||k.push(R))})}}});const c=g.size>0?Math.floor([...g.values()].reduce((y,S)=>y+S,0)/g.size):0;r.forEach(y=>{g.has(y)||g.set(y,c)});const u=new Map;return r.forEach(y=>{const S=g.get(y);u.has(S)||u.set(S,[]),u.get(S).push(y)}),[...u.keys()].sort((y,S)=>y-S).forEach(y=>{const S=u.get(y),w=new Map;S.forEach(k=>{const j=i.get(k)||k,C=n.get(k);let E;if(C){const R=C.toLowerCase();/ingestion|ingest|import|input/i.test(R)?E="service":/gateway|api/i.test(R)?E="gateway":/data|storage|database/i.test(R)?E="database":/external|third/i.test(R)?E="external":E=h(j,k)}else E=h(j,k);w.has(E)||w.set(E,[]),w.get(E).push(k)}),w.forEach((k,j)=>{const C=k.map(E=>i.get(E)||E);e.push(`[${j}] ${C.join(", ")}`)})}),e.push(""),t.forEach(({from:y,to:S,label:w})=>{const k=i.get(y)||y,j=i.get(S)||S;w?e.push(`${k} -> ${j}: ${w}`):e.push(`${k} -> ${j}`)}),e.join(`
`)}function u2(i){const t=i.split(`
`).slice(1),r=new Set,n=[],a=new Map;t.forEach(e=>{if(e=e.trim(),!e||e.startsWith("%%"))return;const l=e.match(/^participant\s+(\w+)(?:\s+as\s+(.+))?/i);if(l){const C=l[1],E=l[2]||l[1];a.set(C,E),r.add(E);return}const h=e.match(/^actor\s+(\w+)(?:\s+as\s+(.+))?/i);if(h){const C=h[1],E=h[2]||h[1];a.set(C,E),r.add(E);return}const d=e.match(/^loop\s+(.+)/i);if(d){n.push(`loop ${d[1]}`);return}const p=e.match(/^alt\s+(.+)/i);if(p){n.push(`alt ${p[1]}`);return}const f=e.match(/^else\s*(.*)/i);if(f){n.push(`else ${f[1]||""}`);return}const x=e.match(/^opt\s+(.+)/i);if(x){n.push(`opt ${x[1]}`);return}const g=e.match(/^par\s+(.+)/i);if(g){n.push(`par ${g[1]}`);return}const m=e.match(/^and\s+(.+)/i);if(m){n.push(`and ${m[1]}`);return}const c=e.match(/^critical\s+(.+)/i);if(c){n.push(`critical ${c[1]}`);return}const u=e.match(/^option\s+(.+)/i);if(u){n.push(`option ${u[1]}`);return}const b=e.match(/^break\s+(.+)/i);if(b){n.push(`break ${b[1]}`);return}const y=e.match(/^rect\s+(.+)/i);if(y){n.push(`rect ${y[1]}`);return}const S=e.match(/^(activate|deactivate)\s+(\w+)/i);if(S){const C=S[2],E=a.get(C)||C;n.push(`${S[1].toLowerCase()} ${E}`);return}if(e.toLowerCase()==="end"){n.push("end");return}const w=e.match(/^note\s+(left|right)\s+of\s+(\w+)\s*:\s*(.+)/i);if(w){const C=w[1].toLowerCase(),E=w[2],R=a.get(E)||E,T=w[3];n.push(`note ${C} of ${R}: ${T}`);return}const k=e.match(/^note\s+over\s+(.+?)\s*:\s*(.+)/i);if(k){const C=k[1].split(",").map(E=>{const R=E.trim();return a.get(R)||R});n.push(`note over ${C.join(", ")}: ${k[2]}`);return}const j=e.match(/(\w+)\s*(-?->>?|-->>?|-x|--x|-\)|--\))([+-])?\s*(\w+)\s*:\s*(.+)/);if(j){const[,C,E,R,T,I]=j,B=a.get(C)||C,z=a.get(T)||T,D=E.startsWith("--"),U=E.includes("x"),N=E.includes(")");r.add(B),r.add(z);let H=D?"-->":"->";U?H=D?"--x":"-x":N&&(H=D?"--)":"-)"),n.push(`${B} ${H} ${z}: ${I}`),R==="+"?n.push(`activate ${z}`):R==="-"&&n.push(`deactivate ${z}`)}});const s=[];return r.size>0&&(s.push(`participant ${[...r].join(", ")}`),s.push("")),s.push(...n),s.join(`
`)}function p2(i){const t=i.split(`
`).slice(1),r=new Map,n=[];let a=null;t.forEach(e=>{if(e=e.trim(),!e||e.startsWith("%%"))return;const l=e.match(/^class\s+(\w+)/i);if(l){a=l[1],r.has(a)||r.set(a,{name:a,members:[]});return}if(a&&(e.startsWith("+")||e.startsWith("-")||e.startsWith("#")||e.startsWith("~"))){r.get(a).members.push(e);return}const h=e.match(/^(\w+)\s*:\s*(.+)/);if(h&&!e.includes("--")&&!e.includes("..")){const[,p,f]=h;r.has(p)||r.set(p,{name:p,members:[]}),r.get(p).members.push(f);return}const d=e.match(/(\w+)\s*(--|>|\.\.>|-->|--\*|--o|\.\.|--)\s*(\w+)(?:\s*:\s*(.+))?/);if(d){const[,p,f,x,g]=d;let m="-->";f==="--|>"?m="--|>":f==="--*"?m="--*":f==="--o"?m="--o":f.includes("..")&&(m="..>"),n.push({from:p,to:x,arrow:m,label:g||""})}});const s=[];return r.forEach(({name:e,members:l})=>{s.push(`class ${e}`),l.forEach(h=>s.push(h)),s.push("")}),n.forEach(({from:e,to:l,arrow:h,label:d})=>{const p=d?`${e} ${h} ${l} : ${d}`:`${e} ${h} ${l}`;s.push(p)}),s.join(`
`)}function h2(i){const t=i.split(`
`).slice(1),r=new Map,n=[],a=[],s=new Map;t.forEach(l=>{if(l=l.trim(),!l||l.startsWith("%%"))return;const h=l.match(/^state\s+"([^"]+)"\s+as\s+(\w+)/i);if(h){const[,c,u]=h;s.set(u,c),r.has(u)||r.set(u,{id:u});return}const d=l.match(/^(\w+)\s*:\s*([^{]+)$/);if(d&&!l.includes("-->")){const[,c,u]=d;s.set(c,u.trim()),r.has(c)||r.set(c,{id:c});return}const p=l.match(/^state\s+(\w+)\s*\{?\s*$/i);if(p){const c=p[1];if(!r.has(c))r.set(c,{id:c,isComposite:!0,children:[]});else{const u=r.get(c);u.isComposite=!0,u.children=u.children||[]}a.push(c);return}if(l==="}"){a.pop();return}const f=l.match(/^state\s+(\w+)\s*<<(fork|join)>>/i);if(f){const[,c,u]=f;r.set(c,{id:c,specialType:u.toLowerCase()});return}const x=l.match(/^state\s+(\w+)\s*<<choice>>/i);if(x){const c=x[1];r.set(c,{id:c,specialType:"choice"});return}const g=l.match(/^state\s+(\w+)\s*<<note>>/i);if(g){const c=g[1];r.set(c,{id:c,specialType:"note"});return}if(l.includes("[*]")){const c=l.match(/\[\*\]\s*-->\s*(\w+)/),u=l.match(/(\w+)\s*-->\s*\[\*\]/);if(c){const b=c[1];if(r.has(b)?r.get(b).isInitial=!0:r.set(b,{id:b,isInitial:!0}),a.length>0){const y=r.get(a[a.length-1]);y&&y.children&&!y.children.includes(b)&&y.children.push(b)}}if(u){const b=u[1];r.has(b)?r.get(b).isFinal=!0:r.set(b,{id:b,isFinal:!0})}return}const m=l.match(/(\w+)\s*-->\s*(\w+)(?:\s*:\s*(.+))?/);if(m){const[,c,u,b]=m;if(r.has(c)||r.set(c,{id:c}),r.has(u)||r.set(u,{id:u}),n.push({from:c,to:u,event:b||""}),a.length>0){const y=r.get(a[a.length-1]);y&&y.children&&(y.children.includes(c)||y.children.push(c),y.children.includes(u)||y.children.push(u))}}});const e=[];return r.forEach(l=>{const h=s.get(l.id),d=h?`${l.id}: ${h}`:l.id;l.isInitial?e.push(`(initial) ${d}`):l.isFinal?e.push(`(final) ${d}`):l.specialType==="fork"?e.push(`(fork) ${d}`):l.specialType==="join"?e.push(`(join) ${d}`):l.specialType==="choice"?e.push(`(choice) ${d}`):l.isComposite&&e.push(`(composite) ${d}`)}),e.length>0&&e.push(""),n.forEach(({from:l,to:h,event:d})=>{const p=d?`${l} -> ${h}: ${d}`:`${l} -> ${h}`;e.push(p)}),e.join(`
`)}function f2(i){const t=i.split(`
`).slice(1),r=new Map;t.forEach(a=>{if(a=a.trim(),!a||a.startsWith("%%"))return;const s=a.match(/^(\w+)\s*\{/);if(s){r.set(s[1],{name:s[1],fields:[]});return}const e=a.match(/^\s*(\w+)\s+(\w+)\s*(PK|FK)?/);if(e&&r.size>0){const[,l,h,d]=e,p=Array.from(r.values()).pop();p&&p.fields.push({name:h,type:l.toUpperCase(),isPK:d==="PK",isFK:d==="FK"})}});const n=[];return r.forEach(({name:a,fields:s})=>{const e=s.map(l=>{let h=`${l.name} ${l.type}`;return l.isPK&&(h+=" PRIMARY KEY"),h}).join(", ");n.push(`CREATE TABLE ${a} (${e});`)}),n.join(`
`)}function g2(i){const t=i.split(`
`).slice(1),r=[],n=new Map;let a="",s=0,e="";return t.forEach(l=>{if(l=l.trim(),!l||l.startsWith("%%"))return;const h=l.match(/^title\s+(.+)/i);if(h){e=h[1].trim();return}if(/^(dateFormat|axisFormat|excludes|todayMarker|tickInterval|weekday)/i.test(l))return;if(l.toLowerCase().startsWith("section")){a=l.replace(/^section\s*/i,"").trim(),r.push(`== ${a} ==`);return}const d=l.match(/^(.+?)\s*:\s*(.+)$/);if(d){const p=d[1].trim(),x=d[2].trim().split(",").map(w=>w.trim()),g=[];let m=null,c=null,u=null,b=null;x.forEach(w=>{/^(done|active|crit|milestone)$/i.test(w)?g.push(w.toLowerCase()):/^after\s+/i.test(w)?c=w.replace(/^after\s+/i,"").trim():/^\d+d?$/.test(w)?b=parseInt(w):/^\d{4}-\d{2}-\d{2}$/.test(w)||/^\d+$/.test(w)?u?b||(b=parseInt(w)):u=w:/^\w+$/.test(w)&&!m&&(m=w)}),b||(b=1);let y=s;if(c&&n.has(c)){const w=n.get(c);y=w.start+w.duration}else u&&/^\d+$/.test(u)&&(y=parseInt(u));m&&n.set(m,{start:y,duration:b});let S=`${p}, ${y}, ${b}`;g.length>0&&(S+=` [${g.join(", ")}]`),c&&(S+=` after:${c}`),r.push(S),s=y+b}}),e&&(r.unshift(`title: ${e}`),r.splice(1,0,"")),r.join(`
`)}function x2(i){const t=i.split(`
`).slice(1),r=[];return t.forEach(n=>{if(n=n.trim(),!n||n.startsWith("%%")||n.startsWith("title"))return;const a=n.match(/"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)/);a&&r.push({label:a[1],value:parseFloat(a[2])})}),r.map(n=>`"${n.label}": ${n.value}`).join(`
`)}function m2(i){const t=i.split(`
`).slice(1),r=[];return t.forEach(n=>{if(n=n.trim(),!n||n.startsWith("%%"))return;const a=n.match(/^commit(?:\s+id:\s*"([^"]+)")?(?:\s+msg:\s*"([^"]+)")?/i);if(a){const h=a[2]||a[1]||"Commit";r.push(`commit "${h}"`);return}const s=n.match(/^branch\s+(\w+)/i);if(s){r.push(`branch ${s[1]}`);return}const e=n.match(/^checkout\s+(\w+)/i);if(e){r.push(`checkout ${e[1]}`);return}const l=n.match(/^merge\s+(\w+)/i);if(l){r.push(`merge ${l[1]}`);return}}),r.join(`
`)}function y2(i){const t=i.split(`
`),r=[];let n="",a=null;t.forEach(l=>{if(l=l.trim(),!l||l.startsWith("%%")||l.toLowerCase()==="journey")return;const h=l.match(/^title\s+(.+)/i);if(h){n=h[1].trim();return}const d=l.match(/^section\s+(.+)/i);if(d){a={name:d[1].trim(),tasks:[]},r.push(a);return}const p=l.match(/^(.+?):\s*(\d+)(?:\s*:\s*(.+))?$/);if(p&&a){const f=p[1].trim(),x=parseInt(p[2]),g=p[3]||"",m=g?g.split(",").map(c=>c.trim()).filter(c=>c):[];a.tasks.push({task:f,score:x,actors:m})}});const s=[];n&&(s.push(`title: ${n}`),s.push(""));const e=new Set;return r.forEach(l=>{l.tasks.forEach(h=>h.actors.forEach(d=>e.add(d)))}),e.size>0&&(s.push(`actors: ${[...e].join(", ")}`),s.push("")),r.forEach(l=>{s.push(`== ${l.name} ==`),l.tasks.forEach(h=>{const d=h.actors.length>0?` | ${h.actors.join(", ")}`:"";s.push(`- ${h.task} | ${h.score}${d}`)}),s.push("")}),s.join(`
`)}function b2(i){const t=i.split(`
`).slice(1),r=[];return t.forEach(n=>{if(!n.trim()||n.trim().startsWith("%%"))return;const a=n.match(/^(\s*)/)[1].length,s=n.trim().replace(/^\(\((.+)\)\)$/,"$1").replace(/^\((.+)\)$/,"$1").replace(/^\[(.+)\]$/,"$1").replace(/^{{(.+)}}$/,"$1");s&&r.push("  ".repeat(Math.floor(a/2))+s)}),r.join(`
`)}function v2(i){const t=i.split(`
`),r=t[0].trim().toLowerCase();r.includes("c4container")||r.includes("c4component")||r.includes("c4dynamic")||r.includes("c4deployment");const n=new Map,a=[],s=[],e=new Map,l=c=>{const u=c.match(/^(\w+)\s*\((.+)\)\s*$/);if(!u)return null;const b=u[1],y=u[2],S=[];let w="",k=!1,j="";for(let C=0;C<y.length;C++){const E=y[C];(E==='"'||E==="'")&&!k?(k=!0,j=E):E===j&&k?(k=!1,j=""):E===","&&!k?(S.push(w.trim().replace(/^["']|["']$/g,"")),w=""):w+=E}return w.trim()&&S.push(w.trim().replace(/^["']|["']$/g,"")),{funcName:b,args:S}};t.slice(1).forEach(c=>{if(c=c.trim(),!c||c.startsWith("%%")||c.startsWith("title"))return;const u=c.match(/^(Enterprise_Boundary|System_Boundary|Container_Boundary|Boundary)\s*\(([^,]+),\s*["']([^"']+)["'](?:,\s*["']([^"']+)["'])?\s*\)/i);if(u){const j=u[2].trim(),C=u[3],E=u[4]||u[1].replace("_Boundary","").toLowerCase(),R=s.length>0?s[s.length-1].alias:null;e.set(j,{label:C,type:E,parentBoundary:R}),s.push({type:u[1],alias:j,label:C});return}if(c==="}"||c==="{"){c==="}"&&s.length>0&&s.pop();return}if(c.startsWith("Update"))return;const b=l(c);if(!b)return;const{funcName:y,args:S}=b,w=y.toLowerCase(),k=s.length>0?s[s.length-1].alias:null;if(w.startsWith("person")){const j=w.includes("_ext");n.set(S[0],{type:j?"external":"clients",label:S[1]||S[0],description:S[2]||"",boundary:k});return}if(w.startsWith("system")){const j=w.includes("_ext"),C=w.includes("db"),E=w.includes("queue");let R="service";j?R="external":C?R="database":E&&(R="service"),n.set(S[0],{type:R,label:S[1]||S[0],description:S[2]||"",technology:"",boundary:k});return}if(w.startsWith("container")){const j=w.includes("_ext"),C=w.includes("db"),E=w.includes("queue");let R="service";j?R="external":C?R="database":E&&(R="service"),n.set(S[0],{type:R,label:S[1]||S[0],technology:S[2]||"",description:S[3]||"",boundary:k});return}if(w.startsWith("component")){const j=w.includes("_ext"),C=w.includes("db");let E="service";j?E="external":C&&(E="database"),n.set(S[0],{type:E,label:S[1]||S[0],technology:S[2]||"",description:S[3]||"",boundary:k});return}if(w==="node"||w==="node_l"||w==="node_r"){n.set(S[0],{type:"service",label:S[1]||S[0],technology:S[2]||"",description:S[3]||"",boundary:k});return}if(w.startsWith("deployment_node")){n.set(S[0],{type:"service",label:S[1]||S[0],technology:S[2]||"",description:S[3]||"",boundary:k});return}if(w.startsWith("rel")||w==="birel"){const j=w==="birel";let C,E,R,T;w==="relindex"?(C=S[1],E=S[2],R=S[3]||"",T=S[4]||""):(C=S[0],E=S[1],R=S[2]||"",T=S[3]||""),a.push({from:C,to:E,label:T?`${R} [${T}]`:R,bidirectional:j});return}});const h=[],d=new Map,p=[];n.forEach((c,u)=>{c.boundary?(d.has(c.boundary)||d.set(c.boundary,[]),d.get(c.boundary).push({alias:u,...c})):p.push({alias:u,...c})});const f=c=>{const u=new Map;c.forEach(y=>{u.has(y.type)||u.set(y.type,[]),u.get(y.type).push(y)});const b=["clients","external","gateway","service","database"];b.forEach(y=>{const S=u.get(y);if(S&&S.length>0){const w=S.map(k=>k.label);h.push(`[${y}] ${w.join(", ")}`)}}),u.forEach((y,S)=>{if(!b.includes(S)&&y.length>0){const w=y.map(k=>k.label);h.push(`[${S}] ${w.join(", ")}`)}})};p.length>0&&(f(p),h.push(""));const x=[],g=new Map;e.forEach((c,u)=>{c.parentBoundary?(g.has(c.parentBoundary)||g.set(c.parentBoundary,[]),g.get(c.parentBoundary).push(u)):x.push(u)});const m=(c,u="")=>{const b=e.get(c);if(!b)return;const y=d.get(c)||[],S=g.get(c)||[];if(!(y.length===0&&S.length===0)){if(h.push(`${u}group "${b.label}" {`),y.length>0){const w=new Map;y.forEach(j=>{w.has(j.type)||w.set(j.type,[]),w.get(j.type).push(j)});const k=["clients","external","gateway","service","database"];k.forEach(j=>{const C=w.get(j);if(C&&C.length>0){const E=C.map(R=>R.label);h.push(`${u}  [${j}] ${E.join(", ")}`)}}),w.forEach((j,C)=>{if(!k.includes(C)&&j.length>0){const E=j.map(R=>R.label);h.push(`${u}  [${C}] ${E.join(", ")}`)}})}S.length>0&&(y.length>0&&h.push(""),S.forEach(w=>{m(w,u+"  ")})),h.push(`${u}}`),h.push("")}};return x.forEach(c=>{m(c)}),a.forEach(c=>{const u=n.get(c.from),b=n.get(c.to),y=(u==null?void 0:u.label)||c.from,S=(b==null?void 0:b.label)||c.to;c.bidirectional?h.push(`${y} <-> ${S}: ${c.label}`):c.label?h.push(`${y} -> ${S}: ${c.label}`):h.push(`${y} -> ${S}`)}),h.join(`
`)}function w2(i){const t=i.split(`
`),r=[];let n="",a="";return t.forEach(s=>{if(s=s.trim(),!s||s.startsWith("%%")||s.toLowerCase()==="timeline")return;const e=s.match(/^title\s+(.+)/i);if(e){n=e[1].trim();return}const l=s.match(/^section\s+(.+)/i);if(l){a=l[1].trim(),r.push(`== ${a} ==`);return}const h=s.match(/^(.+?)\s*:\s*(.+)/);if(h){const d=h[1].trim();h[2].split(":").map(f=>f.trim()).filter(f=>f).forEach(f=>{r.push(`${d}: ${f}`)})}}),n&&(r.unshift(`title: ${n}`),r.splice(1,0,"")),r.join(`
`)}function S2(i){const t=i.split(`
`),r=[];let n="";const a={x:{left:"",right:""},y:{bottom:"",top:""}},s={},e=[];return t.forEach(l=>{var g,m;if(l=l.trim(),!l||l.startsWith("%%")||l.toLowerCase()==="quadrantchart")return;const h=l.match(/^title\s+(.+)/i);if(h){n=h[1].trim();return}const d=l.match(/^x-axis\s+(.+?)(?:\s*-->\s*(.+))?$/i);if(d){a.x.left=d[1].trim(),a.x.right=((g=d[2])==null?void 0:g.trim())||"";return}const p=l.match(/^y-axis\s+(.+?)(?:\s*-->\s*(.+))?$/i);if(p){a.y.bottom=p[1].trim(),a.y.top=((m=p[2])==null?void 0:m.trim())||"";return}const f=l.match(/^quadrant-(\d)\s+(.+)/i);if(f){s[f[1]]=f[2].trim();return}const x=l.match(/^(.+?)(?::::\w+)?:\s*\[([0-9.]+),\s*([0-9.]+)\]/);x&&e.push({name:x[1].trim(),x:parseFloat(x[2]),y:parseFloat(x[3])})}),n&&r.push(`title: ${n}`),a.x.left&&r.push(`x-axis: ${a.x.left}${a.x.right?" -> "+a.x.right:""}`),a.y.bottom&&r.push(`y-axis: ${a.y.bottom}${a.y.top?" -> "+a.y.top:""}`),Object.entries(s).forEach(([l,h])=>{r.push(`quadrant-${l}: ${h}`)}),r.push(""),e.forEach(l=>{r.push(`"${l.name}": [${l.x}, ${l.y}]`)}),r.join(`
`)}function k2(i){const t=i.split(`
`),r=[],n=[];return t.forEach(a=>{if(a=a.trim(),!a||a.startsWith("%%")||a.toLowerCase().startsWith("sankey"))return;const s=[];let e="",l=!1;for(let h=0;h<a.length;h++){const d=a[h];d==='"'&&!l?l=!0:d==='"'&&l?l=!1:d===","&&!l?(s.push(e.trim()),e=""):e+=d}if(e.trim()&&s.push(e.trim()),s.length>=3){const[h,d,p]=s;n.push({source:h,target:d,value:parseFloat(p)})}}),n.forEach(a=>{r.push(`"${a.source}" -> "${a.target}": ${a.value}`)}),r.join(`
`)}function j2(i){const t=i.split(`
`),r=[],n=[];let a=null;return t.forEach(s=>{if(s=s.trim(),!s||s.startsWith("%%")||s.toLowerCase()==="requirementdiagram")return;const e=s.match(/^(requirement|functionalRequirement|interfaceRequirement|performanceRequirement|physicalRequirement|designConstraint)\s+(\w+)\s*\{?/i);if(e){a={type:e[1],name:e[2],id:"",text:"",risk:"",verifyMethod:""};return}const l=s.match(/^element\s+(\w+)\s*\{?/i);if(l){a={type:"element",name:l[1]};return}if(s==="}"){a&&(n.push(a),a=null);return}if(a){const d=s.match(/^(\w+):\s*(.+)/);d&&(a[d[1]]=d[2])}const h=s.match(/^(\w+)\s*-\s*(satisfies|traces|contains|copies|derives|verifies|refines)\s*->\s*(\w+)/i);h&&r.push(`${h[1]} -${h[2]}-> ${h[3]}`)}),n.forEach(s=>{if(s.type==="element")r.unshift(`[element] ${s.name}: ${s.type||""}`);else{const e=[];s.id&&e.push(`id: ${s.id}`),s.text&&e.push(`"${s.text}"`),s.risk&&e.push(`risk: ${s.risk}`),r.unshift(`[${s.type}] ${s.name}: ${e.join(", ")}`)}}),r.join(`
`)}function C2(i){const t=c2(i);if(!t)throw new Error("Could not detect Mermaid diagram type. Supported types: flowchart, sequence, class, state, erDiagram, gantt, pie, gitGraph, journey, mindmap, c4, timeline, quadrant, sankey, requirement");let r="",n=t;switch(t){case"flowchart":{const a=l2(i);r=a.source,n=a.type;break}case"sequence":r=u2(i);break;case"class":r=p2(i);break;case"state":r=h2(i);break;case"erd":r=f2(i);break;case"gantt":r=g2(i);break;case"pie":r=x2(i);break;case"git":r=m2(i);break;case"journey":r=y2(i);break;case"mindmap":r=b2(i);break;case"c4":r=v2(i),n="architecture";break;case"timeline":r=w2(i);break;case"quadrant":r=S2(i);break;case"sankey":r=k2(i);break;case"requirement":r=j2(i);break;default:throw new Error(`Unsupported Mermaid diagram type: ${n}`)}return{type:n,source:r}}function E2(i){const t=["flowchart TD"],r=new Map;let n=0;const a=s=>{const e=s.toLowerCase().replace(/[^a-z0-9]/g,"_");return r.has(e)||r.set(e,`N${n++}`),r.get(e)};return i.split(`
`).forEach(s=>{if(s=s.trim(),!s||s.startsWith("#"))return;const e=s.split(/\s*->\s*/);if(e.length>=2)for(let l=0;l<e.length-1;l++){const h=e[l].match(/^\((\w+)\)\s*(.+)/)||[null,"process",e[l]],d=e[l+1].match(/^\((\w+)\)\s*(.+)/)||[null,"process",e[l+1]],p=h[1],f=h[2].trim(),x=d[1];let g=d[2].trim(),m="";const c=g.match(/^(.+?):\s*(.+)$/);c&&(g=c[1].trim(),m=c[2].trim());const u=a(f),b=a(g),y=(k,j,C)=>{switch(k){case"decision":return`${C}{${j}}`;case"start":case"end":return`${C}((${j}))`;case"io":return`${C}[/${j}/]`;default:return`${C}[${j}]`}},S=y(p,f,u),w=y(x,g,b);m?t.push(`    ${S} -->|${m}| ${w}`):t.push(`    ${S} --> ${w}`)}}),t.join(`
`)}function M2(i){const t=["sequenceDiagram"];return i.split(`
`).forEach(r=>{if(r=r.trim(),!r||r.startsWith("#"))return;if(r.toLowerCase().startsWith("participant")){r.replace(/^participant\s+/i,"").split(",").map(s=>s.trim()).forEach(s=>t.push(`    participant ${s}`));return}const n=r.match(/^(\w+)\s*(-->?)\s*(\w+)\s*:\s*(.+)/);if(n){const[,a,s,e,l]=n,h=s==="-->"?"-->>":"->>";t.push(`    ${a}${h}${e}: ${l}`)}}),t.join(`
`)}function $2(i){const t=["classDiagram"];let r=null;return i.split(`
`).forEach(n=>{if(n=n.trim(),!n)return;if(n.startsWith("class ")){r=n.replace("class ","").trim(),t.push(`    class ${r}`);return}if(r&&/^[+\-#~]/.test(n)){t.push(`    ${r} : ${n}`);return}const a=n.match(/^(\w+)\s*(-->|--\*|--o|--|>|\.\.>)\s*(\w+)(?:\s*:\s*(.+))?/);if(a){const[,s,e,l,h]=a;let d="-->";e==="--|>"?d="--|>":e==="--*"?d="*--":e==="--o"?d="o--":e==="..>"&&(d="..>");const p=h?`${s} ${d} ${l} : ${h}`:`${s} ${d} ${l}`;t.push(`    ${p}`),r=null}}),t.join(`
`)}function R2(i){const t=["stateDiagram-v2"],r=[],n=[];return i.split(`
`).forEach(a=>{if(a=a.trim(),!a||a.startsWith("#"))return;const s=a.match(/^\((\w+)\)\s*(\w+)/);if(s){s[1]==="initial"&&r.push(s[2]),s[1]==="final"&&n.push(s[2]);return}const e=a.match(/^(\w+)\s*->\s*(\w+)(?::\s*(.+))?/);if(e){const[,l,h,d]=e,p=d?`${l} --> ${h} : ${d}`:`${l} --> ${h}`;t.push(`    ${p}`)}}),r.forEach(a=>t.unshift(`    [*] --> ${a}`)),n.forEach(a=>t.push(`    ${a} --> [*]`)),t.join(`
`)}function _2(i){const t=["erDiagram"],r=/CREATE\s+TABLE\s+(?:IF\s+NOT\s+EXISTS\s+)?[`"']?(\w+)[`"']?\s*\(([\s\S]*?)\);/gi,n=[];let a;for(;(a=r.exec(i))!==null;){const s=a[1],e=a[2];t.push(`    ${s} {`),e.split(",").forEach(l=>{if(l=l.trim(),!l||/^(PRIMARY|FOREIGN|UNIQUE|CHECK|CONSTRAINT)/i.test(l))return;const h=l.match(/^[`"']?(\w+)[`"']?\s+(\w+)/);if(h){const[,d,p]=h,f=/PRIMARY\s+KEY/i.test(l),x=/REFERENCES/i.test(l);let g=p.toLowerCase();f&&(g=`${g} PK`),x&&(g=`${g} FK`),t.push(`        ${g} ${d}`);const m=l.match(/REFERENCES\s+[`"']?(\w+)[`"']?/i);m&&n.push({from:s,to:m[1],field:d})}}),t.push("    }")}return n.forEach(s=>{t.push(`    ${s.to} ||--o{ ${s.from} : "has"`)}),t.join(`
`)}function I2(i){const t=["gantt","    dateFormat X","    axisFormat %d"];return i.split(`
`).forEach(r=>{if(r=r.trim(),!r||r.startsWith("#"))return;const n=r.match(/^(.+?),\s*(\d+),\s*(\d+)/);if(n){const[,a,s,e]=n;t.push(`    ${a.trim()} :${s}, ${e}d`)}}),t.join(`
`)}function A2(i){const t=["pie showData"];return i.split(`
`).forEach(r=>{if(r=r.trim(),!r||r.startsWith("#"))return;const n=r.match(/"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)/);n&&t.push(`    "${n[1]}" : ${n[2]}`)}),t.join(`
`)}function T2(i){const t=["gitGraph"];return i.split(`
`).forEach(r=>{if(r=r.trim(),!r||r.startsWith("#"))return;const n=r.match(/^commit\s+"([^"]+)"/i);if(n){t.push(`    commit id: "${n[1]}"`);return}const a=r.match(/^branch\s+(\w+)/i);if(a){t.push(`    branch ${a[1]}`);return}const s=r.match(/^checkout\s+(\w+)/i);if(s){t.push(`    checkout ${s[1]}`);return}const e=r.match(/^merge\s+(\w+)/i);if(e){t.push(`    merge ${e[1]}`);return}}),t.join(`
`)}function P2(i){const t=["journey","    title User Journey"],r=[],n=[];return i.split(`
`).forEach(a=>{var e;if(a=a.trim(),!a||a.startsWith("#"))return;const s=a.match(/^\[(\w+)\]\s*(.+?)(?:\s*:\s*(.+))?$/);if(s&&!a.includes("->")){r.push({type:s[1],label:s[2],desc:s[3]});return}if(a.includes("->")){const l=a.match(/^(.+?)\s*-(?:([^>]+)->|->)\s*(.+)$/);l&&n.push({from:l[1].trim(),label:(e=l[2])==null?void 0:e.trim(),to:l[3].trim()})}}),t.push("    section Journey"),r.filter(a=>a.type!=="actor").forEach((a,s)=>{const e=5-Math.floor(s/2);t.push(`        ${a.label}: ${Math.max(1,Math.min(5,e))}`)}),t.join(`
`)}function D2(i){const t=["mindmap"];return i.split(`
`).forEach(r=>{if(!r.trim())return;const n=r.match(/^(\s*)/)[1].length,a=Math.floor(n/2),s=r.trim();s&&t.push("  ".repeat(a+1)+s)}),t.join(`
`)}function L2(i,t){switch(i){case"flowchart":return E2(t);case"sequence":return M2(t);case"class":return $2(t);case"state":return R2(t);case"erd":return _2(t);case"gantt":return I2(t);case"pie":return A2(t);case"git":return T2(t);case"journey":return P2(t);case"mindmap":return D2(t);default:throw new Error(`Cannot export "${i}" to Mermaid. Supported types: flowchart, sequence, class, state, erd, gantt, pie, git, journey, mindmap`)}}function z2(i,t="diagram"){const r=new Blob([i],{type:"text/plain"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=`${t}.mmd`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(n),100)}async function B2(i){await navigator.clipboard.writeText(i)}function W2(i){const[t,r]=M.useState({past:[],present:{...i,timestamp:Date.now(),changeType:"initial"},future:[]}),n=M.useRef(!1),a=M.useCallback((p,f="unknown")=>{n.current||r(x=>x.present.source===p.source&&x.present.type===p.type&&x.present.diagramName===p.diagramName&&JSON.stringify(x.present.positions)===JSON.stringify(p.positions)?x:{past:[...x.past.slice(-49),x.present],present:{...p,timestamp:Date.now(),changeType:f},future:[]})},[]),s=M.useCallback(()=>{r(p=>{if(p.past.length===0)return p;const f=p.past[p.past.length-1];return n.current=!0,setTimeout(()=>{n.current=!1},0),{past:p.past.slice(0,-1),present:f,future:[p.present,...p.future]}})},[]),e=M.useCallback(()=>{r(p=>{if(p.future.length===0)return p;const f=p.future[0];return n.current=!0,setTimeout(()=>{n.current=!1},0),{past:[...p.past,p.present],present:f,future:p.future.slice(1)}})},[]),l=M.useCallback(()=>{r(p=>({past:[],present:p.present,future:[]}))},[]),h=M.useCallback(p=>{r({past:[],present:{...p,timestamp:Date.now(),changeType:"reset"},future:[]})},[]),d=M.useCallback(()=>n.current,[]);return{state:t.present,canUndo:t.past.length>0,canRedo:t.future.length>0,historyLength:t.past.length,futureLength:t.future.length,undo:s,redo:e,pushState:a,clear:l,reset:h,isApplying:d}}function N2(i,t){let r=null;const n=(...a)=>{r&&clearTimeout(r),r=setTimeout(()=>i(...a),t)};return n.cancel=()=>{r&&clearTimeout(r)},n}const me={dark:{name:"dark",background:"linear-gradient(135deg, #0a0a0f, #1a1a2e, #0f0f1a)",canvasBg:"rgba(0,0,0,0.4)",gridColor:"rgba(124,58,237,0.04)",textPrimary:"#ffffff",textSecondary:"#888888",textMuted:"#555555",border:"rgba(255,255,255,0.1)",surface:"rgba(15, 23, 42, 0.95)",headerBg:"transparent",toolbarBg:"transparent",editorBg:"rgba(0,0,0,0.3)",editorText:"#a78bfa",buttonBg:"rgba(255,255,255,0.05)",buttonActiveBg:"rgba(124,58,237,0.3)",modalBg:"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",inputBg:"rgba(0,0,0,0.3)",logoGradient:"linear-gradient(135deg, #fff, #a78bfa)"},light:{name:"light",background:"linear-gradient(135deg, #f8fafc, #e2e8f0, #f1f5f9)",canvasBg:"rgba(255,255,255,0.7)",gridColor:"rgba(124,58,237,0.08)",textPrimary:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",border:"rgba(0,0,0,0.1)",surface:"rgba(255, 255, 255, 0.95)",headerBg:"rgba(255,255,255,0.8)",toolbarBg:"rgba(255,255,255,0.6)",editorBg:"rgba(255,255,255,0.95)",editorText:"#7c3aed",buttonBg:"rgba(0,0,0,0.05)",buttonActiveBg:"rgba(124,58,237,0.2)",modalBg:"linear-gradient(135deg, rgba(255,255,255,0.98), rgba(241,245,249,0.98))",inputBg:"rgba(255,255,255,0.9)",logoGradient:"linear-gradient(135deg, #1e293b, #7c3aed)"}},xg="ddflow_theme";function q2(){try{return localStorage.getItem(xg)||"dark"}catch{return"dark"}}function O2(i){try{localStorage.setItem(xg,i)}catch{}}const mg="ddflow_sketch_mode";function F2(){try{return localStorage.getItem(mg)==="true"}catch{return!1}}function U2(i){try{localStorage.setItem(mg,i?"true":"false")}catch{}}const he={stroke:"#333333",fill:"#faf9f6",accent:"#5c5c5c"},v={purple:"#7C3AED",blue:"#0EA5E9",green:"#10B981",orange:"#F59E0B",pink:"#EC4899",red:"#EF4444",cyan:"#06B6D4",violet:"#8B5CF6",teal:"#14B8A6",amber:"#D97706",indigo:"#6366F1",rose:"#F43F5E",emerald:"#059669",sky:"#0284C7",fuchsia:"#D946EF",lime:"#84CC16",slate:"#64748B",zinc:"#71717A",yellow:"#EAB308"},se=[v.purple,v.blue,v.green,v.orange,v.pink,v.cyan,v.violet,v.teal],Ct=(i,t=!1)=>t?he.fill:`linear-gradient(135deg, ${i}38, ${i}15)`,He=(i,t,r,n=!1)=>n?"none":t?`0 0 0 2px ${i}, 0 12px 28px ${i}50, 0 20px 40px rgba(0,0,0,0.25)`:r?`0 0 0 3px rgba(124,58,237,0.7), 0 8px 24px rgba(124,58,237,0.35), 0 16px 32px ${i}25`:`0 2px 4px rgba(0,0,0,0.08), 0 8px 20px ${i}25, 0 16px 40px ${i}12`,Qr=(i=!1)=>i?"'Caveat', cursive":"system-ui, -apple-system, sans-serif",G2=(i,t=!1)=>{if(t){if(typeof i=="string"){const r=parseFloat(i),n=i.replace(/[\d.]/g,"")||"px";return`${r*1.25}${n}`}return i*1.25}return i},tr=(i,t,r,n)=>{const a=r-i,s=n-t,e=Math.sqrt(a*a+s*s),l=Math.min(e*.25,60);if(Math.abs(a)>Math.abs(s)){const d=a>0?1:-1;return`M ${i} ${t} C ${i+l*d} ${t}, ${r-l*d} ${n}, ${r} ${n}`}const h=s>0?1:-1;return`M ${i} ${t} C ${i} ${t+l*h}, ${r} ${n-l*h}, ${r} ${n}`},yg=(i,t,r,n,a=!1)=>{if(!a)return tr(i,t,r,n);const s=r-i,e=n-t,l=Math.sqrt(s*s+e*e),h=Math.max(3,Math.floor(l/40)),d=[];for(let f=0;f<=h;f++){const x=f/h;let g=i+s*x,m=t+e*x;f>0&&f<h&&(g+=(Math.random()-.5)*3*2,m+=(Math.random()-.5)*3*2),d.push({x:g,y:m})}if(d.length<2)return`M ${i} ${t} L ${r} ${n}`;let p=`M ${d[0].x} ${d[0].y}`;for(let f=1;f<d.length;f++){const x=d[f-1],g=d[f],m=(x.x+g.x)/2,c=(x.y+g.y)/2;p+=` Q ${x.x} ${x.y} ${m} ${c}`}return p+=` L ${d[d.length-1].x} ${d[d.length-1].y}`,p};function $e(i={x:50,y:50}){const t=M.useRef(null),[r,n]=M.useState(i),[a,s]=M.useState(1),[e,l]=M.useState(!1),[h,d]=M.useState({x:0,y:0}),[p,f]=M.useState({}),[x,g]=M.useState(null),[m,c]=M.useState({x:0,y:0}),[u,b]=M.useState(!0),y=25,S=M.useCallback(W=>u?Math.round(W/y)*y:W,[u,y]),[w,k]=M.useState(new Set),[j,C]=M.useState(null),[E,R]=M.useState(""),[T,I]=M.useState({}),[B,z]=M.useState({}),[D,U]=M.useState({}),[N,H]=M.useState({}),ee={width:130,height:60},ne={width:80,height:40},J={width:300,height:200},[ie,F]=M.useState(null),[_,q]=M.useState(null),[$,P]=M.useState(null),[L,Y]=M.useState(null),[X,K]=M.useState(!1),[be,ve]=M.useState(null),[Q,ge]=M.useState(""),[ae,_e]=M.useState(!1),[oe,le]=M.useState(null),[Pe,Ge]=M.useState(null),[De,Ae]=M.useState(null),[Ce,ke]=M.useState({}),[Qe,rt]=M.useState({}),[xt,nt]=M.useState({}),[Pt,mt]=M.useState(null),[yt,ct]=M.useState({horizontal:[],vertical:[]}),Ne=5,ze=M.useRef(null),bt=M.useRef(null),qe=M.useCallback((W,G)=>{if(!t.current)return{x:0,y:0};const te=t.current.getBoundingClientRect();return{x:(W-te.left-r.x)/a,y:(G-te.top-r.y)/a}},[r,a]),Zr=M.useCallback(W=>{if(W.target===t.current||W.target.classList.contains("canvas-bg"))if(W.shiftKey){const G=qe(W.clientX,W.clientY);K(!0),Y({startX:G.x,startY:G.y,endX:G.x,endY:G.y})}else l(!0),d({x:W.clientX-r.x,y:W.clientY-r.y})},[r,qe]),Jr=M.useCallback((W,G,te,ue)=>{if(W.stopPropagation(),q(null),W.shiftKey){k(ye=>{const Te=new Set(ye);return Te.has(G)?Te.delete(G):Te.add(G),Te});return}k(new Set([G])),g(G);const xe=qe(W.clientX,W.clientY);c({x:xe.x-te,y:xe.y-ue})},[qe]),en=M.useCallback((W,G,te)=>{W.stopPropagation(),C(G),R(te||""),k(new Set([G]))},[]),tn=M.useCallback(()=>{const W={nodeId:j,newValue:E};return C(null),R(""),W},[j,E]),rn=M.useCallback(()=>{C(null),R("")},[]),nn=M.useCallback((W,G)=>{W.preventDefault(),W.stopPropagation(),q({nodeId:G,x:W.clientX,y:W.clientY}),w.has(G)||k(new Set([G]))},[w]),rr=M.useCallback(()=>{q(null)},[]),nr=M.useCallback((W,G)=>{I(te=>({...te,[W]:G})),q(null)},[]),ir=M.useCallback((W,G)=>{z(te=>({...te,[W]:G}))},[]),on=M.useCallback((W,G)=>{U(te=>({...te,[W]:G}))},[]),or=M.useCallback(()=>{k(new Set)},[]),ar=M.useCallback(W=>{if(w.size===0||!W)return;const G=W.filter(ue=>w.has(ue.id));if(G.length===0)return;const te=G.map(ue=>{var xe,ye;return{...ue,copiedX:((xe=p[ue.id])==null?void 0:xe.x)??ue.x,copiedY:((ye=p[ue.id])==null?void 0:ye.y)??ue.y}});return P(te),te},[w,p]),an=M.useCallback(()=>{if(!$||$.length===0)return null;const W=30;return $.map(G=>({...G,id:`${G.id}_copy_${Date.now()}`,x:G.copiedX+W,y:G.copiedY+W,label:G.label}))},[$]),sn=M.useCallback((W,G,te)=>{W.stopPropagation(),ve(G),ge(te||"")},[]),cn=M.useCallback(()=>{const W={edgeId:be,newValue:Q};return ve(null),ge(""),W},[be,Q]),ln=M.useCallback(()=>{ve(null),ge("")},[]),dn=M.useCallback((W,G)=>{W.preventDefault(),W.stopPropagation(),mt({edgeId:G,x:W.clientX,y:W.clientY})},[]),sr=M.useCallback(()=>{mt(null)},[]),cr=M.useCallback((W,G)=>{ke(te=>({...te,[W]:G}))},[]),lr=M.useCallback((W,G)=>{rt(te=>({...te,[W]:G})),mt(null)},[]),dr=M.useCallback((W,G)=>{nt(te=>({...te,[W]:G}))},[]),ur=M.useCallback(W=>N[W]||ee,[N]),pr=M.useCallback((W,G,te)=>{W.stopPropagation(),W.preventDefault();const ue=N[G]||ee;F({nodeId:G,handle:te,startX:W.clientX,startY:W.clientY,startWidth:ue.width,startHeight:ue.height})},[N]),qt=M.useCallback((W,G)=>{if(!ie)return;const te=(W-ie.startX)/a,ue=(G-ie.startY)/a;let xe=ie.startWidth,ye=ie.startHeight;ie.handle.includes("e")&&(xe=Math.max(ne.width,Math.min(J.width,ie.startWidth+te))),ie.handle.includes("s")&&(ye=Math.max(ne.height,Math.min(J.height,ie.startHeight+ue))),u&&(xe=Math.round(xe/y)*y,ye=Math.round(ye/y)*y,xe=Math.max(ne.width,xe),ye=Math.max(ne.height,ye)),H(Te=>({...Te,[ie.nodeId]:{width:xe,height:ye}}))},[ie,a,u,y]);M.useCallback(()=>{F(null)},[]);const hr=M.useCallback((W,G,te,ue)=>{W.stopPropagation(),W.preventDefault(),_e(!0),le({nodeId:G,x:te,y:ue}),Ge({x:te,y:ue})},[]),fr=M.useCallback(()=>{_e(!1),le(null),Ge(null),Ae(null)},[]),gr=M.useCallback(W=>{ae&&oe&&oe.nodeId!==W&&Ae(W)},[ae,oe]),xr=M.useCallback(()=>{Ae(null)},[]),mr=M.useCallback((W,G)=>{if(!G||!W)return[];const te=Math.min(G.startX,G.endX),ue=Math.max(G.startX,G.endX),xe=Math.min(G.startY,G.endY),ye=Math.max(G.startY,G.endY);return W.filter(Te=>{const We=p[Te.id]||{x:Te.x,y:Te.y};return We.x>=te&&We.x<=ue&&We.y>=xe&&We.y<=ye}).map(Te=>Te.id)},[p]),yr=M.useCallback(W=>{if(e)n({x:W.clientX-h.x,y:W.clientY-h.y});else if(ie)qt(W.clientX,W.clientY);else if(ae){const G=qe(W.clientX,W.clientY);Ge({x:G.x,y:G.y})}else if(X&&L){const G=qe(W.clientX,W.clientY);Y(te=>({...te,endX:G.x,endY:G.y}))}else if(x){const G=qe(W.clientX,W.clientY);let te=G.x-m.x,ue=G.y-m.y;te=S(te),ue=S(ue),f(xe=>({...xe,[x]:{x:te,y:ue}}))}else(yt.horizontal.length>0||yt.vertical.length>0)&&ct({horizontal:[],vertical:[]})},[e,h,ie,qt,ae,X,L,x,m,qe,S,yt]),O=M.useCallback((W,G,te,ue)=>{if(!W||!G){ct({horizontal:[],vertical:[]});return}const xe=[],ye=[];te.forEach(Te=>{if(Te.id===W)return;const We=ue(Te);Math.abs(We.y-G.y)<Ne&&xe.push({y:We.y,fromX:Math.min(We.x,G.x)-50,toX:Math.max(We.x,G.x)+200}),Math.abs(We.x-G.x)<Ne&&ye.push({x:We.x,fromY:Math.min(We.y,G.y)-50,toY:Math.max(We.y,G.y)+100})}),ct({horizontal:xe,vertical:ye})},[Ne]),re=M.useCallback(()=>{ct({horizontal:[],vertical:[]});let W=null;return ae&&oe&&De&&(W={source:oe.nodeId,target:De}),l(!1),g(null),F(null),K(!1),Y(null),_e(!1),le(null),Ge(null),Ae(null),W},[ae,oe,De]),de=W=>{if(W.length<2)return null;const G=W[0].clientX-W[1].clientX,te=W[0].clientY-W[1].clientY;return Math.sqrt(G*G+te*te)},Be=W=>W.length<2?{x:W[0].clientX,y:W[0].clientY}:{x:(W[0].clientX+W[1].clientX)/2,y:(W[0].clientY+W[1].clientY)/2},Mt=M.useCallback(W=>{if(W.touches.length===2)W.preventDefault(),ze.current=de(W.touches),bt.current=Be(W.touches);else if(W.touches.length===1){const G=W.touches[0];(W.target===t.current||W.target.classList.contains("canvas-bg"))&&(l(!0),d({x:G.clientX-r.x,y:G.clientY-r.y}))}},[r]),Ze=M.useCallback((W,G,te,ue)=>{if(W.stopPropagation(),W.touches.length===1){const xe=W.touches[0];g(G);const ye=qe(xe.clientX,xe.clientY);c({x:ye.x-te,y:ye.y-ue})}},[qe]),Oe=M.useCallback(W=>{if(W.touches.length===2){W.preventDefault();const G=de(W.touches),te=Be(W.touches);if(ze.current&&G){const ue=G/ze.current;s(xe=>Math.min(Math.max(xe*ue,.2),3))}if(bt.current){const ue=te.x-bt.current.x,xe=te.y-bt.current.y;n(ye=>({x:ye.x+ue,y:ye.y+xe}))}ze.current=G,bt.current=te}else if(W.touches.length===1){const G=W.touches[0];if(e)n({x:G.clientX-h.x,y:G.clientY-h.y});else if(x){W.preventDefault();const te=qe(G.clientX,G.clientY);f(ue=>({...ue,[x]:{x:te.x-m.x,y:te.y-m.y}}))}}},[e,h,x,m,qe]),br=M.useCallback(()=>{l(!1),g(null),ze.current=null,bt.current=null},[]),zg=M.useCallback(W=>{W.preventDefault();const te=1-W.deltaY*.002;s(ue=>Math.min(Math.max(ue*te,.2),3))},[]),Bg=M.useCallback(()=>{n(i),s(1),f({})},[i]),Wg=M.useCallback(W=>{if(!t.current||!W)return;const G=t.current.getBoundingClientRect(),te=60,ue=(G.width-te*2)/W.width,xe=(G.height-te*2)/W.height,ye=Math.min(Math.max(Math.min(ue,xe),.3),1.5),Te=W.x+W.width/2,We=W.y+W.height/2;n({x:G.width/2-Te*ye,y:G.height/2-We*ye}),s(ye)},[]),Ng=M.useCallback((W,G,te)=>{const ue=p[W];return ue?{x:ue.x,y:ue.y}:{x:G,y:te}},[p]);return{canvasRef:t,pan:r,setPan:n,zoom:a,setZoom:s,isPanning:e,dragging:x,positions:p,selectedNodes:w,setSelectedNodes:k,clearSelection:or,editingNode:j,editValue:E,setEditValue:R,handleNodeDoubleClick:en,finishEditing:tn,cancelEditing:rn,nodeColors:T,setNodeColor:nr,nodeIcons:B,setNodeIcon:ir,nodeShapes:D,setNodeShape:on,nodeSizes:N,getNodeSize:ur,resizing:ie,handleResizeStart:pr,contextMenu:_,handleNodeContextMenu:nn,closeContextMenu:rr,clipboard:$,copySelectedNodes:ar,pasteNodes:an,selectionBox:L,isSelecting:X,getNodesInSelectionBox:mr,editingEdge:be,edgeEditValue:Q,setEdgeEditValue:ge,handleEdgeDoubleClick:sn,finishEdgeEditing:cn,cancelEdgeEditing:ln,edgeStyles:Ce,setEdgeStyle:cr,edgeArrowTypes:Qe,setEdgeArrowType:lr,edgePathTypes:xt,setEdgePathType:dr,edgeContextMenu:Pt,handleEdgeContextMenu:dn,closeEdgeContextMenu:sr,isConnecting:ae,connectionStart:oe,connectionEnd:Pe,connectionTarget:De,handlePortMouseDown:hr,cancelConnection:fr,setConnectionTargetNode:gr,clearConnectionTarget:xr,snapToGrid:u,setSnapToGrid:b,alignmentGuides:yt,updateAlignmentGuides:O,handleCanvasMouseDown:Zr,handleNodeMouseDown:Jr,handleMouseMove:yr,handleMouseUp:re,handleTouchStart:Mt,handleNodeTouchStart:Ze,handleTouchMove:Oe,handleTouchEnd:br,handleWheel:zg,resetView:Bg,fitToView:Wg,getNodePosition:Ng,setPositions:f}}function Re({onZoomIn:i,onZoomOut:t,onFit:r,onReset:n,zoom:a,snapToGrid:s,onToggleSnap:e,onAutoLayout:l}){return o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{position:"absolute",bottom:12,left:12,display:"flex",gap:6,zIndex:100},children:[[{l:"+",a:i},{l:"",a:t},{l:"Fit",a:r},{l:"Reset",a:n}].map(h=>o.jsx("button",{onClick:h.a,style:{minWidth:h.l.length>1?"auto":36,height:36,padding:h.l.length>1?"0 12px":0,background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:8,color:"#fff",fontSize:h.l.length>1?"0.75rem":"1.2rem",cursor:"pointer"},children:h.l},h.l)),e&&o.jsxs("button",{onClick:e,title:s?"Snap to grid: ON":"Snap to grid: OFF",style:{minWidth:36,height:36,padding:"0 10px",background:s?"rgba(124,58,237,0.5)":"rgba(0,0,0,0.7)",border:`1px solid ${s?v.purple:"rgba(255,255,255,0.2)"}`,borderRadius:8,color:"#fff",fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:"1rem"},children:""}),o.jsx("span",{children:s?"ON":"OFF"})]}),l&&o.jsxs("button",{onClick:l,title:"Auto-layout: Arrange nodes automatically",style:{minWidth:36,height:36,padding:"0 10px",background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:8,color:"#fff",fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:"1rem"},children:""}),o.jsx("span",{children:"Layout"})]})]}),o.jsxs("div",{style:{position:"absolute",bottom:12,right:12,background:"rgba(0,0,0,0.7)",borderRadius:6,padding:"4px 10px",color:"#888",fontSize:"0.7rem",zIndex:100},children:[Math.round(a*100),"%"]}),o.jsx("div",{style:{position:"absolute",top:12,right:12,background:"rgba(0,0,0,0.6)",borderRadius:6,padding:"6px 10px",color:"#666",fontSize:"0.65rem",zIndex:100},children:"Drag nodes  Drag port to connect  Double-click to edit  Right-click for styles  Shift+drag to select"})]})}const Y2=[{name:"Purple",color:v.purple},{name:"Blue",color:v.blue},{name:"Green",color:v.green},{name:"Orange",color:v.orange},{name:"Pink",color:v.pink},{name:"Red",color:v.red},{name:"Cyan",color:v.cyan},{name:"Teal",color:v.teal},{name:"Indigo",color:v.indigo},{name:"Rose",color:v.rose},{name:"Slate",color:v.slate},{name:"Default",color:null}],H2=[{name:"Rectangle",shape:"rectangle",icon:""},{name:"Rounded",shape:"rounded",icon:""},{name:"Circle",shape:"circle",icon:""},{name:"Diamond",shape:"diamond",icon:""},{name:"Hexagon",shape:"hexagon",icon:""},{name:"Pill",shape:"pill",icon:""}],V2=[{name:"None",icon:null},{name:"Server",icon:""},{name:"Database",icon:""},{name:"Cloud",icon:""},{name:"User",icon:""},{name:"Settings",icon:""},{name:"Lock",icon:""},{name:"Email",icon:""},{name:"API",icon:""},{name:"File",icon:""},{name:"Folder",icon:""},{name:"Code",icon:""},{name:"Chart",icon:""},{name:"Bell",icon:""},{name:"Star",icon:""},{name:"Check",icon:""},{name:"Warning",icon:""},{name:"Error",icon:""},{name:"Money",icon:""},{name:"Clock",icon:""}];function Ke({x:i,y:t,nodeId:r,currentIcon:n,currentShape:a,onSelectColor:s,onSelectIcon:e,onSelectShape:l,onClose:h,theme:d}){const p=M.useRef(null);return M.useEffect(()=>{const f=x=>{p.current&&!p.current.contains(x.target)&&h()};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[h]),o.jsxs("div",{ref:p,style:{position:"fixed",left:i,top:t,background:(d==null?void 0:d.modalBg)||"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",border:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.15)"}`,borderRadius:12,padding:12,zIndex:1e3,boxShadow:"0 8px 32px rgba(0,0,0,0.4)",minWidth:160},children:[o.jsx("div",{style:{color:(d==null?void 0:d.textSecondary)||"#888",fontSize:"0.75rem",marginBottom:8,fontWeight:600},children:"Node Color"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:6},children:Y2.map(f=>o.jsx("button",{onClick:()=>s(r,f.color),title:f.name,style:{width:28,height:28,borderRadius:6,border:f.color?`2px solid ${f.color}`:`2px dashed ${(d==null?void 0:d.textMuted)||"#555"}`,background:f.color?`${f.color}40`:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",color:(d==null?void 0:d.textMuted)||"#666"},children:!f.color&&""},f.name))}),e&&o.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.1)"}`},children:[o.jsx("div",{style:{color:(d==null?void 0:d.textSecondary)||"#888",fontSize:"0.75rem",marginBottom:8,fontWeight:600},children:"Node Icon"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:4,maxHeight:120,overflowY:"auto"},children:V2.map(f=>{const x=n===f.icon||!n&&!f.icon;return o.jsx("button",{onClick:()=>e(r,f.icon),title:f.name,style:{width:28,height:28,borderRadius:6,border:x?`2px solid ${v.purple}`:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.1)"}`,background:x?`${v.purple}20`:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:f.icon?"1rem":"0.7rem",color:(d==null?void 0:d.textMuted)||"#666"},children:f.icon||""},f.name)})})]}),l&&o.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.1)"}`},children:[o.jsx("div",{style:{color:(d==null?void 0:d.textSecondary)||"#888",fontSize:"0.75rem",marginBottom:8,fontWeight:600},children:"Node Shape"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:4},children:H2.map(f=>{const x=a===f.shape||!a&&f.shape==="rounded";return o.jsx("button",{onClick:()=>l(r,f.shape),title:f.name,style:{padding:"6px 8px",borderRadius:6,border:x?`2px solid ${v.purple}`:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.1)"}`,background:x?`${v.purple}20`:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:4,fontSize:"0.7rem",color:(d==null?void 0:d.textPrimary)||"#fff"},children:o.jsx("span",{style:{fontSize:"0.9rem"},children:f.icon})},f.shape)})})]}),o.jsx("div",{style:{marginTop:10,paddingTop:8,borderTop:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.1)"}`},children:o.jsx("button",{onClick:h,style:{width:"100%",padding:"6px 12px",background:"transparent",border:`1px solid ${(d==null?void 0:d.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(d==null?void 0:d.textSecondary)||"#888",fontSize:"0.75rem",cursor:"pointer"},children:"Cancel"})})]})}const dc=[{name:"Animated",style:"animated",icon:"",dasharray:"8,4",animated:!0},{name:"Dashed",style:"dashed",icon:"",dasharray:"8,4",animated:!1},{name:"Dotted",style:"dotted",icon:"",dasharray:"3,3",animated:!1},{name:"Solid",style:"solid",icon:"",dasharray:null,animated:!1}],X2=[{name:"Triangle",type:"triangle",icon:""},{name:"Open",type:"open",icon:""},{name:"Diamond",type:"diamond",icon:""},{name:"Circle",type:"circle",icon:""},{name:"None",type:"none",icon:""}];function K2({x:i,y:t,edgeId:r,currentStyle:n,currentArrowType:a,currentPathType:s,onSelectStyle:e,onSelectArrowType:l,onSelectPathType:h,onClose:d,theme:p}){const f=M.useRef(null);return M.useEffect(()=>{const x=g=>{f.current&&!f.current.contains(g.target)&&d()};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[d]),o.jsxs("div",{ref:f,style:{position:"fixed",left:i,top:t,background:(p==null?void 0:p.modalBg)||"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",border:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.15)"}`,borderRadius:12,padding:12,zIndex:1e3,boxShadow:"0 8px 32px rgba(0,0,0,0.4)",minWidth:160},children:[o.jsx("div",{style:{color:(p==null?void 0:p.textSecondary)||"#888",fontSize:"0.75rem",marginBottom:8,fontWeight:600},children:"Line Style"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:dc.map(x=>{const g=n===x.style||!n&&x.style==="animated";return o.jsxs("button",{onClick:()=>e(r,x.style),style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",borderRadius:8,border:g?`2px solid ${v.purple}`:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`,background:g?`${v.purple}20`:"transparent",cursor:"pointer",color:(p==null?void 0:p.textPrimary)||"#fff",fontSize:"0.8rem"},children:[o.jsx("span",{style:{fontSize:"1rem",width:24},children:x.icon}),o.jsx("span",{children:x.name}),g&&o.jsx("span",{style:{marginLeft:"auto",color:v.purple},children:""})]},x.style)})}),o.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`},children:[o.jsx("div",{style:{color:(p==null?void 0:p.textSecondary)||"#888",fontSize:"0.75rem",marginBottom:8,fontWeight:600},children:"Arrow Style"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:X2.map(x=>{const g=a===x.type||!a&&x.type==="triangle";return o.jsx("button",{onClick:()=>l(r,x.type),title:x.name,style:{display:"flex",alignItems:"center",justifyContent:"center",width:36,height:36,borderRadius:8,border:g?`2px solid ${v.purple}`:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`,background:g?`${v.purple}20`:"transparent",cursor:"pointer",color:(p==null?void 0:p.textPrimary)||"#fff",fontSize:"1rem"},children:x.icon},x.type)})})]}),o.jsxs("div",{style:{marginTop:12,paddingTop:10,borderTop:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`},children:[o.jsx("div",{style:{color:(p==null?void 0:p.textSecondary)||"#888",fontSize:"0.75rem",marginBottom:8,fontWeight:600},children:"Path Style"}),o.jsx("div",{style:{display:"flex",gap:4},children:[{name:"Curved",type:"curved",icon:""},{name:"Straight",type:"straight",icon:""},{name:"Elbow",type:"step",icon:""},{name:"Rounded",type:"rounded",icon:""}].map(x=>{const g=s===x.type||!s&&x.type==="curved";return o.jsxs("button",{onClick:()=>h(r,x.type),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:6,padding:"8px 12px",borderRadius:8,border:g?`2px solid ${v.purple}`:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`,background:g?`${v.purple}20`:"transparent",cursor:"pointer",color:(p==null?void 0:p.textPrimary)||"#fff",fontSize:"0.8rem"},children:[o.jsx("span",{style:{fontSize:"1rem"},children:x.icon}),o.jsx("span",{children:x.name})]},x.type)})})]}),o.jsx("div",{style:{marginTop:10,paddingTop:8,borderTop:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`},children:o.jsx("button",{onClick:d,style:{width:"100%",padding:"6px 12px",background:"transparent",border:`1px solid ${(p==null?void 0:p.border)||"rgba(255,255,255,0.1)"}`,borderRadius:6,color:(p==null?void 0:p.textSecondary)||"#888",fontSize:"0.75rem",cursor:"pointer"},children:"Cancel"})})]})}function Ue({isEditing:i,value:t,onChange:r,onFinish:n,onCancel:a,style:s={},inputStyle:e={}}){const l=M.useRef(null);M.useEffect(()=>{i&&l.current&&(l.current.focus(),l.current.select())},[i]);const h=d=>{d.key==="Enter"?(d.preventDefault(),n()):d.key==="Escape"&&(d.preventDefault(),a())};return i?o.jsx("input",{ref:l,type:"text",value:t,onChange:d=>r(d.target.value),onBlur:n,onKeyDown:h,style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(124,58,237,0.5)",borderRadius:4,color:"#fff",fontSize:"inherit",fontWeight:"inherit",textAlign:"center",padding:"2px 6px",width:"100%",minWidth:60,outline:"none",...e},onClick:d=>d.stopPropagation(),onMouseDown:d=>d.stopPropagation()}):o.jsx("span",{style:s,children:t})}function Q2(i){const t={format:"sections",title:"",actors:[],sections:[]};let r=null;const n=[v.cyan,v.purple,v.orange,v.pink,v.emerald,v.amber,v.blue,v.red],a={user:v.pink,system:v.blue,admin:v.purple,customer:v.cyan,default:v.slate};return i.split(`
`).forEach(s=>{if(s=s.trim(),!s)return;const e=s.match(/^title:\s*(.+)/i);if(e){t.title=e[1].trim();return}const l=s.match(/^actors:\s*(.+)/i);if(l){t.actors=l[1].split(",").map(p=>{const f=p.trim(),x=a[f.toLowerCase()]||a.default;return{name:f,color:x}});return}const h=s.match(/^==\s*(.+?)\s*==$/);if(h){const p=t.sections.length;r={name:h[1],color:n[p%n.length],tasks:[]},t.sections.push(r);return}const d=s.match(/^-\s*(.+?)\s*\|\s*(\d+)(?:\s*\|\s*(.+))?$/);if(d&&r){const p=d[1].trim(),f=parseInt(d[2]),x=d[3]||"",g=x?x.split(",").map(m=>m.trim()).filter(m=>m):[];r.tasks.push({id:`task-${t.sections.length-1}-${r.tasks.length}`,name:p,score:f,actors:g})}}),t}const bg={markdown:i=>{const t=i.split(`
`).filter(a=>a.trim());if(!t.length)return{id:"root",label:"Empty",children:[]};const r={id:"root",label:t[0].trim(),children:[]},n=[{node:r,indent:-1}];for(let a=1;a<t.length;a++){const s=t[a],e=s.trimStart(),l=s.length-e.length,h=e.replace(/^[-*+]\s*/,"").trim();if(!h)continue;for(;n.length>1&&n[n.length-1].indent>=l;)n.pop();const d={id:`node-${a}`,label:h,children:[]};n[n.length-1].node.children.push(d),n.push({node:d,indent:l})}return r},sql:i=>{const t=[],r=/CREATE\s+TABLE\s+(?:IF\s+NOT\s+EXISTS\s+)?[`"']?(\w+)[`"']?\s*\(([\s\S]*?)\);/gi;let n;for(;(n=r.exec(i))!==null;){const a=n[1],s=[];n[2].split(",").map(e=>e.trim()).filter(e=>e&&!/^(PRIMARY|FOREIGN|UNIQUE|CHECK|CONSTRAINT|INDEX|KEY)/i.test(e)).forEach(e=>{const l=e.match(/^[`"']?(\w+)[`"']?\s+(\w+(?:\([^)]+\))?)/i);if(l){const h={name:l[1],type:l[2].toUpperCase()};/PRIMARY\s+KEY/i.test(e)&&(h.key=!0);const d=e.match(/REFERENCES\s+[`"']?(\w+)[`"']?/i);d&&(h.fk=!0,h.references=d[1]),s.push(h)}}),t.push({name:a,fields:s})}return t},architecture:i=>{const t=new Map,r=[],n={clients:{color:v.pink,icon:"",shape:"rect"},client:{color:v.pink,icon:"",shape:"rect"},web:{color:v.pink,icon:"",shape:"rect"},mobile:{color:v.pink,icon:"",shape:"rect"},browser:{color:v.pink,icon:"",shape:"rect"},user:{color:v.pink,icon:"",shape:"rect"},users:{color:v.pink,icon:"",shape:"rect"},gateway:{color:v.orange,icon:"",shape:"hexagon"},gateways:{color:v.orange,icon:"",shape:"hexagon"},api:{color:v.orange,icon:"",shape:"hexagon"},lb:{color:v.orange,icon:"",shape:"hexagon"},loadbalancer:{color:v.orange,icon:"",shape:"hexagon"},proxy:{color:v.orange,icon:"",shape:"hexagon"},cdn:{color:v.orange,icon:"",shape:"hexagon"},dns:{color:v.orange,icon:"",shape:"rect"},firewall:{color:v.red,icon:"",shape:"hexagon"},services:{color:v.blue,icon:"",shape:"rect"},service:{color:v.blue,icon:"",shape:"rect"},backend:{color:v.blue,icon:"",shape:"rect"},microservice:{color:v.blue,icon:"",shape:"rect"},microservices:{color:v.blue,icon:"",shape:"rect"},function:{color:v.violet,icon:"",shape:"rect"},lambda:{color:v.violet,icon:"",shape:"rect"},serverless:{color:v.violet,icon:"",shape:"rect"},worker:{color:v.blue,icon:"",shape:"rect"},container:{color:v.cyan,icon:"",shape:"rect"},containers:{color:v.cyan,icon:"",shape:"rect"},docker:{color:v.cyan,icon:"",shape:"rect"},k8s:{color:v.cyan,icon:"",shape:"rect"},kubernetes:{color:v.cyan,icon:"",shape:"rect"},pod:{color:v.cyan,icon:"",shape:"rect"},pods:{color:v.cyan,icon:"",shape:"rect"},cluster:{color:v.cyan,icon:"",shape:"rect"},node:{color:v.cyan,icon:"",shape:"rect"},databases:{color:v.emerald,icon:"",shape:"cylinder"},database:{color:v.emerald,icon:"",shape:"cylinder"},db:{color:v.emerald,icon:"",shape:"cylinder"},data:{color:v.emerald,icon:"",shape:"cylinder"},sql:{color:v.emerald,icon:"",shape:"cylinder"},nosql:{color:v.emerald,icon:"",shape:"cylinder"},storage:{color:v.emerald,icon:"",shape:"cylinder"},s3:{color:v.emerald,icon:"",shape:"cylinder"},blob:{color:v.emerald,icon:"",shape:"cylinder"},cache:{color:v.red,icon:"",shape:"cylinder"},redis:{color:v.red,icon:"",shape:"cylinder"},memcached:{color:v.red,icon:"",shape:"cylinder"},queue:{color:v.amber,icon:"",shape:"rect"},queues:{color:v.amber,icon:"",shape:"rect"},mq:{color:v.amber,icon:"",shape:"rect"},kafka:{color:v.amber,icon:"",shape:"rect"},rabbitmq:{color:v.amber,icon:"",shape:"rect"},pubsub:{color:v.amber,icon:"",shape:"rect"},eventbus:{color:v.amber,icon:"",shape:"rect"},stream:{color:v.amber,icon:"",shape:"rect"},monitoring:{color:v.fuchsia,icon:"",shape:"rect"},metrics:{color:v.fuchsia,icon:"",shape:"rect"},logging:{color:v.fuchsia,icon:"",shape:"rect"},logs:{color:v.fuchsia,icon:"",shape:"rect"},tracing:{color:v.fuchsia,icon:"",shape:"rect"},alerting:{color:v.fuchsia,icon:"",shape:"rect"},auth:{color:v.indigo,icon:"",shape:"rect"},identity:{color:v.indigo,icon:"",shape:"rect"},vault:{color:v.indigo,icon:"",shape:"rect"},secrets:{color:v.indigo,icon:"",shape:"rect"},cloud:{color:v.sky,icon:"",shape:"rect"},aws:{color:v.orange,icon:"",shape:"rect"},gcp:{color:v.blue,icon:"",shape:"rect"},azure:{color:v.sky,icon:"",shape:"rect"},vpc:{color:v.slate,icon:"",shape:"rect"},subnet:{color:v.slate,icon:"",shape:"rect"},region:{color:v.slate,icon:"",shape:"rect"},zone:{color:v.slate,icon:"",shape:"rect"},external:{color:v.slate,icon:"",shape:"rect"},thirdparty:{color:v.slate,icon:"",shape:"rect"},saas:{color:v.slate,icon:"",shape:"rect"},email:{color:v.slate,icon:"",shape:"rect"},payment:{color:v.slate,icon:"",shape:"rect"},analytics:{color:v.slate,icon:"",shape:"rect"}},a=150,s=90,e=[v.purple,v.blue,v.cyan,v.emerald,v.amber,v.pink];let l=0;const h=new Map,d=new Map,p=new Map,f=[];let x=0;const g=i.split(`
`);for(let _=0;_<g.length;_++){let q=g[_].trim();if(!q||q.startsWith("#"))continue;const $=q.match(/^(?:group|boundary)\s+["']([^"']+)["']\s*\{?\s*$/i);if($){const Y=$[1],X=f.length>0?f[f.length-1]:null;p.set(Y,{name:Y,nodes:[],colorIndex:x++,parent:X,children:[]}),X&&p.has(X)&&p.get(X).children.push(Y),f.push(Y);continue}if(q==="}"&&f.length>0){f.pop();continue}const P=q.match(/^\[(\w+)\]\s*(.+)/);if(P){const Y=P[1].toLowerCase(),X=n[Y]||{color:v.slate,icon:"",shape:"rect"},K=P[2].split(",").map(ve=>ve.trim()).filter(ve=>ve),be=f.length>0?f[f.length-1]:null;K.forEach(ve=>{const Q=ve.match(/^([^:]+):\s*(.+)$/),ge=Q?Q[1].trim():ve,ae=Q?Q[2].trim():"",_e=ge.toLowerCase().replace(/[^a-z0-9]/g,"_"),oe={id:_e,label:ge,description:ae,...X,x:0,y:0,width:Math.max(a,ge.length*9+40),layerIndex:l,group:be};t.set(_e,oe),h.set(_e,l),f.length>0&&(d.set(_e,[...f]),f.forEach(le=>{p.has(le)&&p.get(le).nodes.push(_e)}))}),l++;continue}const L=[{regex:/^(.+?)\s*<->\s*(.+?)(?::\s*(.+))?$/,style:"bidirectional"},{regex:/^(.+?)\s*-->\s*(.+?)(?::\s*(.+))?$/,style:"dotted"},{regex:/^(.+?)\s*==>\s*(.+?)(?::\s*(.+))?$/,style:"thick"},{regex:/^(.+?)\s*->>\s*(.+?)(?::\s*(.+))?$/,style:"async"},{regex:/^(.+?)\s*-\.->\s*(.+?)(?::\s*(.+))?$/,style:"dashed"},{regex:/^(.+?)\s*->\s*(.+?)(?::\s*(.+))?$/,style:"normal"}];for(const{regex:Y,style:X}of L){const K=q.match(Y);if(K){const[,be,ve,Q]=K,ge=be.trim().toLowerCase().replace(/[^a-z0-9]/g,"_"),ae=ve.trim().toLowerCase().replace(/[^a-z0-9]/g,"_");r.push({id:`e-${r.length}`,source:ge,target:ae,label:(Q==null?void 0:Q.trim())||"",style:X}),X==="bidirectional"&&r.push({id:`e-${r.length}`,source:ae,target:ge,label:"",style:"normal"});break}}}const m=t.size,c=r.length,u=m>8||c>10,b=new Set;if(t.forEach(_=>b.add(_.layerIndex)),b.size<=2&&m>4){const _=new Map,q=new Map;t.forEach((Y,X)=>{_.set(X,0),q.set(X,[])}),r.forEach(Y=>{t.has(Y.source)&&t.has(Y.target)&&(q.get(Y.source).push(Y.target),_.set(Y.target,(_.get(Y.target)||0)+1))});const $=new Map,P=[];for(t.forEach((Y,X)=>{_.get(X)===0&&($.set(X,0),P.push(X))});P.length>0;){const Y=P.shift(),X=$.get(Y);q.get(Y).forEach(K=>{const be=X+1;(!$.has(K)||$.get(K)<be)&&$.set(K,be),_.set(K,_.get(K)-1),_.get(K)===0&&P.push(K)})}const L=$.size>0?Math.floor([...$.values()].reduce((Y,X)=>Y+X,0)/$.size):0;t.forEach((Y,X)=>{$.has(X)||$.set(X,L),Y.layerIndex=$.get(X)})}const S=new Bh.graphlib.Graph;S.setGraph({rankdir:"TB",nodesep:u?180:120,ranksep:u?180:130,marginx:120,marginy:100,ranker:"network-simplex"}),S.setDefaultEdgeLabel(()=>({}));const w=new Map;t.forEach((_,q)=>w.set(q,0)),r.forEach(_=>{w.has(_.target)&&w.set(_.target,w.get(_.target)+1)});const k=[];t.forEach((_,q)=>{w.get(q)===0&&k.push(q)}),t.forEach(_=>{S.setNode(_.id,{label:_.label,width:Math.max(_.width,180),height:s,rank:_.layerIndex})});const j=new Set;r.forEach(_=>{const q=t.get(_.source),$=t.get(_.target);if(q&&$){const P=k.includes(_.target)&&!k.includes(_.source),L=q.layerIndex>$.layerIndex;(P||L)&&j.add(_.id)}});const C=new Set;r.forEach(_=>{const q=`${_.source}-${_.target}`,$=`${_.target}-${_.source}`;if(!C.has(q)&&!C.has($)&&t.has(_.source)&&t.has(_.target)){const P=j.has(_.id);S.setEdge(_.source,_.target,{weight:P?.5:3,minlen:P?1:2}),C.add(q)}}),Bh.layout(S),S.nodes().forEach(_=>{const q=t.get(_),$=S.node(_);q&&$&&(q.x=$.x,q.y=$.y)});const E=new Set;r.forEach(_=>{E.add(_.source),E.add(_.target)});let R=0,T=0;t.forEach(_=>{E.has(_.id)&&(R=Math.max(R,_.y+s/2),T=Math.max(T,_.x+(_.width||a)/2))});const I=new Map,B=[];if(t.forEach(_=>{E.has(_.id)||(_.group?(I.has(_.group)||I.set(_.group,[]),I.get(_.group).push(_)):B.push(_))}),B.length>0){const _=new Map;B.forEach(P=>{const L=P.layerIndex||0;_.has(L)||_.set(L,[]),_.get(L).push(P)});const q=new Map;t.forEach(P=>{if(E.has(P.id)&&!P.group){const L=P.layerIndex||0;q.has(L)||q.set(L,P.y)}});let $=T+100;_.forEach((P,L)=>{const Y=q.get(L)||100+L*150;P.forEach((X,K)=>{X.x=$+K*((X.width||a)+60),X.y=Y})})}let z=R+100;const D=50;[...p.keys()].forEach(_=>{const q=I.get(_);if(!q||q.length===0)return;const $=[],P=[];if(p.get(_).nodes.forEach(L=>{const Y=t.get(L);Y&&(E.has(L)?$.push(Y):P.push(Y))}),$.length>0){let L=0,Y=0;$.forEach(X=>{L=Math.max(L,X.x+(X.width||a)/2),Y+=X.y}),Y/=$.length,P.forEach((X,K)=>{X.x=L+80+K*((X.width||a)+60),X.y=Y})}else{const Y=s+40,X=200;P.forEach((be,ve)=>{const Q=Math.floor(ve/3),ge=ve%3;be.x=150+ge*X,be.y=z+Q*Y});const K=Math.ceil(P.length/3);z+=K*Y+D+40}});const N=[],H=new Map,ee=30,ne=15,J=_=>{let q=0,$=_;for(;$;){const P=p.get($);if(P&&P.parent)q++,$=P.parent;else break}return q};[...p.keys()].sort((_,q)=>J(q)-J(_)).forEach(_=>{const q=p.get(_);if(!q||q.nodes.length===0)return;let $=1/0,P=1/0,L=-1/0,Y=-1/0;if(q.nodes.forEach(X=>{const K=t.get(X);if(K){if((d.get(X)||[]).some(ae=>ae!==_&&q.children.includes(ae)))return;const Q=K.width||a,ge=s;$=Math.min($,K.x-Q/2),P=Math.min(P,K.y-ge/2),L=Math.max(L,K.x+Q/2),Y=Math.max(Y,K.y+ge/2)}}),q.children.forEach(X=>{const K=H.get(X);K&&($=Math.min($,K.minX-ne),P=Math.min(P,K.minY-ne),L=Math.max(L,K.maxX+ne),Y=Math.max(Y,K.maxY+ne))}),$!==1/0){H.set(_,{minX:$-ee,minY:P-ee-20,maxX:L+ee,maxY:Y+ee});const X=H.get(_);N.push({id:`group-${_.toLowerCase().replace(/[^a-z0-9]/g,"_")}`,name:_,x:X.minX,y:X.minY,width:X.maxX-X.minX,height:X.maxY-X.minY,color:e[q.colorIndex%e.length],depth:J(_),parent:q.parent})}}),N.sort((_,q)=>_.depth-q.depth);const F=new Map;return N.forEach(_=>{const q=_.parent||"__root__";F.has(q)||F.set(q,[]),F.get(q).push(_)}),F.forEach(_=>{_.sort((q,$)=>q.y-$.y);for(let q=1;q<_.length;q++){const $=_[q-1],P=_[q],L=$.y+$.height;if(P.y<L+20){const Y=L+20-P.y;P.y+=Y;const X=p.get(P.name);X&&X.nodes.forEach(K=>{const be=t.get(K);be&&(be.y+=Y)})}}}),{nodes:Array.from(t.values()),edges:r,groups:N}},flowchart:i=>{const t=new Map,r=[],n=[],a=u=>{u=u.trim();let b="",y=u;const S=u.match(/^(.+?):\s+([^:]+)$/);S&&(y=S[1].trim(),b=S[2].trim());const w=y.match(/^\(([^)]+)\)\s*(.*)$/);if(w){const k=w[1].trim(),j=w[2].trim();return j&&k.toLowerCase()===j.toLowerCase()?{type:"process",label:j,edgeLabel:b}:["start","end","process","decision","io","data","database","document"].includes(k.toLowerCase())?{type:k.toLowerCase(),label:j||k,edgeLabel:b}:{type:"process",label:j||k,edgeLabel:b}}return{type:"process",label:y,edgeLabel:b}};let s="TB";const e=i.match(/^direction:\s*(TB|LR|RL|BT)/im);e&&(s=e[1].toUpperCase());const l=s==="LR"||s==="RL";i.split(`
`).forEach(u=>{if(u=u.trim(),!u||u.startsWith("#")||u.match(/^direction:/i))return;const b=u.split(/\s*->\s*/);b.forEach((y,S)=>{const{type:w,label:k,edgeLabel:j}=a(y),C=k.toLowerCase().replace(/[^a-z0-9]/g,"_");if(t.has(C)||(t.set(C,{id:C,type:w,label:k,x:0,y:0}),n.push(C)),S>0){const{label:E}=a(b[S-1]),R=E.toLowerCase().replace(/[^a-z0-9]/g,"_");r.push({id:`e-${r.length}`,source:R,target:C,label:j})}})});const h=new Map,d=new Map;r.forEach(u=>{h.has(u.source)||h.set(u.source,[]),h.get(u.source).push(u.target),d.has(u.target)||d.set(u.target,[]),d.get(u.target).push(u.source)});const p=u=>{const k=Math.min(180,Math.max(100,((u==null?void 0:u.length)||5)*8+40)),j=Math.floor((k-20)/8),C=Math.ceil(((u==null?void 0:u.length)||5)/j),E=Math.max(60,30+C*18);return{width:k,height:E}};t.forEach((u,b)=>{const y=p(u.label);u.width=y.width,u.height=y.height});const f=n.filter(u=>!d.has(u)||d.get(u).length===0),x=new Set,g=[v.purple,v.blue,v.emerald,v.orange,v.pink,v.cyan],m=(u,b,y,S=0,w=0)=>{if(x.has(u))return;const k=t.get(u);if(!k)return;l?(k.x=b,k.y=y+S):(k.x=y+S,k.y=b),k.depth=w,k.color=g[w%g.length],x.add(u);const j=h.get(u)||[],C=k.width||130,E=k.height||60,R=l?C+60:E+40,T=l?100:200;if(j.length===1)m(j[0],b+R,y,S,w+1);else if(j.length>=2){const I=(j.length-1)*T;j.forEach((B,z)=>{const D=-I/2+z*T;m(B,b+R,y,D,w+1)})}};if(l){let u=200;f.forEach((b,y)=>{m(b,100,u+y*150,0,0)})}else{let u=400;f.forEach((b,y)=>{m(b,100,u+y*250,0,0)})}let c=100;return n.forEach(u=>{if(!x.has(u)){const b=t.get(u);b.x=700,b.y=c,b.depth=0,b.color=v.gray,c+=l?100:(b.height||60)+40,x.add(u)}}),{nodes:Array.from(t.values()),edges:r,direction:s}},stateMachine:i=>{const t=new Map,r=[];i.split(`
`).forEach(a=>{var l;if(a=a.trim(),!a||a.startsWith("#"))return;const s=a.match(/^\((\w+)\)\s*(\w+)(?::\s*(.+))?/);if(s){const h=s[1].toLowerCase(),d=s[2],p=((l=s[3])==null?void 0:l.trim())||"";t.set(d,{id:d,label:p||d,isInitial:h==="initial",isFinal:h==="final",isFork:h==="fork",isJoin:h==="join",isChoice:h==="choice",isComposite:h==="composite",stateType:h});return}const e=a.match(/^(\w+)\s*->\s*(\w+)(?::\s*(.+))?/);e&&(t.has(e[1])||t.set(e[1],{id:e[1],label:e[1]}),t.has(e[2])||t.set(e[2],{id:e[2],label:e[2]}),r.push({from:e[1],to:e[2],event:e[3]||""}))});const n=Array.from(t.values());return n.forEach((a,s)=>{const e=2*Math.PI/n.length*s-Math.PI/2;a.x=300+Math.cos(e)*150,a.y=250+Math.sin(e)*150}),{states:n,transitions:r}},userJourney:i=>{if(i.includes("== ")||i.includes("title:")||i.includes("actors:"))return Q2(i);const t=[],r=new Map,n={actor:{color:v.pink,icon:"",shape:"circle"},user:{color:v.pink,icon:"",shape:"circle"},page:{color:v.cyan,icon:"",shape:"rect"},screen:{color:v.cyan,icon:"",shape:"rect"},action:{color:v.purple,icon:"",shape:"rect"},form:{color:v.orange,icon:"",shape:"rect"},email:{color:v.amber,icon:"",shape:"rect"},success:{color:v.green,icon:"",shape:"rect"},error:{color:v.red,icon:"",shape:"rect"},decision:{color:v.orange,icon:"",shape:"diamond"},notification:{color:v.red,icon:"",shape:"rect",badge:"New"},milestone:{color:v.green,icon:"",shape:"rect"},default:{color:v.blue,icon:"",shape:"rect"}};i.split(`
`).forEach(c=>{var y,S;if(c=c.trim(),!c||c.startsWith("#")||c.toLowerCase().startsWith("title"))return;const u=c.match(/^[\[(](\w+)(?::([a-z0-9-]+))?[\])]\s*(.+?)(?:\s*:\s*(.+))?$/i);if(u&&!c.includes("->")){const w=u[1].toLowerCase(),k=u[2]||null,j=u[3].trim(),C=((y=u[4])==null?void 0:y.trim())||"",E=j.toLowerCase().replace(/[^a-z0-9]/g,"_"),R=n[w]||n.default;r.has(E)||r.set(E,{id:E,label:j,description:C,type:w,linkedTemplate:k,clickable:!!k,...R,x:0,y:0});return}const b=c.match(/^(.+?)\s*-(?:([^>]+)->|->)\s*(.+?)$/);if(b){const w=b[1].trim(),k=((S=b[2])==null?void 0:S.trim())||"",j=b[3].trim(),C=w.toLowerCase().replace(/[^a-z0-9]/g,"_"),E=j.toLowerCase().replace(/[^a-z0-9]/g,"_");r.has(C)||r.set(C,{id:C,label:w,type:"default",...n.default,x:0,y:0}),r.has(E)||r.set(E,{id:E,label:j,type:"default",...n.default,x:0,y:0}),t.push({id:`edge-${t.length}`,source:C,target:E,label:k})}});const a=Array.from(r.values()),s=new Map,e=new Set,l=new Set(t.map(c=>c.target)),h=a.filter(c=>!l.has(c.id)),d=(c,u)=>{e.has(c)||(e.add(c),s.set(c,Math.max(s.get(c)||0,u)),t.filter(b=>b.source===c).forEach(b=>d(b.target,u+1)))};(h.length?h:a.slice(0,1)).forEach(c=>d(c.id,0)),a.forEach(c=>{s.has(c.id)||s.set(c.id,0)});const p=new Map;a.forEach(c=>{const u=s.get(c.id)||0;p.has(u)||p.set(u,[]),p.get(u).push(c)});const f=Math.max(...Array.from(p.values()).map(c=>c.length),1),x=Math.max(...Array.from(s.values()),0)+1,g=220,m=160;for(let c=0;c<=x-1;c++){const u=p.get(c)||[],b=u.length*m,y=150+(f*m-b)/2;u.forEach((S,w)=>{S.x=180+c*g,S.y=y+w*m})}return{nodes:a,edges:t}},timeline:i=>{const t=[];let r=100;return i.split(`
`).forEach((n,a)=>{var h,d;if(n=n.trim(),!n||n.startsWith("#"))return;const s=n.match(/^\[(.+?)\]\s*(.+?)(?:\|(.+))?$/)||[null,"",n,""];let e=s[2].trim();const l=e.startsWith("*");l&&(e=e.substring(1).trim()),t.push({id:`timeline-${a}`,date:((h=s[1])==null?void 0:h.trim())||"",label:e,description:((d=s[3])==null?void 0:d.trim())||"",x:r,y:200,isMilestone:l}),r+=220}),t},sequence:i=>{const t=[],r=[],n=[],a=[];let s=80,e=[],l=0;return i.split(`
`).forEach(h=>{if(h=h.trim(),!h||h.startsWith("#"))return;const d=h.match(/^participants?\s+(.+)/i);if(d){d[1].split(",").forEach(y=>{const S=y.trim(),w=S.toLowerCase().replace(/\s/g,"_");t.find(k=>k.id===w)||(t.push({id:w,label:S,x:s}),s+=160)});return}const p=h.match(/^(loop|alt|opt|par|critical|break|rect)\s+(.+)/i);if(p){e.push({type:p[1].toLowerCase(),label:p[2],startIndex:l,sections:[{label:p[2],startIndex:l}]});return}const f=h.match(/^else\s*(.*)/i);if(f&&e.length>0){const y=e[e.length-1];y.type==="alt"&&y.sections.push({label:f[1]||"else",startIndex:l});return}const x=h.match(/^and\s+(.+)/i);if(x&&e.length>0){const y=e[e.length-1];y.type==="par"&&y.sections.push({label:x[1],startIndex:l});return}const g=h.match(/^option\s+(.+)/i);if(g&&e.length>0){const y=e[e.length-1];y.type==="critical"&&y.sections.push({label:g[1],startIndex:l});return}const m=h.match(/^(activate|deactivate)\s+(\w+)/i);if(m){const y=m[1].toLowerCase(),S=m[2].toLowerCase().replace(/\s/g,"_");r.push({type:y,participant:S,index:l});return}if(h.toLowerCase()==="end"){if(e.length>0){const y=e.pop();y.endIndex=l,n.push(y)}return}const c=h.match(/^note\s+(left|right)\s+of\s+(\w+)\s*:\s*(.+)/i);if(c){const y=c[1].toLowerCase(),S=c[2],w=S.toLowerCase().replace(/\s/g,"_");t.find(k=>k.id===w)||(t.push({id:w,label:S,x:s}),s+=160),a.push({position:y,participantId:w,text:c[3],atMessageIndex:l});return}const u=h.match(/^note\s+over\s+(.+?)\s*:\s*(.+)/i);if(u){const S=u[1].split(",").map(w=>w.trim()).map(w=>{const k=w.toLowerCase().replace(/\s/g,"_");return t.find(j=>j.id===k)||(t.push({id:k,label:w,x:s}),s+=160),k});a.push({position:"over",participantIds:S,text:u[2],atMessageIndex:l});return}const b=h.match(/^(\w+)\s*(->|-->|-x|--x|-\)|--\))\s*(\w+)(?::\s*(.+))?/);if(b){const y=b[1].toLowerCase().replace(/\s/g,"_"),S=b[3].toLowerCase().replace(/\s/g,"_");t.find(w=>w.id===y)||(t.push({id:y,label:b[1],x:s}),s+=160),t.find(w=>w.id===S)||(t.push({id:S,label:b[3],x:s}),s+=160),r.push({from:y,to:S,label:b[4]||"",isReturn:b[2]==="-->",index:l}),l++}}),{participants:t,messages:r,fragments:n,notes:a}},orgChart:i=>{const t=[],r=[],n=[{id:null,indent:-1}];return i.split(`
`).forEach((a,s)=>{var p;if(!a.trim())return;const e=a.trimStart(),l=a.length-e.length,h=e.match(/^(.+?)(?:\s*\[(.+?)\])?$/);for(;n.length>1&&n[n.length-1].indent>=l;)n.pop();const d={id:`org-${s}`,label:h[1].trim(),title:((p=h[2])==null?void 0:p.trim())||"",children:[],parent:n[n.length-1].id};if(t.push(d),n[n.length-1].id){r.push({id:`oe-${s}`,source:n[n.length-1].id,target:d.id});const f=t.find(x=>x.id===n[n.length-1].id);f&&f.children.push(d.id)}n.push({id:d.id,indent:l})}),{nodes:t,edges:r}},network:i=>{const t=new Map,r=[];return i.split(`
`).forEach(n=>{var e;if(n=n.trim(),!n||n.startsWith("#"))return;const a=n.match(/^\[(\w+)\]\s*(.+?)(?:\s*\((.+?)\))?$/);if(a){const l=a[2].trim().toLowerCase().replace(/[^a-z0-9]/g,"_");t.set(l,{id:l,type:a[1].toLowerCase(),label:a[2].trim(),ip:((e=a[3])==null?void 0:e.trim())||""});return}const s=n.match(/^(.+?)\s*--\s*(.+?)(?:\s*:\s*(.+))?$/);s&&r.push({id:`conn-${r.length}`,source:s[1].trim().toLowerCase().replace(/[^a-z0-9]/g,"_"),target:s[2].trim().toLowerCase().replace(/[^a-z0-9]/g,"_"),protocol:s[3]||""})}),{devices:Array.from(t.values()),connections:r}},gantt:i=>{const t=[];return i.split(`
`).forEach((r,n)=>{if(r=r.trim(),!r||r.startsWith("#"))return;const a=r.split(",").map(s=>s.trim());a.length>=2&&t.push({id:`task-${n}`,name:a[0],start:parseInt(a[1])||n*2,duration:parseInt(a[2])||2,progress:parseInt(a[3])||0})}),t},deployment:i=>{const t=[],r=[{id:null,indent:-1}];let n=0;return i.split(`
`).forEach(a=>{if(!a.trim())return;const s=a.trimStart(),e=a.length-s.length,l=s.match(/^\[(\w+)\]\s*(.+)$/)||[null,"component",s];for(;r.length>1&&r[r.length-1].indent>=e;)r.pop();const h={id:`deploy-${n++}`,label:(l[2]||s).trim(),type:(l[1]||"component").toLowerCase(),parentId:r[r.length-1].id,indent:e};t.push(h),r.push({id:h.id,indent:e})}),{nodes:t}},pie:i=>{const t=[];return i.split(`
`).forEach(r=>{if(r=r.trim(),!r||r.startsWith("#")||r.toLowerCase().startsWith("title"))return;const n=r.match(/^"?([^":,]+)"?\s*[:,]\s*(\d+(?:\.\d+)?)/);n&&t.push({label:n[1].trim(),value:parseFloat(n[2])})}),t},quadrant:i=>{const t={title:"",xLabel:"",yLabel:"",quadrants:["","","",""]},r=[];return i.split(`
`).forEach(n=>{if(n=n.trim(),!n||n.startsWith("#"))return;if(n.startsWith("title:")){t.title=n.replace("title:","").trim();return}if(n.startsWith("x-axis:")){t.xLabel=n.replace("x-axis:","").trim();return}if(n.startsWith("y-axis:")){t.yLabel=n.replace("y-axis:","").trim();return}const a=n.match(/^quadrant-(\d):\s*(.+)$/);if(a){t.quadrants[parseInt(a[1])-1]=a[2];return}const s=n.match(/^(.+?):\s*\[(\d+(?:\.\d+)?),\s*(\d+(?:\.\d+)?)\]$/);s&&r.push({id:`point-${r.length}`,label:s[1].trim(),x:parseFloat(s[2]),y:parseFloat(s[3])})}),{config:t,points:r}},git:i=>{const t=[],r=new Map;let n="main",a=0;return r.set("main",{name:"main",y:100,parentBranch:null,branchPoint:0}),i.split(`
`).forEach(s=>{var e;if(s=s.trim(),!(!s||s.startsWith("#"))){if(s.startsWith("branch ")){const l=s.replace("branch ","").trim();r.has(l)||r.set(l,{name:l,y:100+r.size*80,parentBranch:n,branchPoint:a}),n=l;return}if(s.startsWith("checkout ")){n=s.replace("checkout ","").trim();return}if(s.startsWith("commit")||s.startsWith("merge")){const l=s.startsWith("merge"),h=s.match(/"([^"]+)"/);let d=null;if(l){const p=s.match(/merge\s+(\w+)/i);p&&(d=p[1])}t.push({id:`commit-${a}`,label:h?h[1]:`C${a}`,branch:n,x:120+a*100,y:((e=r.get(n))==null?void 0:e.y)||100,isMerge:l,mergeFrom:d,index:a}),a++}}}),{commits:t,branches:Array.from(r.values())}},wireframe:i=>{const t=[];let r=20,n=20,a=[],s=!1,e=0,l=0;const h=/sidebar|aside|slip|cart|panel|summary/i.test(i)&&/<\s*(sidebar|aside|slip|cart|panel|summary)/i.test(i),d=h?480:620,p=200,f=h?d+p+30:d+40,x=()=>s?d+30:a.length>0?a[a.length-1].x+15:n,g=()=>s?p:a.length>0?a[a.length-1].width-30:d;for(i.split(`
`).forEach((m,c)=>{var j,C,E,R,T,I,B,z,D,U,N,H,ee,ne,J,ie,F,_,q;const u=m.trim();if(!u||u.startsWith("//")||u.startsWith("#")&&!u.startsWith("# ")&&!u.startsWith("## ")&&!u.startsWith("### "))return;const b=x(),y=g();if(u.match(/^\{(.+)\}$/)&&!u.match(/\{(badge|tag):/i)){t.push({id:`wf-${c}`,type:"window",label:u.slice(1,-1),x:b,y:r,width:f,height:36}),r+=46;return}if(u.match(/^<(.+)>$/)&&!u.includes("/")){const $=u.slice(1,-1),P=/sidebar|aside|slip|cart|panel|summary/i.test($);P&&!s&&(s=!0,l=r,e=145,r=e);const L=$==="card"||/^(sidebar|aside|panel|slip|summary|cart)$/i.test($),Y={id:`wf-${c}`,type:"card",label:L?"":$,x:b,y:r,width:y,startY:r,children:[],isSidebar:P};t.push(Y),a.push(Y),r+=L?15:45;return}if(u.match(/^<\/(.*)>$/)||u==="</>"){if(a.length>0){const $=a.pop();$.height=r-$.startY+20,$.isSidebar&&(s=!1,r=Math.max(r,l))}r+=25;return}if(u.match(/^\{\{(.+)\}\}$/)){t.push({id:`wf-${c}`,type:"modal",label:u.slice(2,-2),x:b+20,y:r,width:y-40,height:200}),r+=220;return}if(u.match(/^\[\[(.+)\]\]$/)){const $=u.slice(2,-2).split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"navbar",items:$,x:b,y:r,width:f,height:44}),r+=54;return}if(u.match(/^\(\((.+)\)\)$/)){const $=u.slice(2,-2).split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"tabs",items:$,activeIndex:0,x:b,y:r,width:y,height:40}),r+=50;return}if(u.startsWith(">>")){const $=u.slice(2).split(">").map(P=>P.trim()).filter(P=>P);t.push({id:`wf-${c}`,type:"breadcrumbs",items:$,x:b,y:r,width:y}),r+=35;return}const S=u.match(/\[[^\]]+\]/g);if(S&&S.length>1){const $=S.map(P=>{const L=P.slice(1,-1).trim();return L.startsWith("")||L.toLowerCase().startsWith("search")?{type:"search",label:L.replace(/^\s*/,"").replace(/^search:?\s*/i,"").replace(/_/g," ").trim()||"Search..."}:L.startsWith("v ")||L.toLowerCase().startsWith("select:")?{type:"dropdown",label:L.replace(/^v\s+/,"").replace(/^select:\s*/i,"")}:L.startsWith("+")||L.startsWith("+ ")?{type:"button",label:L,variant:"primary"}:{type:"button",label:L,variant:"secondary"}});t.push({id:`wf-${c}`,type:"toolbar",items:$,x:b,y:r,width:y,height:44}),r+=54;return}if(u.match(/^\[[\s_]*(.*)[\s_]*\]$/)||u.match(/^\[search:?\s*(.*)\]$/i)){let $=((j=u.match(/^\[[\s_]*(.*)[\s_]*\]$/))==null?void 0:j[1])||((C=u.match(/^\[search:?\s*(.*)\]$/i))==null?void 0:C[1])||"Search...";$=$.replace(/^_+|_+$/g,"").replace(/_+/g," ").trim()||"Search...",t.push({id:`wf-${c}`,type:"search",label:$,x:b,y:r,width:y,height:40}),r+=50;return}if(u.match(/^\[v\s+(.+)\]$/)||u.match(/^\[select:\s*(.+)\]$/i)){const $=((E=u.match(/^\[v\s+(.+)\]$/))==null?void 0:E[1])||((R=u.match(/^\[select:\s*(.+)\]$/i))==null?void 0:R[1]);t.push({id:`wf-${c}`,type:"dropdown",label:$,x:b,y:r,width:Math.min(200,y),height:36}),r+=46;return}if(u.match(/^\[([oO])\]\s*(.+)$/)){const $=u.match(/^\[([oO])\]\s*(.+)$/);t.push({id:`wf-${c}`,type:"toggle",enabled:$[1]==="O",label:$[2],x:b,y:r}),r+=40;return}if(u.match(/^\(([oO\*\s])\)\s*(.+)$/)){const $=u.match(/^\(([oO\*\s])\)\s*(.+)$/);t.push({id:`wf-${c}`,type:"radio",selected:$[1]==="O"||$[1]==="*",label:$[2],x:b,y:r}),r+=35;return}if(u.match(/^\[=+o-+\]$/)||u.match(/^\[slider:\s*(\d+)%?\]$/i)){let $=50;const P=u.match(/^\[slider:\s*(\d+)%?\]$/i);if(P)$=parseInt(P[1]);else{const L=u.match(/^\[(=*)o(-*)\]$/);L&&($=Math.round(L[1].length/(L[1].length+L[2].length)*100))}t.push({id:`wf-${c}`,type:"slider",value:$,x:b,y:r,width:Math.min(200,y)}),r+=45;return}if(u.match(/^\[\|+\.+\]/)||u.match(/^\[=+-+\]/)||u.match(/^\[progress:\s*(\d+)%?\]/i)){let $=50,P="";const L=u.match(/^\[progress:\s*(\d+)%?\](.*)$/i);if(L)$=parseInt(L[1]),P=((T=L[2])==null?void 0:T.trim())||"";else{const Y=u.match(/^\[(\|+)(\.+)\]\s*(.*)$/);Y&&($=Math.round(Y[1].length/(Y[1].length+Y[2].length)*100),P=Y[3]||"");const X=u.match(/^\[(=+)(-+)\]\s*(.*)$/);X&&($=Math.round(X[1].length/(X[1].length+X[2].length)*100),P=X[3]||"")}t.push({id:`wf-${c}`,type:"progress",value:$,label:P,x:b,y:r,width:y-20}),r+=35;return}if(u.match(/^\(@+\)$/)||u.match(/^\(@(.+)\)$/)){if(u.match(/^\(@+\)$/)){const P=u.length-2;t.push({id:`wf-${c}`,type:"avatar-group",count:P,x:b,y:r})}else{const P=((I=u.match(/^\(@(.+)\)$/))==null?void 0:I[1])||"";t.push({id:`wf-${c}`,type:"avatar",label:P,x:b,y:r})}r+=55;return}if(u.match(/^\[img[^\]]*\](\s+\[img[^\]]*\])+$/i)){const $=u.match(/\[img[^\]]*\]/gi)||[],P=$.length,L=Math.floor((y-(P-1)*8)/P);$.forEach((Y,X)=>{const K=Y.match(/(\d+):(\d+)/),be=K?parseInt(K[1])/parseInt(K[2]):1,ve=Math.min(Math.round(L/be),100);t.push({id:`wf-${c}-${X}`,type:"image",label:"",x:b+X*(L+8),y:r,width:L,height:ve})}),r+=115;return}const w=u.match(/\{(badge|tag):([^}]+)\}/gi);if(w&&w.length>0){const $=w.map(P=>{const Y=P.match(/\{(badge|tag):([^}]+)\}/i)[2].trim(),X=Y.match(/^(success|warning|error|info|new|beta|pro):(.+)$/i),K=X?X[1].toLowerCase():null,be=X?X[2]:Y;return{variant:K,label:be}});t.push({id:`wf-${c}`,type:"badge-group",badges:$,x:b,y:r}),r+=35;return}if(u.match(/^\[img[:\s]?.*\]$/i)){const $=((B=u.match(/^\[img:\s*(.+)\]$/i))==null?void 0:B[1])||"",P=u.match(/(\d+):(\d+)/),L=P?parseInt(P[1])/parseInt(P[2]):16/9,Y=Math.round(y/L);t.push({id:`wf-${c}`,type:"image",label:$,x:b,y:r,width:y,height:Math.min(Y,200)}),r+=Math.min(Y,200)+15;return}if(u.match(/^\[video[:\s]?.*\]$/i)){const $=((z=u.match(/^\[video:\s*(.+)\]$/i))==null?void 0:z[1])||"";t.push({id:`wf-${c}`,type:"video",label:$,x:b,y:r,width:y,height:180}),r+=195;return}if(u.match(/^\[map[:\s]?.*\]$/i)){const $=((D=u.match(/^\[map:\s*(.+)\]$/i))==null?void 0:D[1])||"";t.push({id:`wf-${c}`,type:"map",label:$,x:b,y:r,width:y,height:160}),r+=175;return}if(u.match(/^\[chart[:\s]?.*\]$/i)){const $=((U=u.match(/^\[chart:\s*(.+)\]$/i))==null?void 0:U[1])||"bar";t.push({id:`wf-${c}`,type:"chart",chartType:$,x:b,y:r,width:y,height:150}),r+=165;return}if(u.match(/^\[calendar\]$/i)){t.push({id:`wf-${c}`,type:"calendar",x:b,y:r,width:Math.min(280,y),height:220}),r+=235;return}if(u.match(/^\|.+\|$/)){const $=u.slice(1,-1).split("|").map(L=>L.trim()),P=!t.some(L=>L.type==="table-row"&&L.y===r-36);t.push({id:`wf-${c}`,type:"table-row",cells:$,isHeader:P,x:b,y:r,width:y,height:36}),r+=36;return}if(u.match(/^[-\*]\s+(.+)$/)){const $=u.match(/^[-\*]\s+(.+)$/)[1];t.push({id:`wf-${c}`,type:"list-item",label:$,x:b,y:r}),r+=32;return}if(u.match(/^(\d+)[.)]\s+(.+)$/)){const $=u.match(/^(\d+)[.)]\s+(.+)$/);t.push({id:`wf-${c}`,type:"list-item-numbered",number:$[1],label:$[2],x:b,y:r}),r+=32;return}if(u.match(/^\{(\w+):?(.*)?\}$/)&&!u.match(/^\{.{15,}\}$/)){const $=u.match(/^\{(\w+):?(.*)?\}$/),P=$[1].toLowerCase(),L=$[2]||$[1];if(["badge","tag","success","warning","error","info","new","beta","pro"].includes(P)||$[2]){t.push({id:`wf-${c}`,type:"badge",variant:P,label:L,x:b,y:r}),r+=35;return}}if(u.match(/^\[([!iI])\]\s*(.+)$/)){const $=u.match(/^\[([!iI])\]\s*(.+)$/),P={"!":"error",i:"info",I:"info","":"success","":"error","":"warning"}[$[1]]||"info";t.push({id:`wf-${c}`,type:"alert",variant:P,label:$[2],x:b,y:r,width:y}),r+=55;return}if(u.match(/^\(\d+\)(---\(\d+\))+$/)||u.match(/^\[step:\s*(\d+)\/(\d+)\]$/i)){let $=1,P=3;const L=u.match(/^\[step:\s*(\d+)\/(\d+)\]$/i);L?($=parseInt(L[1]),P=parseInt(L[2])):(P=u.match(/\((\d+)\)/g).length,$=1),t.push({id:`wf-${c}`,type:"stepper",current:$,total:P,x:b,y:r,width:y}),r+=50;return}if(u.match(/^\[<.*>\]$/)||u.match(/^\[page:\s*(\d+)\/(\d+)\]$/i)){let $=1,P=5;const L=u.match(/^\[page:\s*(\d+)\/(\d+)\]$/i);L&&($=parseInt(L[1]),P=parseInt(L[2])),t.push({id:`wf-${c}`,type:"pagination",current:$,total:P,x:b,y:r,width:y}),r+=45;return}if(u==="[~~~]"||u.toLowerCase()==="[skeleton]"){t.push({id:`wf-${c}`,type:"skeleton",x:b,y:r,width:y,height:20}),r+=30;return}if(u.match(/^\["""\s*(.*)\]$/)||u.toLowerCase()==="[textarea]"){const $=((N=u.match(/^\["""\s*(.*)\]$/))==null?void 0:N[1])||"";t.push({id:`wf-${c}`,type:"textarea",label:$,x:b,y:r,width:y,height:80}),r+=95;return}if(u.match(/^\[~(.+)~\]$/)){t.push({id:`wf-${c}`,type:"button",variant:"secondary",label:u.match(/^\[~(.+)~\]$/)[1],x:b,y:r,width:120,height:36}),r+=48;return}if(u.match(/^\[--(.+)--\]$/)){t.push({id:`wf-${c}`,type:"button",variant:"ghost",label:u.match(/^\[--(.+)--\]$/)[1],x:b,y:r,width:120,height:36}),r+=48;return}if(u.match(/^\[!!(.+)!!\]$/)){t.push({id:`wf-${c}`,type:"button",variant:"danger",label:u.match(/^\[!!(.+)!!\]$/)[1],x:b,y:r,width:120,height:36}),r+=48;return}if(u.match(/^\[icon:(\w+)\]$/i)){const $=u.match(/^\[icon:(\w+)\]$/i)[1];t.push({id:`wf-${c}`,type:"icon-button",icon:$,x:b,y:r}),r+=45;return}if(u.match(/^---\s*(.+)\s*---$/)||u.match(/^===\s*(.+)\s*===$/)){const $=u.match(/^[-=]{3}\s*(.+)\s*[-=]{3}$/)[1];t.push({id:`wf-${c}`,type:"divider-label",label:$,x:b,y:r,width:y}),r+=30;return}if(u.match(/^\[[\*]+\]$/)){const $=u.slice(1,-1),P=($.match(/[\*]/g)||[]).length,L=$.length;t.push({id:`wf-${c}`,type:"rating",filled:P,total:L,x:b,y:r}),r+=35;return}if(u.match(/^(<\w+>\s*)+$/)){const $=u.match(/<(\w+)>/g).map(P=>P.slice(1,-1));t.push({id:`wf-${c}`,type:"chip-group",tags:$,x:b,y:r}),r+=40;return}if(u==="[?]"||u==="(?)"){t.push({id:`wf-${c}`,type:"tooltip",x:b,y:r}),r+=30;return}if(u.match(/^\[.+\](\s+\[.+\])+$/)&&!u.includes("|")){const $=u.match(/\[([^\]]+)\]/g).map(P=>P.slice(1,-1));t.push({id:`wf-${c}`,type:"button-row",buttons:$,x:b,y:r,width:y}),r+=50;return}if(u.match(/^@\w+\s+.+/)||u.match(/^@\w+:\s*.+/)){const $=u.match(/^@(\w+):?\s*(.+)$/);if($){t.push({id:`wf-${c}`,type:"feed-item",username:$[1],text:$[2],x:b,y:r,width:y}),r+=38;return}}if(u.match(/^[]\s*@\w+/)){const $=u.match(/^([])\s*@(\w+)\s*(.+)$/);if($){t.push({id:`wf-${c}`,type:"win-notification",emoji:$[1],username:$[2],text:$[3],x:b,y:r,width:y}),r+=44;return}}if(u.match(/^[].+[]/)){t.push({id:`wf-${c}`,type:"social-stats",text:u,x:b,y:r,width:y}),r+=40;return}if(u.match(/^_{3,}$/)){r+=20;return}if(u.match(/^\[hero:\s*(.+)\]$/i)){const $=u.match(/^\[hero:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"hero",title:$[0],subtitle:$[1]||"",cta:$[2]||"Get Started",x:b,y:r,width:y,height:280}),r+=300;return}if(u.match(/^\[pricing:\s*(.+)\]$/i)){const $=u.match(/^\[pricing:\s*(.+)\]$/i)[1].split("|").map(L=>L.trim()),P=$[2]?$[2].split(",").map(L=>L.trim()):[];t.push({id:`wf-${c}`,type:"pricing-card",plan:$[0],price:$[1]||"$0",features:P,cta:$[3]||"Choose Plan",x:b,y:r,width:Math.min(280,y),height:320}),r+=340;return}if(u.match(/^\[feature:\s*(.+)\]$/i)){const $=u.match(/^\[feature:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"feature-card",icon:$[0]||"",title:$[1]||"Feature",description:$[2]||"",x:b,y:r,width:Math.min(300,y),height:160}),r+=180;return}if(u.match(/^\[stat:\s*(.+)\]$/i)){const $=u.match(/^\[stat:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"stat-widget",value:$[0],label:$[1]||"",trend:$[2]||"",x:b,y:r,width:Math.min(200,y),height:140}),r+=160;return}if(u.match(/^\[login-form[:\s]*(.*)?\]$/i)){const $=((H=u.match(/^\[login-form:\s*(.+)\]$/i))==null?void 0:H[1])||"Sign In";t.push({id:`wf-${c}`,type:"login-form",title:$,x:b,y:r,width:Math.min(360,y),height:420}),r+=440;return}if(u.match(/^\[signup-form[:\s]*(.*)?\]$/i)){const $=((ee=u.match(/^\[signup-form:\s*(.+)\]$/i))==null?void 0:ee[1])||"Create Account";t.push({id:`wf-${c}`,type:"signup-form",title:$,x:b,y:r,width:Math.min(360,y),height:480}),r+=500;return}if(u.match(/^\[widget:\s*(.+)\]$/i)){const $=u.match(/^\[widget:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"dashboard-widget",title:$[0],value:$[1]||"",icon:$[2]||"",x:b,y:r,width:Math.min(200,y),height:120}),r+=140;return}if(u.match(/^\[bottom-nav:\s*(.+)\]$/i)){const $=u.match(/^\[bottom-nav:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"bottom-nav",items:$,x:b,y:r,width:y,height:64}),r+=80;return}if(u.match(/^\[app-bar:\s*(.+)\]$/i)){const $=u.match(/^\[app-bar:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"app-bar",title:$[0],actions:$.slice(1),x:b,y:r,width:y,height:56}),r+=70;return}if(u.match(/^\[fab:\s*(.+)\]$/i)){const $=u.match(/^\[fab:\s*(.+)\]$/i)[1];t.push({id:`wf-${c}`,type:"fab",icon:$,x:b+y-70,y:r,width:56,height:56}),r+=70;return}if(u.match(/^\[toast:\s*(.+)\]$/i)){const $=u.match(/^\[toast:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"toast",message:$[0],variant:$[1]||"info",x:b,y:r,width:Math.min(400,y),height:56}),r+=70;return}if(u.match(/^\[empty:\s*(.+)\]$/i)){const $=u.match(/^\[empty:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"empty-state",title:$[0],description:$[1]||"",cta:$[2]||"",x:b,y:r,width:y,height:240}),r+=260;return}if(u.match(/^\[error:\s*(.+)\]$/i)){const $=u.match(/^\[error:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"error-state",title:$[0],description:$[1]||"",cta:$[2]||"Retry",x:b,y:r,width:y,height:240}),r+=260;return}if(u.match(/^\[loading[:\s]*(.*)?\]$/i)){const $=((ne=u.match(/^\[loading:\s*(.+)\]$/i))==null?void 0:ne[1])||"Loading...";t.push({id:`wf-${c}`,type:"loading-state",text:$,x:b,y:r,width:y,height:120}),r+=140;return}if(u.match(/^\[testimonial:\s*(.+)\]$/i)){const $=u.match(/^\[testimonial:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"testimonial",quote:(J=$[0])==null?void 0:J.replace(/^["']|["']$/g,""),name:$[1]||"John Doe",title:$[2]||"",x:b,y:r,width:Math.min(400,y),height:200}),r+=220;return}if(u.match(/^\[footer:\s*(.+)\]$/i)){const $=u.match(/^\[footer:\s*(.+)\]$/i)[1],P=$.includes("::")?$.split("::").map(L=>L.split("|").map(Y=>Y.trim())):[$.split("|").map(L=>L.trim())];t.push({id:`wf-${c}`,type:"footer",sections:P,copyright:"",x:b,y:r,width:y,height:140}),r+=160;return}if(u.match(/^\[social:\s*(.+)\]$/i)){const $=u.match(/^\[social:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"social-links",links:$,x:b,y:r,width:y,height:48}),r+=60;return}if(u.match(/^\[cta:\s*(.+)\]$/i)){const $=u.match(/^\[cta:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"cta-section",title:$[0],description:$[1]||"",cta:$[2]||"Get Started",x:b,y:r,width:y,height:180}),r+=200;return}if(u.match(/^\[profile:\s*(.+)\]$/i)){const $=u.match(/^\[profile:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"profile-card",name:$[0],username:$[1]||"",bio:$[2]||"",x:b,y:r,width:Math.min(300,y),height:280}),r+=300;return}if(u.match(/^\[activity:\s*(.+)\]$/i)){const $=u.match(/^\[activity:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"activity-item",text:$[0],time:$[1]||"Just now",x:b,y:r,width:y,height:60}),r+=70;return}if(u.match(/^\[comment:\s*(.+)\]$/i)){const $=u.match(/^\[comment:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"comment",username:$[0],text:$[1]||"",time:$[2]||"",x:b,y:r,width:y,height:100}),r+=115;return}if(u.match(/^\[code[:\s]*(.*)?\]$/i)){const $=((ie=u.match(/^\[code:\s*(.+)\]$/i))==null?void 0:ie[1])||"javascript";t.push({id:`wf-${c}`,type:"code-block",language:$,x:b,y:r,width:y,height:160}),r+=180;return}if(u.match(/^\[upload[:\s]*(.*)?\]$/i)){const $=((F=u.match(/^\[upload:\s*(.+)\]$/i))==null?void 0:F[1])||"Drag and drop files here";t.push({id:`wf-${c}`,type:"upload",label:$,x:b,y:r,width:y,height:160}),r+=180;return}if(u.match(/^\[accordion:\s*(.+)\]$/i)){const $=u.match(/^\[accordion:\s*(.+)\]$/i)[1].split("|").map(P=>P.trim());t.push({id:`wf-${c}`,type:"accordion",items:$,x:b,y:r,width:y,height:60+$.length*50}),r+=80+$.length*50;return}if(u.match(/^\[data-table:\s*(\d+)?\s*rows?\]$/i)){const $=parseInt(((_=u.match(/^\[data-table:\s*(\d+)/i))==null?void 0:_[1])||"3");t.push({id:`wf-${c}`,type:"data-table",rows:$,x:b,y:r,width:y,height:52+$*52}),r+=72+$*52;return}if(u.match(/^\[(user|bot|assistant|chatgpt|ai|me|you|system):\s*(.+)\]$/i)){const $=u.match(/^\[(\w+):\s*(.+)\]$/i),P=$[1],L=$[2],Y=/user|me|you/i.test(P);t.push({id:`wf-${c}`,type:"chat-message",sender:P,message:L,isUser:Y,x:b,y:r,width:y}),r+=60;return}if(u.match(/^\[([^\]:]+)\]$/)&&!u.match(/^\[_{2,}\]$/)&&!u.match(/^\[(x| )\]/i)&&!u.match(/^\[v\s/)){t.push({id:`wf-${c}`,type:"button",variant:"primary",label:u.slice(1,-1),x:b,y:r,width:120,height:36}),r+=48;return}if(u.match(/^\[_{2,}\]$/)||u.match(/^"(.+)"$/)){t.push({id:`wf-${c}`,type:"input",label:((q=u.match(/^"(.+)"$/))==null?void 0:q[1])||"",x:b,y:r,width:y,height:36}),r+=48;return}const k=u.match(/^\[(x| )\]\s*(.+)$/i);if(k){t.push({id:`wf-${c}`,type:"checkbox",checked:k[1].toLowerCase()==="x",label:k[2],x:b,y:r}),r+=35;return}if(u==="---"||u==="==="){t.push({id:`wf-${c}`,type:"separator",x:b,y:r,width:y,height:2}),r+=15;return}if(u){const $=u.startsWith("# "),P=u.startsWith("## "),L=u.startsWith("### "),Y=u.startsWith("**")&&u.endsWith("**");let X=u,K="body";$?(X=u.slice(2),K="h1"):P?(X=u.slice(3),K="h2"):L?(X=u.slice(4),K="h3"):Y&&(X=u.slice(2,-2),K="bold"),t.push({id:`wf-${c}`,type:"text",label:X,textType:K,x:b,y:r}),r+=K==="h1"?45:K==="h2"?38:K==="h3"?32:K==="bold"?30:26}});a.length>0;){const m=a.pop();m.height=r-m.startY+15}return{elements:t,totalHeight:r+40}},classDiagram:i=>{const t=[],r=[];let n=null;return i.split(`
`).forEach(a=>{var d;if(a=a.trim(),!a||a.startsWith("#"))return;const s=a.match(/^class\s+(\w+)/i);if(s){n&&t.push(n),n={id:s[1],name:s[1],properties:[],methods:[]};return}const e=a.match(/^(\w+)\s*(--|>|--\*|-->|--)\s*(\w+)(?:\s*:\s*(.+))?$/);if(e){const p=e[2]==="--|>"?"extends":e[2]==="--*"?"composition":"association";r.push({from:e[1],to:e[3],type:p,label:((d=e[4])==null?void 0:d.trim())||""});return}const l=a.match(/^([+\-#~])?\s*(\w+)\s*:\s*(.+)$/);if(l&&n){n.properties.push({visibility:l[1]||"+",name:l[2],type:l[3]});return}const h=a.match(/^([+\-#~])?\s*(\w+)\s*\(([^)]*)\)\s*(?::\s*(.+))?$/);h&&n&&n.methods.push({visibility:h[1]||"+",name:h[2],params:h[3],returns:h[4]||"void"})}),n&&t.push(n),{classes:t,relationships:r}},activity:i=>{const t=new Map,r=[],n=[],a=i.split(`
`).map(f=>f.trim()).filter(f=>f&&!f.startsWith("#"));if(a.forEach(f=>{if(f.match(/^[^<:\[].+?\s*->\s*.+$/))return;let x="action",g=f,m=f;f==="[start]"||f==="start"?(x="start",g="start",m=""):f==="[end]"||f==="end"?(x="end",g="end",m=""):f.match(/^<(.+)>$/)?(x="decision",g=f.match(/^<(.+)>$/)[1],m=g):f.match(/^:(.+);?$/)&&(g=f.match(/^:(.+);?$/)[1],m=g);const c=g.toLowerCase().replace(/[^a-z0-9]/g,"_");t.has(c)||(t.set(c,{id:c,type:x,label:m,x:0,y:0}),n.push(c))}),a.forEach(f=>{var g;const x=f.match(/^(.+?)\s*->\s*(.+?)(?::\s*(.+))?$/);if(x){const m=x[1].replace(/^[<:\[]|[>;>\]]$/g,"").trim(),c=x[2].replace(/^[<:\[]|[>;>\]]$/g,"").trim(),u=((g=x[3])==null?void 0:g.trim())||"",b=m.toLowerCase().replace(/[^a-z0-9]/g,"_"),y=c.toLowerCase().replace(/[^a-z0-9]/g,"_");t.has(b)&&t.has(y)&&r.push({id:`ae-${r.length}`,source:b,target:y,label:u})}}),r.length===0&&n.length>1)for(let f=0;f<n.length-1;f++)r.push({id:`ae-${f}`,source:n[f],target:n[f+1]});const s=new Map,e=new Map;r.forEach(f=>{s.has(f.source)||s.set(f.source,[]),s.get(f.source).push(f.target),e.has(f.target)||e.set(f.target,[]),e.get(f.target).push(f.source)});const l=new Set,h=(f,x,g)=>{if(l.has(f)||!t.has(f))return;const m=t.get(f);m.x=x,m.y=g,l.add(f);const c=s.get(f)||[];c.length===1?h(c[0],x,g+120):c.length>=2&&c.forEach((b,y)=>{const S=y===0?-100:y===1?100:(y-.5)*200;h(b,x+S,g+120)})},d=n.find(f=>{var x;return((x=t.get(f))==null?void 0:x.type)==="start"})||n[0];d&&h(d,400,80);let p=80;return n.forEach(f=>{if(!l.has(f)){const x=t.get(f);x.x=650,x.y=p,p+=120,l.add(f)}}),{nodes:Array.from(t.values()),edges:r}},useCase:i=>{const t=[],r=[],n=[];return i.split(`
`).forEach(a=>{if(a=a.trim(),!a||a.startsWith("#"))return;if(a.match(/^actor\s+/i)){t.push({id:`actor-${t.length}`,label:a.replace(/^actor\s+/i,"").trim()});return}if(a.startsWith("(")||a.match(/^usecase\s+/i)){r.push({id:`uc-${r.length}`,label:a.replace(/^usecase\s+/i,"").replace(/[()]/g,"").trim()});return}const s=a.match(/^(.+?)\s*->\s*(.+)$/);s&&n.push({from:s[1].trim(),to:s[2].trim()})}),{actors:t,useCases:r,relationships:n}},component:i=>{const t=[],r=[];return i.split(`
`).forEach(n=>{if(n=n.trim(),!n||n.startsWith("#"))return;const a=n.match(/^\[(\w+)\]\s*(.+)$/);if(a){t.push({id:`comp-${t.length}`,label:a[2].trim(),type:a[1]});return}const s=n.match(/^(.+?)\s*(-->|--)\s*(.+)$/);s&&r.push({from:s[1].trim(),to:s[3].trim()})}),{components:t,connections:r}},c4:i=>{const t=[],r=[],n=[],a=[];let s=0;return i.split(`
`).forEach((e,l)=>{var f,x;if(e=e.trim(),!e||e.startsWith("#"))return;const h=e.match(/^(?:boundary|group)\s+["']([^"']+)["']\s*\{?\s*$/i);if(h){const g={id:`boundary-${s++}`,name:h[1].trim(),elements:[],parent:a.length>0?a[a.length-1].id:null};n.push(g),a.push(g);return}if(e==="}"&&a.length>0){a.pop();return}const d=e.match(/^\[(\w+)\]\s*(.+?)(?::\s*(.+))?$/);if(d){const g={id:`c4-${l}`,type:d[1].toLowerCase(),label:d[2].trim(),description:((f=d[3])==null?void 0:f.trim())||"",boundary:a.length>0?a[a.length-1].id:null};t.push(g),a.length>0&&a[a.length-1].elements.push(g.id);return}const p=e.match(/^(.+?)\s*->\s*(.+?)(?::\s*(.+))?$/);p&&r.push({from:p[1].trim(),to:p[2].trim(),label:((x=p[3])==null?void 0:x.trim())||""})}),{elements:t,relationships:r,boundaries:n}},requirement:i=>{const t=[],r=[];let n=null;return i.split(`
`).forEach((a,s)=>{var h;if(a=a.trim(),!a||a.startsWith("#"))return;const e=a.match(/^requirement\s+(.+?)(?:\s*{)?$/i);if(e){n&&t.push(n),n={id:`req-${s}`,name:e[1].trim(),text:"",risk:"",priority:""};return}const l=a.match(/^(.+?)\s*->\s*(.+?)(?::\s*(.+))?$/);if(l&&!n){r.push({from:l[1].trim(),to:l[2].trim(),label:((h=l[3])==null?void 0:h.trim())||""});return}n&&(a.startsWith("text:")?n.text=a.replace("text:","").trim():a.startsWith("risk:")?n.risk=a.replace("risk:","").trim():a.startsWith("priority:")?n.priority=a.replace("priority:","").trim():a==="}"&&(t.push(n),n=null))}),n&&t.push(n),{requirements:t,traces:r}},sankey:i=>{const t=new Map,r=[];i.split(`
`).forEach((m,c)=>{if(m=m.trim(),!m||m.startsWith("#"))return;const u=m.match(/^(.+?)\s*->\s*(.+?)(?::\s*(\d+(?:\.\d+)?))?$/);if(u){const b=u[1].trim(),y=u[2].trim(),S=parseFloat(u[3])||10,w=b.toLowerCase().replace(/[^a-z0-9]/g,"_"),k=y.toLowerCase().replace(/[^a-z0-9]/g,"_");t.has(w)||t.set(w,{id:w,label:b}),t.has(k)||t.set(k,{id:k,label:y}),r.push({id:`link-${c}`,source:w,target:k,value:S})}});const n=Array.from(t.values()),a=new Map,s=new Map;r.forEach(m=>{a.has(m.source)||a.set(m.source,[]),a.get(m.source).push(m.target),s.has(m.target)||s.set(m.target,[]),s.get(m.target).push(m.source)});const e=new Map,l=(m,c)=>{const u=e.get(m);u!==void 0&&u>=c||(e.set(m,c),(a.get(m)||[]).forEach(b=>l(b,c+1)))};n.filter(m=>!s.has(m.id)||s.get(m.id).length===0).forEach(m=>l(m.id,0)),n.forEach(m=>{e.has(m.id)||e.set(m.id,0)});const h=Math.max(...e.values(),0),d=new Map;n.forEach(m=>{const c=e.get(m.id)||0;d.has(c)||d.set(c,[]),d.get(c).push(m)}),n.forEach(m=>{const c=r.filter(b=>b.source===m.id).reduce((b,y)=>b+y.value,0),u=r.filter(b=>b.target===m.id).reduce((b,y)=>b+y.value,0);m.value=Math.max(c,u,10)});const p=800,f=500,x=60,g=(p-x*2)/(h+1||1);for(let m=0;m<=h;m++){const c=d.get(m)||[],u=c.reduce((y,S)=>y+Math.max(30,S.value*2),0)+(c.length-1)*20;let b=(f-u)/2;c.forEach(y=>{y.x=x+m*g,y.y=b,y.height=Math.max(30,y.value*2),y.layer=m,b+=y.height+20})}return r.forEach(m=>{const c=t.get(m.source),u=t.get(m.target);c&&u&&(m.sourceY=c.y+c.height/2,m.targetY=u.y+u.height/2,m.thickness=Math.max(4,m.value*1.5))}),{nodes:n,links:r}},swimlane:i=>{const t=[],r=[],n=[];let a=null,s=0;i.split(`
`).forEach(f=>{if(f=f.trim(),!f||f.startsWith("#"))return;const x=f.match(/^\[(.+?)\]$/)||f.match(/^lane:\s*(.+)$/i);if(x){a={id:`lane-${t.length}`,name:x[1].trim(),nodes:[]},t.push(a);return}const g=f.match(/^\((\w+)\)\s*(.+?)(?:\s*->\s*(.+))?$/)||f.match(/^(.+?)\s*->\s*(.+)$/);if(g){let m,c,u;g[1]&&g[2]&&f.startsWith("(")?(m=g[1].toLowerCase(),c=g[2].trim(),u=g[3]):(m="process",c=g[1].trim(),u=g[2]);const b={start:"start",end:"end",decision:"diamond",diamond:"diamond",process:"rect",task:"rect",rect:"rect",action:"rect",document:"document",doc:"document",data:"parallelogram",io:"parallelogram"},y=`n${s++}`,S={id:y,label:c,type:b[m]||"rect",lane:(a==null?void 0:a.id)||null};r.push(S),a&&a.nodes.push(y),u&&u.split(",").map(k=>k.trim()).forEach(k=>{const j=k.match(/^(.+?):\s*(.+)$/),C=j?j[1].trim():k,E=j?j[2].trim():"";n.push({id:`e${n.length}`,source:y,targetLabel:C,label:E})})}else if(a&&f){const m=f.match(/^\((\w+)\)\s*(.+)$/)||[null,"process",f],c=m[1]||"process",u=m[2]||f,b={start:"start",end:"end",decision:"diamond",diamond:"diamond",process:"rect",task:"rect",rect:"rect",action:"rect"},y=`n${s++}`;r.push({id:y,label:u,type:b[c.toLowerCase()]||"rect",lane:a.id}),a.nodes.push(y)}}),n.forEach(f=>{const x=r.find(g=>g.label.toLowerCase()===f.targetLabel.toLowerCase());x&&(f.target=x.id)});const e=n.filter(f=>f.target),l=120,h=140,d=50;t.forEach((f,x)=>{f.y=x*l,f.height=l,r.filter(m=>m.lane===f.id).forEach((m,c)=>{m.x=180+c*(h+60),m.y=f.y+(l-d)/2,m.width=h,m.height=d})});const p=r.filter(f=>!f.lane);if(p.length>0){const f={id:"default",name:"General",nodes:[],y:t.length*l,height:l};t.push(f),p.forEach((x,g)=>{x.lane="default",x.x=180+g*(h+60),x.y=f.y+(l-d)/2,x.width=h,x.height=d})}return{lanes:t,nodes:r,edges:e}}};function vg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:100,y:0}),[l,h]=M.useState(new Set),d=M.useMemo(()=>{const c=[],u=[],b=new Map,y=50,S=E=>Math.max(120,((E==null?void 0:E.length)||5)*9+50),w=(E,R)=>{var I;const T=S(E.label);b.set(R,Math.max(b.get(R)||0,T)),(I=E.children)!=null&&I.length&&!l.has(E.id)&&E.children.forEach(B=>w(B,R+1))},k=E=>{let R=0;for(let T=0;T<E;T++)R+=(b.get(T)||120)+y;return R},j=E=>{var R;return!((R=E.children)!=null&&R.length)||l.has(E.id)?38:E.children.reduce((T,I)=>T+j(I)+16,-16)},C=(E,R,T,I,B)=>{var ee,ne,J;const z=j(E),D=T+z/2,U=S(E.label),N=R===0?v.purple:B,H=k(R);if(c.push({id:E.id,label:E.label||"",defaultX:H,defaultY:D,width:U,level:R,color:N,hasChildren:((ee=E.children)==null?void 0:ee.length)>0,isCollapsed:l.has(E.id),childCount:((ne=E.children)==null?void 0:ne.length)||0}),I&&u.push({id:`e-${I}-${E.id}`,source:I,target:E.id,color:N}),(J=E.children)!=null&&J.length&&!l.has(E.id)){let ie=T;E.children.forEach((F,_)=>{C(F,R+1,ie,E.id,R===0?se[_%se.length]:B),ie+=j(F)+16})}};if(i!=null&&i.label&&(w(i,0),C(i,0,0,null,se[0]),c.length)){const E=Math.min(...c.map(T=>T.defaultY)),R=Math.max(...c.map(T=>T.defaultY));c.forEach(T=>{T.defaultY+=-(E+R)/2+300})}return{nodes:c,edges:u}},[i,l]),p=c=>e.getNodePosition(c.id,c.defaultX,c.defaultY),f=(c,u)=>{const b=p(c),y=p(u),S=b.x+c.width+5,w=b.y,k=y.x-5,j=y.y,C=k-S,E=Math.min(Math.abs(C)*.4,80);return`M ${S} ${w} C ${S+E} ${w}, ${k-E} ${j}, ${k} ${j}`},x=M.useCallback(()=>{const c=e.finishEditing();if(c.nodeId&&c.newValue&&n){const u=d.nodes.find(b=>b.id===c.nodeId);u&&u.label!==c.newValue&&n(c.nodeId,u.label,c.newValue)}},[e,d.nodes,n]);M.useEffect(()=>{const c=u=>{const y=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?u.metaKey:u.ctrlKey;if(!e.editingNode){if((u.key==="Delete"||u.key==="Backspace")&&e.selectedNodes.size>0&&a){u.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(y&&u.key.toLowerCase()==="c"&&e.selectedNodes.size>0){u.preventDefault(),e.copySelectedNodes(d.nodes);return}if(y&&u.key.toLowerCase()==="v"&&e.clipboard&&s){u.preventDefault();const S=e.pasteNodes();S&&s(S);return}}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[e,d.nodes,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const c=e.getNodesInSelectionBox(d.nodes.map(u=>({...u,x:u.defaultX,y:u.defaultY})),e.selectionBox);c.length>0&&e.setSelectedNodes(new Set(c))}},[e.isSelecting,e.selectionBox,d.nodes,e]);const g=M.useCallback(c=>{(c.target===e.canvasRef.current||c.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]),m=M.useCallback(c=>{h(u=>{const b=new Set(u);return b.has(c)?b.delete(c):b.add(c),b})},[]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:g,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${30*e.zoom}px ${30*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[d.edges.map(c=>{const u=d.nodes.find(w=>w.id===c.source),b=d.nodes.find(w=>w.id===c.target);if(!u||!b)return null;const y=f(u,b),S=r?he.stroke:c.color;return o.jsxs("g",{children:[!r&&o.jsx("path",{d:y,fill:"none",stroke:S,strokeWidth:6,strokeOpacity:.1,strokeLinecap:"round"}),!r&&o.jsx("path",{d:y,fill:"none",stroke:S,strokeWidth:3,strokeOpacity:.25,strokeLinecap:"round"}),o.jsx("path",{d:y,fill:"none",stroke:S,strokeWidth:r?2.5:2,strokeOpacity:r?1:.8,strokeLinecap:"round"})]},c.id)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:"rgba(124,58,237,0.1)",stroke:v.purple,strokeWidth:2,strokeDasharray:"5,5",style:{pointerEvents:"none"}})]})}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:d.nodes.map(c=>{const u=p(c),b=e.nodeColors[c.id]||c.color,y=e.dragging===c.id,S=e.selectedNodes.has(c.id),w=e.editingNode===c.id;return o.jsxs("div",{onMouseDown:k=>e.handleNodeMouseDown(k,c.id,u.x,u.y),onDoubleClick:k=>e.handleNodeDoubleClick(k,c.id,c.label),onContextMenu:k=>e.handleNodeContextMenu(k,c.id),style:{position:"absolute",left:u.x,top:u.y-19,width:c.width,height:38,background:r?he.fill:c.level===0?`linear-gradient(135deg, ${b}, ${b}dd)`:Ct(b),border:r?`2px solid ${he.stroke}`:`2px solid ${b}`,borderRadius:c.level===0?19:10,display:"flex",alignItems:"center",justifyContent:"center",cursor:y?"grabbing":"grab",boxShadow:He(b,y,S,r),transition:y?"none":"box-shadow 0.2s, background 0.2s",fontFamily:Qr(r)},children:[o.jsx(Ue,{isEditing:w,value:w?e.editValue:c.label,onChange:e.setEditValue,onFinish:x,onCancel:e.cancelEditing,style:{color:r?he.stroke:c.level===0?"#fff":t.textPrimary,fontSize:r?G2(c.level===0?14:13):c.level===0?14:13,fontWeight:c.level===0?700:500}}),c.hasChildren&&o.jsx("div",{onClick:k=>{k.stopPropagation(),m(c.id)},style:{position:"absolute",right:-28,width:24,height:24,borderRadius:"50%",background:b,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:16,fontWeight:700,cursor:"pointer"},children:c.isCollapsed?"+":""})]},c.id)})})]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(c=>Math.min(c*1.2,3)),onZoomOut:()=>e.setZoom(c=>Math.max(c*.8,.2)),onFit:()=>{},onReset:()=>{e.resetView(),h(new Set)},zoom:e.zoom,snapToGrid:e.snapToGrid,onToggleSnap:()=>e.setSnapToGrid(c=>!c)}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(124,58,237,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.selectedNodes.size," selected  C copy  V paste  Del remove"]}),e.clipboard&&e.clipboard.length>0&&e.selectedNodes.size===0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(16,185,129,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.clipboard.length," in clipboard  V to paste"]}),e.contextMenu&&o.jsx(Ke,{x:e.contextMenu.x,y:e.contextMenu.y,nodeId:e.contextMenu.nodeId,currentIcon:e.nodeIcons[e.contextMenu.nodeId],currentShape:e.nodeShapes[e.contextMenu.nodeId],onSelectColor:e.setNodeColor,onSelectIcon:e.setNodeIcon,onSelectShape:e.setNodeShape,onClose:e.closeContextMenu,theme:t})]})}function wg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:0,y:30}),{nodes:l=[],edges:h=[],groups:d=[]}=i,p=u=>e.getNodePosition(u.id,u.x,u.y),f=u=>u.shape==="cylinder"||["database","cache","storage","db","redis","s3","blob"].includes(u.type)?"cylinder":u.shape==="hexagon"||["gateway","loadbalancer","lb","api","proxy","cdn","firewall"].includes(u.type)?"hexagon":"rect",x=M.useMemo(()=>{if(!l||l.length===0)return{x:0,y:0,width:800,height:600};const u=150,b=90,y=l.map(R=>{var I;return((I=e.nodePositions)==null?void 0:I[R.id])||{x:R.x||0,y:R.y||0}});if(y.length===0)return{x:0,y:0,width:800,height:600};const S=y.map(R=>R.x),w=y.map(R=>R.y),k=Math.min(...S)-u,j=Math.max(...S)+u,C=Math.min(...w)-b,E=Math.max(...w)+b;return{x:k,y:C,width:j-k,height:E-C}},[l,e.nodePositions]),g=u=>{switch(u.style||"normal"){case"dotted":return{strokeDasharray:"4,4",strokeWidth:2};case"dashed":return{strokeDasharray:"8,4",strokeWidth:2};case"thick":return{strokeDasharray:"none",strokeWidth:4};case"async":return{strokeDasharray:"2,2",strokeWidth:2};default:return{strokeDasharray:"6,4",strokeWidth:2}}},m=M.useCallback(()=>{const u=e.finishEditing();if(u.nodeId&&u.newValue&&n){const b=l.find(y=>y.id===u.nodeId);b&&b.label!==u.newValue&&n(u.nodeId,b.label,u.newValue)}},[e,l,n]);M.useEffect(()=>{const u=b=>{const S=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?b.metaKey:b.ctrlKey;if(!e.editingNode){if((b.key==="Delete"||b.key==="Backspace")&&e.selectedNodes.size>0&&a){b.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(S&&b.key.toLowerCase()==="c"&&e.selectedNodes.size>0){b.preventDefault(),e.copySelectedNodes(l);return}if(S&&b.key.toLowerCase()==="v"&&e.clipboard&&s){b.preventDefault();const w=e.pasteNodes();w&&s(w);return}}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[e,l,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const u=e.getNodesInSelectionBox(l,e.selectionBox);u.length>0&&e.setSelectedNodes(new Set(u))}},[e.isSelecting,e.selectionBox,l,e]);const c=M.useCallback(u=>{(u.target===e.canvasRef.current||u.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:c,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsxs("defs",{children:[o.jsx("marker",{id:"arch-arr",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.purple})}),o.jsx("marker",{id:"arch-arr-thick",markerWidth:"12",markerHeight:"10",refX:"11",refY:"5",orient:"auto",children:o.jsx("polygon",{points:"0 0, 12 5, 0 10",fill:v.purple})})]}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[d.map(u=>o.jsxs("g",{children:[o.jsx("rect",{x:u.x,y:u.y,width:u.width,height:u.height,fill:`${u.color}08`,stroke:u.color,strokeWidth:2,strokeDasharray:"8,4",rx:12,opacity:.8}),o.jsx("text",{x:u.x+16,y:u.y+24,fill:u.color,fontSize:"14",fontWeight:"600",fontFamily:"system-ui",children:u.name})]},u.id)),h.map(u=>{const b=l.find(H=>H.id===u.source),y=l.find(H=>H.id===u.target);if(!b||!y)return null;const S=p(b),w=p(y),k=w.x-S.x,j=w.y-S.y,C=Math.sqrt(k*k+j*j)||1,E=S.x+k/C*55,R=S.y+j/C*45,T=w.x-k/C*55,I=w.y-j/C*45,B=(E+T)/2,z=(R+I)/2,D=r?yg(E,R,T,I,!0):tr(E,R,T,I),U=r?he.stroke:v.purple,N=g(u);return o.jsxs("g",{children:[!r&&o.jsx("path",{d:D,fill:"none",stroke:U,strokeWidth:N.strokeWidth*4,strokeOpacity:.08,strokeLinecap:"round"}),!r&&o.jsx("path",{d:D,fill:"none",stroke:U,strokeWidth:N.strokeWidth*2,strokeOpacity:.2,strokeLinecap:"round"}),o.jsx("path",{d:D,fill:"none",stroke:U,strokeWidth:r?2.5:N.strokeWidth,strokeDasharray:N.strokeDasharray,markerEnd:r?"":u.style==="thick"?"url(#arch-arr-thick)":"url(#arch-arr)",opacity:r?1:.8,strokeLinecap:"round"}),u.label&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:B-Math.max(u.label.length*4,40),y:z-10,width:Math.max(u.label.length*8,80),height:20,rx:4,fill:"rgba(15,23,42,0.9)",stroke:v.purple,strokeWidth:1,opacity:.9}),o.jsx("text",{x:B,y:z+4,textAnchor:"middle",fill:t.textPrimary,fontSize:"10",fontFamily:"system-ui",fontWeight:"500",children:u.label})]})]},u.id)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:"rgba(124,58,237,0.1)",stroke:v.purple,strokeWidth:2,strokeDasharray:"5,5",style:{pointerEvents:"none"}})]})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:l.map(u=>{const b=p(u),y=f(u),S=e.nodeColors[u.id]||u.color,w=e.dragging===u.id,k=e.selectedNodes.has(u.id),j=e.editingNode===u.id,C=u.description&&u.description.length>0;let E={position:"absolute",left:b.x-65,top:b.y-37,width:130,height:C?90:75,background:Ct(S,r),border:r?`2px solid ${he.stroke}`:`2px solid ${S}`,borderRadius:12,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:w?"grabbing":"grab",boxShadow:He(S,w,k,r),transition:w?"none":"box-shadow 0.2s",fontFamily:Qr(r)};return y==="cylinder"&&(E.borderRadius="50% / 15%",E.height=C?100:85),y==="hexagon"&&(E.clipPath="polygon(10% 0%, 90% 0%, 100% 50%, 90% 100%, 10% 100%, 0% 50%)",E.width=145),o.jsxs("div",{onMouseDown:R=>e.handleNodeMouseDown(R,u.id,b.x,b.y),onDoubleClick:R=>e.handleNodeDoubleClick(R,u.id,u.label),onContextMenu:R=>e.handleNodeContextMenu(R,u.id),style:E,title:u.description||"",children:[o.jsx("div",{style:{fontSize:"1.5rem",marginBottom:2},children:e.nodeIcons[u.id]||u.icon}),o.jsx(Ue,{isEditing:j,value:j?e.editValue:u.label,onChange:e.setEditValue,onFinish:m,onCancel:e.cancelEditing,style:{fontSize:r?"1rem":"0.8rem",fontWeight:600,color:r?he.stroke:t.textPrimary,textAlign:"center"}}),C&&o.jsx("div",{style:{fontSize:"0.65rem",color:t.textSecondary,textAlign:"center",padding:"0 8px",marginTop:2,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:u.description})]},u.id)})})]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(u=>Math.min(u*1.2,2.5)),onZoomOut:()=>e.setZoom(u=>Math.max(u*.8,.3)),onFit:()=>e.fitToView(x),onReset:e.resetView,zoom:e.zoom,snapToGrid:e.snapToGrid,onToggleSnap:()=>e.setSnapToGrid(u=>!u)}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(124,58,237,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.selectedNodes.size," selected  C copy  V paste  Del remove"]}),e.clipboard&&e.clipboard.length>0&&e.selectedNodes.size===0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(16,185,129,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.clipboard.length," in clipboard  V to paste"]}),e.contextMenu&&o.jsx(Ke,{x:e.contextMenu.x,y:e.contextMenu.y,nodeId:e.contextMenu.nodeId,currentIcon:e.nodeIcons[e.contextMenu.nodeId],currentShape:e.nodeShapes[e.contextMenu.nodeId],onSelectColor:e.setNodeColor,onSelectIcon:e.setNodeIcon,onSelectShape:e.setNodeShape,onClose:e.closeContextMenu,theme:t})]})}function Sg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s,onLinkedTemplateClick:e}){if((i==null?void 0:i.format)==="sections")return o.jsx(Z2,{data:i,theme:t});const l=$e({x:50,y:50}),{nodes:h,edges:d}=i,p=m=>l.getNodePosition(m.id,m.x,m.y),f=M.useMemo(()=>{if(!h||h.length===0)return{x:0,y:0,width:400,height:300};const m=h.map(w=>w.x),c=h.map(w=>w.y),u=Math.min(...m)-100,b=Math.max(...m)+100,y=Math.min(...c)-80,S=Math.max(...c)+80;return{x:u,y,width:b-u,height:S-y}},[h]),x=M.useCallback(()=>{const m=l.finishEditing();if(m.nodeId&&m.newValue!==void 0&&n){const c=h.find(u=>u.id===m.nodeId);c&&c.label!==m.newValue&&n(m.nodeId,c.label,m.newValue)}},[l,h,n]);M.useEffect(()=>{const m=c=>{const b=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?c.metaKey:c.ctrlKey;if(!l.editingNode){if((c.key==="Delete"||c.key==="Backspace")&&l.selectedNodes.size>0&&a){c.preventDefault(),a(Array.from(l.selectedNodes)),l.clearSelection();return}if(b&&c.key.toLowerCase()==="c"&&l.selectedNodes.size>0){c.preventDefault(),l.copySelectedNodes(h);return}if(b&&c.key.toLowerCase()==="v"&&l.clipboard&&s){c.preventDefault();const y=l.pasteNodes();y&&s(y);return}}};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[l,h,a,s]),M.useEffect(()=>{if(!l.isSelecting&&l.selectionBox){const m=l.getNodesInSelectionBox(h,l.selectionBox);m.length>0&&l.setSelectedNodes(new Set(m))}},[l.isSelecting,l.selectionBox,h,l]);const g=M.useCallback(m=>{(m.target===l.canvasRef.current||m.target.classList.contains("canvas-bg"))&&(l.clearSelection(),l.closeContextMenu())},[l]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:l.canvasRef,className:"canvas-bg",onClick:g,onMouseDown:l.handleCanvasMouseDown,onMouseMove:l.handleMouseMove,onMouseUp:l.handleMouseUp,onMouseLeave:l.handleMouseUp,onTouchStart:l.handleTouchStart,onTouchMove:l.handleTouchMove,onTouchEnd:l.handleTouchEnd,onWheel:l.handleWheel,style:{width:"100%",height:"100%",cursor:l.isPanning||l.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*l.zoom}px ${25*l.zoom}px`,backgroundPosition:`${l.pan.x}px ${l.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:o.jsx("marker",{id:"journey-arrow",markerWidth:"6",markerHeight:"6",refX:"5",refY:"3",orient:"auto",children:o.jsx("path",{d:"M 0 0 L 6 3 L 0 6 Z",fill:v.purple,opacity:"0.9"})})}),o.jsxs("g",{transform:`translate(${l.pan.x}, ${l.pan.y}) scale(${l.zoom})`,children:[d.map(m=>{const c=h.find(ie=>ie.id===m.source),u=h.find(ie=>ie.id===m.target);if(!c||!u)return null;const b=p(c),y=p(u),S=y.x-b.x,w=y.y-b.y,k=c.shape==="circle"?50:70,j=c.shape==="circle"?50:45,C=u.shape==="circle"?50:70,E=u.shape==="circle"?50:45,R=Math.atan2(w,S),T=b.x+Math.cos(R)*k,I=b.y+Math.sin(R)*j,B=y.x-Math.cos(R)*C,z=y.y-Math.sin(R)*E,D=(T+B)/2,U=(I+z)/2,N=Math.min(Math.abs(w)*.3,30),H=D,ee=U-N,ne=`M ${T} ${I} Q ${H} ${ee} ${B} ${z}`,J=m.label?Math.max(m.label.length*7+16,50):0;return o.jsxs("g",{children:[o.jsx("path",{d:ne,fill:"none",stroke:v.purple,strokeWidth:8,strokeOpacity:.08,strokeLinecap:"round"}),o.jsx("path",{d:ne,fill:"none",stroke:v.purple,strokeWidth:4,strokeOpacity:.2,strokeLinecap:"round"}),o.jsx("path",{d:ne,fill:"none",stroke:v.purple,strokeWidth:2,markerEnd:"url(#journey-arrow)",strokeLinecap:"round",opacity:"0.8"}),o.jsx("path",{d:ne,fill:"none",stroke:"rgba(255,255,255,0.6)",strokeWidth:2,strokeLinecap:"round",strokeDasharray:"4,12",children:o.jsx("animate",{attributeName:"stroke-dashoffset",from:"16",to:"0",dur:"0.8s",repeatCount:"indefinite"})}),m.label&&o.jsxs("g",{children:[o.jsx("rect",{x:D-J/2,y:ee-10,width:J,height:20,rx:10,fill:"rgba(15, 23, 42, 0.9)",stroke:"rgba(124,58,237,0.5)",strokeWidth:1}),o.jsx("text",{x:D,y:ee+4,textAnchor:"middle",fill:"#e0e0e0",fontSize:10,fontWeight:"500",fontFamily:"system-ui, sans-serif",children:m.label})]})]},m.id)}),l.isSelecting&&l.selectionBox&&o.jsx("rect",{x:Math.min(l.selectionBox.startX,l.selectionBox.endX),y:Math.min(l.selectionBox.startY,l.selectionBox.endY),width:Math.abs(l.selectionBox.endX-l.selectionBox.startX),height:Math.abs(l.selectionBox.endY-l.selectionBox.startY),fill:`${v.blue}20`,stroke:v.blue,strokeWidth:1,strokeDasharray:"4,4"})]})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${l.pan.x}px, ${l.pan.y}px) scale(${l.zoom})`,transformOrigin:"0 0"},children:h.map(m=>{const c=p(m),u=l.dragging===m.id,b=l.selectedNodes.has(m.id);if(m.shape==="circle")return o.jsxs("div",{onClick:S=>l.handleNodeClick(S,m.id),onDoubleClick:S=>l.handleNodeDoubleClick(S,m.id,m.label),onContextMenu:S=>l.handleNodeContextMenu(S,m.id),onMouseDown:S=>l.handleNodeMouseDown(S,m.id,c.x,c.y),onTouchStart:S=>l.handleNodeTouchStart(S,m.id,c.x,c.y),style:{position:"absolute",left:c.x-50,top:c.y-50,width:100,height:100,borderRadius:"50%",background:Ct(m.color),border:`2px solid ${b?v.blue:m.color}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:u?"grabbing":"grab",boxShadow:He(m.color,u,b),transition:u?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("span",{style:{fontSize:24},children:m.icon}),l.editingNode===m.id?o.jsx(Ue,{value:l.editingValue,onChange:S=>l.setEditingValue(S),onFinish:x,style:{fontSize:r?14:12,fontWeight:600,color:r?he.stroke:t.textPrimary,marginTop:4}}):o.jsx("span",{style:{fontSize:r?14:12,fontWeight:600,color:r?he.stroke:t.textPrimary,marginTop:4},children:m.label})]},m.id);const y=S=>{m.linkedTemplate&&e?(S.stopPropagation(),e(m.linkedTemplate,m.label)):l.handleNodeClick(S,m.id)};return o.jsxs("div",{onClick:y,onDoubleClick:S=>m.linkedTemplate&&e?e(m.linkedTemplate,m.label):l.handleNodeDoubleClick(S,m.id,m.label),onContextMenu:S=>l.handleNodeContextMenu(S,m.id),onMouseDown:S=>l.handleNodeMouseDown(S,m.id,c.x,c.y),onTouchStart:S=>l.handleNodeTouchStart(S,m.id,c.x,c.y),style:{position:"absolute",left:c.x-70,top:c.y-45,width:140,height:90,background:Ct(m.color),border:`2px solid ${b?v.blue:m.linkedTemplate?v.cyan:m.color}`,borderRadius:12,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:m.linkedTemplate?"pointer":u?"grabbing":"grab",boxShadow:m.linkedTemplate?`${He(m.color,u,b)}, 0 0 0 3px ${v.cyan}30`:He(m.color,u,b),transition:u?"none":"box-shadow 0.2s",touchAction:"none"},children:[m.badge&&o.jsx("div",{style:{position:"absolute",top:-10,right:-10,background:v.red,color:"#fff",fontSize:10,fontWeight:600,padding:"3px 8px",borderRadius:10},children:m.badge}),m.linkedTemplate&&o.jsx("div",{style:{position:"absolute",top:-8,left:-8,background:v.cyan,color:"#fff",fontSize:10,fontWeight:600,padding:"2px 6px",borderRadius:6,display:"flex",alignItems:"center",gap:3},children:" Click to open"}),o.jsx("span",{style:{fontSize:22},children:m.icon}),l.editingNode===m.id?o.jsx(Ue,{value:l.editingValue,onChange:S=>l.setEditingValue(S),onFinish:x,style:{fontSize:r?14:11,fontWeight:600,color:r?he.stroke:t.textPrimary,marginTop:4}}):o.jsx("span",{style:{fontSize:r?14:11,fontWeight:600,color:r?he.stroke:t.textPrimary,marginTop:4},children:m.label})]},m.id)})})]}),l.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(0,0,0,0.8)",padding:"6px 12px",borderRadius:6,fontSize:"0.75rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{children:[l.selectedNodes.size," selected"]}),o.jsx("span",{style:{opacity:.6},children:"|"}),o.jsx("span",{style:{opacity:.7},children:"Del to delete  C copy  V paste"})]}),l.clipboard&&o.jsxs("div",{style:{position:"absolute",top:l.selectedNodes.size>0?48:12,left:12,background:`${v.green}20`,padding:"4px 10px",borderRadius:4,fontSize:"0.7rem",color:v.green,border:`1px solid ${v.green}40`},children:[l.clipboard.length," node",l.clipboard.length>1?"s":""," copied"]}),o.jsx(Re,{onZoomIn:()=>l.setZoom(m=>Math.min(m*1.2,3)),onZoomOut:()=>l.setZoom(m=>Math.max(m*.8,.2)),onFit:()=>l.fitToView(f),onReset:l.resetView,zoom:l.zoom}),l.contextMenu&&o.jsx(Ke,{position:l.contextMenu,onClose:()=>l.closeContextMenu(),nodeId:l.contextMenu.nodeId})]})}function Z2({data:i,theme:t=me.dark}){var m,c;const{title:r,actors:n,sections:a}=i,s=M.useRef(null),[e,l]=M.useState({width:1200,height:600}),h=M.useMemo(()=>{const u=[];return a.forEach((b,y)=>{b.tasks.forEach((S,w)=>{u.push({...S,section:b.name,sectionIndex:y,sectionColor:b.color})})}),u},[a]);M.useEffect(()=>{if(s.current){const u=s.current.getBoundingClientRect();l({width:Math.max(u.width,800),height:Math.max(u.height-80,400)})}},[]);const d=M.useMemo(()=>{const u={top:120,bottom:100,left:80,right:80},b=Math.max(e.width-u.left-u.right,h.length*150),y=e.height-u.top-u.bottom,S=b/Math.max(h.length-1,1),w=h.map((I,B)=>{const z=u.left+B*S,D=y*.2,U=Math.sin(B*.8)*D,H=u.top+y/2+U;return{...I,x:z,y:H,index:B}});let k="";if(w.length>0){k=`M ${w[0].x} ${w[0].y}`;for(let I=1;I<w.length;I++){const B=w[I-1],z=w[I],D=B.x+(z.x-B.x)*.5,U=B.x+(z.x-B.x)*.5;k+=` C ${D} ${B.y}, ${U} ${z.y}, ${z.x} ${z.y}`}}const j=w.map((I,B)=>{const z=u.top+50-(I.score-1)*12;return{x:I.x,y:z,score:I.score}});let C="";if(j.length>0){C=`M ${j[0].x} ${j[0].y}`;for(let I=1;I<j.length;I++){const B=j[I-1],z=j[I],D=B.x+(z.x-B.x)*.5;C+=` C ${D} ${B.y}, ${D} ${z.y}, ${z.x} ${z.y}`}}const E=[];let R=-1,T=0;return w.forEach((I,B)=>{I.sectionIndex!==R&&(R>=0&&E.push({index:R,start:T,end:I.x-S/2,color:a[R].color,name:a[R].name}),R=I.sectionIndex,T=B===0?u.left-40:I.x-S/2)}),R>=0&&E.push({index:R,start:T,end:u.left+b+40,color:a[R].color,name:a[R].name}),{nodes:w,pathString:k,emotionPathString:C,emotionPath:j,sectionBounds:E,padding:u,availableWidth:b}},[h,e,a]),p=u=>({1:"#ef4444",2:"#f97316",3:"#eab308",4:"#22c55e",5:"#10b981"})[u]||"#64748b",f=u=>{const b=u.toLowerCase();return b.includes("user")?v.pink:b.includes("system")?v.blue:b.includes("admin")?v.purple:v.cyan},x=u=>{const b=u.toLowerCase();return b.includes("user")?"":b.includes("system")?"":b.includes("admin")?"":""},g=d.padding.left+d.availableWidth+d.padding.right;return o.jsxs("div",{ref:s,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:`linear-gradient(180deg, ${t.canvasBg} 0%, rgba(15,23,42,1) 100%)`,borderRadius:12,border:`1px solid ${t.border}`},children:[r&&o.jsxs("div",{style:{position:"absolute",top:16,left:24,zIndex:10,display:"flex",alignItems:"center",gap:12},children:[o.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",boxShadow:"0 4px 20px rgba(139,92,246,0.4)"},children:""}),o.jsxs("div",{children:[o.jsx("h2",{style:{margin:0,fontSize:"1.1rem",fontWeight:700,color:t.textPrimary},children:r}),o.jsxs("p",{style:{margin:0,fontSize:"0.75rem",color:t.textSecondary},children:[h.length," steps across ",a.length," phases"]})]})]}),n.length>0&&o.jsx("div",{style:{position:"absolute",top:16,right:24,zIndex:10,display:"flex",gap:8},children:n.map((u,b)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 14px",borderRadius:20,background:`${f(u.name)}15`,border:`1px solid ${f(u.name)}40`,backdropFilter:"blur(8px)"},children:[o.jsx("span",{style:{fontSize:"0.9rem"},children:x(u.name)}),o.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:f(u.name)},children:u.name})]},b))}),o.jsx("div",{style:{width:"100%",height:"100%",overflowX:"auto",overflowY:"hidden"},children:o.jsxs("svg",{width:Math.max(g,e.width),height:e.height,style:{display:"block"},children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"pathGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:v.purple}),o.jsx("stop",{offset:"50%",stopColor:v.pink}),o.jsx("stop",{offset:"100%",stopColor:v.cyan})]}),o.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),d.sectionBounds.map((u,b)=>o.jsxs("linearGradient",{id:`sectionGrad${b}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:u.color,stopOpacity:"0.08"}),o.jsx("stop",{offset:"100%",stopColor:u.color,stopOpacity:"0.02"})]},b)),o.jsxs("linearGradient",{id:"emotionGrad",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#10b981"}),o.jsx("stop",{offset:"50%",stopColor:"#eab308"}),o.jsx("stop",{offset:"100%",stopColor:"#10b981"})]})]}),d.sectionBounds.map((u,b)=>o.jsxs("g",{children:[o.jsx("rect",{x:u.start,y:60,width:u.end-u.start,height:e.height-120,rx:16,fill:`url(#sectionGrad${b})`}),o.jsx("text",{x:u.start+(u.end-u.start)/2,y:85,textAnchor:"middle",fill:u.color,fontSize:"11",fontWeight:"600",fontFamily:"system-ui",opacity:"0.8",children:u.name.toUpperCase()}),o.jsx("circle",{cx:u.start+30,cy:85,r:12,fill:u.color,opacity:"0.9"}),o.jsx("text",{x:u.start+30,y:89,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"700",fontFamily:"system-ui",children:b+1})]},`section-${b}`)),o.jsxs("g",{children:[o.jsx("path",{d:d.emotionPathString+` L ${((m=d.emotionPath[d.emotionPath.length-1])==null?void 0:m.x)||0} ${d.padding.top+60} L ${((c=d.emotionPath[0])==null?void 0:c.x)||0} ${d.padding.top+60} Z`,fill:"url(#emotionGrad)",opacity:"0.1"}),o.jsx("path",{d:d.emotionPathString,fill:"none",stroke:"url(#emotionGrad)",strokeWidth:"2",strokeDasharray:"4,4",opacity:"0.6"}),d.emotionPath.map((u,b)=>o.jsx("circle",{cx:u.x,cy:u.y,r:4,fill:p(u.score),opacity:"0.8"},`emotion-${b}`)),o.jsx("text",{x:d.padding.left-45,y:d.padding.top+10,fill:t.textSecondary,fontSize:"9",fontFamily:"system-ui",children:" Great"}),o.jsx("text",{x:d.padding.left-45,y:d.padding.top+58,fill:t.textSecondary,fontSize:"9",fontFamily:"system-ui",children:" Poor"})]}),o.jsx("path",{d:d.pathString,fill:"none",stroke:"url(#pathGradient)",strokeWidth:"6",strokeLinecap:"round",opacity:"0.2",filter:"url(#glow)"}),o.jsx("path",{d:d.pathString,fill:"none",stroke:"url(#pathGradient)",strokeWidth:"3",strokeLinecap:"round",opacity:"0.8"}),o.jsx("path",{d:d.pathString,fill:"none",stroke:"rgba(255,255,255,0.8)",strokeWidth:"2",strokeLinecap:"round",strokeDasharray:"8,40",opacity:"0.6",children:o.jsx("animate",{attributeName:"stroke-dashoffset",from:"48",to:"0",dur:"2s",repeatCount:"indefinite"})}),d.nodes.map((u,b)=>{const S=u.actors.length>0?f(u.actors[0]):u.sectionColor;return o.jsxs("g",{style:{cursor:"pointer"},children:[o.jsx("circle",{cx:u.x,cy:u.y,r:48/2+8,fill:S,opacity:"0.15",filter:"url(#glow)"}),o.jsx("circle",{cx:u.x,cy:u.y,r:48/2+3,fill:"none",stroke:S,strokeWidth:"2",opacity:"0.5"}),o.jsx("circle",{cx:u.x,cy:u.y,r:48/2,fill:`${t.canvasBg}`,stroke:S,strokeWidth:"2"}),o.jsx("circle",{cx:u.x,cy:u.y,r:48/2-4,fill:"none",stroke:p(u.score),strokeWidth:"3",strokeDasharray:`${u.score/5*100} 100`,transform:`rotate(-90 ${u.x} ${u.y})`,opacity:"0.8"}),o.jsx("text",{x:u.x,y:u.y+4,textAnchor:"middle",fill:t.textPrimary,fontSize:"14",fontWeight:"700",fontFamily:"system-ui",children:b+1}),u.actors.length>0&&o.jsxs("g",{children:[o.jsx("circle",{cx:u.x+48/2-4,cy:u.y-48/2+4,r:10,fill:S}),o.jsx("text",{x:u.x+48/2-4,y:u.y-48/2+8,textAnchor:"middle",fontSize:"10",children:x(u.actors[0])})]}),o.jsx("foreignObject",{x:u.x-70,y:u.y+48/2+8,width:"140",height:"50",children:o.jsx("div",{style:{textAlign:"center",fontSize:"0.7rem",fontWeight:500,color:t.textPrimary,lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:u.name})})]},u.id)})]})}),o.jsxs("div",{style:{position:"absolute",bottom:12,left:"50%",transform:"translateX(-50%)",display:"flex",gap:24,padding:"8px 20px",background:"rgba(0,0,0,0.6)",borderRadius:20,backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.1)"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:20,height:3,background:"linear-gradient(90deg, #8b5cf6, #ec4899, #06b6d4)",borderRadius:2}}),o.jsx("span",{style:{fontSize:"0.7rem",color:t.textSecondary},children:"Journey Path"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("div",{style:{width:20,height:2,background:"#22c55e",borderRadius:2,opacity:.6}}),o.jsx("span",{style:{fontSize:"0.7rem",color:t.textSecondary},children:"Sentiment"})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[[5,4,3,2,1].map(u=>o.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:p(u)}},u)),o.jsx("span",{style:{fontSize:"0.7rem",color:t.textSecondary,marginLeft:4},children:"Score"})]})]})]})}function jr({nodes:i,edges:t,theme:r=me.dark,sketchMode:n=!1,onLabelChange:a,onDeleteNodes:s,onPasteNodes:e,onEdgeLabelChange:l,onCreateConnection:h}){const d=$e({x:50,y:50}),p={start:{color:v.green,icon:""},end:{color:v.red,icon:""},process:{color:v.blue,icon:""},decision:{color:v.orange,icon:""},action:{color:v.blue,icon:""},io:{color:v.purple,icon:""},default:{color:v.purple,icon:""}},f=k=>d.getNodePosition(k.id,k.x,k.y),x=M.useMemo(()=>{if(!i||i.length===0)return{x:0,y:0,width:400,height:300};const k=i.map(C=>C.x),j=i.map(C=>C.y);return{x:Math.min(...k)-100,y:Math.min(...j)-80,width:Math.max(...k)-Math.min(...k)+300,height:Math.max(...j)-Math.min(...j)+200}},[i]),g=M.useCallback(()=>{const k=d.finishEditing();if(k.nodeId&&k.newValue&&a){const j=i.find(C=>C.id===k.nodeId);j&&j.label!==k.newValue&&a(k.nodeId,j.label,k.newValue)}},[d,i,a]),m=M.useCallback(()=>{const k=d.finishEdgeEditing();if(k.edgeId&&l){const j=t.find(C=>C.id===k.edgeId);l(k.edgeId,(j==null?void 0:j.label)||"",k.newValue)}},[d,t,l]),c=M.useCallback(()=>{if(!i||i.length===0)return;const k=new Map,j=new Map;i.forEach(N=>{k.set(N.id,[]),j.set(N.id,0)}),t.forEach(N=>{k.has(N.source)&&k.get(N.source).push(N.target),j.has(N.target)&&j.set(N.target,j.get(N.target)+1)});const C=i.filter(N=>j.get(N.id)===0);C.length===0&&C.push(i[0]);const E=new Map,R=C.map(N=>({id:N.id,level:0})),T=new Set;for(;R.length>0;){const{id:N,level:H}=R.shift();if(T.has(N))continue;T.add(N),E.set(N,H),(k.get(N)||[]).forEach(ne=>{T.has(ne)||R.push({id:ne,level:H+1})})}i.forEach(N=>{T.has(N.id)||E.set(N.id,0)});const I=new Map;E.forEach((N,H)=>{I.has(N)||I.set(N,[]),I.get(N).push(H)});const B=120,z=180,D=100,U={};I.forEach((N,H)=>{const ee=D+H*B,J=300-(N.length-1)*z/2;N.forEach((ie,F)=>{U[ie]={x:J+F*z,y:ee}})}),d.setPositions(U),d.fitToView(x)},[i,t,d,x]),u=M.useCallback(()=>{const k=Array.from(d.selectedNodes);if(k.length<3)return;const j=k.map(I=>{var B,z;return{id:I,x:((B=d.positions[I])==null?void 0:B.x)??((z=i.find(D=>D.id===I))==null?void 0:z.x)??0}});j.sort((I,B)=>I.x-B.x);const C=j[0].x,R=(j[j.length-1].x-C)/(j.length-1),T={...d.positions};j.forEach((I,B)=>{var D,U;const z=((D=T[I.id])==null?void 0:D.y)??((U=i.find(N=>N.id===I.id))==null?void 0:U.y)??0;T[I.id]={x:C+B*R,y:z}}),d.setPositions(T)},[d,i]),b=M.useCallback(()=>{const k=Array.from(d.selectedNodes);if(k.length<3)return;const j=k.map(I=>{var B,z;return{id:I,y:((B=d.positions[I])==null?void 0:B.y)??((z=i.find(D=>D.id===I))==null?void 0:z.y)??0}});j.sort((I,B)=>I.y-B.y);const C=j[0].y,R=(j[j.length-1].y-C)/(j.length-1),T={...d.positions};j.forEach((I,B)=>{var D,U;const z=((D=T[I.id])==null?void 0:D.x)??((U=i.find(N=>N.id===I.id))==null?void 0:U.x)??0;T[I.id]={x:z,y:C+B*R}}),d.setPositions(T)},[d,i]);M.useEffect(()=>{if(d.dragging){const k=f({id:d.dragging});d.updateAlignmentGuides(d.dragging,k,i,f)}},[d.dragging,d.positions,i,f,d.updateAlignmentGuides]),M.useEffect(()=>{const k=j=>{const E=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?j.metaKey:j.ctrlKey;if(!(d.editingNode||d.editingEdge)){if((j.key==="Delete"||j.key==="Backspace")&&d.selectedNodes.size>0&&s){j.preventDefault(),s(Array.from(d.selectedNodes)),d.clearSelection();return}if(E&&j.key.toLowerCase()==="c"&&d.selectedNodes.size>0){j.preventDefault(),d.copySelectedNodes(i);return}if(E&&j.key.toLowerCase()==="v"&&d.clipboard&&e){j.preventDefault();const R=d.pasteNodes();R&&e(R);return}}};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[d,i,s,e]),M.useEffect(()=>{if(!d.isSelecting&&d.selectionBox){const k=d.getNodesInSelectionBox(i,d.selectionBox);k.length>0&&d.setSelectedNodes(new Set(k))}},[d.isSelecting,d.selectionBox,i,d]);const y=M.useCallback(k=>{(k.target===d.canvasRef.current||k.target.classList.contains("canvas-bg"))&&(d.clearSelection(),d.closeContextMenu(),d.closeEdgeContextMenu(),d.cancelEdgeEditing())},[d]),S=M.useCallback(k=>{const j=d.edgeStyles[k]||"animated",C=d.edgeArrowTypes[k]||"triangle",E=dc.find(T=>T.style===j)||dc[0];let R="url(#flow-arr-triangle)";return C==="none"?R="":C==="open"?R="url(#flow-arr-open)":C==="diamond"?R="url(#flow-arr-diamond)":C==="circle"&&(R="url(#flow-arr-circle)"),{strokeDasharray:E.dasharray,animation:E.animated?"flowDash 1s linear infinite":"none",markerEnd:R}},[d.edgeStyles,d.edgeArrowTypes]),w=M.useCallback(k=>{const j=d.handleMouseUp();j&&h&&h(j.source,j.target)},[d,h]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:r.canvasBg,borderRadius:12,border:`1px solid ${r.border}`,touchAction:"none"},children:[o.jsx("style",{children:`
        @keyframes flowDash { to { stroke-dashoffset: -20; } }
        .flow-node:hover .connection-port-right { opacity: 1 !important; transform: translateY(-50%) scale(1.1) !important; }
        .flow-node:hover .connection-port-left { opacity: 0.3 !important; }
        .edge-add-label:hover { opacity: 1 !important; }
      `}),o.jsxs("div",{ref:d.canvasRef,className:"canvas-bg",onClick:y,onMouseDown:d.handleCanvasMouseDown,onMouseMove:d.handleMouseMove,onMouseUp:w,onMouseLeave:w,onTouchStart:d.handleTouchStart,onTouchMove:d.handleTouchMove,onTouchEnd:d.handleTouchEnd,onWheel:d.handleWheel,style:{width:"100%",height:"100%",cursor:d.isPanning||d.dragging?"grabbing":d.isConnecting?"crosshair":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${r.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${r.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*d.zoom}px ${25*d.zoom}px`,backgroundPosition:`${d.pan.x}px ${d.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible"},children:[o.jsxs("defs",{children:[o.jsx("marker",{id:"flow-arr-triangle",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.purple})}),o.jsx("marker",{id:"flow-arr-open",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polyline",{points:"0 0, 10 4, 0 8",fill:"none",stroke:v.purple,strokeWidth:"2"})}),o.jsx("marker",{id:"flow-arr-diamond",markerWidth:"12",markerHeight:"8",refX:"11",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 4, 6 0, 12 4, 6 8",fill:v.purple})}),o.jsx("marker",{id:"flow-arr-circle",markerWidth:"10",markerHeight:"10",refX:"9",refY:"5",orient:"auto",children:o.jsx("circle",{cx:"5",cy:"5",r:"4",fill:v.purple})}),o.jsx("marker",{id:"flow-arr",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.purple})})]}),o.jsxs("g",{transform:`translate(${d.pan.x}, ${d.pan.y}) scale(${d.zoom})`,children:[t.map(k=>{const j=i.find(L=>L.id===k.source),C=i.find(L=>L.id===k.target);if(!j||!C)return null;const E=f(j),R=f(C),T=R.x-E.x,I=R.y-E.y,B=Math.sqrt(T*T+I*I)||1,z=j.type==="decision"?45:40,D=C.type==="decision"?45:40,U=E.x+T/B*z,N=E.y+I/B*35,H=R.x-T/B*D,ee=R.y-I/B*35,ne=d.edgePathTypes[k.id]||"curved",J=(U+H)/2,ie=(N+ee)/2,F=ne==="straight"?0:Math.abs(T)>50?Math.sign(I||1)*20:0;let _;if(ne==="straight")_=`M ${U} ${N} L ${H} ${ee}`;else if(ne==="step")Math.abs(T)>Math.abs(I)?_=`M ${U} ${N} L ${J} ${N} L ${J} ${ee} L ${H} ${ee}`:_=`M ${U} ${N} L ${U} ${ie} L ${H} ${ie} L ${H} ${ee}`;else if(ne==="rounded")if(Math.abs(T)>Math.abs(I)){const Y=ee>N?1:-1;_=`M ${U} ${N} L ${J-12} ${N} Q ${J} ${N} ${J} ${N+Y*12} L ${J} ${ee-Y*12} Q ${J} ${ee} ${J+12*Math.sign(T)} ${ee} L ${H} ${ee}`}else{const Y=H>U?1:-1;_=`M ${U} ${N} L ${U} ${ie-Math.sign(I)*12} Q ${U} ${ie} ${U+Y*12} ${ie} L ${H-Y*12} ${ie} Q ${H} ${ie} ${H} ${ie+Math.sign(I)*12} L ${H} ${ee}`}else _=n?yg(U,N,H,ee,!0):tr(U,N,H,ee);const q=d.editingEdge===k.id,$=q?d.edgeEditValue:k.label||"",P=S(k.id);return o.jsxs("g",{children:[o.jsx("path",{d:_,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer",pointerEvents:"stroke"},onDoubleClick:L=>{L.stopPropagation(),d.handleEdgeDoubleClick(L,k.id,k.label||"")},onContextMenu:L=>{L.preventDefault(),L.stopPropagation(),d.handleEdgeContextMenu(L,k.id)}}),!n&&o.jsx("path",{d:_,fill:"none",stroke:v.purple,strokeWidth:8,strokeOpacity:.08,strokeLinecap:"round",style:{pointerEvents:"none"}}),!n&&o.jsx("path",{d:_,fill:"none",stroke:v.purple,strokeWidth:4,strokeOpacity:.2,strokeLinecap:"round",style:{pointerEvents:"none"}}),o.jsx("path",{d:_,fill:"none",stroke:n?he.stroke:v.purple,strokeWidth:n?2.5:2,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:P.strokeDasharray,markerEnd:n?"":P.markerEnd,opacity:.9,style:{animation:n?"none":P.animation,pointerEvents:"none"}}),($||q)&&o.jsxs("g",{style:{cursor:"pointer"},onDoubleClick:L=>{L.stopPropagation(),d.handleEdgeDoubleClick(L,k.id,k.label||"")},children:[o.jsx("rect",{x:J-Math.max($.length,3)*3.5-8,y:ie+F-12,width:Math.max($.length,3)*7+16,height:22,rx:11,fill:q?"rgba(124,58,237,0.3)":"rgba(15,23,42,0.9)",stroke:q?v.purple:"rgba(124,58,237,0.4)",strokeWidth:q?2:1}),!q&&o.jsx("text",{x:J,y:ie+F+4,textAnchor:"middle",fill:"#e0e0e0",fontSize:10,fontWeight:500,children:$})]}),!$&&!q&&o.jsxs("g",{style:{cursor:"pointer",opacity:0},className:"edge-add-label",onDoubleClick:L=>{L.stopPropagation(),d.handleEdgeDoubleClick(L,k.id,"")},children:[o.jsx("rect",{x:J-20,y:ie+F-10,width:40,height:20,rx:10,fill:"rgba(124,58,237,0.2)"}),o.jsx("text",{x:J,y:ie+F+4,textAnchor:"middle",fill:"#888",fontSize:9,children:"+ label"})]})]},k.id)}),d.isSelecting&&d.selectionBox&&o.jsx("rect",{x:Math.min(d.selectionBox.startX,d.selectionBox.endX),y:Math.min(d.selectionBox.startY,d.selectionBox.endY),width:Math.abs(d.selectionBox.endX-d.selectionBox.startX),height:Math.abs(d.selectionBox.endY-d.selectionBox.startY),fill:"rgba(124,58,237,0.1)",stroke:v.purple,strokeWidth:2,strokeDasharray:"5,5",style:{pointerEvents:"none"}}),d.isConnecting&&d.connectionStart&&d.connectionEnd&&o.jsxs("g",{style:{pointerEvents:"none"},children:[o.jsx("line",{x1:d.connectionStart.x,y1:d.connectionStart.y,x2:d.connectionEnd.x,y2:d.connectionEnd.y,stroke:d.connectionTarget?v.green:v.purple,strokeWidth:3,strokeDasharray:"8,4",opacity:.8}),o.jsx("circle",{cx:d.connectionEnd.x,cy:d.connectionEnd.y,r:8,fill:d.connectionTarget?v.green:v.purple,opacity:.6})]}),d.alignmentGuides.horizontal.map((k,j)=>o.jsx("line",{x1:k.fromX,y1:k.y,x2:k.toX,y2:k.y,stroke:v.cyan,strokeWidth:1,strokeDasharray:"4,4",opacity:.8,style:{pointerEvents:"none"}},`h-${j}`)),d.alignmentGuides.vertical.map((k,j)=>o.jsx("line",{x1:k.x,y1:k.fromY,x2:k.x,y2:k.toY,stroke:v.cyan,strokeWidth:1,strokeDasharray:"4,4",opacity:.8,style:{pointerEvents:"none"}},`v-${j}`))]})]}),d.editingEdge&&(()=>{const k=t.find(D=>D.id===d.editingEdge);if(!k)return null;const j=i.find(D=>D.id===k.source),C=i.find(D=>D.id===k.target);if(!j||!C)return null;const E=f(j),R=f(C),T=(E.x+R.x)/2,I=(E.y+R.y)/2,B=T*d.zoom+d.pan.x,z=I*d.zoom+d.pan.y;return o.jsx("div",{style:{position:"absolute",left:B-50,top:z-12,zIndex:200},children:o.jsx("input",{autoFocus:!0,type:"text",value:d.edgeEditValue,onChange:D=>d.setEdgeEditValue(D.target.value),onKeyDown:D=>{D.key==="Enter"?(D.preventDefault(),m()):D.key==="Escape"&&(D.preventDefault(),d.cancelEdgeEditing())},onBlur:m,placeholder:"Label",style:{width:100,padding:"4px 8px",background:"rgba(15,23,42,0.95)",border:`2px solid ${v.purple}`,borderRadius:8,color:"#fff",fontSize:"0.75rem",textAlign:"center",outline:"none"},onClick:D=>D.stopPropagation(),onMouseDown:D=>D.stopPropagation()})})})(),o.jsx("div",{style:{position:"absolute",transform:`translate(${d.pan.x}px, ${d.pan.y}px) scale(${d.zoom})`,transformOrigin:"0 0"},children:i.map(k=>{var Y,X;const j=f(k),C=p[k.type]||p.default,E=d.nodeColors[k.id]||k.color||C.color,R=d.dragging===k.id,T=d.selectedNodes.has(k.id),I=d.editingNode===k.id,B=((Y=d.resizing)==null?void 0:Y.nodeId)===k.id,D=d.nodeShapes[k.id]||(k.type==="decision"?"diamond":["start","end"].includes(k.type)?"pill":"rounded"),U=D==="diamond",N=d.getNodeSize(k.id),H=d.nodeSizes[k.id]?N:{width:k.width||N.width,height:k.height||N.height},ee=D==="circle",ne=Math.max(H.width,H.height),J=U?70:ee?ne:H.width,ie=U?70:ee?ne:H.height;let F=12,_;D==="rectangle"?F=0:D==="rounded"?F=12:D==="circle"?F="50%":D==="pill"?F=ie/2:D==="hexagon"&&(_="polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)");let q={position:"absolute",left:j.x-J/2,top:j.y-ie/2,width:J,height:ie,background:Ct(E,n),border:n?`2px solid ${he.stroke}`:`2px solid ${E}`,borderRadius:F,clipPath:_,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:R?"grabbing":B?"nwse-resize":"grab",boxShadow:He(E,R,T,n),transition:R||B?"none":"box-shadow 0.2s, background 0.2s",touchAction:"none",fontFamily:Qr(n)};U&&(q.left=j.x-35,q.top=j.y-35,q.transform="rotate(45deg)",q.borderRadius=8,q.clipPath=void 0);const $=d.isConnecting&&d.connectionTarget===k.id,P=d.isConnecting&&((X=d.connectionStart)==null?void 0:X.nodeId)!==k.id,L=U?35:J/2;return o.jsxs("div",{className:"flow-node",onMouseDown:K=>d.handleNodeMouseDown(K,k.id,j.x,j.y),onDoubleClick:K=>d.handleNodeDoubleClick(K,k.id,k.label),onContextMenu:K=>d.handleNodeContextMenu(K,k.id),onTouchStart:K=>d.handleNodeTouchStart(K,k.id,j.x,j.y),onMouseEnter:()=>P&&d.setConnectionTargetNode(k.id),onMouseLeave:()=>d.clearConnectionTarget(),style:{...q,boxShadow:$?`0 0 0 4px ${v.green}, 0 0 30px ${v.green}50`:q.boxShadow},children:[o.jsxs("div",{style:{transform:U?"rotate(-45deg)":"none",textAlign:"center",width:"100%",padding:"0 8px"},children:[(d.nodeIcons[k.id]||C.icon)&&o.jsx("div",{style:{fontSize:"1.2rem"},children:d.nodeIcons[k.id]||C.icon}),o.jsx(Ue,{isEditing:I,value:I?d.editValue:k.label,onChange:d.setEditValue,onFinish:g,onCancel:d.cancelEditing,style:{fontSize:n?"1rem":"0.8rem",fontWeight:600,color:n?he.stroke:r.textPrimary}})]}),o.jsx("div",{className:"connection-port connection-port-right",onMouseDown:K=>d.handlePortMouseDown(K,k.id,j.x+L,j.y),style:{position:"absolute",right:-8,top:"50%",transform:U?"rotate(-45deg) translateY(-50%)":"translateY(-50%)",width:16,height:16,borderRadius:"50%",background:v.purple,border:"3px solid rgba(255,255,255,0.9)",cursor:"crosshair",opacity:0,transition:"opacity 0.15s, transform 0.15s",zIndex:10},title:"Drag to connect"}),o.jsx("div",{className:"connection-port connection-port-left",style:{position:"absolute",left:-8,top:"50%",transform:U?"rotate(-45deg) translateY(-50%)":"translateY(-50%)",width:16,height:16,borderRadius:"50%",background:P?v.green:v.blue,border:"3px solid rgba(255,255,255,0.9)",cursor:"pointer",opacity:P?1:0,transition:"opacity 0.15s, transform 0.15s",zIndex:10,pointerEvents:P?"auto":"none"}}),T&&!U&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"resize-handle resize-handle-se",onMouseDown:K=>d.handleResizeStart(K,k.id,"se"),style:{position:"absolute",right:-6,bottom:-6,width:12,height:12,background:v.purple,border:"2px solid #fff",borderRadius:2,cursor:"nwse-resize",zIndex:20}}),o.jsx("div",{className:"resize-handle resize-handle-e",onMouseDown:K=>d.handleResizeStart(K,k.id,"e"),style:{position:"absolute",right:-5,top:"50%",transform:"translateY(-50%)",width:10,height:20,background:v.purple,border:"2px solid #fff",borderRadius:2,cursor:"ew-resize",zIndex:20,opacity:.7}}),o.jsx("div",{className:"resize-handle resize-handle-s",onMouseDown:K=>d.handleResizeStart(K,k.id,"s"),style:{position:"absolute",bottom:-5,left:"50%",transform:"translateX(-50%)",width:20,height:10,background:v.purple,border:"2px solid #fff",borderRadius:2,cursor:"ns-resize",zIndex:20,opacity:.7}})]})]},k.id)})})]}),o.jsx(Re,{onZoomIn:()=>d.setZoom(k=>Math.min(k*1.2,2.5)),onZoomOut:()=>d.setZoom(k=>Math.max(k*.8,.3)),onFit:()=>d.fitToView(x),onReset:d.resetView,zoom:d.zoom,snapToGrid:d.snapToGrid,onToggleSnap:()=>d.setSnapToGrid(k=>!k),onAutoLayout:c}),d.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,display:"flex",alignItems:"center",gap:8,zIndex:100},children:[o.jsxs("div",{style:{background:"rgba(124,58,237,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem"},children:[d.selectedNodes.size," selected  C copy  V paste  Del remove"]}),d.selectedNodes.size>=3&&o.jsxs("div",{style:{display:"flex",gap:4},children:[o.jsxs("button",{onClick:u,title:"Distribute horizontally",style:{padding:"4px 8px",background:"rgba(0,0,0,0.8)",border:"1px solid rgba(124,58,237,0.5)",borderRadius:6,color:"#fff",fontSize:"0.7rem",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{transform:"rotate(90deg)",fontSize:"0.9rem"},children:""})," H"]}),o.jsxs("button",{onClick:b,title:"Distribute vertically",style:{padding:"4px 8px",background:"rgba(0,0,0,0.8)",border:"1px solid rgba(124,58,237,0.5)",borderRadius:6,color:"#fff",fontSize:"0.7rem",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[o.jsx("span",{style:{fontSize:"0.9rem"},children:""})," V"]})]})]}),d.clipboard&&d.clipboard.length>0&&d.selectedNodes.size===0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(16,185,129,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[d.clipboard.length," in clipboard  V to paste"]}),d.contextMenu&&o.jsx(Ke,{x:d.contextMenu.x,y:d.contextMenu.y,nodeId:d.contextMenu.nodeId,currentIcon:d.nodeIcons[d.contextMenu.nodeId],currentShape:d.nodeShapes[d.contextMenu.nodeId],onSelectColor:d.setNodeColor,onSelectIcon:d.setNodeIcon,onSelectShape:d.setNodeShape,onClose:d.closeContextMenu,theme:r}),d.edgeContextMenu&&o.jsx(K2,{x:d.edgeContextMenu.x,y:d.edgeContextMenu.y,edgeId:d.edgeContextMenu.edgeId,currentStyle:d.edgeStyles[d.edgeContextMenu.edgeId],currentArrowType:d.edgeArrowTypes[d.edgeContextMenu.edgeId],currentPathType:d.edgePathTypes[d.edgeContextMenu.edgeId],onSelectStyle:d.setEdgeStyle,onSelectArrowType:d.setEdgeArrowType,onSelectPathType:d.setEdgePathType,onClose:d.closeEdgeContextMenu,theme:r})]})}function kg({tables:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e(),l=M.useMemo(()=>{const x=Math.min(3,Math.ceil(Math.sqrt(i.length)));return i.map((g,m)=>({...g,id:g.name,label:g.name,defaultX:m%x*280+60,defaultY:Math.floor(m/x)*250+60,width:230}))},[i]),h=x=>e.getNodePosition(x.name,x.defaultX,x.defaultY),d=M.useMemo(()=>{if(!l||l.length===0)return{x:0,y:0,width:400,height:300};const x=l.map(m=>m.defaultX),g=l.map(m=>m.defaultY);return{x:Math.min(...x)-60,y:Math.min(...g)-60,width:Math.max(...x)-Math.min(...x)+300,height:Math.max(...g)-Math.min(...g)+300}},[l]),p=M.useCallback(()=>{const x=e.finishEditing();if(x.nodeId&&x.newValue&&n){const g=l.find(m=>m.name===x.nodeId);g&&g.name!==x.newValue&&n(x.nodeId,g.name,x.newValue)}},[e,l,n]);M.useEffect(()=>{const x=g=>{const c=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?g.metaKey:g.ctrlKey;if(!e.editingNode){if((g.key==="Delete"||g.key==="Backspace")&&e.selectedNodes.size>0&&a){g.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(c&&g.key.toLowerCase()==="c"&&e.selectedNodes.size>0){g.preventDefault(),e.copySelectedNodes(l);return}if(c&&g.key.toLowerCase()==="v"&&e.clipboard&&s){g.preventDefault();const u=e.pasteNodes();u&&s(u);return}}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[e,l,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const x=e.getNodesInSelectionBox(l.map(g=>({...g,x:g.defaultX,y:g.defaultY})),e.selectionBox);x.length>0&&e.setSelectedNodes(new Set(x))}},[e.isSelecting,e.selectionBox,l,e]);const f=M.useCallback(x=>{(x.target===e.canvasRef.current||x.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:f,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:o.jsx("marker",{id:"erd-crow",markerWidth:"16",markerHeight:"12",refX:"14",refY:"6",orient:"auto",children:o.jsx("path",{d:"M 0 6 L 10 0 M 0 6 L 10 6 M 0 6 L 10 12",stroke:v.blue,strokeWidth:"2",fill:"none"})})}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[l.flatMap(x=>{var g;return((g=x.fields)==null?void 0:g.filter(m=>m.fk&&m.references).map((m,c)=>{const u=l.find(E=>E.name===m.references);if(!u)return null;const b=h(x),y=h(u),S=b.y+44+c*30+15,w=b.x+x.width,k=y.x,j=y.y+22,C=`M ${w} ${S} C ${(w+k)/2} ${S}, ${(w+k)/2} ${j}, ${k} ${j}`;return o.jsxs("g",{children:[o.jsx("path",{d:C,fill:"none",stroke:v.blue,strokeWidth:8,strokeOpacity:.1,strokeLinecap:"round"}),o.jsx("path",{d:C,fill:"none",stroke:v.blue,strokeWidth:4,strokeOpacity:.25,strokeLinecap:"round"}),o.jsx("path",{d:C,fill:"none",stroke:v.blue,strokeWidth:2,markerEnd:"url(#erd-crow)",opacity:.8,strokeLinecap:"round"})]},`${x.name}-${m.name}`)}))||[]}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:"rgba(124,58,237,0.1)",stroke:v.purple,strokeWidth:2,strokeDasharray:"5,5",style:{pointerEvents:"none"}})]})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:l.map(x=>{var y;const g=h(x),m=e.dragging===x.name,c=e.selectedNodes.has(x.name),u=e.editingNode===x.name,b=e.nodeColors[x.name]||v.orange;return o.jsxs("div",{onMouseDown:S=>e.handleNodeMouseDown(S,x.name,g.x,g.y),onDoubleClick:S=>e.handleNodeDoubleClick(S,x.name,x.name),onContextMenu:S=>e.handleNodeContextMenu(S,x.name),onTouchStart:S=>e.handleNodeTouchStart(S,x.name,g.x,g.y),style:{position:"absolute",left:g.x,top:g.y,width:x.width,background:`linear-gradient(180deg, ${t.surface}, rgba(15,23,42,0.95))`,border:`2px solid ${b}`,borderRadius:12,overflow:"hidden",cursor:m?"grabbing":"grab",boxShadow:He(b,m,c),transition:m?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("div",{style:{padding:"12px 16px",background:`linear-gradient(135deg, ${b}, ${b}dd)`},children:o.jsxs("span",{style:{color:"#fff",fontWeight:700,fontSize:"0.95rem",display:"flex",alignItems:"center",gap:6},children:["",o.jsx(Ue,{isEditing:u,value:u?e.editValue:x.name,onChange:e.setEditValue,onFinish:p,onCancel:e.cancelEditing,style:{color:"#fff",fontWeight:700,fontSize:r?"1.1rem":"0.95rem"}})]})}),o.jsx("div",{style:{padding:"8px 0"},children:(y=x.fields)==null?void 0:y.map((S,w)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"7px 16px",borderBottom:w<x.fields.length-1?`1px solid ${t.border}`:"none",gap:10},children:[o.jsx("span",{style:{width:20,fontSize:"0.8rem"},children:S.key?"":S.fk?"":""}),o.jsx("span",{style:{flex:1,color:S.key?b:S.fk?v.blue:t.textPrimary,fontSize:"0.85rem",fontWeight:S.key?600:400},children:S.name}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem",fontFamily:"monospace"},children:S.type})]},w))})]},x.name)})})]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(x=>Math.min(x*1.2,2)),onZoomOut:()=>e.setZoom(x=>Math.max(x*.8,.3)),onFit:()=>e.fitToView(d),onReset:e.resetView,zoom:e.zoom,snapToGrid:e.snapToGrid,onToggleSnap:()=>e.setSnapToGrid(x=>!x)}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(124,58,237,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.selectedNodes.size," selected  C copy  V paste  Del remove"]}),e.clipboard&&e.clipboard.length>0&&e.selectedNodes.size===0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(16,185,129,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.clipboard.length," in clipboard  V to paste"]}),e.contextMenu&&o.jsx(Ke,{x:e.contextMenu.x,y:e.contextMenu.y,nodeId:e.contextMenu.nodeId,currentIcon:e.nodeIcons[e.contextMenu.nodeId],currentShape:e.nodeShapes[e.contextMenu.nodeId],onSelectColor:e.setNodeColor,onSelectIcon:e.setNodeIcon,onSelectShape:e.setNodeShape,onClose:e.closeContextMenu,theme:t})]})}function jg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e(),l={router:"",switch:"",firewall:"",server:"",computer:"",cloud:"",hub:""},h=M.useMemo(()=>{const g=Math.ceil(Math.sqrt(i.devices.length));return{devices:i.devices.map((m,c)=>({...m,defaultX:100+c%g*200,defaultY:100+Math.floor(c/g)*170})),connections:i.connections}},[i]),d=g=>e.getNodePosition(g.id,g.defaultX,g.defaultY),p=M.useMemo(()=>{if(!h.devices||h.devices.length===0)return{x:0,y:0,width:400,height:300};const g=h.devices.map(c=>c.defaultX),m=h.devices.map(c=>c.defaultY);return{x:Math.min(...g)-60,y:Math.min(...m)-60,width:Math.max(...g)-Math.min(...g)+200,height:Math.max(...m)-Math.min(...m)+200}},[h]),f=M.useCallback(()=>{const g=e.finishEditing();if(g.nodeId&&g.newValue&&n){const m=h.devices.find(c=>c.id===g.nodeId);m&&m.label!==g.newValue&&n(g.nodeId,m.label,g.newValue)}},[e,h.devices,n]);M.useEffect(()=>{const g=m=>{const u=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?m.metaKey:m.ctrlKey;if(!e.editingNode){if((m.key==="Delete"||m.key==="Backspace")&&e.selectedNodes.size>0&&a){m.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(u&&m.key.toLowerCase()==="c"&&e.selectedNodes.size>0){m.preventDefault(),e.copySelectedNodes(h.devices);return}if(u&&m.key.toLowerCase()==="v"&&e.clipboard&&s){m.preventDefault();const b=e.pasteNodes();b&&s(b);return}}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[e,h.devices,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const g=e.getNodesInSelectionBox(h.devices.map(m=>({...m,x:m.defaultX,y:m.defaultY})),e.selectionBox);g.length>0&&e.setSelectedNodes(new Set(g))}},[e.isSelecting,e.selectionBox,h.devices,e]);const x=M.useCallback(g=>{(g.target===e.canvasRef.current||g.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:x,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[h.connections.map(g=>{const m=h.devices.find(R=>R.id===g.source),c=h.devices.find(R=>R.id===g.target);if(!m||!c)return null;const u=d(m),b=d(c),y=u.x+65,S=u.y+55,w=b.x+65,k=b.y+55,j=tr(y,S,w,k),C=(y+w)/2,E=(S+k)/2;return o.jsxs("g",{children:[o.jsx("path",{d:j,fill:"none",stroke:v.blue,strokeWidth:8,strokeOpacity:.08,strokeLinecap:"round"}),o.jsx("path",{d:j,fill:"none",stroke:v.blue,strokeWidth:4,strokeOpacity:.2,strokeLinecap:"round"}),o.jsx("path",{d:j,fill:"none",stroke:v.blue,strokeWidth:2,strokeDasharray:"6,4",opacity:.8,strokeLinecap:"round"}),g.protocol&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:C-28,y:E-10,width:56,height:18,rx:4,fill:"rgba(0,0,0,0.8)"}),o.jsx("text",{x:C,y:E+3,textAnchor:"middle",fill:v.blue,fontSize:10,children:g.protocol})]})]},g.id)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:"rgba(124,58,237,0.1)",stroke:v.purple,strokeWidth:2,strokeDasharray:"5,5",style:{pointerEvents:"none"}})]})}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:h.devices.map(g=>{const m=d(g),c=e.dragging===g.id,u=e.selectedNodes.has(g.id),b=e.editingNode===g.id,y=e.nodeColors[g.id]||v.blue;return o.jsxs("div",{onMouseDown:S=>e.handleNodeMouseDown(S,g.id,m.x,m.y),onDoubleClick:S=>e.handleNodeDoubleClick(S,g.id,g.label),onContextMenu:S=>e.handleNodeContextMenu(S,g.id),onTouchStart:S=>e.handleNodeTouchStart(S,g.id,m.x,m.y),style:{position:"absolute",left:m.x,top:m.y,width:130,background:Ct(y),border:`2px solid ${y}`,borderRadius:12,padding:12,textAlign:"center",cursor:c?"grabbing":"grab",boxShadow:He(y,c,u),transition:c?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("div",{style:{fontSize:"2.5rem",marginBottom:6},children:e.nodeIcons[g.id]||l[g.type]||""}),o.jsx(Ue,{isEditing:b,value:b?e.editValue:g.label,onChange:e.setEditValue,onFinish:f,onCancel:e.cancelEditing,style:{fontSize:r?"1rem":"0.85rem",fontWeight:600,color:r?he.stroke:t.textPrimary}}),g.ip&&o.jsx("div",{style:{fontSize:"0.7rem",color:t.textSecondary,fontFamily:"monospace",marginTop:4},children:g.ip})]},g.id)})})]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(g=>Math.min(g*1.2,2)),onZoomOut:()=>e.setZoom(g=>Math.max(g*.8,.3)),onFit:()=>e.fitToView(p),onReset:e.resetView,zoom:e.zoom,snapToGrid:e.snapToGrid,onToggleSnap:()=>e.setSnapToGrid(g=>!g)}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(124,58,237,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.selectedNodes.size," selected  C copy  V paste  Del remove"]}),e.clipboard&&e.clipboard.length>0&&e.selectedNodes.size===0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(16,185,129,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.clipboard.length," in clipboard  V to paste"]}),e.contextMenu&&o.jsx(Ke,{x:e.contextMenu.x,y:e.contextMenu.y,nodeId:e.contextMenu.nodeId,currentIcon:e.nodeIcons[e.contextMenu.nodeId],currentShape:e.nodeShapes[e.contextMenu.nodeId],onSelectColor:e.setNodeColor,onSelectIcon:e.setNodeIcon,onSelectShape:e.setNodeShape,onClose:e.closeContextMenu,theme:t})]})}function Cg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e(),{classes:l=[],relationships:h=[]}=i,d=M.useMemo(()=>{const c=Math.min(3,Math.ceil(Math.sqrt(l.length)));return l.map((u,b)=>({...u,label:u.name,defaultX:80+b%c*300,defaultY:80+Math.floor(b/c)*220,width:230}))},[l]),p=c=>e.getNodePosition(c.id,c.defaultX,c.defaultY),f=M.useMemo(()=>{if(!d||d.length===0)return{x:0,y:0,width:400,height:300};const c=d.map(b=>b.defaultX),u=d.map(b=>b.defaultY);return{x:Math.min(...c)-60,y:Math.min(...u)-60,width:Math.max(...c)-Math.min(...c)+320,height:Math.max(...u)-Math.min(...u)+280}},[d]),x=c=>{const b=c.properties.length>0?c.properties.length*22+16:30,y=c.methods.length>0?c.methods.length*22+16:30;return 38+b+y},g=M.useCallback(()=>{const c=e.finishEditing();if(c.nodeId&&c.newValue&&n){const u=d.find(b=>b.id===c.nodeId);u&&u.name!==c.newValue&&n(c.nodeId,u.name,c.newValue)}},[e,d,n]);M.useEffect(()=>{const c=u=>{const y=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?u.metaKey:u.ctrlKey;if(!e.editingNode){if((u.key==="Delete"||u.key==="Backspace")&&e.selectedNodes.size>0&&a){u.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(y&&u.key.toLowerCase()==="c"&&e.selectedNodes.size>0){u.preventDefault(),e.copySelectedNodes(d);return}if(y&&u.key.toLowerCase()==="v"&&e.clipboard&&s){u.preventDefault();const S=e.pasteNodes();S&&s(S);return}}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[e,d,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const c=e.getNodesInSelectionBox(d.map(u=>({...u,x:u.defaultX,y:u.defaultY})),e.selectionBox);c.length>0&&e.setSelectedNodes(new Set(c))}},[e.isSelecting,e.selectionBox,d,e]);const m=M.useCallback(c=>{(c.target===e.canvasRef.current||c.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("style",{children:"@keyframes flowDash { to { stroke-dashoffset: -20; } }"}),o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:m,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsxs("defs",{children:[o.jsx("marker",{id:"class-inherit",markerWidth:"12",markerHeight:"12",refX:"11",refY:"6",orient:"auto",children:o.jsx("polygon",{points:"0 0, 12 6, 0 12",fill:"none",stroke:v.purple,strokeWidth:"2"})}),o.jsx("marker",{id:"class-assoc",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.blue})}),o.jsx("marker",{id:"class-diamond",markerWidth:"12",markerHeight:"12",refX:"11",refY:"6",orient:"auto",children:o.jsx("polygon",{points:"0 6, 6 0, 12 6, 6 12",fill:v.orange})})]}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[h.map((c,u)=>{const b=d.find(_=>_.id===c.from||_.name===c.from),y=d.find(_=>_.id===c.to||_.name===c.to);if(!b||!y)return null;const S=p(b),w=p(y),k=x(b),j=x(y),C=S.x+b.width/2,E=S.y+k/2,R=w.x+y.width/2,T=w.y+j/2,I=R-C,B=T-E,z=Math.sqrt(I*I+B*B)||1,D=C+I/z*(b.width/2+5),U=E+B/z*(k/2+5),N=R-I/z*(y.width/2+15),H=T-B/z*(j/2+5),ee=(D+N)/2,ne=(U+H)/2,J=c.type==="extends"?"url(#class-inherit)":c.type==="composition"?"url(#class-diamond)":"url(#class-assoc)",ie=c.type==="extends"?v.purple:c.type==="composition"?v.orange:v.blue,F=tr(D,U,N,H);return o.jsxs("g",{children:[o.jsx("path",{d:F,fill:"none",stroke:ie,strokeWidth:8,strokeOpacity:.08,strokeLinecap:"round"}),o.jsx("path",{d:F,fill:"none",stroke:ie,strokeWidth:4,strokeOpacity:.2,strokeLinecap:"round"}),o.jsx("path",{d:F,fill:"none",stroke:ie,strokeWidth:2,strokeDasharray:"8,4",markerEnd:J,opacity:.8,strokeLinecap:"round",style:{animation:"flowDash 1s linear infinite"}}),c.label&&o.jsxs("g",{children:[o.jsx("rect",{x:ee-c.label.length*3.5-6,y:ne-10,width:c.label.length*7+12,height:18,rx:4,fill:"rgba(0,0,0,0.8)"}),o.jsx("text",{x:ee,y:ne+4,textAnchor:"middle",fill:ie,fontSize:10,children:c.label})]})]},u)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:"rgba(124,58,237,0.1)",stroke:v.purple,strokeWidth:2,strokeDasharray:"5,5",style:{pointerEvents:"none"}})]})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:d.map(c=>{const u=p(c),b=e.dragging===c.id,y=e.selectedNodes.has(c.id),S=e.editingNode===c.id,w=e.nodeColors[c.id]||v.purple;return o.jsxs("div",{onMouseDown:k=>e.handleNodeMouseDown(k,c.id,u.x,u.y),onDoubleClick:k=>e.handleNodeDoubleClick(k,c.id,c.name),onContextMenu:k=>e.handleNodeContextMenu(k,c.id),onTouchStart:k=>e.handleNodeTouchStart(k,c.id,u.x,u.y),style:{position:"absolute",left:u.x,top:u.y,width:c.width,background:`linear-gradient(180deg, ${t.surface}, rgba(15,23,42,0.95))`,border:`2px solid ${w}`,borderRadius:8,overflow:"hidden",cursor:b?"grabbing":"grab",boxShadow:He(w,b,y),transition:b?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("div",{style:{padding:"10px 14px",background:`linear-gradient(135deg, ${w}40, ${w}20)`,borderBottom:`1px solid ${w}`},children:o.jsx(Ue,{isEditing:S,value:S?e.editValue:c.name,onChange:e.setEditValue,onFinish:g,onCancel:e.cancelEditing,style:{color:r?he.stroke:t.textPrimary,fontWeight:700,fontSize:r?"1rem":"inherit"}})}),o.jsxs("div",{style:{padding:"8px 14px",borderBottom:`1px solid ${t.border}`},children:[c.properties.map((k,j)=>o.jsxs("div",{style:{fontSize:"0.8rem",color:t.textSecondary},children:[o.jsx("span",{style:{color:v.orange},children:k.visibility})," ",k.name,": ",k.type]},j)),c.properties.length===0&&o.jsx("div",{style:{fontSize:"0.75rem",color:t.textMuted},children:"No properties"})]}),o.jsxs("div",{style:{padding:"8px 14px"},children:[c.methods.map((k,j)=>o.jsxs("div",{style:{fontSize:"0.8rem",color:t.textSecondary},children:[o.jsx("span",{style:{color:v.green},children:k.visibility})," ",k.name,"(): ",k.returns]},j)),c.methods.length===0&&o.jsx("div",{style:{fontSize:"0.75rem",color:t.textMuted},children:"No methods"})]})]},c.id)})})]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(c=>Math.min(c*1.2,2)),onZoomOut:()=>e.setZoom(c=>Math.max(c*.8,.3)),onFit:()=>e.fitToView(f),onReset:e.resetView,zoom:e.zoom,snapToGrid:e.snapToGrid,onToggleSnap:()=>e.setSnapToGrid(c=>!c)}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(124,58,237,0.9)",borderRadius:6,padding:"4px 10px",color:"#fff",fontSize:"0.75rem",zIndex:100},children:[e.selectedNodes.size," selected  C copy  V paste  Del remove"]}),e.contextMenu&&o.jsx(Ke,{x:e.contextMenu.x,y:e.contextMenu.y,nodeId:e.contextMenu.nodeId,currentIcon:e.nodeIcons[e.contextMenu.nodeId],currentShape:e.nodeShapes[e.contextMenu.nodeId],onSelectColor:e.setNodeColor,onSelectIcon:e.setNodeIcon,onSelectShape:e.setNodeShape,onClose:e.closeContextMenu,theme:t})]})}function Eg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:0,y:50}),l=M.useMemo(()=>{const{nodes:x,edges:g}=i;if(!x.length)return{nodes:[],edges:g};const m={};x.forEach(w=>{m[w.id]=[]}),g.forEach(w=>{m[w.source]&&m[w.source].push(w.target)});const c=new Set(g.map(w=>w.target)),u=x.find(w=>!c.has(w.id));if(!u)return{nodes:x,edges:g};const b=w=>{const k=m[w]||[];return k.length===0?180:Math.max(180,k.map(b).reduce((j,C)=>j+C+40,-40))},y=[],S=(w,k,j,C)=>{const E=x.find(I=>I.id===w);if(!E)return;const R=m[w]||[],T=b(w);if(y.push({...E,defaultX:k,defaultY:j,level:C,color:[v.purple,v.blue,v.green,v.orange][Math.min(C,3)]}),R.length){let I=k-T/2;R.forEach(B=>{const z=b(B);S(B,I+z/2,j+120,C+1),I+=z+40})}};return S(u.id,b(u.id)/2+100,80,0),{nodes:y,edges:g}},[i]),h=x=>e.getNodePosition(x.id,x.defaultX,x.defaultY),d=M.useCallback(()=>{const x=e.finishEditing();if(x.nodeId&&x.newValue!==void 0&&n){const g=l.nodes.find(m=>m.id===x.nodeId);g&&g.label!==x.newValue&&n(x.nodeId,g.label,x.newValue)}},[e,l.nodes,n]);M.useEffect(()=>{const x=g=>{const c=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?g.metaKey:g.ctrlKey;if(!e.editingNode){if((g.key==="Delete"||g.key==="Backspace")&&e.selectedNodes.size>0&&a){g.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(c&&g.key.toLowerCase()==="c"&&e.selectedNodes.size>0){g.preventDefault(),e.copySelectedNodes(l.nodes);return}if(c&&g.key.toLowerCase()==="v"&&e.clipboard&&s){g.preventDefault();const u=e.pasteNodes();u&&s(u);return}}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[e,l.nodes,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const x=e.getNodesInSelectionBox(l.nodes.map(g=>({...g,x:g.defaultX,y:g.defaultY})),e.selectionBox);x.length>0&&e.setSelectedNodes(new Set(x))}},[e.isSelecting,e.selectionBox,l.nodes,e]);const p=M.useCallback(x=>{(x.target===e.canvasRef.current||x.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]),f=M.useMemo(()=>{if(!l.nodes||l.nodes.length===0)return{x:0,y:0,width:400,height:300};const x=l.nodes.map(m=>m.defaultX),g=l.nodes.map(m=>m.defaultY);return{x:Math.min(...x)-60,y:Math.min(...g)-60,width:Math.max(...x)-Math.min(...x)+250,height:Math.max(...g)-Math.min(...g)+180}},[l]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:p,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[l.edges.map(x=>{const g=l.nodes.find(C=>C.id===x.source),m=l.nodes.find(C=>C.id===x.target);if(!g||!m)return null;const c=h(g),u=h(m),b=c.x+90,y=c.y+60,S=u.x+90,w=u.y,k=(y+w)/2,j=`M ${b} ${y} L ${b} ${k} L ${S} ${k} L ${S} ${w}`;return o.jsxs("g",{children:[!r&&o.jsx("path",{d:j,fill:"none",stroke:v.purple,strokeWidth:8,strokeOpacity:.08,strokeLinecap:"round",strokeLinejoin:"round"}),!r&&o.jsx("path",{d:j,fill:"none",stroke:v.purple,strokeWidth:4,strokeOpacity:.2,strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("path",{d:j,fill:"none",stroke:r?he.stroke:v.purple,strokeWidth:r?2.5:2,strokeDasharray:"6,4",opacity:r?1:.7,strokeLinecap:"round",strokeLinejoin:"round"})]},x.id)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:`${v.blue}20`,stroke:v.blue,strokeWidth:1,strokeDasharray:"4,4"})]})}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:l.nodes.map(x=>{const g=h(x),m=e.dragging===x.id,c=e.selectedNodes.has(x.id);return o.jsxs("div",{onClick:u=>e.handleNodeClick(u,x.id),onDoubleClick:u=>e.handleNodeDoubleClick(u,x.id,x.label),onContextMenu:u=>e.handleNodeContextMenu(u,x.id),onMouseDown:u=>e.handleNodeMouseDown(u,x.id,g.x,g.y),onTouchStart:u=>e.handleNodeTouchStart(u,x.id,g.x,g.y),style:{position:"absolute",left:g.x,top:g.y,width:180,background:Ct(x.color,r),border:r?`2px solid ${he.stroke}`:`2px solid ${c?v.blue:x.color}`,borderRadius:12,padding:"10px 8px",textAlign:"center",cursor:m?"grabbing":"grab",boxShadow:He(x.color,m,c,r),transition:m?"none":"box-shadow 0.2s",touchAction:"none",overflow:"hidden",fontFamily:Qr(r)},children:[e.editingNode===x.id?o.jsx(Ue,{value:e.editingValue,onChange:u=>e.setEditingValue(u),onFinish:d,style:{fontSize:r?"1.1rem":"0.95rem",fontWeight:600,color:r?he.stroke:t.textPrimary}}):o.jsx("div",{style:{fontSize:r?"1.1rem":"0.95rem",fontWeight:600,color:r?he.stroke:t.textPrimary},children:x.label}),x.title&&o.jsx("div",{style:{fontSize:r?"0.9rem":"0.75rem",color:r?he.accent:x.color,marginTop:4},children:x.title})]},x.id)})})]}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(0,0,0,0.8)",padding:"6px 12px",borderRadius:6,fontSize:"0.75rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{children:[e.selectedNodes.size," selected"]}),o.jsx("span",{style:{opacity:.6},children:"|"}),o.jsx("span",{style:{opacity:.7},children:"Del to delete  C copy  V paste"})]}),e.clipboard&&o.jsxs("div",{style:{position:"absolute",top:e.selectedNodes.size>0?48:12,left:12,background:`${v.green}20`,padding:"4px 10px",borderRadius:4,fontSize:"0.7rem",color:v.green,border:`1px solid ${v.green}40`},children:[e.clipboard.length," node",e.clipboard.length>1?"s":""," copied"]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(x=>Math.min(x*1.2,2)),onZoomOut:()=>e.setZoom(x=>Math.max(x*.8,.3)),onFit:()=>e.fitToView(f),onReset:e.resetView,zoom:e.zoom}),e.contextMenu&&o.jsx(Ke,{position:e.contextMenu,onClose:()=>e.closeContextMenu(),nodeId:e.contextMenu.nodeId})]})}function Mg({data:i,theme:t=me.dark,sketchMode:r=!1}){const{participants:n,messages:a,fragments:s=[],notes:e=[]}=i,l=$e({x:30,y:20}),h=m=>l.getNodePosition(m.id,m.x,0),d=60,p=110,f=M.useMemo(()=>{if(!n||n.length===0)return{x:0,y:0,width:400,height:300};const m=n.map(c=>c.x);return{x:Math.min(...m)-60,y:0,width:Math.max(...m)-Math.min(...m)+200,height:85+a.length*d+80}},[n,a]),x=m=>p+m*d,g={loop:v.blue,alt:v.orange,opt:v.green};return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("div",{ref:l.canvasRef,className:"canvas-bg",onMouseDown:l.handleCanvasMouseDown,onMouseMove:l.handleMouseMove,onMouseUp:l.handleMouseUp,onMouseLeave:l.handleMouseUp,onTouchStart:l.handleTouchStart,onTouchMove:l.handleTouchMove,onTouchEnd:l.handleTouchEnd,onWheel:l.handleWheel,style:{width:"100%",height:"100%",cursor:l.isPanning||l.dragging?"grabbing":"grab",touchAction:"none"},children:o.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute"},children:o.jsxs("g",{transform:`translate(${l.pan.x}, ${l.pan.y}) scale(${l.zoom})`,children:[s.map((m,c)=>{if(!m||m.startIndex===void 0)return null;const u=g[m.type]||v.purple,b=a.filter(I=>I.index>=m.startIndex&&I.index<(m.endIndex||m.startIndex+1));if(b.length===0)return null;const y=new Set;b.forEach(I=>{y.add(I.from),y.add(I.to)});const S=n.filter(I=>y.has(I.id));if(S.length===0)return null;const w=S.map(I=>h(I).x),k=Math.min(...w)-10,j=Math.max(...w)+130,C=Math.min(...b.map(I=>I.index)),E=Math.max(...b.map(I=>I.index)),R=x(C)-35,T=(E-C+1)*d+25;return o.jsxs("g",{children:[o.jsx("rect",{x:k,y:R,width:j-k,height:T,rx:6,fill:`${u}08`,stroke:u,strokeWidth:1.5,strokeDasharray:"6,3",opacity:.8}),o.jsx("rect",{x:k,y:R,width:50,height:18,fill:u,rx:4}),o.jsx("text",{x:k+25,y:R+13,textAnchor:"middle",fill:"#fff",fontSize:9,fontWeight:700,children:m.type}),o.jsxs("text",{x:k+55,y:R+13,fill:u,fontSize:9,fontWeight:600,children:["[",m.label,"]"]})]},`frag-${c}`)}),n.map((m,c)=>{const u=h(m);return o.jsxs("g",{children:[o.jsx("line",{x1:u.x+60,y1:85,x2:u.x+60,y2:85+a.length*d+40,stroke:v.purple,strokeWidth:2,strokeDasharray:"4,4",opacity:.4}),o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:`seq-grad-${c}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:se[c%se.length],stopOpacity:"0.35"}),o.jsx("stop",{offset:"100%",stopColor:se[c%se.length],stopOpacity:"0.12"})]}),o.jsx("filter",{id:`seq-shadow-${c}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:o.jsx("feDropShadow",{dx:"0",dy:"4",stdDeviation:"8",floodColor:se[c%se.length],floodOpacity:"0.3"})})]}),o.jsx("rect",{x:u.x,y:30,width:120,height:45,rx:8,fill:`url(#seq-grad-${c})`,stroke:se[c%se.length],strokeWidth:2,filter:`url(#seq-shadow-${c})`,style:{cursor:l.dragging===m.id?"grabbing":"grab",touchAction:"none"},onMouseDown:b=>{b.stopPropagation(),l.handleNodeMouseDown(b,m.id,u.x,0)},onTouchStart:b=>{b.stopPropagation(),l.handleNodeTouchStart(b,m.id,u.x,0)}}),o.jsx("text",{x:u.x+60,y:58,textAnchor:"middle",fill:t.textPrimary,fontSize:13,fontWeight:600,style:{pointerEvents:"none"},children:m.label})]},m.id)}),a.map((m,c)=>{const u=n.find(R=>R.id===m.from),b=n.find(R=>R.id===m.to);if(!u||!b)return null;const y=h(u),S=h(b),w=x(c),k=y.x+60,j=S.x+60,C=m.isReturn?t.textSecondary:v.purple;return m.from===m.to?o.jsxs("g",{children:[o.jsx("defs",{children:o.jsx("marker",{id:`seq-arr-${c}`,markerWidth:"10",markerHeight:"8",refX:"8",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:C})})}),o.jsx("path",{d:`M ${k} ${w} L ${k+40} ${w} L ${k+40} ${w+30} L ${k+8} ${w+30}`,stroke:C,strokeWidth:2,fill:"none",markerEnd:`url(#seq-arr-${c})`}),o.jsx("rect",{x:k+40+5,y:w-10,width:Math.max(80,m.label.length*6),height:18,rx:4,fill:"rgba(0,0,0,0.85)"}),o.jsx("text",{x:k+40+10,y:w+3,fill:C,fontSize:11,children:m.label})]},`msg-${c}`):o.jsxs("g",{children:[o.jsx("defs",{children:o.jsx("marker",{id:`seq-arr-${c}`,markerWidth:"10",markerHeight:"8",refX:"8",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:C})})}),o.jsx("line",{x1:k,y1:w,x2:j-(k<j?8:-8),y2:w,stroke:C,strokeWidth:6,strokeOpacity:.1,strokeLinecap:"round"}),o.jsx("line",{x1:k,y1:w,x2:j-(k<j?8:-8),y2:w,stroke:C,strokeWidth:4,strokeOpacity:.2,strokeLinecap:"round"}),o.jsx("line",{x1:k,y1:w,x2:j-(k<j?8:-8),y2:w,stroke:C,strokeWidth:2,strokeDasharray:m.isReturn?"4,3":"none",markerEnd:`url(#seq-arr-${c})`}),o.jsx("rect",{x:Math.min(k,j)+Math.abs(j-k)/2-50,y:w-20,width:100,height:18,rx:4,fill:"rgba(0,0,0,0.85)"}),o.jsx("text",{x:Math.min(k,j)+Math.abs(j-k)/2,y:w-7,textAnchor:"middle",fill:C,fontSize:11,children:m.label})]},`msg-${c}`)}),e.map((m,c)=>{const u=n.find(k=>k.id===m.participantId);if(!u)return null;const b=h(u),y=x(m.atMessageIndex)-15,S=m.position==="right"?b.x+130:b.x-110,w=Math.max(100,m.text.length*6+20);return o.jsxs("g",{children:[o.jsx("path",{d:`M ${S} ${y} L ${S+w-10} ${y} L ${S+w} ${y+10} L ${S+w} ${y+40} L ${S} ${y+40} Z`,fill:"#fef3c7",stroke:"#f59e0b",strokeWidth:1}),o.jsx("path",{d:`M ${S+w-10} ${y} L ${S+w-10} ${y+10} L ${S+w} ${y+10}`,fill:"#fde68a",stroke:"#f59e0b",strokeWidth:1}),o.jsx("text",{x:S+8,y:y+25,fill:"#92400e",fontSize:11,fontWeight:500,children:m.text})]},`note-${c}`)})]})})}),o.jsx(Re,{onZoomIn:()=>l.setZoom(m=>Math.min(m*1.2,2)),onZoomOut:()=>l.setZoom(m=>Math.max(m*.8,.3)),onFit:()=>l.fitToView(f),onReset:l.resetView,zoom:l.zoom})]})}function $g({events:i,theme:t=me.dark,sketchMode:r=!1}){const n=$e({x:30,y:0}),a=e=>n.getNodePosition(e.id,e.x,e.y),s=M.useMemo(()=>{if(!i||i.length===0)return{x:0,y:0,width:400,height:300};const e=i.map(l=>l.x);return{x:Math.min(...e)-60,y:0,width:Math.max(...e)-Math.min(...e)+280,height:350}},[i]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("div",{ref:n.canvasRef,className:"canvas-bg",onMouseDown:n.handleCanvasMouseDown,onMouseMove:n.handleMouseMove,onMouseUp:n.handleMouseUp,onMouseLeave:n.handleMouseUp,onTouchStart:n.handleTouchStart,onTouchMove:n.handleTouchMove,onTouchEnd:n.handleTouchEnd,onWheel:n.handleWheel,style:{width:"100%",height:"100%",cursor:n.isPanning||n.dragging?"grabbing":"grab",touchAction:"none"},children:o.jsxs("div",{style:{position:"absolute",transform:`translate(${n.pan.x}px, ${n.pan.y}px) scale(${n.zoom})`,transformOrigin:"0 0",padding:"80px 50px"},children:[o.jsx("div",{style:{position:"absolute",top:265,left:50,width:i.length*220,height:4,background:`linear-gradient(90deg, ${v.purple}, ${v.blue}, ${v.green})`,borderRadius:2}}),i.map((e,l)=>{const h=a(e),d=e.isMilestone?v.orange:v.purple,p=n.dragging===e.id;return o.jsxs("div",{onMouseDown:f=>n.handleNodeMouseDown(f,e.id,h.x,h.y),onTouchStart:f=>n.handleNodeTouchStart(f,e.id,h.x,h.y),style:{position:"absolute",left:h.x,top:80,width:190,cursor:p?"grabbing":"grab",touchAction:"none"},children:[o.jsxs("div",{style:{background:e.isMilestone?`linear-gradient(135deg, ${v.orange}35, ${v.orange}12)`:Ct(d),border:`2px solid ${d}`,borderRadius:12,padding:16,textAlign:"center",minHeight:110,boxShadow:He(d,p,!1),transition:p?"none":"box-shadow 0.2s"},children:[e.isMilestone&&o.jsx("div",{style:{fontSize:"1.3rem",marginBottom:6},children:""}),o.jsx("div",{style:{fontSize:"0.8rem",color:d,fontWeight:600,marginBottom:6},children:e.date}),o.jsx("div",{style:{fontSize:"0.95rem",fontWeight:700,color:t.textPrimary},children:e.label}),e.description&&o.jsx("div",{style:{fontSize:"0.75rem",color:t.textSecondary,marginTop:6},children:e.description})]}),o.jsx("div",{style:{position:"absolute",left:93,top:"100%",width:2,height:35,background:d}}),o.jsx("div",{style:{position:"absolute",left:88,top:"calc(100% + 30px)",width:14,height:14,borderRadius:"50%",background:d,border:"3px solid #0f0f1a"}})]},e.id)})]})}),o.jsx(Re,{onZoomIn:()=>n.setZoom(e=>Math.min(e*1.2,2)),onZoomOut:()=>n.setZoom(e=>Math.max(e*.8,.3)),onFit:()=>n.fitToView(s),onReset:n.resetView,zoom:n.zoom})]})}function Rg({data:i,theme:t=me.dark,sketchMode:r=!1}){const{commits:n,branches:a}=i,s=$e({x:20,y:20}),e=d=>s.getNodePosition(d.id,d.x,d.y),l=M.useMemo(()=>{if(!n||n.length===0)return{x:0,y:0,width:400,height:300};const d=n.map(f=>f.x),p=n.map(f=>f.y);return{x:Math.min(...d)-100,y:Math.min(...p)-60,width:Math.max(...d)-Math.min(...d)+200,height:Math.max(...p)-Math.min(...p)+120}},[n]),h=M.useMemo(()=>{const d=[];return a.forEach((p,f)=>{const x=n.filter(g=>g.branch===p.name).sort((g,m)=>g.index-m.index);for(let g=0;g<x.length-1;g++)d.push({type:"seq",from:x[g],to:x[g+1],color:se[f%se.length]});if(p.parentBranch){a.findIndex(u=>u.name===p.parentBranch);const g=n.filter(u=>u.branch===p.parentBranch),m=g.find(u=>u.index===p.branchPoint-1)||g[g.length-1],c=x[0];m&&c&&d.push({type:"branch",from:m,to:c,color:se[f%se.length]})}}),n.filter(p=>p.isMerge&&p.mergeFrom).forEach(p=>{const f=a.findIndex(g=>g.name===p.mergeFrom),x=n.filter(g=>g.branch===p.mergeFrom).sort((g,m)=>m.index-g.index)[0];x&&d.push({type:"merge",from:x,to:p,color:se[f%se.length]})}),d},[n,a]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("div",{ref:s.canvasRef,className:"canvas-bg",onMouseDown:s.handleCanvasMouseDown,onMouseMove:s.handleMouseMove,onMouseUp:s.handleMouseUp,onMouseLeave:s.handleMouseUp,onTouchStart:s.handleTouchStart,onTouchMove:s.handleTouchMove,onTouchEnd:s.handleTouchEnd,onWheel:s.handleWheel,style:{width:"100%",height:"100%",cursor:s.isPanning||s.dragging?"grabbing":"grab",touchAction:"none"},children:o.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute"},children:o.jsxs("g",{transform:`translate(${s.pan.x}, ${s.pan.y}) scale(${s.zoom})`,children:[a.map((d,p)=>o.jsx("text",{x:30,y:d.y+5,fill:se[p%se.length],fontSize:14,fontWeight:700,children:d.name},d.name)),h.map((d,p)=>{const f=e(d.from),x=e(d.to);if(d.type==="seq")return o.jsxs("g",{children:[o.jsx("line",{x1:f.x,y1:f.y,x2:x.x,y2:x.y,stroke:d.color,strokeWidth:10,strokeOpacity:.1,strokeLinecap:"round"}),o.jsx("line",{x1:f.x,y1:f.y,x2:x.x,y2:x.y,stroke:d.color,strokeWidth:6,strokeOpacity:.25,strokeLinecap:"round"}),o.jsx("line",{x1:f.x,y1:f.y,x2:x.x,y2:x.y,stroke:d.color,strokeWidth:4,strokeLinecap:"round"})]},p);const g=(f.x+x.x)/2,m=`M ${f.x} ${f.y} C ${g} ${f.y}, ${g} ${x.y}, ${x.x} ${x.y}`;return o.jsxs("g",{children:[o.jsx("path",{d:m,fill:"none",stroke:d.color,strokeWidth:8,strokeOpacity:.1,strokeLinecap:"round"}),o.jsx("path",{d:m,fill:"none",stroke:d.color,strokeWidth:5,strokeOpacity:.25,strokeLinecap:"round"}),o.jsx("path",{d:m,fill:"none",stroke:d.color,strokeWidth:3,strokeDasharray:d.type==="merge"?"6,4":"none",opacity:.9,strokeLinecap:"round"})]},p)}),n.map(d=>{const p=e(d),f=a.findIndex(g=>g.name===d.branch),x=s.dragging===d.id;return o.jsxs("g",{style:{cursor:x?"grabbing":"grab",touchAction:"none"},onMouseDown:g=>{g.stopPropagation(),s.handleNodeMouseDown(g,d.id,p.x,p.y)},onTouchStart:g=>{g.stopPropagation(),s.handleNodeTouchStart(g,d.id,p.x,p.y)},children:[o.jsx("circle",{cx:p.x,cy:p.y,r:d.isMerge?14:12,fill:se[f%se.length],stroke:x?"#fff":t.canvasBg,strokeWidth:x?4:3}),d.isMerge&&o.jsx("circle",{cx:p.x,cy:p.y,r:6,fill:t.canvasBg}),o.jsx("text",{x:p.x,y:p.y-22,textAnchor:"middle",fill:t.textPrimary,fontSize:12,fontWeight:600,children:d.label})]},d.id)})]})})}),o.jsx(Re,{onZoomIn:()=>s.setZoom(d=>Math.min(d*1.2,2)),onZoomOut:()=>s.setZoom(d=>Math.max(d*.8,.3)),onFit:()=>s.fitToView(l),onReset:s.resetView,zoom:s.zoom})]})}function _g({tasks:i,theme:t=me.dark,sketchMode:r=!1}){const n=Math.max(...i.map(a=>a.start+a.duration),14);return o.jsxs("div",{style:{width:"100%",height:"100%",overflow:"auto",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,padding:20},children:[o.jsx("div",{style:{display:"flex",marginLeft:160,marginBottom:12},children:Array.from({length:n+1},(a,s)=>o.jsx("div",{style:{width:40,textAlign:"center",fontSize:"0.75rem",color:t.textSecondary},children:s},s))}),i.map((a,s)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",height:44,borderBottom:`1px solid ${t.border}`},children:[o.jsx("div",{style:{width:160,paddingRight:16,fontSize:"0.85rem",color:t.textPrimary,fontWeight:500},children:a.name}),o.jsxs("div",{style:{flex:1,position:"relative",height:"100%"},children:[Array.from({length:n+1},(e,l)=>o.jsx("div",{style:{position:"absolute",left:l*40,top:0,bottom:0,width:1,background:t.border}},l)),o.jsx("div",{style:{position:"absolute",left:a.start*40+2,top:10,width:a.duration*40-4,height:24,background:`linear-gradient(135deg, ${se[s%se.length]}, ${se[s%se.length]}cc)`,borderRadius:6,boxShadow:`0 2px 8px ${se[s%se.length]}40`}})]})]},a.id))]})}function Ig({data:i,theme:t=me.dark,sketchMode:r=!1}){const n=i.reduce((e,l)=>e+l.value,0);let a=-90;const s=i.map((e,l)=>{const h=e.value/n*100,d=e.value/n*360,p=a;a+=d;const f=200+120*Math.cos(p*Math.PI/180),x=200+120*Math.sin(p*Math.PI/180),g=200+120*Math.cos((p+d)*Math.PI/180),m=200+120*Math.sin((p+d)*Math.PI/180),c=200+150*Math.cos((p+d/2)*Math.PI/180),u=200+150*Math.sin((p+d/2)*Math.PI/180);return{...e,pct:h,path:`M 200 200 L ${f} ${x} A 120 120 0 ${d>180?1:0} 1 ${g} ${m} Z`,color:se[l%se.length],lx:c,ly:u}});return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,display:"flex",alignItems:"center",justifyContent:"center"},children:[o.jsx("svg",{width:"450",height:"400",viewBox:"0 0 450 400",children:s.map((e,l)=>o.jsxs("g",{children:[o.jsx("path",{d:e.path,fill:e.color,stroke:t.canvasBg,strokeWidth:2}),o.jsx("text",{x:e.lx,y:e.ly,textAnchor:"middle",fill:t.textPrimary,fontSize:11,fontWeight:500,children:e.label}),o.jsxs("text",{x:e.lx,y:e.ly+14,textAnchor:"middle",fill:t.textSecondary,fontSize:10,children:[e.pct.toFixed(1),"%"]})]},l))}),o.jsx("div",{style:{position:"absolute",right:20,top:"50%",transform:"translateY(-50%)"},children:s.map((e,l)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[o.jsx("div",{style:{width:14,height:14,borderRadius:3,background:e.color}}),o.jsx("span",{style:{fontSize:"0.8rem",color:t.textPrimary},children:e.label})]},l))})]})}function Ag({data:i,theme:t=me.dark,sketchMode:r=!1}){const{config:n,points:a}=i,s=$e({x:50,y:20}),e=400,l=60,h=e-l*2,d=p=>s.getNodePosition(p.id,l+p.x/100*h+50,l+h-p.y/100*h);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`},children:[o.jsx("div",{ref:s.canvasRef,className:"canvas-bg",onMouseDown:s.handleCanvasMouseDown,onMouseMove:s.handleMouseMove,onMouseUp:s.handleMouseUp,onMouseLeave:s.handleMouseUp,onWheel:s.handleWheel,style:{width:"100%",height:"100%",cursor:s.isPanning||s.dragging?"grabbing":"grab",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsxs("svg",{width:e+100,height:e,viewBox:`0 0 ${e+100} ${e}`,style:{transform:`translate(${s.pan.x-50}px, ${s.pan.y-20}px) scale(${s.zoom})`,transformOrigin:"center"},children:[n.title&&o.jsx("text",{x:e/2+50,y:30,textAnchor:"middle",fill:t.textPrimary,fontSize:16,fontWeight:700,children:n.title}),o.jsx("rect",{x:l+50,y:l,width:h/2,height:h/2,fill:v.green+"15"}),o.jsx("rect",{x:l+h/2+50,y:l,width:h/2,height:h/2,fill:v.blue+"15"}),o.jsx("rect",{x:l+50,y:l+h/2,width:h/2,height:h/2,fill:v.orange+"15"}),o.jsx("rect",{x:l+h/2+50,y:l+h/2,width:h/2,height:h/2,fill:v.red+"15"}),o.jsx("line",{x1:l+50,y1:l+h/2,x2:l+h+50,y2:l+h/2,stroke:t.border,strokeWidth:2}),o.jsx("line",{x1:l+h/2+50,y1:l,x2:l+h/2+50,y2:l+h,stroke:t.border,strokeWidth:2}),n.quadrants.map((p,f)=>{const x=[{x:l+h/4+50,y:l+h/4},{x:l+h*3/4+50,y:l+h/4},{x:l+h/4+50,y:l+h*3/4},{x:l+h*3/4+50,y:l+h*3/4}];return p&&o.jsx("text",{x:x[f].x,y:x[f].y,textAnchor:"middle",fill:t.textSecondary,fontSize:11,children:p},f)}),n.xLabel&&o.jsx("text",{x:e/2+50,y:e-10,textAnchor:"middle",fill:t.textSecondary,fontSize:12,children:n.xLabel}),n.yLabel&&o.jsx("text",{x:20,y:e/2,textAnchor:"middle",fill:t.textSecondary,fontSize:12,transform:`rotate(-90, 20, ${e/2})`,children:n.yLabel}),a.map((p,f)=>{const x=d(p),g=s.dragging===p.id;return o.jsxs("g",{style:{cursor:g?"grabbing":"grab"},onMouseDown:m=>{m.stopPropagation(),s.handleNodeMouseDown(m,p.id,x.x,x.y)},children:[o.jsx("circle",{cx:x.x,cy:x.y,r:12,fill:se[f%se.length],stroke:g?"#fff":"none",strokeWidth:3}),o.jsx("text",{x:x.x,y:x.y-18,textAnchor:"middle",fill:t.textPrimary,fontSize:11,children:p.label})]},f)})]})}),o.jsx(Re,{onZoomIn:()=>s.setZoom(p=>Math.min(p*1.2,2)),onZoomOut:()=>s.setZoom(p=>Math.max(p*.8,.3)),onFit:()=>{},onReset:s.resetView,zoom:s.zoom})]})}function Tg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:30,y:30}),l={cloud:{color:v.sky,icon:""},cluster:{color:v.teal,icon:""},container:{color:v.cyan,icon:""},database:{color:v.green,icon:""},storage:{color:v.emerald,icon:""},device:{color:v.pink,icon:""},server:{color:v.violet,icon:""},component:{color:v.purple,icon:""}},h=M.useMemo(()=>{const g=i.nodes,m=[],c=w=>g.filter(k=>k.parentId===w),u=w=>{const k=c(w);return k.length===0?70:60+k.reduce((j,C)=>j+u(C.id)+15,0)},b=(w,k,j,C)=>{const E=l[w.type]||l.component,R=c(w.id),T=u(w.id);m.push({...w,defaultX:k,defaultY:j,width:220,height:T,level:C,...E,hasChildren:R.length>0});let I=j+55;R.forEach(B=>{b(B,k+20,I,C+1),I+=u(B.id)+15})},y=g.filter(w=>!w.parentId);let S=40;return y.forEach(w=>{b(w,S,40,0),S+=280}),{nodes:m.sort((w,k)=>w.level-k.level)}},[i]),d=g=>e.getNodePosition(g.id,g.defaultX,g.defaultY),p=M.useCallback(()=>{const g=e.finishEditing();if(g.nodeId&&g.newValue!==void 0&&n){const m=h.nodes.find(c=>c.id===g.nodeId);m&&m.label!==g.newValue&&n(g.nodeId,m.label,g.newValue)}},[e,h.nodes,n]);M.useEffect(()=>{const g=m=>{const u=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?m.metaKey:m.ctrlKey;if(!e.editingNode){if((m.key==="Delete"||m.key==="Backspace")&&e.selectedNodes.size>0&&a){m.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(u&&m.key.toLowerCase()==="c"&&e.selectedNodes.size>0){m.preventDefault(),e.copySelectedNodes(h.nodes);return}if(u&&m.key.toLowerCase()==="v"&&e.clipboard&&s){m.preventDefault();const b=e.pasteNodes();b&&s(b);return}}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[e,h.nodes,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const g=e.getNodesInSelectionBox(h.nodes.map(m=>({...m,x:m.defaultX,y:m.defaultY})),e.selectionBox);g.length>0&&e.setSelectedNodes(new Set(g))}},[e.isSelecting,e.selectionBox,h.nodes,e]);const f=M.useCallback(g=>{(g.target===e.canvasRef.current||g.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]),x=M.useMemo(()=>{if(!h.nodes||h.nodes.length===0)return{x:0,y:0,width:400,height:300};const g=h.nodes.map(u=>u.defaultX),m=h.nodes.map(u=>u.defaultY),c=h.nodes.map(u=>u.height||70);return{x:Math.min(...g)-60,y:Math.min(...m)-60,width:Math.max(...g)-Math.min(...g)+300,height:Math.max(...m.map((u,b)=>u+c[b]))-Math.min(...m)+120}},[h]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:f,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:o.jsx("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:`${v.blue}20`,stroke:v.blue,strokeWidth:1,strokeDasharray:"4,4"})})}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:h.nodes.map(g=>{const m=d(g),c=e.dragging===g.id,u=e.selectedNodes.has(g.id);return o.jsx("div",{onClick:b=>e.handleNodeClick(b,g.id),onDoubleClick:b=>e.handleNodeDoubleClick(b,g.id,g.label),onContextMenu:b=>e.handleNodeContextMenu(b,g.id),onMouseDown:b=>e.handleNodeMouseDown(b,g.id,m.x,m.y),onTouchStart:b=>e.handleNodeTouchStart(b,g.id,m.x,m.y),style:{position:"absolute",left:m.x,top:m.y,width:g.width,height:g.height,background:`${g.color}10`,border:`2px ${g.level===0?"solid":"dashed"} ${u?v.blue:g.color}`,borderRadius:12,boxSizing:"border-box",cursor:c?"grabbing":"grab",boxShadow:u?`0 0 0 2px ${v.blue}, 0 0 20px ${v.blue}40`:c?`0 0 30px ${g.color}40`:"none",transition:c?"none":"box-shadow 0.2s",touchAction:"none"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",borderBottom:g.hasChildren?`1px solid ${g.color}30`:"none"},children:[o.jsx("span",{style:{fontSize:"1.3rem"},children:g.icon}),e.editingNode===g.id?o.jsx(Ue,{value:e.editingValue,onChange:b=>e.setEditingValue(b),onFinish:p,style:{fontSize:r?"1rem":"0.9rem",fontWeight:600,color:r?he.stroke:t.textPrimary}}):o.jsx("span",{style:{fontSize:r?"1rem":"0.9rem",fontWeight:600,color:r?he.stroke:t.textPrimary},children:g.label}),o.jsxs("span",{style:{fontSize:"0.6rem",color:g.color,marginLeft:"auto",background:`${g.color}20`,padding:"3px 8px",borderRadius:4},children:["",g.type,""]})]})},g.id)})})]}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(0,0,0,0.8)",padding:"6px 12px",borderRadius:6,fontSize:"0.75rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{children:[e.selectedNodes.size," selected"]}),o.jsx("span",{style:{opacity:.6},children:"|"}),o.jsx("span",{style:{opacity:.7},children:"Del to delete  C copy  V paste"})]}),e.clipboard&&o.jsxs("div",{style:{position:"absolute",top:e.selectedNodes.size>0?48:12,left:12,background:`${v.green}20`,padding:"4px 10px",borderRadius:4,fontSize:"0.7rem",color:v.green,border:`1px solid ${v.green}40`},children:[e.clipboard.length," node",e.clipboard.length>1?"s":""," copied"]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(g=>Math.min(g*1.2,2)),onZoomOut:()=>e.setZoom(g=>Math.max(g*.8,.3)),onFit:()=>e.fitToView(x),onReset:e.resetView,zoom:e.zoom}),e.contextMenu&&o.jsx(Ke,{position:e.contextMenu,onClose:()=>e.closeContextMenu(),nodeId:e.contextMenu.nodeId})]})}function Pg({data:i,theme:t=me.dark,sketchMode:r=!1}){const{elements:n,totalHeight:a}=i,s=(c,u={})=>!c||!c.includes("**")&&!c.includes("~~")&&!c.includes("{badge:")&&!c.includes("{tag:")?c:c.split(/(\*\*[^*]+\*\*|~~[^~]+~~|\{(?:badge|tag):[^}]+\})/gi).map((y,S)=>{if(y.startsWith("**")&&y.endsWith("**"))return o.jsx("strong",{style:{fontWeight:700,...u},children:y.slice(2,-2)},S);if(y.startsWith("~~")&&y.endsWith("~~"))return o.jsx("span",{style:{textDecoration:"line-through",opacity:.6},children:y.slice(2,-2)},S);const w=y.match(/^\{(?:badge|tag):([^}]+)\}$/i);if(w){const k=w[1],j=k.match(/^(success|warning|error|info|new|beta|pro):(.+)$/i),C={success:v.green,warning:v.orange,error:v.red,info:v.blue,new:v.pink,beta:v.purple,pro:v.amber},E=j?j[1].toLowerCase():null,R=j?j[2]:k,T=C[E]||v.red;return o.jsx("span",{style:{display:"inline-flex",padding:"2px 8px",background:`${T}25`,border:`1px solid ${T}`,borderRadius:10,color:T,fontSize:"0.7rem",fontWeight:600,marginRight:6},children:R},S)}return y}),e=t.name==="light",l=e?{light:{background:"rgba(255,255,255,0.7)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},medium:{background:"rgba(255,255,255,0.8)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},dark:{background:"rgba(255,255,255,0.9)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"}}:{light:{background:"rgba(255,255,255,0.08)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},medium:{background:"rgba(255,255,255,0.06)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)"},dark:{background:"rgba(0,0,0,0.4)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"}},h=e?{sm:"0 2px 8px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.05)",md:"0 4px 20px rgba(0,0,0,0.1), 0 2px 8px rgba(0,0,0,0.06)",lg:"0 8px 40px rgba(0,0,0,0.12), 0 4px 16px rgba(0,0,0,0.08)",xl:"0 20px 60px rgba(0,0,0,0.15), 0 8px 24px rgba(0,0,0,0.1)",glow:c=>`0 4px 20px ${c}30, 0 0 40px ${c}15`,inset:"inset 0 1px 0 rgba(255,255,255,0.5)"}:{sm:"0 2px 8px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.1)",md:"0 4px 20px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.15)",lg:"0 8px 40px rgba(0,0,0,0.3), 0 4px 16px rgba(0,0,0,0.2)",xl:"0 20px 60px rgba(0,0,0,0.4), 0 8px 24px rgba(0,0,0,0.25)",glow:c=>`0 4px 20px ${c}40, 0 0 40px ${c}20`,inset:"inset 0 1px 0 rgba(255,255,255,0.1)"},d=e?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.15)",p=e?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.08)",f=e?"rgba(0,0,0,0.15)":"rgba(255,255,255,0.2)",x=e?"rgba(0,0,0,0.25)":"rgba(255,255,255,0.3)",g={low:e?"rgba(0,0,0,0.02)":"rgba(255,255,255,0.02)",medium:e?"rgba(0,0,0,0.04)":"rgba(255,255,255,0.04)",high:e?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",elevated:e?"rgba(0,0,0,0.08)":"rgba(255,255,255,0.08)",prominent:e?"rgba(0,0,0,0.12)":"rgba(255,255,255,0.12)",overlay:e?"rgba(255,255,255,0.95)":"rgba(30,30,40,0.95)",code:e?"rgba(0,0,0,0.04)":"rgba(0,0,0,0.4)"},m=c=>{var b,y;const u={position:"absolute",left:c.x,top:c.y,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'};switch(c.type){case"window":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:e?"linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%)":"linear-gradient(180deg, #2d3748 0%, #1a202c 100%)",borderRadius:"12px 12px 0 0",display:"flex",alignItems:"center",padding:"0 16px",boxShadow:h.lg,border:`1px solid ${d}`},children:[o.jsxs("div",{style:{display:"flex",gap:8,marginRight:16},children:[o.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:"linear-gradient(135deg, #ff6b6b, #ee5a5a)",boxShadow:"0 2px 4px rgba(238,90,90,0.4)"}}),o.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:"linear-gradient(135deg, #ffd93d, #f0c419)",boxShadow:"0 2px 4px rgba(240,196,25,0.4)"}}),o.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:"linear-gradient(135deg, #6bcf63, #4ade80)",boxShadow:"0 2px 4px rgba(74,222,128,0.4)"}})]}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.9rem",fontWeight:600,letterSpacing:"-0.01em"},children:s(c.label)})]},c.id);case"card":return o.jsx("div",{style:{...u,width:c.width,height:c.height,...l.light,border:`1px solid ${d}`,borderRadius:16,boxShadow:`${h.md}, ${h.inset}`},children:c.label&&o.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${p}`,background:e?"linear-gradient(180deg, rgba(0,0,0,0.02) 0%, transparent 100%)":"linear-gradient(180deg, rgba(255,255,255,0.06) 0%, transparent 100%)",borderRadius:"16px 16px 0 0",fontWeight:600,color:t.textPrimary,fontSize:"0.9rem",letterSpacing:"-0.01em"},children:s(c.label)})},c.id);case"modal":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,...l.medium,border:`1px solid ${d}`,borderRadius:20,boxShadow:h.xl},children:[o.jsxs("div",{style:{padding:"18px 24px",borderBottom:`1px solid ${p}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:e?"linear-gradient(180deg, rgba(0,0,0,0.02) 0%, transparent 100%)":"linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 100%)",borderRadius:"20px 20px 0 0"},children:[o.jsx("span",{style:{fontWeight:700,color:t.textPrimary,fontSize:"1rem",letterSpacing:"-0.02em"},children:s(c.label)}),o.jsx("div",{style:{width:28,height:28,borderRadius:8,background:e?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:o.jsx("span",{style:{color:t.textSecondary,fontSize:"1rem",lineHeight:1},children:""})})]}),o.jsx("div",{style:{padding:24,color:t.textSecondary,fontSize:"0.9rem",lineHeight:1.6},children:"Modal content area..."})]},c.id);case"navbar":const S=c.items[0]&&/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/u.test(c.items[0]);return o.jsxs("div",{style:{...u,width:c.width,height:c.height,...l.dark,borderRadius:12,display:"flex",alignItems:"center",padding:"0 20px",gap:24,boxShadow:h.md,border:`1px solid ${p}`},children:[!S&&o.jsx("span",{style:{fontWeight:800,color:t.textPrimary,fontSize:"1.1rem",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:""}),c.items.map((F,_)=>{const q=F.match(/^\[(.+)\]$/),$=F.match(/^\((@?\w+)\)$/);return q?o.jsx("button",{style:{padding:"8px 18px",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,color:"#fff",border:"none",borderRadius:8,fontSize:"0.85rem",fontWeight:600,cursor:"pointer",boxShadow:h.glow(v.purple),transition:"transform 0.2s, box-shadow 0.2s"},children:q[1]},_):$?o.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}40, ${v.blue}40)`,border:`2px solid ${v.purple}60`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:600,color:v.purple},children:$[1].slice(0,2).toUpperCase()},_):o.jsx("span",{style:{color:_===0?v.purple:t.textSecondary,fontSize:"0.9rem",fontWeight:_===0?600:500,transition:"color 0.2s"},children:F},_)})]},c.id);case"tabs":return o.jsx("div",{style:{...u,width:c.width,height:c.height,display:"flex",gap:4,background:g.medium,padding:4,borderRadius:12,border:`1px solid ${p}`},children:c.items.map((F,_)=>o.jsx("div",{style:{padding:"10px 20px",color:_===c.activeIndex?"#fff":t.textSecondary,background:_===c.activeIndex?`linear-gradient(135deg, ${v.purple}, ${v.blue})`:"transparent",borderRadius:8,fontSize:"0.85rem",fontWeight:_===c.activeIndex?600:500,boxShadow:_===c.activeIndex?h.glow(v.purple):"none",transition:"all 0.2s"},children:F},_))},c.id);case"breadcrumbs":return o.jsx("div",{style:{...u,display:"flex",alignItems:"center",gap:10},children:c.items.map((F,_)=>o.jsxs(M.Fragment,{children:[o.jsx("span",{style:{color:_===c.items.length-1?t.textPrimary:v.purple,fontSize:"0.85rem",fontWeight:_===c.items.length-1?600:400},children:F}),_<c.items.length-1&&o.jsx("span",{style:{color:t.textMuted,opacity:.5},children:""})]},_))},c.id);case"search":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,...l.light,border:`1px solid ${d}`,borderRadius:12,display:"flex",alignItems:"center",padding:"0 18px",gap:12,boxShadow:h.sm},children:[o.jsx("span",{style:{fontSize:"1rem",opacity:.7},children:""}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.9rem"},children:c.label})]},c.id);case"toolbar":return o.jsx("div",{style:{...u,width:c.width,height:c.height,display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:c.items.map((F,_)=>{if(F.type==="search")return o.jsxs("div",{style:{flex:1,minWidth:150,height:38,...l.light,border:`1px solid ${d}`,borderRadius:10,display:"flex",alignItems:"center",padding:"0 14px",gap:10,boxShadow:h.sm},children:[o.jsx("span",{style:{fontSize:"0.9rem",opacity:.7},children:""}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.85rem"},children:F.label})]},_);if(F.type==="dropdown")return o.jsxs("div",{style:{height:38,...l.light,border:`1px solid ${f}`,borderRadius:10,display:"flex",alignItems:"center",padding:"0 14px",gap:8,boxShadow:h.sm},children:[o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.85rem",fontWeight:500},children:F.label}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.65rem"},children:""})]},_);const q=F.variant==="primary";return o.jsx("button",{style:{height:38,padding:"0 16px",background:q?`linear-gradient(135deg, ${v.purple}, ${v.blue})`:"transparent",color:q?"#fff":t.textPrimary,border:q?"none":`1px solid ${f}`,borderRadius:10,fontSize:"0.85rem",fontWeight:600,cursor:"pointer",boxShadow:q?h.glow(v.purple):h.sm,display:"flex",alignItems:"center",gap:6},children:F.label},_)})},c.id);case"dropdown":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,...l.light,border:`1px solid ${f}`,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 14px",boxShadow:h.sm},children:[o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.9rem",fontWeight:500},children:c.label}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem"},children:""})]},c.id);case"toggle":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:14},children:[o.jsx("div",{style:{width:52,height:28,borderRadius:14,background:c.enabled?`linear-gradient(135deg, ${v.green}, #22c55e)`:g.prominent,position:"relative",boxShadow:c.enabled?h.glow(v.green):h.sm,transition:"all 0.3s"},children:o.jsx("div",{style:{position:"absolute",top:3,left:c.enabled?27:3,width:22,height:22,borderRadius:"50%",background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",transition:"left 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}})}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.9rem",fontWeight:500},children:c.label})]},c.id);case"radio":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:12},children:[o.jsx("div",{style:{width:22,height:22,borderRadius:"50%",border:`2px solid ${c.selected?v.purple:x}`,display:"flex",alignItems:"center",justifyContent:"center",background:c.selected?`${v.purple}15`:"transparent",boxShadow:c.selected?h.glow(v.purple):"none",transition:"all 0.2s"},children:c.selected&&o.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`}})}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.9rem",fontWeight:500},children:c.label})]},c.id);case"slider":return o.jsxs("div",{style:{...u,width:c.width},children:[o.jsxs("div",{style:{height:8,background:g.prominent,borderRadius:4,position:"relative",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.2)"},children:[o.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${c.value}%`,background:`linear-gradient(90deg, ${v.purple}, ${v.blue})`,borderRadius:4,boxShadow:h.glow(v.purple)}}),o.jsx("div",{style:{position:"absolute",top:-8,left:`${c.value}%`,transform:"translateX(-50%)",width:24,height:24,borderRadius:"50%",background:"#fff",border:`3px solid ${v.purple}`,boxShadow:"0 2px 10px rgba(0,0,0,0.3)"}})]}),o.jsxs("div",{style:{textAlign:"right",fontSize:"0.8rem",color:v.purple,marginTop:10,fontWeight:600},children:[c.value,"%"]})]},c.id);case"progress":return o.jsx("div",{style:{...u,width:c.width},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("div",{style:{flex:1,height:10,background:g.prominent,borderRadius:5,overflow:"hidden",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.2)"},children:o.jsx("div",{style:{height:"100%",width:`${c.value}%`,background:`linear-gradient(90deg, ${v.purple}, ${v.blue}, ${v.cyan})`,borderRadius:5,boxShadow:h.glow(v.purple)}})}),o.jsx("span",{style:{fontSize:"0.8rem",color:t.textSecondary,fontWeight:600,whiteSpace:"nowrap"},children:c.label||`${c.value}%`})]})},c.id);case"avatar":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:14},children:[o.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.pink})`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:"1.2rem",boxShadow:h.glow(v.purple),border:"3px solid rgba(255,255,255,0.2)"},children:c.label?c.label.charAt(0).toUpperCase():""}),c.label&&o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.95rem",fontWeight:600},children:c.label})]},c.id);case"avatar-group":return o.jsxs("div",{style:{...u,display:"flex"},children:[Array.from({length:Math.min(c.count,5)}).map((F,_)=>o.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:se[_%se.length],border:`2px solid ${e?"#fff":"#1a1a2e"}`,marginLeft:_>0?-12:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"0.8rem",fontWeight:600},children:String.fromCharCode(65+_)},_)),c.count>5&&o.jsxs("div",{style:{width:36,height:36,borderRadius:"50%",background:g.prominent,border:`2px solid ${e?"#fff":"#1a1a2e"}`,marginLeft:-12,display:"flex",alignItems:"center",justifyContent:"center",color:t.textSecondary,fontSize:"0.7rem"},children:["+",c.count-5]})]},c.id);case"image":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.high,border:`2px dashed ${f}`,borderRadius:8,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:8},children:[o.jsx("span",{style:{fontSize:"2rem"},children:""}),c.label&&o.jsx("span",{style:{color:t.textMuted,fontSize:"0.8rem"},children:c.label})]},c.id);case"video":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:e?"rgba(0,0,0,0.05)":"rgba(0,0,0,0.3)",border:`2px dashed ${f}`,borderRadius:8,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:8},children:[o.jsx("div",{style:{width:60,height:60,borderRadius:"50%",background:g.prominent,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("span",{style:{fontSize:"1.5rem",marginLeft:4,color:t.textPrimary},children:""})}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.8rem"},children:c.label||"Video"})]},c.id);case"map":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:"rgba(20,184,166,0.1)",border:"2px dashed rgba(20,184,166,0.3)",borderRadius:8,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:8},children:[o.jsx("span",{style:{fontSize:"2.5rem"},children:""}),o.jsx("span",{style:{color:v.teal,fontSize:"0.8rem"},children:c.label||"Map"})]},c.id);case"chart":return o.jsx("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:8,padding:16},children:o.jsx("div",{style:{height:"100%",display:"flex",alignItems:"flex-end",justifyContent:"space-around",gap:8},children:[60,85,45,90,55,70].map((F,_)=>o.jsx("div",{style:{width:"12%",height:`${F}%`,background:`linear-gradient(180deg, ${se[_%se.length]}, ${se[_%se.length]}88)`,borderRadius:"4px 4px 0 0"}},_))})},c.id);case"calendar":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:8,padding:12},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("span",{style:{color:t.textMuted},children:""}),o.jsx("span",{style:{color:t.textPrimary,fontWeight:600,fontSize:"0.85rem"},children:"December 2024"}),o.jsx("span",{style:{color:t.textMuted},children:""})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:2,textAlign:"center"},children:[["S","M","T","W","T","F","S"].map((F,_)=>o.jsx("div",{style:{color:t.textMuted,fontSize:"0.7rem",padding:4},children:F},_)),Array.from({length:35}).map((F,_)=>{const q=_-5,$=q===15;return o.jsx("div",{style:{padding:6,fontSize:"0.75rem",color:q<1||q>31?"transparent":$?"#fff":t.textSecondary,background:$?v.purple:"transparent",borderRadius:"50%"},children:q<1||q>31?"":q},_)})]})]},c.id);case"table-row":return o.jsx("div",{style:{...u,width:c.width,height:c.height,display:"flex",borderBottom:`1px solid ${p}`,background:c.isHeader?g.high:"transparent"},children:c.cells.map((F,_)=>o.jsx("div",{style:{flex:1,padding:"8px 12px",color:c.isHeader?t.textPrimary:t.textSecondary,fontSize:"0.8rem",fontWeight:c.isHeader?600:400,borderRight:_<c.cells.length-1?`1px solid ${p}`:"none"},children:F},_))},c.id);case"list-item":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{color:v.purple},children:""}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.85rem"},children:c.label})]},c.id);case"list-item-numbered":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:10},children:[o.jsxs("span",{style:{color:v.purple,fontWeight:600,minWidth:20},children:[c.number,"."]}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.85rem"},children:c.label})]},c.id);case"badge":const k={success:v.green,warning:v.orange,error:v.red,info:v.blue,new:v.pink,beta:v.purple,pro:v.amber}[c.variant]||v.purple;return o.jsx("div",{style:{...u,display:"inline-flex",padding:"5px 12px",background:`linear-gradient(135deg, ${k}30, ${k}15)`,border:`1px solid ${k}50`,borderRadius:20,color:k,fontSize:"0.75rem",fontWeight:700,letterSpacing:"0.02em",textTransform:"uppercase",boxShadow:`0 2px 8px ${k}25`},children:c.label},c.id);case"badge-group":const j={success:v.green,warning:v.orange,error:v.red,info:v.blue,new:v.pink,beta:v.purple,pro:v.amber};return o.jsx("div",{style:{...u,display:"flex",flexWrap:"wrap",gap:8},children:c.badges.map((F,_)=>{const q=j[F.variant]||v.purple;return o.jsx("span",{style:{display:"inline-flex",padding:"5px 12px",background:`linear-gradient(135deg, ${q}30, ${q}15)`,border:`1px solid ${q}50`,borderRadius:20,color:q,fontSize:"0.75rem",fontWeight:700,letterSpacing:"0.02em",textTransform:"uppercase",boxShadow:`0 2px 8px ${q}25`},children:F.label},_)})},c.id);case"alert":const C={info:{color:v.blue,icon:""},success:{color:v.green,icon:""},warning:{color:v.orange,icon:""},error:{color:v.red,icon:""}},E=C[c.variant]||C.info;return o.jsxs("div",{style:{...u,width:c.width,padding:"12px 16px",background:`${E.color}15`,border:`1px solid ${E.color}40`,borderRadius:8,display:"flex",alignItems:"center",gap:12},children:[o.jsx("span",{style:{fontSize:"1.1rem"},children:E.icon}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.85rem"},children:c.label})]},c.id);case"stepper":return o.jsx("div",{style:{...u,width:c.width,display:"flex",alignItems:"center",justifyContent:"center",gap:0},children:Array.from({length:c.total}).map((F,_)=>o.jsxs(M.Fragment,{children:[o.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:_<c.current?v.green:_===c.current-1?v.purple:g.prominent,display:"flex",alignItems:"center",justifyContent:"center",color:_<c.current?"#fff":t.textSecondary,fontSize:"0.8rem",fontWeight:600},children:_<c.current-1?"":_+1}),_<c.total-1&&o.jsx("div",{style:{width:40,height:2,background:_<c.current-1?v.green:g.prominent}})]},_))},c.id);case"pagination":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:4},children:[o.jsx("button",{style:{width:32,height:32,background:g.prominent,border:"none",borderRadius:6,color:t.textSecondary,cursor:"pointer"},children:""}),Array.from({length:Math.min(c.total,5)}).map((F,_)=>{const q=_+1;return o.jsx("button",{style:{width:32,height:32,background:q===c.current?v.purple:g.prominent,border:"none",borderRadius:6,color:q===c.current?"#fff":t.textSecondary,cursor:"pointer",fontSize:"0.8rem"},children:q},_)}),c.total>5&&o.jsx("span",{style:{color:t.textMuted,padding:"0 8px"},children:"..."}),c.total>5&&o.jsx("button",{style:{width:32,height:32,background:g.prominent,border:"none",borderRadius:6,color:t.textSecondary,cursor:"pointer",fontSize:"0.8rem"},children:c.total}),o.jsx("button",{style:{width:32,height:32,background:g.prominent,border:"none",borderRadius:6,color:t.textSecondary,cursor:"pointer"},children:""})]},c.id);case"skeleton":return o.jsx("div",{style:{...u,width:c.width,height:c.height,background:e?"linear-gradient(90deg, rgba(0,0,0,0.04) 25%, rgba(0,0,0,0.08) 50%, rgba(0,0,0,0.04) 75%)":"linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%)",backgroundSize:"200% 100%",borderRadius:4,animation:"shimmer 1.5s infinite"}},c.id);case"textarea":return o.jsx("div",{style:{...u,width:c.width,height:c.height,background:g.elevated,border:`1px solid ${f}`,borderRadius:8,padding:12},children:o.jsx("span",{style:{color:t.textMuted,fontSize:"0.85rem"},children:c.label||"Enter text..."})},c.id);case"chat-message":const R=c.isUser?v.blue:g.prominent,T=c.isUser?"flex-end":"flex-start",I=c.isUser?"16px 16px 4px 16px":"16px 16px 16px 4px";return o.jsxs("div",{style:{...u,width:c.width,display:"flex",flexDirection:"column",alignItems:T},children:[o.jsx("span",{style:{fontSize:"0.7rem",color:t.textMuted,marginBottom:4},children:c.sender}),o.jsx("div",{style:{maxWidth:"75%",background:R,padding:"10px 14px",borderRadius:I},children:o.jsx("span",{style:{color:c.isUser?"#fff":t.textPrimary,fontSize:"0.85rem",lineHeight:1.4},children:c.message})})]},c.id);case"button":const B={primary:{bg:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,border:"transparent",color:"#fff",shadow:h.glow(v.purple)},secondary:{bg:g.elevated,border:f,color:t.textPrimary,shadow:h.sm},ghost:{bg:"transparent",border:"transparent",color:v.purple,shadow:"none"},danger:{bg:`linear-gradient(135deg, ${v.red}, #dc2626)`,border:"transparent",color:"#fff",shadow:h.glow(v.red)},success:{bg:`linear-gradient(135deg, ${v.green}, #22c55e)`,border:"transparent",color:"#fff",shadow:h.glow(v.green)}},z=B[c.variant]||B.primary;return o.jsx("div",{style:{...u,width:c.width,height:c.height,background:z.bg,border:`2px solid ${z.border}`,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:z.shadow,transition:"all 0.2s"},children:o.jsx("span",{style:{color:z.color,fontSize:"0.9rem",fontWeight:600,letterSpacing:"-0.01em"},children:c.label})},c.id);case"icon-button":const D={menu:"",close:"",settings:"",user:"",search:"",home:"",edit:"",delete:"",add:"+",more:""};return o.jsx("div",{style:{...u,width:40,height:40,background:g.prominent,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:o.jsx("span",{style:{fontSize:"1.2rem"},children:D[c.icon]||c.icon})},c.id);case"divider-label":return o.jsxs("div",{style:{...u,width:c.width,display:"flex",alignItems:"center",gap:12},children:[o.jsx("div",{style:{flex:1,height:1,background:d}}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem"},children:c.label}),o.jsx("div",{style:{flex:1,height:1,background:d}})]},c.id);case"rating":return o.jsx("div",{style:{...u,display:"flex",gap:4},children:Array.from({length:c.total}).map((F,_)=>o.jsx("span",{style:{color:_<c.filled?v.amber:f,fontSize:"1.2rem"},children:""},_))},c.id);case"chip-group":return o.jsx("div",{style:{...u,display:"flex",gap:8,flexWrap:"wrap"},children:c.tags.map((F,_)=>o.jsx("span",{style:{padding:"6px 12px",background:`${se[_%se.length]}20`,border:`1px solid ${se[_%se.length]}`,borderRadius:16,color:se[_%se.length],fontSize:"0.8rem"},children:F},_))},c.id);case"tooltip":return o.jsx("div",{style:{...u,width:20,height:20,borderRadius:"50%",background:g.prominent,display:"flex",alignItems:"center",justifyContent:"center",color:t.textSecondary,fontSize:"0.75rem",fontWeight:600},children:"?"},c.id);case"button-row":return o.jsx("div",{style:{...u,width:c.width,display:"flex",gap:10,flexWrap:"wrap"},children:c.buttons.map((F,_)=>o.jsx("div",{style:{padding:"10px 16px",background:se[_%se.length],borderRadius:8,color:"#fff",fontSize:"0.85rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:F},_))},c.id);case"feed-item":return o.jsxs("div",{style:{...u,width:c.width,display:"flex",alignItems:"center",gap:10,padding:"8px 0"},children:[o.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.pink})`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"0.75rem",fontWeight:700},children:c.username.charAt(0).toUpperCase()}),o.jsxs("div",{style:{flex:1},children:[o.jsxs("span",{style:{color:v.purple,fontWeight:600,fontSize:"0.85rem"},children:["@",c.username]}),o.jsx("span",{style:{color:t.textSecondary,fontSize:"0.85rem",marginLeft:6},children:c.text})]})]},c.id);case"win-notification":return o.jsxs("div",{style:{...u,width:c.width,display:"flex",alignItems:"center",gap:12,padding:"10px 14px",background:"rgba(16,185,129,0.1)",border:"1px solid rgba(16,185,129,0.3)",borderRadius:10},children:[o.jsx("span",{style:{fontSize:"1.5rem"},children:c.emoji}),o.jsxs("div",{style:{flex:1},children:[o.jsxs("span",{style:{color:v.green,fontWeight:700,fontSize:"0.9rem"},children:["@",c.username]}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.9rem",marginLeft:6},children:c.text})]})]},c.id);case"social-stats":return o.jsx("div",{style:{...u,width:c.width,display:"flex",alignItems:"center",gap:20,padding:"8px 0"},children:c.text.split(/\s{2,}/).map((F,_)=>o.jsx("span",{style:{color:_===0?v.pink:t.textSecondary,fontSize:"0.9rem",display:"flex",alignItems:"center",gap:4},children:F},_))},c.id);case"input":return o.jsx("div",{style:{...u,width:c.width,height:c.height,...l.light,border:`1px solid ${f}`,borderRadius:10,display:"flex",alignItems:"center",padding:"0 16px",boxShadow:`${h.sm}, inset 0 1px 2px rgba(0,0,0,0.1)`,transition:"border-color 0.2s, box-shadow 0.2s"},children:o.jsx("span",{style:{color:t.textMuted,fontSize:"0.9rem",fontWeight:400},children:c.label||"Enter text..."})},c.id);case"checkbox":return o.jsxs("div",{style:{...u,display:"flex",alignItems:"center",gap:10},children:[o.jsx("div",{style:{width:20,height:20,border:`2px solid ${c.checked?v.blue:x}`,borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",background:c.checked?v.blue:"transparent"},children:c.checked&&o.jsx("span",{style:{color:"#fff",fontSize:"0.75rem"},children:""})}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.85rem"},children:c.label})]},c.id);case"separator":return o.jsx("div",{style:{...u,width:c.width,height:c.height,background:d}},c.id);case"text":const U={h1:{fontSize:"1.5rem",fontWeight:800,color:t.textPrimary},h2:{fontSize:"1.2rem",fontWeight:700,color:t.textPrimary},h3:{fontSize:"1rem",fontWeight:600,color:t.textPrimary},bold:{fontSize:"0.9rem",fontWeight:600,color:t.textPrimary},body:{fontSize:"0.9rem",fontWeight:400,color:t.textSecondary}},N=U[c.textType]||U.body;return o.jsx("div",{style:{...u,...N},children:s(c.label,{color:t.textPrimary})},c.id);case"hero":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:`linear-gradient(135deg, ${v.purple}20, ${v.blue}15, ${v.cyan}10)`,borderRadius:16,padding:"48px 40px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",border:`1px solid ${v.purple}30`,boxShadow:`0 8px 32px ${v.purple}15`},children:[o.jsx("h1",{style:{color:t.textPrimary,fontSize:"2.2rem",fontWeight:800,marginBottom:16,letterSpacing:"-0.02em",background:`linear-gradient(135deg, ${t.textPrimary}, ${v.purple})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:c.title||"Welcome to Our Platform"}),c.subtitle&&o.jsx("p",{style:{color:t.textSecondary,fontSize:"1.1rem",maxWidth:520,lineHeight:1.6,marginBottom:28},children:c.subtitle}),c.cta&&o.jsx("button",{style:{padding:"14px 32px",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,border:"none",borderRadius:10,color:"#fff",fontSize:"1rem",fontWeight:600,cursor:"pointer",boxShadow:`0 4px 20px ${v.purple}50`,transform:"translateY(0)",transition:"all 0.2s"},children:c.cta})]},c.id);case"pricing-card":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:c.featured?`linear-gradient(135deg, ${v.purple}15, ${v.blue}10)`:g.low,border:`${c.featured?2:1}px solid ${c.featured?v.purple:d}`,borderRadius:16,padding:"28px 24px",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},children:[c.featured&&o.jsx("div",{style:{position:"absolute",top:12,right:-32,background:`linear-gradient(135deg, ${v.purple}, ${v.pink})`,color:"#fff",fontSize:"0.7rem",fontWeight:700,padding:"4px 40px",transform:"rotate(45deg)"},children:"POPULAR"}),o.jsxs("div",{style:{marginBottom:20},children:[o.jsx("h3",{style:{color:t.textPrimary,fontSize:"1.2rem",fontWeight:700,marginBottom:8},children:c.plan||"Pro Plan"}),o.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[o.jsx("span",{style:{color:t.textPrimary,fontSize:"2.5rem",fontWeight:800},children:c.price||"$29"}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.9rem"},children:"/month"})]})]}),o.jsx("div",{style:{flex:1,borderTop:`1px solid ${p}`,paddingTop:20},children:(c.features||["Feature 1","Feature 2","Feature 3"]).map((F,_)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:12,color:t.textSecondary,fontSize:"0.9rem"},children:[o.jsx("span",{style:{color:v.green,fontSize:"1rem"},children:""}),F]},_))}),o.jsx("button",{style:{marginTop:20,padding:"12px 20px",background:c.featured?`linear-gradient(135deg, ${v.purple}, ${v.blue})`:g.prominent,border:c.featured?"none":`1px solid ${f}`,borderRadius:10,color:c.featured?"#fff":t.textPrimary,fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},children:c.cta||"Get Started"})]},c.id);case"feature-card":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:16,padding:"28px",display:"flex",flexDirection:"column",gap:16,transition:"all 0.2s",boxShadow:h.md},children:[o.jsx("div",{style:{width:56,height:56,borderRadius:14,background:`${v.purple}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem"},children:c.icon||""}),o.jsx("h3",{style:{color:t.textPrimary,fontSize:"1.1rem",fontWeight:700},children:c.title||"Feature Title"}),o.jsx("p",{style:{color:t.textSecondary,fontSize:"0.9rem",lineHeight:1.6},children:c.description||"Feature description goes here with more details about this amazing capability."})]},c.id);case"stat-widget":const H=(b=c.trend)!=null&&b.startsWith("+")?v.green:(y=c.trend)!=null&&y.startsWith("-")?v.red:t.textMuted;return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:14,padding:"20px 24px",display:"flex",flexDirection:"column",gap:8},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("span",{style:{color:t.textMuted,fontSize:"0.85rem",fontWeight:500},children:c.label||"Metric"}),c.trend&&o.jsx("span",{style:{color:H,fontSize:"0.8rem",fontWeight:600,padding:"3px 8px",background:`${H}15`,borderRadius:6},children:c.trend})]}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"2rem",fontWeight:800,letterSpacing:"-0.02em"},children:c.value||"1,234"}),o.jsx("div",{style:{height:32,display:"flex",alignItems:"flex-end",gap:3,marginTop:8},children:[40,65,45,80,55,70,90,60,75,85].map((F,_)=>o.jsx("div",{style:{flex:1,height:`${F}%`,background:`linear-gradient(180deg, ${v.purple}80, ${v.purple}40)`,borderRadius:2}},_))})]},c.id);case"login-form":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:20,padding:"36px 32px",display:"flex",flexDirection:"column",boxShadow:h.xl},children:[o.jsxs("div",{style:{textAlign:"center",marginBottom:28},children:[o.jsx("div",{style:{width:56,height:56,margin:"0 auto 16px",borderRadius:14,background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem"},children:""}),o.jsx("h2",{style:{color:t.textPrimary,fontSize:"1.4rem",fontWeight:700,marginBottom:4},children:c.title||"Welcome Back"}),o.jsx("p",{style:{color:t.textMuted,fontSize:"0.85rem"},children:"Sign in to your account"})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14,flex:1},children:[o.jsxs("div",{children:[o.jsx("label",{style:{color:t.textSecondary,fontSize:"0.8rem",fontWeight:500,marginBottom:6,display:"block"},children:"Email"}),o.jsx("div",{style:{background:g.high,border:`1px solid ${d}`,borderRadius:10,padding:"12px 14px",color:t.textMuted,fontSize:"0.9rem"},children:"you@example.com"})]}),o.jsxs("div",{children:[o.jsx("label",{style:{color:t.textSecondary,fontSize:"0.8rem",fontWeight:500,marginBottom:6,display:"block"},children:"Password"}),o.jsx("div",{style:{background:g.high,border:`1px solid ${d}`,borderRadius:10,padding:"12px 14px",color:t.textMuted,fontSize:"0.9rem"},children:""})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:4},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("div",{style:{width:16,height:16,borderRadius:4,border:`1.5px solid ${x}`}}),o.jsx("span",{style:{color:t.textSecondary,fontSize:"0.8rem"},children:"Remember me"})]}),o.jsx("span",{style:{color:v.purple,fontSize:"0.8rem",cursor:"pointer"},children:"Forgot password?"})]})]}),o.jsx("button",{style:{marginTop:20,padding:"14px",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,border:"none",borderRadius:10,color:"#fff",fontSize:"0.95rem",fontWeight:600,cursor:"pointer"},children:"Sign In"}),o.jsxs("p",{style:{textAlign:"center",marginTop:16,color:t.textMuted,fontSize:"0.85rem"},children:["Don't have an account? ",o.jsx("span",{style:{color:v.purple,cursor:"pointer"},children:"Sign up"})]})]},c.id);case"signup-form":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:20,padding:"36px 32px",display:"flex",flexDirection:"column",boxShadow:h.xl},children:[o.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[o.jsx("div",{style:{width:56,height:56,margin:"0 auto 16px",borderRadius:14,background:`linear-gradient(135deg, ${v.green}, ${v.teal})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem"},children:""}),o.jsx("h2",{style:{color:t.textPrimary,fontSize:"1.4rem",fontWeight:700,marginBottom:4},children:c.title||"Create Account"}),o.jsx("p",{style:{color:t.textMuted,fontSize:"0.85rem"},children:"Start your journey today"})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12,flex:1},children:[o.jsxs("div",{style:{display:"flex",gap:12},children:[o.jsxs("div",{style:{flex:1},children:[o.jsx("label",{style:{color:t.textSecondary,fontSize:"0.75rem",fontWeight:500,marginBottom:5,display:"block"},children:"First Name"}),o.jsx("div",{style:{background:g.high,border:`1px solid ${d}`,borderRadius:10,padding:"11px 12px",color:t.textMuted,fontSize:"0.85rem"},children:"John"})]}),o.jsxs("div",{style:{flex:1},children:[o.jsx("label",{style:{color:t.textSecondary,fontSize:"0.75rem",fontWeight:500,marginBottom:5,display:"block"},children:"Last Name"}),o.jsx("div",{style:{background:g.high,border:`1px solid ${d}`,borderRadius:10,padding:"11px 12px",color:t.textMuted,fontSize:"0.85rem"},children:"Doe"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{color:t.textSecondary,fontSize:"0.75rem",fontWeight:500,marginBottom:5,display:"block"},children:"Email"}),o.jsx("div",{style:{background:g.high,border:`1px solid ${d}`,borderRadius:10,padding:"11px 12px",color:t.textMuted,fontSize:"0.85rem"},children:"john@example.com"})]}),o.jsxs("div",{children:[o.jsx("label",{style:{color:t.textSecondary,fontSize:"0.75rem",fontWeight:500,marginBottom:5,display:"block"},children:"Password"}),o.jsx("div",{style:{background:g.high,border:`1px solid ${d}`,borderRadius:10,padding:"11px 12px",color:t.textMuted,fontSize:"0.85rem"},children:""})]})]}),o.jsx("button",{style:{marginTop:18,padding:"13px",background:`linear-gradient(135deg, ${v.green}, ${v.teal})`,border:"none",borderRadius:10,color:"#fff",fontSize:"0.95rem",fontWeight:600,cursor:"pointer"},children:"Create Account"}),o.jsxs("p",{style:{textAlign:"center",marginTop:14,color:t.textMuted,fontSize:"0.85rem"},children:["Already have an account? ",o.jsx("span",{style:{color:v.purple,cursor:"pointer"},children:"Sign in"})]})]},c.id);case"dashboard-widget":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:14,padding:"18px 20px",display:"flex",flexDirection:"column"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[o.jsx("span",{style:{color:t.textSecondary,fontSize:"0.85rem",fontWeight:500},children:c.title||"Widget"}),o.jsx("span",{style:{fontSize:"1.2rem"},children:c.icon||""})]}),o.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:o.jsx("span",{style:{color:t.textPrimary,fontSize:"1.8rem",fontWeight:800},children:c.value||"0"})})]},c.id);case"bottom-nav":return o.jsx("div",{style:{...u,width:c.width,height:c.height,background:g.overlay,borderRadius:"20px 20px 0 0",display:"flex",alignItems:"center",justifyContent:"space-around",padding:"0 16px",boxShadow:e?"0 -4px 20px rgba(0,0,0,0.1)":"0 -4px 20px rgba(0,0,0,0.3)",backdropFilter:"blur(10px)"},children:(c.items||[" Home"," Search",""," Likes"," Profile"]).map((F,_)=>{const q=_===0,[$,P]=F.includes(" ")?F.split(" ",2):[F,""];return o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:"8px 12px",cursor:"pointer"},children:[o.jsx("span",{style:{fontSize:$===""?"1.8rem":"1.3rem",opacity:q?1:.6},children:$}),P&&o.jsx("span",{style:{fontSize:"0.65rem",color:q?v.purple:t.textMuted,fontWeight:q?600:400},children:P})]},_)})},c.id);case"app-bar":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.overlay,borderRadius:"0 0 16px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",boxShadow:h.md,backdropFilter:"blur(10px)"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("span",{style:{fontSize:"1.3rem",cursor:"pointer",color:t.textPrimary},children:""}),o.jsx("span",{style:{color:t.textPrimary,fontSize:"1.1rem",fontWeight:600},children:c.title||"Screen Title"})]}),o.jsx("div",{style:{display:"flex",alignItems:"center",gap:16},children:(c.actions||["",""]).map((F,_)=>o.jsx("span",{style:{fontSize:"1.2rem",cursor:"pointer"},children:F},_))})]},c.id);case"fab":return o.jsx("div",{style:{...u,width:56,height:56,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:`0 6px 24px ${v.purple}50`,fontSize:"1.5rem",color:"#fff",fontWeight:300},children:c.icon||"+"},c.id);case"toast":const ee={success:v.green,error:v.red,warning:v.orange,info:v.blue},ne={success:"",error:"",warning:"",info:""},J=ee[c.variant]||v.blue;return o.jsxs("div",{style:{...u,width:c.width,minHeight:52,background:g.overlay,border:`1px solid ${J}40`,borderRadius:12,padding:"12px 16px",display:"flex",alignItems:"center",gap:12,boxShadow:`${h.lg}, 0 0 0 1px ${J}20`,backdropFilter:"blur(10px)"},children:[o.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:`${J}20`,display:"flex",alignItems:"center",justifyContent:"center",color:J,fontSize:"0.9rem",fontWeight:700},children:ne[c.variant]||""}),o.jsx("span",{style:{flex:1,color:t.textPrimary,fontSize:"0.9rem"},children:c.message||"Notification message"}),o.jsx("span",{style:{color:t.textMuted,fontSize:"1rem",cursor:"pointer"},children:""})]},c.id);case"empty-state":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`2px dashed ${d}`,borderRadius:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:32,textAlign:"center"},children:[o.jsx("div",{style:{width:80,height:80,borderRadius:20,background:g.high,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:20,fontSize:"2.5rem"},children:""}),o.jsx("h3",{style:{color:t.textPrimary,fontSize:"1.2rem",fontWeight:600,marginBottom:8},children:c.title||"No items yet"}),o.jsx("p",{style:{color:t.textMuted,fontSize:"0.9rem",maxWidth:280,lineHeight:1.5,marginBottom:20},children:c.description||"Get started by creating your first item"}),c.cta&&o.jsx("button",{style:{padding:"10px 24px",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,border:"none",borderRadius:8,color:"#fff",fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},children:c.cta})]},c.id);case"error-state":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:`${v.red}08`,border:`1px solid ${v.red}30`,borderRadius:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:32,textAlign:"center"},children:[o.jsx("div",{style:{width:80,height:80,borderRadius:20,background:`${v.red}15`,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:20,fontSize:"2.5rem"},children:""}),o.jsx("h3",{style:{color:v.red,fontSize:"1.2rem",fontWeight:600,marginBottom:8},children:c.title||"Something went wrong"}),o.jsx("p",{style:{color:t.textSecondary,fontSize:"0.9rem",maxWidth:300,lineHeight:1.5,marginBottom:20},children:c.description||"We encountered an error. Please try again."}),c.cta&&o.jsx("button",{style:{padding:"10px 24px",background:v.red,border:"none",borderRadius:8,color:"#fff",fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},children:c.cta})]},c.id);case"loading-state":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:16},children:[o.jsx("div",{style:{width:48,height:48,border:`3px solid ${v.purple}30`,borderTopColor:v.purple,borderRadius:"50%",animation:"spin 1s linear infinite"}}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.9rem"},children:c.text||"Loading..."}),o.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]},c.id);case"testimonial":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:16,padding:"28px",display:"flex",flexDirection:"column"},children:[o.jsx("div",{style:{fontSize:"2.5rem",color:v.purple,opacity:.6,lineHeight:1},children:'"'}),o.jsx("p",{style:{flex:1,color:t.textPrimary,fontSize:"1rem",lineHeight:1.6,fontStyle:"italic",marginTop:8},children:c.quote||"This product has completely transformed how we work."}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:20,paddingTop:16,borderTop:`1px solid ${p}`},children:[o.jsx("div",{style:{width:44,height:44,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.pink})`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:"1.1rem"},children:(c.name||"J").charAt(0)}),o.jsxs("div",{children:[o.jsx("div",{style:{color:t.textPrimary,fontWeight:600,fontSize:"0.95rem"},children:c.name||"Jane Doe"}),o.jsx("div",{style:{color:t.textMuted,fontSize:"0.8rem"},children:c.title||"CEO, Company"})]})]})]},c.id);case"footer":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:e?"rgba(0,0,0,0.04)":"rgba(0,0,0,0.3)",borderRadius:"16px 16px 0 0",padding:"32px 40px",display:"flex",flexDirection:"column",gap:24},children:[o.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:32},children:(c.sections||[["Product","Features","Pricing"],["Company","About","Blog"],["Support","Help","Contact"]]).map((F,_)=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[o.jsx("div",{style:{color:t.textPrimary,fontWeight:600,fontSize:"0.9rem"},children:F[0]}),F.slice(1).map((q,$)=>o.jsx("span",{style:{color:t.textMuted,fontSize:"0.85rem",cursor:"pointer"},children:q},$))]},_))}),o.jsxs("div",{style:{borderTop:`1px solid ${p}`,paddingTop:20,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{color:t.textMuted,fontSize:"0.8rem"},children:c.copyright||" 2024 Company. All rights reserved."}),o.jsx("div",{style:{display:"flex",gap:16},children:["twitter","github","linkedin"].map((F,_)=>o.jsx("div",{style:{width:32,height:32,borderRadius:8,background:g.elevated,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"0.9rem",color:t.textSecondary},children:F==="twitter"?"":F==="github"?"":"in"},_))})]})]},c.id);case"social-links":const ie={twitter:"",github:"",linkedin:"in",facebook:"f",instagram:"",youtube:""};return o.jsx("div",{style:{...u,display:"flex",gap:12},children:(c.links||["twitter","github","linkedin"]).map((F,_)=>o.jsx("div",{style:{width:40,height:40,borderRadius:10,background:g.elevated,border:`1px solid ${d}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1rem",color:t.textSecondary},children:ie[F.toLowerCase()]||F.charAt(0).toUpperCase()},_))},c.id);case"cta-section":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:`linear-gradient(135deg, ${v.purple}20, ${v.blue}15)`,border:`1px solid ${v.purple}30`,borderRadius:20,padding:"40px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[o.jsx("h2",{style:{color:t.textPrimary,fontSize:"1.8rem",fontWeight:800,marginBottom:12},children:c.title||"Ready to get started?"}),o.jsx("p",{style:{color:t.textSecondary,fontSize:"1rem",maxWidth:480,marginBottom:24},children:c.description||"Join thousands of satisfied customers today."}),o.jsxs("div",{style:{display:"flex",gap:12},children:[o.jsx("button",{style:{padding:"14px 28px",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,border:"none",borderRadius:10,color:"#fff",fontSize:"1rem",fontWeight:600,cursor:"pointer"},children:c.cta||"Get Started"}),o.jsx("button",{style:{padding:"14px 28px",background:"transparent",border:`1px solid ${x}`,borderRadius:10,color:t.textPrimary,fontSize:"1rem",fontWeight:600,cursor:"pointer"},children:"Learn More"})]})]},c.id);case"profile-card":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`1px solid ${d}`,borderRadius:20,padding:"28px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[o.jsx("div",{style:{width:80,height:80,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.pink})`,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16,fontSize:"2rem",color:"#fff",fontWeight:700},children:(c.name||"U").charAt(0)}),o.jsx("h3",{style:{color:t.textPrimary,fontSize:"1.2rem",fontWeight:700,marginBottom:4},children:c.name||"User Name"}),o.jsx("span",{style:{color:v.purple,fontSize:"0.85rem",marginBottom:12},children:c.username||"@username"}),o.jsx("p",{style:{color:t.textSecondary,fontSize:"0.9rem",lineHeight:1.5},children:c.bio||"Software developer and design enthusiast."}),o.jsxs("div",{style:{display:"flex",gap:24,marginTop:20,paddingTop:20,borderTop:`1px solid ${p}`,width:"100%",justifyContent:"center"},children:[o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:t.textPrimary,fontWeight:700,fontSize:"1.1rem"},children:"1.2K"}),o.jsx("div",{style:{color:t.textMuted,fontSize:"0.75rem"},children:"Followers"})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{color:t.textPrimary,fontWeight:700,fontSize:"1.1rem"},children:"348"}),o.jsx("div",{style:{color:t.textMuted,fontSize:"0.75rem"},children:"Following"})]})]})]},c.id);case"activity-item":return o.jsxs("div",{style:{...u,width:c.width,display:"flex",alignItems:"flex-start",gap:12,padding:"12px 0"},children:[o.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:`linear-gradient(135deg, ${se[Math.floor(Math.random()*5)]}, ${se[Math.floor(Math.random()*5)+1]})`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"0.8rem",fontWeight:600,flexShrink:0},children:"U"}),o.jsxs("div",{style:{flex:1},children:[o.jsx("p",{style:{color:t.textPrimary,fontSize:"0.9rem",lineHeight:1.5,margin:0},children:c.text||"User performed an action"}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem"},children:c.time||"2 hours ago"})]})]},c.id);case"comment":return o.jsxs("div",{style:{...u,width:c.width,display:"flex",alignItems:"flex-start",gap:12,padding:"16px",background:g.low,borderRadius:12,border:`1px solid ${p}`},children:[o.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:`linear-gradient(135deg, ${v.purple}, ${v.blue})`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"0.9rem",fontWeight:600,flexShrink:0},children:(c.username||"U").charAt(0)}),o.jsxs("div",{style:{flex:1},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[o.jsx("span",{style:{color:t.textPrimary,fontWeight:600,fontSize:"0.9rem"},children:c.username||"Username"}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem"},children:c.time||"1 hour ago"})]}),o.jsx("p",{style:{color:t.textSecondary,fontSize:"0.9rem",lineHeight:1.5,margin:0},children:c.text||"This is a comment..."}),o.jsxs("div",{style:{display:"flex",gap:16,marginTop:10},children:[o.jsx("span",{style:{color:t.textMuted,fontSize:"0.8rem",cursor:"pointer"},children:" Like"}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.8rem",cursor:"pointer"},children:" Reply"})]})]})]},c.id);case"code-block":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.code,border:`1px solid ${d}`,borderRadius:12,overflow:"hidden",fontFamily:"SF Mono, Monaco, Consolas, monospace"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 14px",background:g.low,borderBottom:`1px solid ${p}`},children:[o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem"},children:c.language||"javascript"}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem",cursor:"pointer"},children:" Copy"})]}),o.jsx("pre",{style:{margin:0,padding:"16px",color:t.textSecondary,fontSize:"0.85rem",lineHeight:1.6,overflow:"auto"},children:o.jsx("code",{children:c.code||`const greeting = "Hello, World!";
console.log(greeting);`})})]},c.id);case"upload":return o.jsxs("div",{style:{...u,width:c.width,height:c.height,background:g.low,border:`2px dashed ${f}`,borderRadius:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,cursor:"pointer",transition:"all 0.2s"},children:[o.jsx("div",{style:{width:56,height:56,borderRadius:14,background:`${v.purple}15`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem"},children:""}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("p",{style:{color:t.textPrimary,fontSize:"0.95rem",fontWeight:600,marginBottom:4},children:c.label||"Drag files here"}),o.jsx("p",{style:{color:t.textMuted,fontSize:"0.8rem"},children:"or click to browse"})]}),o.jsx("span",{style:{color:t.textMuted,fontSize:"0.75rem"},children:"Max 10MB  PNG, JPG, PDF"})]},c.id);case"accordion":return o.jsx("div",{style:{...u,width:c.width,background:g.low,border:`1px solid ${d}`,borderRadius:12,overflow:"hidden"},children:(c.items||["Section 1","Section 2","Section 3"]).map((F,_)=>{var q;return o.jsxs("div",{style:{borderBottom:_<(((q=c.items)==null?void 0:q.length)||3)-1?`1px solid ${p}`:"none"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 18px",cursor:"pointer"},children:[o.jsx("span",{style:{color:t.textPrimary,fontSize:"0.95rem",fontWeight:500},children:F}),o.jsx("span",{style:{color:t.textMuted,transform:_===0?"rotate(180deg)":"none",transition:"transform 0.2s"},children:""})]}),_===0&&o.jsx("div",{style:{padding:"0 18px 14px",color:t.textSecondary,fontSize:"0.9rem",lineHeight:1.5},children:"Expanded content for this section with more details..."})]},_)})},c.id);case"data-table":return o.jsxs("div",{style:{...u,width:c.width,background:g.low,border:`1px solid ${d}`,borderRadius:12,overflow:"hidden"},children:[o.jsx("div",{style:{display:"flex",background:g.high,borderBottom:`1px solid ${d}`},children:["Name","Status","Date","Actions"].map((F,_)=>o.jsx("div",{style:{flex:_===0?2:1,padding:"12px 16px",color:t.textSecondary,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:F},_))}),Array.from({length:c.rows||3}).map((F,_)=>o.jsxs("div",{style:{display:"flex",borderBottom:_<(c.rows||3)-1?`1px solid ${p}`:"none"},children:[o.jsxs("div",{style:{flex:2,padding:"14px 16px",color:t.textPrimary,fontSize:"0.9rem"},children:["Item ",_+1]}),o.jsx("div",{style:{flex:1,padding:"14px 16px"},children:o.jsx("span",{style:{padding:"4px 10px",background:_===0?`${v.green}20`:`${v.orange}20`,color:_===0?v.green:v.orange,borderRadius:6,fontSize:"0.75rem",fontWeight:500},children:_===0?"Active":"Pending"})}),o.jsxs("div",{style:{flex:1,padding:"14px 16px",color:t.textMuted,fontSize:"0.85rem"},children:["Dec ",10+_,", 2024"]}),o.jsxs("div",{style:{flex:1,padding:"14px 16px",display:"flex",gap:8},children:[o.jsx("span",{style:{cursor:"pointer"},children:""}),o.jsx("span",{style:{cursor:"pointer"},children:""})]})]},_))]},c.id);default:return null}};return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"auto",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`},children:[o.jsx("style",{children:"@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }"}),o.jsx("div",{style:{position:"relative",minHeight:a,padding:20},children:n.map(m)})]})}function J2({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:50,y:50}),{components:l=[],connections:h=[]}=i,d={service:{color:v.blue,icon:""},database:{color:v.green,icon:""},cache:{color:v.red,icon:""},queue:{color:v.orange,icon:""},api:{color:v.purple,icon:""},component:{color:v.purple,icon:""},default:{color:v.purple,icon:""}},p=M.useMemo(()=>{const c=Math.min(4,Math.max(2,Math.ceil(Math.sqrt(l.length))));return l.map((u,b)=>({...u,id:u.label.toLowerCase().replace(/[^a-z0-9]/g,"_"),defaultX:120+b%c*220,defaultY:100+Math.floor(b/c)*160,style:d[u.type]||d.default}))},[l]),f=c=>e.getNodePosition(c.id,c.defaultX,c.defaultY),x=M.useCallback(()=>{const c=e.finishEditing();if(c.nodeId&&c.newValue!==void 0&&n){const u=p.find(b=>b.id===c.nodeId);u&&u.label!==c.newValue&&n(c.nodeId,u.label,c.newValue)}},[e,p,n]);M.useEffect(()=>{const c=u=>{const y=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?u.metaKey:u.ctrlKey;if(!e.editingNode){if((u.key==="Delete"||u.key==="Backspace")&&e.selectedNodes.size>0&&a){u.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(y&&u.key.toLowerCase()==="c"&&e.selectedNodes.size>0){u.preventDefault(),e.copySelectedNodes(p);return}if(y&&u.key.toLowerCase()==="v"&&e.clipboard&&s){u.preventDefault();const S=e.pasteNodes();S&&s(S);return}}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[e,p,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const c=e.getNodesInSelectionBox(p.map(u=>({...u,x:u.defaultX,y:u.defaultY})),e.selectionBox);c.length>0&&e.setSelectedNodes(new Set(c))}},[e.isSelecting,e.selectionBox,p,e]);const g=M.useCallback(c=>{(c.target===e.canvasRef.current||c.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]),m=M.useMemo(()=>{if(!p.length)return{x:0,y:0,width:400,height:300};const c=p.map(b=>b.defaultX),u=p.map(b=>b.defaultY);return{x:Math.min(...c)-80,y:Math.min(...u)-60,width:Math.max(...c)-Math.min(...c)+280,height:Math.max(...u)-Math.min(...u)+220}},[p]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("style",{children:"@keyframes flowDash { to { stroke-dashoffset: -20; } }"}),o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:g,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:o.jsx("marker",{id:"comp-arrow",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.purple})})}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[h.map((c,u)=>{const b=p.find(z=>z.id===c.from.toLowerCase().replace(/[^a-z0-9]/g,"_")),y=p.find(z=>z.id===c.to.toLowerCase().replace(/[^a-z0-9]/g,"_"));if(!b||!y)return null;const S=f(b),w=f(y),k=w.x-S.x,j=w.y-S.y,C=Math.sqrt(k*k+j*j)||1,E=(S.x+w.x)/2,R=(S.y+w.y)/2,T=-j/C*30,I=k/C*30,B=`M ${S.x+k/C*75} ${S.y+j/C*50} Q ${E+T} ${R+I} ${w.x-k/C*75} ${w.y-j/C*50}`;return o.jsxs("g",{children:[o.jsx("path",{d:B,fill:"none",stroke:v.purple,strokeWidth:2,strokeDasharray:"8,4",markerEnd:"url(#comp-arrow)",opacity:.8,style:{animation:"flowDash 1s linear infinite"}}),c.label&&o.jsx("text",{x:E+T,y:R+I-8,textAnchor:"middle",fill:t.textSecondary,fontSize:10,children:c.label})]},u)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:`${v.blue}20`,stroke:v.blue,strokeWidth:1,strokeDasharray:"4,4"})]})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:p.map(c=>{const u=f(c),b=e.dragging===c.id,y=e.selectedNodes.has(c.id);return o.jsxs("div",{onClick:S=>e.handleNodeClick(S,c.id),onDoubleClick:S=>e.handleNodeDoubleClick(S,c.id,c.label),onContextMenu:S=>e.handleNodeContextMenu(S,c.id),onMouseDown:S=>e.handleNodeMouseDown(S,c.id,u.x,u.y),onTouchStart:S=>e.handleNodeTouchStart(S,c.id,u.x,u.y),style:{position:"absolute",left:u.x-75,top:u.y-50,width:150,height:100,background:`${c.style.color}15`,border:`2px solid ${y?v.blue:c.style.color}`,borderRadius:12,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:b?"grabbing":"grab",boxShadow:y?`0 0 0 2px ${v.blue}, 0 0 20px ${v.blue}40`:b?`0 0 30px ${c.style.color}50`:`0 4px 20px ${c.style.color}20`,transition:b?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("div",{style:{fontSize:"1.8rem",marginBottom:6},children:c.style.icon}),e.editingNode===c.id?o.jsx(Ue,{value:e.editingValue,onChange:S=>e.setEditingValue(S),onFinish:x,style:{fontSize:r?"1rem":"0.85rem",fontWeight:600,color:r?he.stroke:t.textPrimary,textAlign:"center"}}):o.jsx("div",{style:{fontSize:r?"1rem":"0.85rem",fontWeight:600,color:r?he.stroke:t.textPrimary,textAlign:"center",padding:"0 8px"},children:c.label})]},c.id)})})]}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(0,0,0,0.8)",padding:"6px 12px",borderRadius:6,fontSize:"0.75rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{children:[e.selectedNodes.size," selected"]}),o.jsx("span",{style:{opacity:.6},children:"|"}),o.jsx("span",{style:{opacity:.7},children:"Del to delete  C copy  V paste"})]}),e.clipboard&&o.jsxs("div",{style:{position:"absolute",top:e.selectedNodes.size>0?48:12,left:12,background:`${v.green}20`,padding:"4px 10px",borderRadius:4,fontSize:"0.7rem",color:v.green,border:`1px solid ${v.green}40`},children:[e.clipboard.length," node",e.clipboard.length>1?"s":""," copied"]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(c=>Math.min(c*1.2,2.5)),onZoomOut:()=>e.setZoom(c=>Math.max(c*.8,.3)),onFit:()=>e.fitToView(m),onReset:e.resetView,zoom:e.zoom}),e.contextMenu&&o.jsx(Ke,{position:e.contextMenu,onClose:()=>e.closeContextMenu(),nodeId:e.contextMenu.nodeId})]})}function ew({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:50,y:50}),{elements:l=[],relationships:h=[],boundaries:d=[]}=i,p={person:{color:v.blue,icon:"",shape:"person"},system:{color:v.cyan,icon:"",shape:"rect"},container:{color:v.green,icon:"",shape:"rect"},component:{color:v.purple,icon:"",shape:"rect"},database:{color:v.emerald,icon:"",shape:"cylinder"},external:{color:v.slate,icon:"",shape:"rect"},default:{color:v.cyan,icon:"",shape:"rect"}},f=[v.purple,v.blue,v.cyan,v.emerald,v.amber,v.pink],x=M.useMemo(()=>{const y=new Map,S=[];l.forEach((R,T)=>{R.boundary?(y.has(R.boundary)||y.set(R.boundary,[]),y.get(R.boundary).push({...R,origIndex:T})):S.push({...R,origIndex:T})});const w=[];let k=120;const j=40,C=220,E=160;if(S.length>0){const R=Math.min(4,Math.max(2,Math.ceil(Math.sqrt(S.length))));S.forEach((I,B)=>{w.push({...I,id:I.label.toLowerCase().replace(/[^a-z0-9]/g,"_"),defaultX:150+B%R*C,defaultY:k+Math.floor(B/R)*E,style:p[I.type]||p.default})});const T=Math.ceil(S.length/Math.min(4,Math.max(2,Math.ceil(Math.sqrt(S.length)))));k+=T*E+j}return d.forEach((R,T)=>{const I=y.get(R.id)||[];if(I.length===0)return;const B=Math.min(3,Math.max(1,Math.ceil(Math.sqrt(I.length))));I.forEach((D,U)=>{w.push({...D,id:D.label.toLowerCase().replace(/[^a-z0-9]/g,"_"),defaultX:150+j+U%B*C,defaultY:k+j+30+Math.floor(U/B)*E,style:p[D.type]||p.default,boundaryId:R.id})});const z=Math.ceil(I.length/B);k+=z*E+j*2+40}),w},[l,d]),g=M.useMemo(()=>d.map((y,S)=>{const w=x.filter(E=>E.boundaryId===y.id);if(w.length===0)return null;const k=w.map(E=>E.defaultX),j=w.map(E=>E.defaultY),C=30;return{id:y.id,name:y.name,x:Math.min(...k)-85-C,y:Math.min(...j)-60-C-25,width:Math.max(...k)-Math.min(...k)+170+C*2,height:Math.max(...j)-Math.min(...j)+120+C*2+25,color:f[S%f.length]}}).filter(Boolean),[d,x]),m=y=>e.getNodePosition(y.id,y.defaultX,y.defaultY),c=M.useCallback(()=>{const y=e.finishEditing();if(y.nodeId&&y.newValue!==void 0&&n){const S=x.find(w=>w.id===y.nodeId);S&&S.label!==y.newValue&&n(y.nodeId,S.label,y.newValue)}},[e,x,n]);M.useEffect(()=>{const y=S=>{const k=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?S.metaKey:S.ctrlKey;if(!e.editingNode){if((S.key==="Delete"||S.key==="Backspace")&&e.selectedNodes.size>0&&a){S.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(k&&S.key.toLowerCase()==="c"&&e.selectedNodes.size>0){S.preventDefault(),e.copySelectedNodes(x);return}if(k&&S.key.toLowerCase()==="v"&&e.clipboard&&s){S.preventDefault();const j=e.pasteNodes();j&&s(j);return}}};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[e,x,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const y=e.getNodesInSelectionBox(x.map(S=>({...S,x:S.defaultX,y:S.defaultY})),e.selectionBox);y.length>0&&e.setSelectedNodes(new Set(y))}},[e.isSelecting,e.selectionBox,x,e]);const u=M.useCallback(y=>{(y.target===e.canvasRef.current||y.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]),b=M.useMemo(()=>{if(!x.length)return{x:0,y:0,width:400,height:300};const y=x.map(w=>w.defaultX),S=x.map(w=>w.defaultY);return{x:Math.min(...y)-100,y:Math.min(...S)-80,width:Math.max(...y)-Math.min(...y)+320,height:Math.max(...S)-Math.min(...S)+260}},[x]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("style",{children:"@keyframes flowDash { to { stroke-dashoffset: -20; } }"}),o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:u,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:o.jsx("marker",{id:"c4-arrow",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.cyan})})}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[h.map((y,S)=>{const w=x.find(N=>N.id===y.from.toLowerCase().replace(/[^a-z0-9]/g,"_")),k=x.find(N=>N.id===y.to.toLowerCase().replace(/[^a-z0-9]/g,"_"));if(!w||!k)return null;const j=m(w),C=m(k),E=C.x-j.x,R=C.y-j.y,T=Math.sqrt(E*E+R*R)||1,I=(j.x+C.x)/2,B=(j.y+C.y)/2,z=-R/T*25,D=E/T*25,U=`M ${j.x+E/T*85} ${j.y+R/T*60} Q ${I+z} ${B+D} ${C.x-E/T*85} ${C.y-R/T*60}`;return o.jsxs("g",{children:[o.jsx("path",{d:U,fill:"none",stroke:v.cyan,strokeWidth:2,strokeDasharray:"8,4",markerEnd:"url(#c4-arrow)",opacity:.8,style:{animation:"flowDash 1s linear infinite"}}),y.label&&o.jsxs("g",{children:[o.jsx("rect",{x:I+z-y.label.length*3.5-6,y:B+D-18,width:y.label.length*7+12,height:16,rx:4,fill:"rgba(0,0,0,0.8)"}),o.jsx("text",{x:I+z,y:B+D-7,textAnchor:"middle",fill:v.cyan,fontSize:10,children:y.label})]})]},S)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:`${v.blue}20`,stroke:v.blue,strokeWidth:1,strokeDasharray:"4,4"})]})]}),o.jsxs("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:[g.map(y=>o.jsx("div",{style:{position:"absolute",left:y.x,top:y.y,width:y.width,height:y.height,background:`${y.color}08`,border:`2px dashed ${y.color}50`,borderRadius:16,pointerEvents:"none"},children:o.jsx("div",{style:{position:"absolute",top:8,left:12,fontSize:"0.75rem",fontWeight:600,color:y.color,textTransform:"uppercase",letterSpacing:"0.5px",opacity:.8},children:y.name})},y.id)),x.map(y=>{const S=m(y),w=e.dragging===y.id,k=e.selectedNodes.has(y.id),j=y.style.shape==="person";return o.jsxs("div",{onClick:C=>e.handleNodeClick(C,y.id),onDoubleClick:C=>e.handleNodeDoubleClick(C,y.id,y.label),onContextMenu:C=>e.handleNodeContextMenu(C,y.id),onMouseDown:C=>e.handleNodeMouseDown(C,y.id,S.x,S.y),onTouchStart:C=>e.handleNodeTouchStart(C,y.id,S.x,S.y),style:{position:"absolute",left:S.x-85,top:S.y-60,width:170,height:120,background:`${y.style.color}15`,border:`2px solid ${k?v.blue:y.style.color}`,borderRadius:j?"50% 50% 12px 12px":y.style.shape==="cylinder"?"50% / 15%":12,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:w?"grabbing":"grab",boxShadow:k?`0 0 0 2px ${v.blue}, 0 0 20px ${v.blue}40`:w?`0 0 30px ${y.style.color}50`:`0 4px 20px ${y.style.color}20`,transition:w?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("div",{style:{fontSize:"2rem",marginBottom:6},children:y.style.icon}),e.editingNode===y.id?o.jsx(Ue,{value:e.editingValue,onChange:C=>e.setEditingValue(C),onFinish:c,style:{fontSize:r?"1rem":"0.9rem",fontWeight:600,color:r?he.stroke:t.textPrimary,textAlign:"center"}}):o.jsx("div",{style:{fontSize:r?"1rem":"0.9rem",fontWeight:600,color:r?he.stroke:t.textPrimary,textAlign:"center"},children:y.label}),y.description&&o.jsx("div",{style:{fontSize:"0.7rem",color:t.textSecondary,textAlign:"center",padding:"0 8px",marginTop:4},children:y.description})]},y.id)})]})]}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(0,0,0,0.8)",padding:"6px 12px",borderRadius:6,fontSize:"0.75rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{children:[e.selectedNodes.size," selected"]}),o.jsx("span",{style:{opacity:.6},children:"|"}),o.jsx("span",{style:{opacity:.7},children:"Del to delete  C copy  V paste"})]}),e.clipboard&&o.jsxs("div",{style:{position:"absolute",top:e.selectedNodes.size>0?48:12,left:12,background:`${v.green}20`,padding:"4px 10px",borderRadius:4,fontSize:"0.7rem",color:v.green,border:`1px solid ${v.green}40`},children:[e.clipboard.length," node",e.clipboard.length>1?"s":""," copied"]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(y=>Math.min(y*1.2,2.5)),onZoomOut:()=>e.setZoom(y=>Math.max(y*.8,.3)),onFit:()=>e.fitToView(b),onReset:e.resetView,zoom:e.zoom}),e.contextMenu&&o.jsx(Ke,{position:e.contextMenu,onClose:()=>e.closeContextMenu(),nodeId:e.contextMenu.nodeId})]})}function tw({data:i,theme:t=me.dark,sketchMode:r=!1}){const n=$e({x:50,y:50}),{requirements:a=[],traces:s=[]}=i,e={critical:v.red,high:v.orange,medium:v.amber,low:v.green},l=M.useMemo(()=>{const p=Math.min(3,Math.max(2,Math.ceil(Math.sqrt(a.length))));return a.map((f,x)=>{var g;return{...f,id:f.name.toLowerCase().replace(/[^a-z0-9]/g,"_"),defaultX:150+x%p*280,defaultY:100+Math.floor(x/p)*160,color:e[(g=f.priority)==null?void 0:g.toLowerCase()]||v.orange}})},[a]),h=p=>n.getNodePosition(p.id,p.defaultX,p.defaultY),d=M.useMemo(()=>{if(!l.length)return{x:0,y:0,width:400,height:300};const p=l.map(x=>x.defaultX),f=l.map(x=>x.defaultY);return{x:Math.min(...p)-100,y:Math.min(...f)-60,width:Math.max(...p)-Math.min(...p)+360,height:Math.max(...f)-Math.min(...f)+220}},[l]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("style",{children:"@keyframes flowDash { to { stroke-dashoffset: -20; } }"}),o.jsxs("div",{ref:n.canvasRef,className:"canvas-bg",onMouseDown:n.handleCanvasMouseDown,onMouseMove:n.handleMouseMove,onMouseUp:n.handleMouseUp,onMouseLeave:n.handleMouseUp,onTouchStart:n.handleTouchStart,onTouchMove:n.handleTouchMove,onTouchEnd:n.handleTouchEnd,onWheel:n.handleWheel,style:{width:"100%",height:"100%",cursor:n.isPanning||n.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*n.zoom}px ${25*n.zoom}px`,backgroundPosition:`${n.pan.x}px ${n.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:o.jsx("marker",{id:"req-arrow",markerWidth:"10",markerHeight:"8",refX:"9",refY:"4",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 4, 0 8",fill:v.orange})})}),o.jsx("g",{transform:`translate(${n.pan.x}, ${n.pan.y}) scale(${n.zoom})`,children:s.map((p,f)=>{const x=l.find(S=>S.id===p.from.toLowerCase().replace(/[^a-z0-9]/g,"_")),g=l.find(S=>S.id===p.to.toLowerCase().replace(/[^a-z0-9]/g,"_"));if(!x||!g)return null;const m=h(x),c=h(g),u=c.x-m.x,b=c.y-m.y,y=Math.sqrt(u*u+b*b)||1;return o.jsxs("g",{children:[o.jsx("line",{x1:m.x+u/y*120,y1:m.y+b/y*65,x2:c.x-u/y*120,y2:c.y-b/y*65,stroke:v.orange,strokeWidth:2,strokeDasharray:"8,4",markerEnd:"url(#req-arrow)",opacity:.8,style:{animation:"flowDash 1s linear infinite"}}),p.label&&o.jsx("text",{x:(m.x+c.x)/2,y:(m.y+c.y)/2-8,textAnchor:"middle",fill:t.textSecondary,fontSize:10,children:p.label})]},f)})})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${n.pan.x}px, ${n.pan.y}px) scale(${n.zoom})`,transformOrigin:"0 0"},children:l.map(p=>{const f=h(p),x=n.dragging===p.id;return o.jsxs("div",{onMouseDown:g=>n.handleNodeMouseDown(g,p.id,f.x,f.y),onTouchStart:g=>n.handleNodeTouchStart(g,p.id,f.x,f.y),style:{position:"absolute",left:f.x-110,top:f.y-55,width:220,height:110,background:`${p.color}15`,border:`2px solid ${p.color}`,borderRadius:12,padding:12,cursor:x?"grabbing":"grab",boxShadow:x?`0 0 30px ${p.color}50`:`0 4px 20px ${p.color}20`,transition:x?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[o.jsx("span",{style:{fontSize:"1.2rem"},children:""}),o.jsx("span",{style:{fontSize:"0.9rem",fontWeight:600,color:t.textPrimary},children:p.name})]}),p.text&&o.jsx("div",{style:{fontSize:"0.75rem",color:t.textSecondary,marginBottom:6,lineHeight:1.3},children:p.text}),o.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[p.priority&&o.jsx("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:`${p.color}30`,color:p.color,borderRadius:4},children:p.priority}),p.risk&&o.jsxs("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",color:t.textSecondary,borderRadius:4},children:["Risk: ",p.risk]})]})]},p.id)})})]}),o.jsx(Re,{onZoomIn:()=>n.setZoom(p=>Math.min(p*1.2,2.5)),onZoomOut:()=>n.setZoom(p=>Math.max(p*.8,.3)),onFit:()=>n.fitToView(d),onReset:n.resetView,zoom:n.zoom})]})}function rw({data:i,theme:t=me.dark,sketchMode:r=!1}){const n=$e({x:50,y:50}),{nodes:a=[],links:s=[]}=i,e=20,l=[v.purple,v.blue,v.cyan,v.emerald,v.green,v.amber,v.orange],h=M.useMemo(()=>{if(!a.length)return{x:0,y:0,width:800,height:500};const f=a.map(m=>m.x),x=a.map(m=>m.y),g=a.map(m=>m.height||30);return{x:Math.min(...f)-40,y:Math.min(...x)-40,width:Math.max(...f)-Math.min(...f)+e+80,height:Math.max(...x.map((m,c)=>m+g[c]))-Math.min(...x)+80}},[a]),d=f=>n.getNodePosition(f.id,f.x,f.y),p=f=>{const x=a.find(k=>k.id===f.source),g=a.find(k=>k.id===f.target);if(!x||!g)return"";const m=d(x),c=d(g),u=m.x+e,b=m.y+(x.height||30)/2,y=c.x,S=c.y+(g.height||30)/2,w=(u+y)/2;return`M ${u} ${b} C ${w} ${b}, ${w} ${S}, ${y} ${S}`};return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:n.canvasRef,className:"canvas-bg",onMouseDown:n.handleCanvasMouseDown,onMouseMove:n.handleMouseMove,onMouseUp:n.handleMouseUp,onMouseLeave:n.handleMouseUp,onTouchStart:n.handleTouchStart,onTouchMove:n.handleTouchMove,onTouchEnd:n.handleTouchEnd,onWheel:n.handleWheel,style:{width:"100%",height:"100%",cursor:n.isPanning||n.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*n.zoom}px ${25*n.zoom}px`,backgroundPosition:`${n.pan.x}px ${n.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:s.map((f,x)=>{const g=a.find(b=>b.id===f.source),m=a.find(b=>b.id===f.target),c=l[((g==null?void 0:g.layer)||0)%l.length],u=l[((m==null?void 0:m.layer)||0)%l.length];return o.jsxs("linearGradient",{id:`sankey-gradient-${x}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:c,stopOpacity:"0.6"}),o.jsx("stop",{offset:"100%",stopColor:u,stopOpacity:"0.6"})]},`grad-${x}`)})}),o.jsx("g",{transform:`translate(${n.pan.x}, ${n.pan.y}) scale(${n.zoom})`,children:s.map((f,x)=>{const g=p(f),m=f.thickness||8;return o.jsxs("g",{children:[o.jsx("path",{d:g,fill:"none",stroke:`url(#sankey-gradient-${x})`,strokeWidth:m,strokeLinecap:"round",opacity:.7}),o.jsx("title",{children:`${f.value}`})]},f.id)})})]}),o.jsx("div",{style:{position:"absolute",transform:`translate(${n.pan.x}px, ${n.pan.y}px) scale(${n.zoom})`,transformOrigin:"0 0"},children:a.map((f,x)=>{const g=d(f),m=n.dragging===f.id,c=l[(f.layer||0)%l.length],u=f.height||30;return o.jsxs("div",{onMouseDown:b=>n.handleNodeMouseDown(b,f.id,g.x,g.y),onTouchStart:b=>n.handleNodeTouchStart(b,f.id,g.x,g.y),style:{position:"absolute",left:g.x,top:g.y,width:e,height:u,background:r?he.stroke:c,borderRadius:3,cursor:m?"grabbing":"grab",boxShadow:m?`0 0 20px ${c}80`:`0 2px 10px ${c}40`,transition:m?"none":"box-shadow 0.2s",touchAction:"none"},children:[o.jsx("div",{style:{position:"absolute",left:e+8,top:"50%",transform:"translateY(-50%)",whiteSpace:"nowrap",fontSize:"0.8rem",fontWeight:500,fontFamily:r?"'Caveat', cursive":"inherit",color:r?he.stroke:t.textPrimary},children:f.label}),o.jsx("div",{style:{position:"absolute",left:e+8,top:"50%",transform:"translateY(50%)",fontSize:"0.65rem",color:t.textSecondary},children:f.value})]},f.id)})})]}),o.jsx(Re,{onZoomIn:()=>n.setZoom(f=>Math.min(f*1.2,2.5)),onZoomOut:()=>n.setZoom(f=>Math.max(f*.8,.3)),onFit:()=>n.fitToView(h),onReset:n.resetView,zoom:n.zoom})]})}function nw({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:50,y:50}),{lanes:l=[],nodes:h=[],edges:d=[]}=i,p=[v.purple,v.blue,v.cyan,v.emerald,v.green,v.amber],f=M.useMemo(()=>{if(!h.length)return{x:0,y:0,width:800,height:400};const c=h.map(S=>S.x),u=h.map(S=>S.y),b=h.map(S=>S.width||140),y=h.map(S=>S.height||50);return{x:Math.min(...c)-200,y:Math.min(...u)-40,width:Math.max(...c.map((S,w)=>S+b[w]))-Math.min(...c)+280,height:Math.max(...u.map((S,w)=>S+y[w]))-Math.min(...u)+80}},[h]),x=c=>e.getNodePosition(c.id,c.x,c.y),g=c=>{const u=h.find(J=>J.id===c.source),b=h.find(J=>J.id===c.target);if(!u||!b)return"";const y=x(u),S=x(b),w=u.width||140,k=u.height||50,j=b.width||140,C=b.height||50,E=y.x+w/2,R=y.y+k/2,T=S.x+j/2,I=S.y+C/2;let B,z,D,U;const N=T-E,H=I-R;Math.abs(N)>Math.abs(H)?(B=N>0?y.x+w:y.x,z=R,D=N>0?S.x:S.x+j,U=I):(B=E,z=H>0?y.y+k:y.y,D=T,U=H>0?S.y:S.y+C);const ee=(B+D)/2,ne=(z+U)/2;return Math.abs(N)>Math.abs(H)?`M ${B} ${z} L ${ee} ${z} L ${ee} ${U} L ${D} ${U}`:`M ${B} ${z} L ${B} ${ne} L ${D} ${ne} L ${D} ${U}`},m=c=>{switch(c){case"start":return{borderRadius:"50%",width:30,height:30,background:v.green};case"end":return{borderRadius:"50%",width:30,height:30,background:v.red,border:"3px solid"};case"diamond":return{borderRadius:4,transform:"rotate(45deg)",width:40,height:40};case"document":return{borderRadius:"0 0 8px 8px",clipPath:"polygon(0 0, 100% 0, 100% 85%, 50% 100%, 0 85%)"};case"parallelogram":return{transform:"skewX(-10deg)"};default:return{borderRadius:8}}};return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`linear-gradient(${t.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${t.gridColor} 1px, transparent 1px)`,backgroundSize:`${25*e.zoom}px ${25*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsx("defs",{children:o.jsx("marker",{id:"swimlane-arrow",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:o.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:t.textSecondary})})}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[l.map((c,u)=>{const y=p[u%p.length];return o.jsxs("g",{children:[o.jsx("rect",{x:0,y:c.y,width:1200,height:c.height,fill:y,fillOpacity:.05,stroke:y,strokeOpacity:.3,strokeWidth:1,rx:4}),u<l.length-1&&o.jsx("line",{x1:0,y1:c.y+c.height,x2:1200,y2:c.y+c.height,stroke:t.border,strokeWidth:1,strokeDasharray:"5,5"})]},c.id)}),d.map(c=>{const u=g(c);return o.jsxs("g",{children:[o.jsx("path",{d:u,fill:"none",stroke:r?he.stroke:t.textSecondary,strokeWidth:2,markerEnd:"url(#swimlane-arrow)",opacity:.7}),c.label&&o.jsx("text",{x:0,y:0,fill:t.textSecondary,fontSize:"0.7rem",fontFamily:r?"'Caveat', cursive":"inherit",textAnchor:"middle",children:o.jsx("textPath",{href:`#edge-path-${c.id}`,startOffset:"50%",children:c.label})})]},c.id)})]})]}),o.jsxs("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:[l.map((c,u)=>{const b=p[u%p.length];return o.jsx("div",{style:{position:"absolute",left:0,top:c.y,width:160,height:c.height,display:"flex",alignItems:"center",justifyContent:"center",padding:"0 16px",background:`${b}15`,borderRight:`2px solid ${b}50`,borderRadius:"4px 0 0 4px"},children:o.jsx("span",{style:{color:r?he.stroke:b,fontWeight:600,fontSize:"0.85rem",fontFamily:r?"'Caveat', cursive":"inherit",textAlign:"center",wordBreak:"break-word"},children:c.name})},`lane-header-${c.id}`)}),h.map(c=>{const u=x(c),b=e.dragging===c.id,y=l.find(C=>C.id===c.lane),S=l.indexOf(y),w=p[S%p.length]||v.purple,k=m(c.type),j=["start","end","diamond"].includes(c.type);return o.jsx("div",{onMouseDown:C=>e.handleNodeMouseDown(C,c.id,u.x,u.y),onTouchStart:C=>e.handleNodeTouchStart(C,c.id,u.x,u.y),style:{position:"absolute",left:u.x,top:u.y,width:j?k.width:c.width||140,height:j?k.height:c.height||50,background:k.background||(r?he.bg:`${w}20`),border:`2px solid ${r?he.stroke:w}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:b?"grabbing":"grab",boxShadow:b?`0 0 20px ${w}50`:"0 2px 8px rgba(0,0,0,0.2)",transition:b?"none":"box-shadow 0.2s",touchAction:"none",...k},children:!j&&o.jsx("span",{style:{color:r?he.stroke:t.textPrimary,fontSize:"0.8rem",fontWeight:500,fontFamily:r?"'Caveat', cursive":"inherit",textAlign:"center",padding:"4px 8px",wordBreak:"break-word",transform:c.type==="diamond"?"rotate(-45deg)":"none"},children:c.label})},c.id)})]})]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(c=>Math.min(c*1.2,2.5)),onZoomOut:()=>e.setZoom(c=>Math.max(c*.8,.3)),onFit:()=>e.fitToView(f),onReset:e.resetView,zoom:e.zoom})]})}function Dg({data:i,theme:t=me.dark,sketchMode:r=!1,onLabelChange:n,onDeleteNodes:a,onPasteNodes:s}){const e=$e({x:50,y:50}),{actors:l=[],useCases:h=[],relationships:d=[]}=i,{actorPositions:p,useCasePositions:f}=M.useMemo(()=>{const w=new Map;l.forEach(I=>w.set(I.label.toLowerCase(),[])),d.forEach(I=>{const B=I.from.toLowerCase(),z=I.to.toLowerCase();w.has(B)&&w.get(B).push(z)});const k=[],j=new Set;let C=120;const E=110,R=450;return l.forEach((I,B)=>{(w.get(I.label.toLowerCase())||[]).forEach(D=>{const U=h.find(N=>N.label.toLowerCase()===D);U&&!j.has(U.id)&&(k.push({...U,x:R,y:C,actorIndex:B}),j.add(U.id),C+=E)})}),h.forEach(I=>{j.has(I.id)||(k.push({...I,x:R,y:C,actorIndex:-1}),C+=E)}),{actorPositions:l.map((I,B)=>{const z=k.filter(U=>U.actorIndex===B);let D;if(z.length>0){const U=Math.min(...z.map(H=>H.y)),N=Math.max(...z.map(H=>H.y));D=(U+N)/2}else D=150+B*180;return{...I,x:120,y:D}}),useCasePositions:k}},[l,h,d]),x=w=>e.getNodePosition(w.id,w.x,w.y),g=w=>e.getNodePosition(w.id,w.x,w.y),m=M.useMemo(()=>d.map((w,k)=>{const j=p.find(E=>E.label.toLowerCase()===w.from.toLowerCase()),C=f.find(E=>E.label.toLowerCase()===w.to.toLowerCase());return j&&C?{id:`conn-${k}`,from:j,to:C}:null}).filter(Boolean),[d,p,f]),c=M.useMemo(()=>{if(f.length===0)return{x:280,y:40,width:400,height:300};const w=f.map(C=>C.x),k=f.map(C=>C.y),j=100;return{x:Math.min(...w)-j,y:Math.min(...k)-j-20,width:Math.max(...w)-Math.min(...w)+j*2+140,height:Math.max(...k)-Math.min(...k)+j*2+80}},[f]),u=M.useMemo(()=>{const w=[...p.map(T=>T.x),...f.map(T=>T.x)],k=[...p.map(T=>T.y),...f.map(T=>T.y)];if(w.length===0)return{x:0,y:0,width:400,height:300};const j=Math.min(...w)-100,C=Math.max(...w)+100,E=Math.min(...k)-80,R=Math.max(...k)+80;return{x:j,y:E,width:C-j,height:R-E}},[p,f]),b=M.useMemo(()=>[...p,...f],[p,f]),y=M.useCallback(()=>{const w=e.finishEditing();if(w.nodeId&&w.newValue!==void 0&&n){const k=b.find(j=>j.id===w.nodeId);k&&k.label!==w.newValue&&n(w.nodeId,k.label,w.newValue)}},[e,b,n]);M.useEffect(()=>{const w=k=>{const C=/Mac|iPhone|iPad|iPod/.test(navigator.platform)?k.metaKey:k.ctrlKey;if(!e.editingNode){if((k.key==="Delete"||k.key==="Backspace")&&e.selectedNodes.size>0&&a){k.preventDefault(),a(Array.from(e.selectedNodes)),e.clearSelection();return}if(C&&k.key.toLowerCase()==="c"&&e.selectedNodes.size>0){k.preventDefault(),e.copySelectedNodes(b);return}if(C&&k.key.toLowerCase()==="v"&&e.clipboard&&s){k.preventDefault();const E=e.pasteNodes();E&&s(E);return}}};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[e,b,a,s]),M.useEffect(()=>{if(!e.isSelecting&&e.selectionBox){const w=e.getNodesInSelectionBox(b,e.selectionBox);w.length>0&&e.setSelectedNodes(new Set(w))}},[e.isSelecting,e.selectionBox,b,e]);const S=M.useCallback(w=>{(w.target===e.canvasRef.current||w.target.classList.contains("canvas-bg"))&&(e.clearSelection(),e.closeContextMenu())},[e]);return o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:t.canvasBg,borderRadius:12,border:`1px solid ${t.border}`,touchAction:"none"},children:[o.jsx("style",{children:`
        @keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes flow { from { stroke-dashoffset: 20; } to { stroke-dashoffset: 0; } }
      `}),o.jsxs("div",{ref:e.canvasRef,className:"canvas-bg",onClick:S,onMouseDown:e.handleCanvasMouseDown,onMouseMove:e.handleMouseMove,onMouseUp:e.handleMouseUp,onMouseLeave:e.handleMouseUp,onTouchStart:e.handleTouchStart,onTouchMove:e.handleTouchMove,onTouchEnd:e.handleTouchEnd,onWheel:e.handleWheel,style:{width:"100%",height:"100%",cursor:e.isPanning||e.dragging?"grabbing":"grab",touchAction:"none"},children:[o.jsx("div",{className:"canvas-bg",style:{position:"absolute",inset:0,backgroundImage:`radial-gradient(circle at 1px 1px, ${t.gridColor} 1px, transparent 0)`,backgroundSize:`${30*e.zoom}px ${30*e.zoom}px`,backgroundPosition:`${e.pan.x}px ${e.pan.y}px`,pointerEvents:"none"}}),o.jsxs("svg",{width:"100%",height:"100%",style:{position:"absolute",overflow:"visible",pointerEvents:"none"},children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"uc-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:v.purple}),o.jsx("stop",{offset:"100%",stopColor:v.blue})]}),o.jsxs("filter",{id:"uc-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"blur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsxs("g",{transform:`translate(${e.pan.x}, ${e.pan.y}) scale(${e.zoom})`,children:[o.jsx("rect",{x:c.x,y:c.y,width:c.width,height:c.height,fill:"rgba(124, 58, 237, 0.03)",rx:24}),o.jsx("rect",{x:c.x,y:c.y,width:c.width,height:c.height,fill:"none",stroke:"url(#uc-gradient)",strokeWidth:2,rx:24,opacity:"0.4"}),o.jsx("text",{x:c.x+c.width/2,y:c.y+30,textAnchor:"middle",fill:v.purple,fontSize:13,fontWeight:"600",fontFamily:"system-ui, sans-serif",opacity:"0.8",children:"System Boundary"}),m.map((w,k)=>{const j=x(w.from),C=g(w.to),E=j.x+45,R=j.y,T=C.x-85,I=C.y,B=`M ${E} ${R} L ${T} ${I}`;return o.jsxs("g",{children:[o.jsx("path",{d:B,fill:"none",stroke:v.purple,strokeWidth:4,strokeLinecap:"round",opacity:"0.15"}),o.jsx("path",{d:B,fill:"none",stroke:"url(#uc-gradient)",strokeWidth:1.5,strokeLinecap:"round",opacity:"0.6"}),o.jsx("path",{d:B,fill:"none",stroke:"rgba(255,255,255,0.8)",strokeWidth:1.5,strokeLinecap:"round",strokeDasharray:"2,10",style:{animation:"flow 0.6s linear infinite",animationDelay:`${k*.15}s`}})]},w.id)}),e.isSelecting&&e.selectionBox&&o.jsx("rect",{x:Math.min(e.selectionBox.startX,e.selectionBox.endX),y:Math.min(e.selectionBox.startY,e.selectionBox.endY),width:Math.abs(e.selectionBox.endX-e.selectionBox.startX),height:Math.abs(e.selectionBox.endY-e.selectionBox.startY),fill:`${v.blue}20`,stroke:v.blue,strokeWidth:1,strokeDasharray:"4,4"})]})]}),o.jsxs("div",{style:{position:"absolute",transform:`translate(${e.pan.x}px, ${e.pan.y}px) scale(${e.zoom})`,transformOrigin:"0 0"},children:[p.map(w=>{const k=x(w),j=e.dragging===w.id,C=e.selectedNodes.has(w.id);return o.jsxs("div",{onClick:E=>e.handleNodeClick(E,w.id),onDoubleClick:E=>e.handleNodeDoubleClick(E,w.id,w.label),onContextMenu:E=>e.handleNodeContextMenu(E,w.id),onMouseDown:E=>e.handleNodeMouseDown(E,w.id,k.x,k.y),onTouchStart:E=>e.handleNodeTouchStart(E,w.id,k.x,k.y),style:{position:"absolute",left:k.x-45,top:k.y-55,width:90,display:"flex",flexDirection:"column",alignItems:"center",cursor:j?"grabbing":"grab",transition:j?"none":"transform 0.2s",transform:j?"scale(1.05)":"scale(1)",touchAction:"none"},children:[o.jsx("div",{style:{width:70,height:70,borderRadius:"50%",background:`linear-gradient(135deg, ${v.pink}35, ${v.purple}15)`,border:`2px solid ${C?v.blue:v.pink}`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:He(v.pink,j,C),transition:"box-shadow 0.2s"},children:o.jsxs("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("circle",{cx:"12",cy:"8",r:"4",stroke:v.pink,strokeWidth:"1.5",fill:`${v.pink}20`}),o.jsx("path",{d:"M4 20c0-4 4-6 8-6s8 2 8 6",stroke:v.pink,strokeWidth:"1.5",strokeLinecap:"round",fill:"none"})]})}),o.jsx("div",{style:{marginTop:10,padding:"4px 12px",background:"rgba(0,0,0,0.4)",borderRadius:12,backdropFilter:"blur(8px)"},children:e.editingNode===w.id?o.jsx(Ue,{value:e.editingValue,onChange:E=>e.setEditingValue(E),onFinish:y,style:{fontSize:r?14:12,fontWeight:600,color:r?he.stroke:t.textPrimary}}):o.jsx("span",{style:{fontSize:r?14:12,fontWeight:600,color:r?he.stroke:t.textPrimary},children:w.label})})]},w.id)}),f.map(w=>{const k=g(w),j=e.dragging===w.id,C=e.selectedNodes.has(w.id);return o.jsx("div",{onClick:E=>e.handleNodeClick(E,w.id),onDoubleClick:E=>e.handleNodeDoubleClick(E,w.id,w.label),onContextMenu:E=>e.handleNodeContextMenu(E,w.id),onMouseDown:E=>e.handleNodeMouseDown(E,w.id,k.x,k.y),onTouchStart:E=>e.handleNodeTouchStart(E,w.id,k.x,k.y),style:{position:"absolute",left:k.x-80,top:k.y-35,width:160,height:70,background:`linear-gradient(135deg, ${v.blue}25, ${v.purple}15)`,border:`1.5px solid ${C?v.blue:"rgba(14, 165, 233, 0.5)"}`,borderRadius:35,display:"flex",alignItems:"center",justifyContent:"center",cursor:j?"grabbing":"grab",boxShadow:He(v.blue,j,C),backdropFilter:"blur(8px)",transition:j?"none":"box-shadow 0.2s, transform 0.2s",transform:j?"scale(1.03)":"scale(1)",touchAction:"none"},children:e.editingNode===w.id?o.jsx(Ue,{value:e.editingValue,onChange:E=>e.setEditingValue(E),onFinish:y,style:{fontSize:r?14:12,fontWeight:500,color:r?he.stroke:t.textPrimary,textAlign:"center"}}):o.jsx("span",{style:{fontSize:r?14:12,fontWeight:500,color:r?he.stroke:t.textPrimary,textAlign:"center",padding:"0 12px",lineHeight:1.3},children:w.label})},w.id)})]})]}),e.selectedNodes.size>0&&o.jsxs("div",{style:{position:"absolute",top:12,left:12,background:"rgba(0,0,0,0.8)",padding:"6px 12px",borderRadius:6,fontSize:"0.75rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{children:[e.selectedNodes.size," selected"]}),o.jsx("span",{style:{opacity:.6},children:"|"}),o.jsx("span",{style:{opacity:.7},children:"Del to delete  C copy  V paste"})]}),e.clipboard&&o.jsxs("div",{style:{position:"absolute",top:e.selectedNodes.size>0?48:12,left:12,background:`${v.green}20`,padding:"4px 10px",borderRadius:4,fontSize:"0.7rem",color:v.green,border:`1px solid ${v.green}40`},children:[e.clipboard.length," node",e.clipboard.length>1?"s":""," copied"]}),o.jsx(Re,{onZoomIn:()=>e.setZoom(w=>Math.min(w*1.15,3)),onZoomOut:()=>e.setZoom(w=>Math.max(w*.85,.2)),onFit:()=>e.fitToView(u),onReset:e.resetView,zoom:e.zoom}),e.contextMenu&&o.jsx(Ke,{position:e.contextMenu,onClose:()=>e.closeContextMenu(),nodeId:e.contextMenu.nodeId})]})}function Lg({type:i,data:t,source:r,theme:n="dark",sketchMode:a=!1,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l,onEdgeLabelChange:h,onCreateConnection:d,onLinkedTemplateClick:p}){var g;const f=me[n]||me.dark,x=M.useMemo(()=>{if(t)return t;if(!r)return null;const m=bg;switch(i){case"mindmap":case"wbs":return m.markdown(r);case"erd":return m.sql(r);case"flowchart":return m.flowchart(r);case"architecture":return m.architecture(r);case"state":return m.stateMachine(r);case"journey":return m.userJourney(r);case"timeline":return m.timeline(r);case"sequence":return m.sequence(r);case"orgchart":return m.orgChart(r);case"network":return m.network(r);case"gantt":return m.gantt(r);case"deployment":return m.deployment(r);case"pie":return m.pie(r);case"quadrant":return m.quadrant(r);case"git":return m.git(r);case"wireframe":return m.wireframe(r);case"class":return m.classDiagram(r);case"activity":return m.activity(r);case"usecase":return m.useCase(r);case"component":return m.component(r);case"c4":return m.c4(r);case"requirement":return m.requirement(r);case"sankey":return m.sankey(r);case"swimlane":return m.swimlane(r);default:return null}},[i,t,r]);if(!x)return o.jsx("div",{style:{padding:20,color:"#888"},children:"No data"});switch(i){case"mindmap":case"wbs":return o.jsx(vg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"erd":return o.jsx(kg,{tables:Array.isArray(x)?x:[],theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"architecture":return o.jsx(wg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"flowchart":return o.jsx(jr,{nodes:x.nodes||[],edges:x.edges||[],theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l,onEdgeLabelChange:h,onCreateConnection:d});case"state":return o.jsx(jr,{nodes:x.states||[],edges:((g=x.transitions)==null?void 0:g.map((m,c)=>({id:`t-${c}`,source:m.from,target:m.to,label:m.event})))||[],theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l,onEdgeLabelChange:h,onCreateConnection:d});case"activity":return o.jsx(jr,{nodes:x.nodes||[],edges:x.edges||[],theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l,onEdgeLabelChange:h,onCreateConnection:d});case"journey":return o.jsx(Sg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l,onLinkedTemplateClick:p});case"timeline":return o.jsx($g,{events:x,theme:f,sketchMode:a});case"sequence":return o.jsx(Mg,{data:x,theme:f,sketchMode:a});case"orgchart":return o.jsx(Eg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"network":return o.jsx(jg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"gantt":return o.jsx(_g,{tasks:x,theme:f,sketchMode:a});case"deployment":return o.jsx(Tg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"pie":return o.jsx(Ig,{data:x,theme:f,sketchMode:a});case"quadrant":return o.jsx(Ag,{data:x,theme:f,sketchMode:a});case"git":return o.jsx(Rg,{data:x,theme:f,sketchMode:a});case"wireframe":return o.jsx(Pg,{data:x,theme:f,sketchMode:a});case"class":return o.jsx(Cg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"usecase":return o.jsx(Dg,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"component":return o.jsx(J2,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"c4":return o.jsx(ew,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});case"requirement":return o.jsx(tw,{data:x,theme:f,sketchMode:a});case"sankey":return o.jsx(rw,{data:x,theme:f,sketchMode:a});case"swimlane":return o.jsx(nw,{data:x,theme:f,sketchMode:a,onLabelChange:s,onDeleteNodes:e,onPasteNodes:l});default:return o.jsxs("div",{style:{padding:20,color:"#888"},children:["Unknown: ",i]})}}function iw({isOpen:i,onClose:t}){if(!i)return null;const r=o2(),n=typeof navigator<"u"&&/Mac|iPhone|iPad|iPod/.test(navigator.platform);return o.jsx("div",{style:{position:"fixed",inset:0,zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"},onClick:t,children:o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",borderRadius:16,padding:24,maxWidth:600,width:"90%",maxHeight:"80vh",overflow:"auto",border:"1px solid rgba(124,58,237,0.3)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},onClick:a=>a.stopPropagation(),children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:" Keyboard Shortcuts"}),o.jsx("button",{onClick:t,style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,padding:"6px 12px",color:"#888",cursor:"pointer",fontSize:"0.875rem"},children:"ESC"})]}),o.jsx("p",{style:{color:"#888",fontSize:"0.75rem",marginBottom:16},children:n?"Using  (Command) for keyboard shortcuts":"Using Ctrl for keyboard shortcuts"}),Object.entries(r).map(([a,s])=>o.jsxs("div",{style:{marginBottom:20},children:[o.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"0.7rem",color:v.purple,textTransform:"uppercase",letterSpacing:"0.1em"},children:a}),o.jsx("div",{style:{display:"grid",gap:6},children:s.map(e=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",background:"rgba(255,255,255,0.03)",borderRadius:8,border:"1px solid rgba(255,255,255,0.05)"},children:[o.jsx("span",{style:{color:"#e0e0e0",fontSize:"0.8rem"},children:e.description}),o.jsx("kbd",{style:{background:"rgba(124,58,237,0.2)",padding:"4px 8px",borderRadius:4,fontSize:"0.7rem",color:"#a78bfa",fontFamily:"monospace",border:"1px solid rgba(124,58,237,0.3)"},children:e.formatted})]},e.name))})]},a)),o.jsx("div",{style:{marginTop:20,padding:12,background:"rgba(16,185,129,0.1)",borderRadius:8,border:"1px solid rgba(16,185,129,0.2)"},children:o.jsxs("p",{style:{margin:0,color:v.green,fontSize:"0.75rem"},children:[" Tip: Press ",o.jsx("kbd",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:4,margin:"0 4px"},children:"?"})," anytime to show this help"]})})]})})}function ow({isOpen:i,onClose:t,onSelect:r,onRemove:n}){const[a,s]=M.useState([]);return M.useEffect(()=>{i&&s(Pc())},[i]),i?o.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"},onClick:t,children:o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",borderRadius:16,padding:24,maxWidth:500,width:"90%",maxHeight:"70vh",overflow:"auto",border:"1px solid rgba(124,58,237,0.3)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:" Recent Diagrams"}),o.jsx("button",{onClick:t,style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,padding:"6px 12px",color:"#888",cursor:"pointer",fontSize:"0.875rem"},children:"ESC"})]}),a.length===0?o.jsxs("div",{style:{padding:40,textAlign:"center",color:"#666"},children:[o.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),o.jsx("p",{style:{margin:0},children:"No recent diagrams"}),o.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"0.75rem"},children:"Save a diagram to see it here"})]}):o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:a.map((e,l)=>{var h,d;return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",background:"rgba(255,255,255,0.03)",borderRadius:10,border:"1px solid rgba(255,255,255,0.05)",cursor:"pointer",transition:"all 0.2s"},onClick:()=>{r(e),t()},onMouseEnter:p=>p.currentTarget.style.background="rgba(124,58,237,0.1)",onMouseLeave:p=>p.currentTarget.style.background="rgba(255,255,255,0.03)",children:[o.jsx("div",{style:{fontSize:24},children:((d=(h=Xt[e.type])==null?void 0:h.title)==null?void 0:d.split(" ")[0])||""}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{color:"#e0e0e0",fontWeight:600,fontSize:"0.9rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),o.jsxs("div",{style:{color:"#666",fontSize:"0.7rem",display:"flex",gap:8},children:[o.jsx("span",{children:e.type}),o.jsx("span",{children:""}),o.jsx("span",{children:bv(e.savedAt)})]})]}),o.jsx("button",{onClick:p=>{p.stopPropagation(),n(e.name),s(f=>f.filter(x=>x.name!==e.name))},style:{background:"rgba(239,68,68,0.1)",border:"none",borderRadius:6,padding:"4px 8px",color:v.red,cursor:"pointer",fontSize:"0.7rem"},title:"Remove from recent",children:""})]},`${e.name}-${l}`)})}),o.jsx("div",{style:{marginTop:20,paddingTop:16,borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",gap:8},children:o.jsx("button",{onClick:async()=>{try{const e=await xv();r(e),t()}catch(e){alert(e.message)}},style:{flex:1,padding:"10px 16px",background:"rgba(16,185,129,0.2)",border:"1px solid rgba(16,185,129,0.3)",borderRadius:8,color:v.green,cursor:"pointer",fontWeight:600,fontSize:"0.85rem"},children:" Import .ddflow File"})})]})}):null}function aw({isOpen:i,onClose:t,onImport:r}){const[n,a]=M.useState(""),[s,e]=M.useState(""),[l,h]=M.useState(null);M.useEffect(()=>{i||(a(""),e(""),h(null))},[i]);const d=()=>{try{e("");const f=C2(n);h(f)}catch(f){e(f.message),h(null)}},p=()=>{l&&(r(l.type,l.source),t())};return i?o.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"},onClick:t,children:o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",borderRadius:16,padding:24,maxWidth:700,width:"90%",maxHeight:"85vh",overflow:"auto",border:"1px solid rgba(124,58,237,0.3)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},onClick:f=>f.stopPropagation(),children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:" Import from Mermaid"}),o.jsx("button",{onClick:t,style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,padding:"6px 12px",color:"#888",cursor:"pointer",fontSize:"0.875rem"},children:"ESC"})]}),o.jsx("p",{style:{color:"#888",fontSize:"0.8rem",marginBottom:16},children:"Paste your Mermaid diagram code below. Supported: flowchart, sequence, class, state, erDiagram, gantt, pie, gitGraph, journey, mindmap"}),o.jsx("textarea",{value:n,onChange:f=>{a(f.target.value),e(""),h(null)},placeholder:`flowchart TD
    A[Start] --> B{Decision}
    B -->|Yes| C[OK]
    B -->|No| D[Cancel]`,style:{width:"100%",height:200,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:8,padding:12,color:"#a78bfa",fontFamily:"Monaco, monospace",fontSize:"0.75rem",lineHeight:1.5,resize:"vertical",outline:"none",boxSizing:"border-box"}}),s&&o.jsx("div",{style:{marginTop:12,padding:12,background:"rgba(239,68,68,0.1)",borderRadius:8,border:"1px solid rgba(239,68,68,0.3)"},children:o.jsxs("div",{style:{color:v.red,fontSize:"0.8rem"},children:[" ",s]})}),l&&o.jsxs("div",{style:{marginTop:16},children:[o.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:o.jsxs("span",{style:{color:v.green,fontSize:"0.85rem"},children:[" Detected: ",o.jsx("strong",{children:l.type})]})}),o.jsx("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:8,padding:12,border:"1px solid rgba(16,185,129,0.3)",maxHeight:150,overflow:"auto"},children:o.jsx("pre",{style:{margin:0,color:"#a78bfa",fontSize:"0.7rem",fontFamily:"Monaco, monospace",whiteSpace:"pre-wrap"},children:l.source})})]}),o.jsxs("div",{style:{marginTop:20,display:"flex",gap:8},children:[o.jsx("button",{onClick:d,disabled:!n.trim(),style:{flex:1,padding:"10px 16px",background:"rgba(124,58,237,0.2)",border:"1px solid rgba(124,58,237,0.3)",borderRadius:8,color:v.purple,cursor:n.trim()?"pointer":"not-allowed",fontWeight:600,fontSize:"0.85rem",opacity:n.trim()?1:.5},children:" Preview Conversion"}),o.jsx("button",{onClick:p,disabled:!l,style:{flex:1,padding:"10px 16px",background:l?"rgba(16,185,129,0.2)":"rgba(255,255,255,0.05)",border:`1px solid ${l?"rgba(16,185,129,0.3)":"rgba(255,255,255,0.1)"}`,borderRadius:8,color:l?v.green:"#666",cursor:l?"pointer":"not-allowed",fontWeight:600,fontSize:"0.85rem"},children:" Import to Editor"})]})]})}):null}function sw({isOpen:i,onClose:t,diagramType:r,diagramSource:n}){const[a,s]=M.useState(""),[e,l]=M.useState(""),[h,d]=M.useState(!1);M.useEffect(()=>{if(i&&r&&n)try{const x=L2(r,n);s(x),l("")}catch(x){s(""),l(x.message)}},[i,r,n]),M.useEffect(()=>{i||d(!1)},[i]);const p=async()=>{try{await B2(a),d(!0),setTimeout(()=>d(!1),2e3)}catch(x){l("Failed to copy: "+x.message)}},f=()=>{z2(a,`ddflow-${r}`)};return i?o.jsx("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"},onClick:t,children:o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(15,23,42,0.98), rgba(30,41,59,0.98))",borderRadius:16,padding:24,maxWidth:600,width:"90%",maxHeight:"80vh",overflow:"auto",border:"1px solid rgba(124,58,237,0.3)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},onClick:x=>x.stopPropagation(),children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",color:"#fff",display:"flex",alignItems:"center",gap:8},children:" Export as Mermaid"}),o.jsx("button",{onClick:t,style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,padding:"6px 12px",color:"#888",cursor:"pointer",fontSize:"0.875rem"},children:"ESC"})]}),e?o.jsx("div",{style:{padding:20,background:"rgba(239,68,68,0.1)",borderRadius:8,border:"1px solid rgba(239,68,68,0.3)"},children:o.jsxs("div",{style:{color:v.red,fontSize:"0.85rem"},children:[" ",e]})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:o.jsxs("span",{style:{color:v.green,fontSize:"0.85rem"},children:[" Converted from: ",o.jsx("strong",{children:r})]})}),o.jsx("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:8,padding:16,border:"1px solid rgba(124,58,237,0.2)",maxHeight:300,overflow:"auto"},children:o.jsx("pre",{style:{margin:0,color:"#a78bfa",fontSize:"0.75rem",fontFamily:"Monaco, monospace",whiteSpace:"pre-wrap"},children:a})}),o.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[o.jsx("button",{onClick:p,style:{flex:1,padding:"10px 16px",background:h?"rgba(16,185,129,0.3)":"rgba(14,165,233,0.2)",border:`1px solid ${h?"rgba(16,185,129,0.3)":"rgba(14,165,233,0.3)"}`,borderRadius:8,color:h?v.green:v.blue,cursor:"pointer",fontWeight:600,fontSize:"0.85rem"},children:h?" Copied!":" Copy to Clipboard"}),o.jsx("button",{onClick:f,style:{flex:1,padding:"10px 16px",background:"rgba(124,58,237,0.2)",border:"1px solid rgba(124,58,237,0.3)",borderRadius:8,color:v.purple,cursor:"pointer",fontWeight:600,fontSize:"0.85rem"},children:" Download .mmd"})]})]})]})}):null}const Xt={journey:{title:" Journey",source:`[actor] User
[page] Landing Page
[action] Sign Up
[email] Verify Email
[page] Onboarding
[page] Dashboard
[notification] Welcome!

User -Visit-> Landing Page
Landing Page -Click CTA-> Sign Up
Sign Up -Submit-> Verify Email
Verify Email -Confirm-> Onboarding
Onboarding -Complete-> Dashboard
Dashboard -> Welcome!`},mindmap:{title:" Mind Map",source:`Project
  Goals
    Revenue
    Growth
  Features
    Auth
    Dashboard
  Stack
    React
    Node`},architecture:{title:" Architecture",source:`# Modern Cloud Architecture
[users] Web App, Mobile App
[cdn] CloudFront CDN
[lb] Load Balancer
[gateway] API Gateway

boundary "Backend Services" {
[microservices] Auth Service, User Service, Order Service
[worker] Background Worker
}

boundary "Data Layer" {
[database] PostgreSQL: Primary DB
[cache] Redis: Session cache
[queue] Kafka: Event stream
}

[monitoring] Prometheus, Grafana

# Connections
Web App -> CloudFront CDN
Mobile App -> Load Balancer
CloudFront CDN -> Load Balancer
Load Balancer -> API Gateway
API Gateway -> Auth Service
API Gateway -> User Service
API Gateway -> Order Service
Auth Service --> Redis: sessions
User Service -> PostgreSQL
Order Service -> PostgreSQL
Order Service ->> Kafka: events
Background Worker -> Kafka
Prometheus --> Auth Service: metrics
Prometheus --> User Service: metrics`},erd:{title:" ERD",source:`CREATE TABLE users (id UUID PRIMARY KEY, email VARCHAR(255), name VARCHAR(100));
CREATE TABLE posts (id UUID PRIMARY KEY, title VARCHAR(200), user_id UUID REFERENCES users(id));`},sequence:{title:" Sequence",source:`participant Client, API, DB

Client -> API: Request
API -> DB: Query
DB --> API: Result
API --> Client: Response`},flowchart:{title:" Flowchart",source:`(start) Start
Start -> (process) Process
Process -> (decision) Valid?
Valid? -> (end) Done
Valid? -> (io) Error`},state:{title:" State",source:`(initial) Idle
(final) Done

Idle -> Loading: FETCH
Loading -> Done: SUCCESS
Loading -> Idle: FAIL`},timeline:{title:" Timeline",source:`[Jan] *Kickoff | Started
[Mar] Design | UI done
[Jun] *MVP | Core ready
[Sep] Launch | Public`},orgchart:{title:" Org Chart",source:`CEO [Chief Executive]
  CTO [Technology]
    Dev Lead
    QA Lead
  CFO [Finance]`},network:{title:" Network",source:`[cloud] Internet
[firewall] Firewall (10.0.0.1)
[router] Router (10.0.0.2)
[server] Server (10.0.0.10)

Internet -- Firewall
Firewall -- Router
Router -- Server`},gantt:{title:" Gantt",source:`Research, 0, 2
Design, 2, 3
Develop, 5, 4
Test, 9, 2
Launch, 11, 1`},deployment:{title:" Deployment",source:`[cloud] AWS
  [cluster] K8s
    [container] API
    [container] Worker
  [database] RDS
[device] Browser`},pie:{title:" Pie",source:`"JavaScript": 40
"Python": 25
"TypeScript": 20
"Go": 15`},quadrant:{title:" Quadrant",source:`title: Tech Matrix
x-axis: Effort 
y-axis: Impact 
quadrant-1: Quick Wins
quadrant-2: Big Projects
quadrant-3: Fill-ins
quadrant-4: Thankless

React: [30, 90]
Refactor: [80, 70]
Docs: [20, 40]`},git:{title:" Git",source:`commit "Initial"
commit "Feature A"
branch develop
commit "Dev work"
checkout main
commit "Hotfix"
merge develop`},wireframe:{title:" Wireframe",source:`{Dashboard App}
[[  Home |  Analytics |  Profile |  Settings | [Upgrade] ]]

>> Home > Dashboard

---

[hero: Welcome to Your Dashboard | Track your progress, manage tasks, and achieve your goals. | Get Started]

---

## Key Metrics

[stat: 2,847 | Active Users | +12%]

[stat: $48,294 | Revenue | +8.5%]

[stat: 156 | New Orders | +23%]

---

## Quick Actions

[widget: Tasks | 12 | ]

[widget: Messages | 5 | ]

[widget: Reports | 3 | ]

---

## Features

[feature:  | Fast Performance | Lightning-fast load times with optimized delivery.]

[feature:  | Secure by Default | Enterprise-grade security with encryption.]

[feature:  | Real-time Analytics | Live insights into your business metrics.]

---

## Recent Activity

[activity: John completed project review | 5 min ago]

[activity: Sarah uploaded new design files | 1 hour ago]

[activity: Team meeting scheduled | 2 hours ago]

---

## Data Overview

[data-table: 4 rows]

---

## Quick Upload

[upload: Drop files here or click to browse]

---

[toast: Changes saved successfully | success]

[fab: +]

---

[footer: Product | Pricing | Support :: Company | About | Careers ::  2024 App Inc.]`},class:{title:" Class",source:`class User
+id: string
+name: string
-password: string
+login(): boolean
+getPosts(): Post[]

class Post
+id: string
+title: string
+content: string
+userId: string
+publish(): void

User --> Post : has many
User --* Post : owns`},activity:{title:" Activity",source:`[start]
:Open App;
:Login;
<Valid?>
:Dashboard;
:Error;
[end]

start -> Open App
Open App -> Login
Login -> Valid?
Valid? -> Dashboard: Yes
Valid? -> Error: No
Dashboard -> end
Error -> Login`},usecase:{title:" Use Case",source:`actor Customer
actor Admin
(Browse Products)
(Checkout)
(Manage Inventory)
(View Reports)

Customer -> Browse Products
Customer -> Checkout
Admin -> Manage Inventory
Admin -> View Reports`},component:{title:" Component",source:`[service] Frontend
[api] API Gateway
[service] Auth Service
[database] Database
[cache] Redis Cache

Frontend --> API Gateway
API Gateway --> Auth Service
API Gateway --> Database
Auth Service --> Redis Cache`},c4:{title:" C4",source:`[person] User: App customer
[system] WebApp: Main application
[container] API: REST Backend
[database] DB: PostgreSQL
[external] Email: SendGrid

User -> WebApp: Uses
WebApp -> API: Calls
API -> DB: Reads/Writes
API -> Email: Sends`},requirement:{title:" Requirement",source:`requirement Login {
text: Users must authenticate
risk: low
priority: high
}

requirement Security {
text: All data encrypted
priority: critical
}

requirement Performance {
text: Response under 200ms
risk: medium
priority: high
}

Login -> Security: derives
Security -> Performance: traces`},sankey:{title:" Sankey",source:`# Energy Flow
Coal -> Electricity: 40
Gas -> Electricity: 30
Nuclear -> Electricity: 20
Solar -> Electricity: 10
Electricity -> Residential: 35
Electricity -> Commercial: 25
Electricity -> Industrial: 30
Electricity -> Transport: 10`},swimlane:{title:" Swimlane",source:`[Customer]
(start) Submit Order -> Review Order

[Sales]
Review Order -> (decision) Approve?
Approve? -> Process Payment
Approve? -> Reject Order

[Warehouse]
Process Payment -> Ship Order
Ship Order -> (end) Complete`}};function cw(){var sr,cr,lr,dr,ur,pr,qt,hr,fr,gr,xr,mr,yr;const[i,t]=M.useState("journey"),[r,n]=M.useState(""),[a,s]=M.useState(!1),[e,l]=M.useState(!1),[h,d]=M.useState(!1),[p,f]=M.useState(!1),[x,g]=M.useState(!1),[m,c]=M.useState(!1),[u,b]=M.useState(!1),[y,S]=M.useState(!1),[w,k]=M.useState(!1),[j,C]=M.useState(null),[E,R]=M.useState(!1),[T,I]=M.useState(!1),[B,z]=M.useState(!1),[D,U]=M.useState(!1),[N,H]=M.useState(!1),[ee,ne]=M.useState(!1),[J,ie]=M.useState(()=>dg()),[F,_]=M.useState("Untitled Diagram"),[q,$]=M.useState(()=>mv()),[P,L]=M.useState({loading:!1,message:""}),[Y,X]=M.useState(()=>q2()),[K,be]=M.useState(()=>F2()),ve=me[Y]||me.dark,Q=M.useMemo(()=>({...ve,buttonActiveBg:`${J.accentPrimary}30`,gridColor:`${J.accentPrimary}08`,logoGradient:`linear-gradient(135deg, ${ve.name==="dark"?"#fff":"#1e293b"}, ${J.accentPrimary})`}),[ve,J]),ge=M.useRef(null),ae=M.useRef(null),_e=M.useRef(!1),oe=Xt[i],le=a&&r?r:oe.source,{state:Pe,canUndo:Ge,canRedo:De,undo:Ae,redo:Ce,pushState:ke,isApplying:Qe}=W2({type:i,source:r||oe.source,diagramName:F}),rt=M.useRef(null);M.useEffect(()=>(rt.current=N2((O,re,de)=>{!_e.current&&!Qe()&&ke({type:re,source:O,diagramName:de},"source")},1e3),()=>{var O;return(O=rt.current)==null?void 0:O.cancel()}),[ke,Qe]);const xt=M.useCallback(O=>{var re;n(O),(re=rt.current)==null||re.call(rt,O,i,F)},[i,F]),nt=M.useCallback(O=>{var re;(re=rt.current)==null||re.cancel(),t(O),n(""),ke({type:O,source:"",diagramName:F},"type")},[ke,F]);M.useCallback(O=>{_(O)},[]);const Pt=M.useCallback((O,re,de)=>{if(!le||!re||!de)return;const Be=re.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Mt=new RegExp(`\\b${Be}\\b`,"g"),Ze=le.replace(Mt,de);Ze!==le&&(n(Ze),ke({type:i,source:Ze,diagramName:F},"label-edit"))},[le,i,F,ke]),mt=M.useCallback(O=>{if(!le||!O||O.length===0)return;let re=le;O.forEach(de=>{re=re.split(`
`).filter(Ze=>{const Oe=Ze.trim();return!(Oe.startsWith(de+":")||Oe.startsWith(de+" ")||Oe.match(new RegExp(`^\\[${de}\\]`))||Oe.match(new RegExp(`^${de}\\s*->`))||Oe.match(new RegExp(`->\\s*${de}\\s*$`)))}).join(`
`)}),re!==le&&(n(re),ke({type:i,source:re,diagramName:F},"delete-nodes"))},[le,i,F,ke]),yt=M.useCallback(O=>{if(!O||O.length===0)return;const re=O.map(Be=>{const Mt=Be.type?`[${Be.type}] `:"";return`${Be.id}: ${Mt}${Be.label}`}),de=le+`
`+re.join(`
`);n(de),ke({type:i,source:de,diagramName:F},"paste-nodes")},[le,i,F,ke]),ct=M.useCallback((O,re,de)=>{if(!le)return;const Ze=le.split(`
`).map(Oe=>{if(Oe.includes("->")){if(re&&Oe.includes(re))return Oe.replace(re,de);if(!re&&de){const br=Oe.trim();if(!br.includes(":")&&!br.includes("|"))return Oe+" : "+de}}return Oe}).join(`
`);Ze!==le&&(n(Ze),ke({type:i,source:Ze,diagramName:F},"edge-label"))},[le,i,F,ke]),Ne=M.useCallback((O,re)=>{if(!O||!re)return;const de=`${O} -> ${re}`,Be=le+`
`+de;n(Be),ke({type:i,source:Be,diagramName:F},"create-connection")},[le,i,F,ke]),ze=M.useCallback((O,re)=>{const de=Z1(O);de?(t(de.type),n(de.source),_(de.name),s(!0),ke({type:de.type,source:de.source,diagramName:de.name},"linked-template")):console.warn(`Template not found: ${O}`)},[ke]);M.useEffect(()=>{Qe()&&(_e.current=!0,Pe.type!==i&&t(Pe.type),Pe.source!==r&&n(Pe.source),Pe.diagramName!==F&&_(Pe.diagramName),setTimeout(()=>{_e.current=!1},0))},[Pe,Qe]),M.useEffect(()=>{const O=re=>{(/Mac|iPhone|iPad|iPod/.test(navigator.platform)?re.metaKey:re.ctrlKey)&&re.key.toLowerCase()==="z"&&(re.preventDefault(),re.shiftKey?Ce():Ae())};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[Ae,Ce]);const bt=M.useMemo(()=>({HELP:()=>d(!0),HELP_ALT:()=>d(!0),TOGGLE_EDITOR:()=>s(O=>!O),TOGGLE_AI_CHAT:()=>l(O=>!O),EXPORT_PNG:()=>rr(),EXPORT_SVG:()=>nr(),COPY_CLIPBOARD:()=>ir()}),[]);s2(bt,!h),M.useEffect(()=>{const O=hv();O&&Xt[O.type]&&(t(O.type),n(O.source),O.name&&_(O.name),s(!0))},[]),M.useEffect(()=>{if(q)return ae.current&&clearTimeout(ae.current),ae.current=setTimeout(()=>{const O=r||oe.source;Oh(i,O,F)},1e3),()=>{ae.current&&clearTimeout(ae.current)}},[i,r,F,q,oe.source]);const qe=()=>{const O=r||oe.source;Oh(i,O,F),L({loading:!1,message:"Saved!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)},Zr=()=>{const O=r||oe.source,re=F.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"diagram";gv(i,O,re),L({loading:!1,message:"File exported!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)},Jr=O=>{Xt[O.type]&&(t(O.type),n(O.source),_(O.name||"Recent Diagram"),s(!0))},en=()=>{const O=!q;$(O),yv(O),L({loading:!1,message:O?"Auto-save enabled":"Auto-save disabled"}),setTimeout(()=>L({loading:!1,message:""}),2e3)},tn=()=>{const O=Y==="dark"?"light":"dark";X(O),O2(O),L({loading:!1,message:`${O==="dark"?"Dark":"Light"} mode`}),setTimeout(()=>L({loading:!1,message:""}),2e3)},rn=()=>{const O=!K;be(O),U2(O),L({loading:!1,message:O?"Sketch mode":"Clean mode"}),setTimeout(()=>L({loading:!1,message:""}),2e3)},nn=O=>{const de={flowchart:"flowchart",orgchart:"orgchart",state:"state",sequence:"sequence",network:"network",gantt:"gantt",pie:"pie",erd:"erd",class:"class",quadrant:"quadrant",mindmap:"mindmap",architecture:"architecture",usecase:"usecase",timeline:"timeline",journey:"journey",gitgraph:"git",git:"git",deployment:"deployment",component:"component",c4:"c4",activity:"activity",requirement:"requirement",wireframe:"wireframe"}[O.template];de&&Xt[de]?(t(de),n(O.dsl),s(!0)):(n(O.dsl),s(!0)),ne(!1),L({loading:!1,message:`Loaded ${O.label} template`}),setTimeout(()=>L({loading:!1,message:""}),2e3)},rr=async()=>{if(ge.current){L({loading:!0,message:"Exporting PNG..."});try{await e2(ge.current,`ddflow-${i}`),L({loading:!1,message:"PNG exported!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)}catch(O){L({loading:!1,message:`Error: ${O.message}`}),setTimeout(()=>L({loading:!1,message:""}),3e3)}}},nr=()=>{if(ge.current){L({loading:!0,message:"Exporting SVG..."});try{t2(ge.current,`ddflow-${i}`),L({loading:!1,message:"SVG exported!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)}catch(O){L({loading:!1,message:`Error: ${O.message}`}),setTimeout(()=>L({loading:!1,message:""}),3e3)}}},ir=async()=>{if(ge.current){L({loading:!0,message:"Copying to clipboard..."});try{await r2(ge.current),L({loading:!1,message:"Copied to clipboard!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)}catch(O){L({loading:!1,message:`Error: ${O.message}`}),setTimeout(()=>L({loading:!1,message:""}),3e3)}}},on=()=>{if(ge.current){L({loading:!0,message:"Opening print dialog..."});try{n2(ge.current),L({loading:!1,message:""})}catch(O){L({loading:!1,message:`Error: ${O.message}`}),setTimeout(()=>L({loading:!1,message:""}),3e3)}}},or=(O,re)=>{t(O),n(re),s(!0)},ar=M.useCallback(O=>{const de=(r||oe.source).trim()+`
`+O;xt(de),s(!0)},[r,oe.source,xt]),an=M.useCallback(async()=>{if(!Dt()){L({loading:!1,message:"AI not configured. Check .env"}),setTimeout(()=>L({loading:!1,message:""}),3e3);return}R(!0),C({type:"explain",content:null,loading:!0});try{const O=await U1(le,i);C({type:"explain",content:O,loading:!1})}catch(O){C({type:"explain",content:`Error: ${O.message}`,loading:!1})}finally{R(!1)}},[le,i]),sn=M.useCallback(async()=>{if(!Dt()){L({loading:!1,message:"AI not configured. Check .env"}),setTimeout(()=>L({loading:!1,message:""}),3e3);return}R(!0),C({type:"improve",content:null,loading:!0});try{const O=await G1(le,i);C({type:"improve",content:O,loading:!1})}catch(O){C({type:"improve",content:{explanation:`Error: ${O.message}`},loading:!1})}finally{R(!1)}},[le,i]),cn=M.useCallback(async()=>{if(!Dt()){L({loading:!1,message:"AI not configured. Check .env"}),setTimeout(()=>L({loading:!1,message:""}),3e3);return}R(!0),C({type:"validate",content:null,loading:!0});try{const O=await Y1(le,i);C({type:"validate",content:O,loading:!1})}catch(O){C({type:"validate",content:{isValid:!1,errors:[O.message],warnings:[],suggestions:[]},loading:!1})}finally{R(!1)}},[le,i]),ln=M.useCallback(()=>{var O;(j==null?void 0:j.type)==="improve"&&((O=j.content)!=null&&O.dsl)&&(t(j.content.type),n(j.content.dsl),s(!0),C(null))},[j]),dn=(O,re)=>{t(O),n(re),s(!0),L({loading:!1,message:"Mermaid imported!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)};return o.jsxs("div",{style:{minHeight:"100vh",background:Q.background,fontFamily:"system-ui",color:Q.textPrimary,transition:"background 0.3s ease, color 0.3s ease"},children:[o.jsxs("div",{style:{padding:"10px 20px",borderBottom:`1px solid ${Q.border}`,background:Q.headerBg,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[o.jsx("div",{children:o.jsxs("h1",{style:{fontSize:"1.2rem",fontWeight:800,background:Q.logoGradient,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",margin:0,display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontSize:"1.4rem"},children:""})," DDFlow"]})}),o.jsx("div",{style:{height:24,width:1,background:Q.border}}),o.jsx("span",{style:{color:Q.textMuted,fontSize:"0.85rem"},children:"Diagram Engine"})]}),o.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[o.jsx("button",{onClick:tn,style:{padding:"6px 10px",background:"transparent",border:`1px solid ${Q.border}`,borderRadius:6,color:Q.textSecondary,fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},title:`Switch to ${Y==="dark"?"light":"dark"} mode`,children:Y==="dark"?"":""}),o.jsx("button",{onClick:rn,style:{padding:"6px 10px",background:K?`${J.accentPrimary}20`:"transparent",border:`1px solid ${K?J.accentPrimary:Q.border}`,borderRadius:6,color:K?J.accentPrimary:Q.textSecondary,fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},title:K?"Switch to clean mode":"Switch to sketch mode",children:K?"":""}),o.jsx("button",{onClick:()=>ne(!0),style:{padding:"6px 10px",background:"transparent",border:`1px solid ${Q.border}`,borderRadius:6,color:Q.textSecondary,fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},title:"Shape Library",children:o.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})]})}),o.jsx("button",{onClick:()=>d(!0),style:{padding:"6px 10px",background:"transparent",border:`1px solid ${Q.border}`,borderRadius:6,color:Q.textSecondary,fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},title:"Keyboard Shortcuts (?)",children:""}),o.jsx("button",{onClick:()=>I(!0),style:{padding:"6px 10px",background:"transparent",border:`1px solid ${Q.border}`,borderRadius:6,color:Q.textSecondary,fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},title:"Color Settings",children:""}),o.jsx("a",{href:"/guide.html",target:"_blank",rel:"noopener noreferrer",style:{padding:"6px 10px",background:"transparent",border:`1px solid ${Q.border}`,borderRadius:6,color:Q.textSecondary,fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",textDecoration:"none"},children:""}),o.jsx("div",{style:{height:20,width:1,background:Q.border,margin:"0 4px"}}),o.jsx("button",{onClick:()=>l(!e),style:{padding:"6px 14px",background:e?`linear-gradient(135deg, ${J.accentPrimary}, ${J.accentSecondary})`:`${J.accentPrimary}20`,border:`1px solid ${e?"transparent":J.accentPrimary}`,borderRadius:6,color:e?"#fff":J.accentPrimary,fontSize:"0.85rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",fontWeight:600},children:" AI Chat"})]})]}),o.jsxs("div",{style:{display:"flex",gap:10,padding:"10px 20px",borderBottom:`1px solid ${Q.border}`,background:Q.toolbarBg,alignItems:"center"},children:[o.jsx(cv,{activeType:i,onTypeChange:nt,theme:Q}),o.jsx("div",{style:{width:1,height:28,background:Q.border}}),o.jsx(kr,{label:"File",icon:"",color:v.blue,theme:Q,items:[{type:"section",label:"Create"},{icon:"",label:"Browse Templates",description:"Start from a template",onClick:()=>b(!0)},{icon:"",label:"Save as Template",description:"Save current as template",onClick:()=>S(!0)},{type:"divider"},{type:"section",label:"Save & Open"},{icon:"",label:"Save",description:"Save to browser",shortcut:"S",onClick:qe},{icon:"",label:"Export File",description:"Download .ddflow",onClick:Zr},{icon:"",label:"Open Recent",description:"Open saved diagrams",onClick:()=>f(!0)},{type:"divider"},{icon:q?"":"",label:"Auto-save",description:q?"Enabled":"Disabled",onClick:en,active:q}]}),o.jsx(kr,{label:"Export",icon:"",color:v.pink,theme:Q,items:[{type:"section",label:"Image"},{icon:"",label:"Copy to Clipboard",shortcut:"C",onClick:ir,disabled:P.loading},{icon:"",label:"Export as PNG",shortcut:"P",onClick:rr,disabled:P.loading},{icon:"",label:"Export as SVG",shortcut:"S",onClick:nr,disabled:P.loading},{icon:"",label:"Export as PDF",onClick:on,disabled:P.loading},{type:"divider"},{type:"section",label:"Code"},{icon:"",label:"Export as Mermaid",description:"Convert to Mermaid syntax",onClick:()=>c(!0)},{icon:"",label:"Export as PlantUML",description:"Convert to PlantUML syntax",onClick:()=>H(!0)}]}),o.jsx(kr,{label:"Import",icon:"",color:v.cyan,theme:Q,items:[{icon:"",label:"Import from Image",description:"AI extracts diagram from image",onClick:()=>z(!0)},{icon:"",label:"Import Mermaid",description:"Convert from Mermaid syntax",onClick:()=>g(!0)},{icon:"",label:"Import PlantUML",description:"Convert from PlantUML syntax",onClick:()=>U(!0)},{icon:"",label:"Open .ddflow File",description:"Load saved diagram",onClick:()=>f(!0)}]}),o.jsx(kr,{label:E?"AI...":"AI Tools",icon:"",color:v.purple,theme:Q,items:[{type:"section",label:"Analysis"},{icon:"",label:"Explain Diagram",description:"Get AI explanation of diagram",onClick:an,disabled:E},{icon:"",label:"Validate Diagram",description:"Check for errors and issues",onClick:cn,disabled:E},{type:"divider"},{type:"section",label:"Enhancement"},{icon:"",label:"Suggest Improvements",description:"Get AI optimization tips",onClick:sn,disabled:E}]}),o.jsx("div",{style:{width:1,height:28,background:Q.border}}),o.jsxs("div",{style:{display:"flex",gap:4},children:[o.jsx("button",{onClick:Ae,disabled:!Ge,style:{padding:"6px 10px",background:Ge?"rgba(100,116,139,0.2)":"rgba(255,255,255,0.02)",border:`1px solid ${Ge?"rgba(100,116,139,0.3)":"rgba(255,255,255,0.05)"}`,borderRadius:6,color:Ge?v.slate:"#444",fontSize:"0.7rem",cursor:Ge?"pointer":"not-allowed",opacity:Ge?1:.5,display:"flex",alignItems:"center",gap:4},title:"Undo (Cmd+Z)",children:o.jsx("span",{children:""})}),o.jsx("button",{onClick:Ce,disabled:!De,style:{padding:"6px 10px",background:De?"rgba(100,116,139,0.2)":"rgba(255,255,255,0.02)",border:`1px solid ${De?"rgba(100,116,139,0.3)":"rgba(255,255,255,0.05)"}`,borderRadius:6,color:De?v.slate:"#444",fontSize:"0.7rem",cursor:De?"pointer":"not-allowed",opacity:De?1:.5,display:"flex",alignItems:"center",gap:4},title:"Redo (Cmd+Shift+Z)",children:o.jsx("span",{children:""})})]}),o.jsx("div",{style:{width:1,height:28,background:Q.border}}),o.jsxs("button",{onClick:()=>k(!w),style:{padding:"6px 12px",background:w?`${v.orange}30`:"rgba(255,255,255,0.05)",border:`1px solid ${w?v.orange:"rgba(255,255,255,0.1)"}`,borderRadius:6,color:w?v.orange:Y==="dark"?"#888":"#64748b",fontSize:"0.8rem",cursor:"pointer",display:"flex",alignItems:"center",gap:6,fontWeight:500},title:"Toggle Node Library",children:[w?"":""," Nodes"]}),o.jsx("div",{style:{flex:1}}),P.message&&o.jsxs("span",{style:{padding:"5px 10px",background:P.message.startsWith("Error")?"rgba(239,68,68,0.2)":"rgba(16,185,129,0.2)",borderRadius:6,color:P.message.startsWith("Error")?v.red:v.green,fontSize:"0.7rem",display:"flex",alignItems:"center",gap:4},children:[P.loading&&"",P.message]}),o.jsxs("button",{onClick:()=>s(!a),style:{padding:"6px 12px",background:a?"rgba(16,185,129,0.2)":"rgba(255,255,255,0.05)",border:`1px solid ${a?v.green:"rgba(255,255,255,0.1)"}`,borderRadius:6,color:a?v.green:Y==="dark"?"#888":"#64748b",fontSize:"0.7rem",cursor:"pointer",display:"flex",alignItems:"center",gap:6,fontWeight:500},children:[a?"":""," Editor"]})]}),o.jsxs("div",{style:{display:"flex",height:"calc(100vh - 105px)"},children:[a&&o.jsx("div",{style:{width:300,borderRight:`1px solid ${Q.border}`},children:o.jsx("textarea",{value:r||oe.source,onChange:O=>xt(O.target.value),style:{width:"100%",height:"100%",background:Q.editorBg,border:"none",padding:12,color:Q.editorText,fontFamily:"Monaco, monospace",fontSize:"0.65rem",lineHeight:1.5,resize:"none",outline:"none",boxSizing:"border-box",transition:"background 0.3s ease, color 0.3s ease"}})}),o.jsx("div",{ref:ge,style:{flex:1,padding:10,marginRight:e?"380px":0,marginLeft:w?"260px":0,transition:"margin 0.3s ease"},onDragOver:O=>{O.preventDefault(),O.dataTransfer.dropEffect="copy"},onDrop:O=>{O.preventDefault();const re=O.dataTransfer.getData("text/plain");re&&ar(re)},children:o.jsx(Lg,{type:i,source:le,theme:Y,sketchMode:K,onLabelChange:Pt,onDeleteNodes:mt,onPasteNodes:yt,onEdgeLabelChange:ct,onCreateConnection:Ne,onLinkedTemplateClick:ze},`${i}-${le}-${Y}-${K}`)})]}),o.jsx(uv,{isOpen:w,diagramType:i,theme:Q,onAddNode:ar}),o.jsx(Q1,{isOpen:e,onClose:()=>l(!1),onApplyDiagram:or}),o.jsx(iw,{isOpen:h,onClose:()=>d(!1)}),o.jsx(ow,{isOpen:p,onClose:()=>f(!1),onSelect:Jr,onRemove:fv}),o.jsx(aw,{isOpen:x,onClose:()=>g(!1),onImport:dn}),o.jsx(sw,{isOpen:m,onClose:()=>c(!1),diagramType:i,diagramSource:le}),o.jsx(ov,{isOpen:u,onClose:()=>b(!1),onApplyTemplate:or,theme:Q}),o.jsx(av,{isOpen:y,onClose:()=>S(!1),diagramType:i,diagramSource:le,theme:Q}),j&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},onClick:()=>!j.loading&&C(null),children:o.jsxs("div",{style:{background:Q.modalBg,borderRadius:16,border:`1px solid ${Q.border}`,width:"100%",maxWidth:600,maxHeight:"80vh",overflow:"hidden",boxShadow:"0 25px 50px rgba(0,0,0,0.4)"},onClick:O=>O.stopPropagation(),children:[o.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${Q.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",background:`${v.purple}15`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{fontSize:"1.2rem"},children:j.type==="explain"?"":j.type==="validate"?"":""}),o.jsx("span",{style:{fontWeight:600,color:Q.textPrimary},children:j.type==="explain"?"Diagram Explanation":j.type==="validate"?"Validation Results":"Improvement Suggestions"})]}),o.jsx("button",{onClick:()=>C(null),disabled:j.loading,style:{background:"transparent",border:"none",color:Q.textSecondary,fontSize:"1.2rem",cursor:j.loading?"not-allowed":"pointer",padding:4},children:""})]}),o.jsx("div",{style:{padding:20,maxHeight:"calc(80vh - 120px)",overflowY:"auto"},children:j.loading?o.jsxs("div",{style:{textAlign:"center",padding:40,color:Q.textSecondary},children:[o.jsx("div",{style:{fontSize:"2rem",marginBottom:12},children:""}),o.jsx("div",{children:"Analyzing diagram with AI..."})]}):j.type==="explain"?o.jsx("div",{style:{color:Q.textPrimary,lineHeight:1.6,fontSize:"0.9rem",whiteSpace:"pre-wrap"},children:j.content}):j.type==="validate"?o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"12px 16px",background:(sr=j.content)!=null&&sr.isValid?`${v.green}15`:`${v.red}15`,borderRadius:8,marginBottom:16},children:[o.jsx("span",{style:{fontSize:"1.2rem"},children:(cr=j.content)!=null&&cr.isValid?"":""}),o.jsx("span",{style:{color:(lr=j.content)!=null&&lr.isValid?v.green:v.red,fontWeight:600},children:(dr=j.content)!=null&&dr.isValid?"Diagram is valid":"Issues found"})]}),((pr=(ur=j.content)==null?void 0:ur.errors)==null?void 0:pr.length)>0&&o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{color:v.red,fontWeight:600,marginBottom:8,fontSize:"0.85rem"},children:"Errors:"}),j.content.errors.map((O,re)=>o.jsx("div",{style:{padding:"8px 12px",background:`${v.red}10`,borderRadius:6,marginBottom:4,color:Q.textPrimary,fontSize:"0.85rem"},children:O},re))]}),((hr=(qt=j.content)==null?void 0:qt.warnings)==null?void 0:hr.length)>0&&o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{color:v.orange,fontWeight:600,marginBottom:8,fontSize:"0.85rem"},children:"Warnings:"}),j.content.warnings.map((O,re)=>o.jsx("div",{style:{padding:"8px 12px",background:`${v.orange}10`,borderRadius:6,marginBottom:4,color:Q.textPrimary,fontSize:"0.85rem"},children:O},re))]}),((gr=(fr=j.content)==null?void 0:fr.suggestions)==null?void 0:gr.length)>0&&o.jsxs("div",{children:[o.jsx("div",{style:{color:v.blue,fontWeight:600,marginBottom:8,fontSize:"0.85rem"},children:"Suggestions:"}),j.content.suggestions.map((O,re)=>o.jsx("div",{style:{padding:"8px 12px",background:`${v.blue}10`,borderRadius:6,marginBottom:4,color:Q.textPrimary,fontSize:"0.85rem"},children:O},re))]})]}):j.type==="improve"?o.jsxs("div",{children:[o.jsx("div",{style:{color:Q.textPrimary,lineHeight:1.6,fontSize:"0.9rem",marginBottom:20,whiteSpace:"pre-wrap"},children:((xr=j.content)==null?void 0:xr.explanation)||"No explanation provided."}),((mr=j.content)==null?void 0:mr.dsl)&&o.jsxs("div",{children:[o.jsx("div",{style:{color:v.purple,fontWeight:600,marginBottom:8,fontSize:"0.85rem"},children:"Improved DSL:"}),o.jsx("pre",{style:{background:Q.inputBg,padding:12,borderRadius:8,fontSize:"0.75rem",overflow:"auto",maxHeight:200,color:Q.editorText},children:j.content.dsl})]})]}):null}),!j.loading&&o.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${Q.border}`,display:"flex",justifyContent:"flex-end",gap:10},children:[j.type==="improve"&&((yr=j.content)==null?void 0:yr.dsl)&&o.jsx("button",{onClick:ln,style:{padding:"8px 16px",background:`linear-gradient(135deg, ${v.purple}, ${v.indigo})`,border:"none",borderRadius:6,color:"#fff",fontSize:"0.8rem",fontWeight:600,cursor:"pointer"},children:"Apply Improvements"}),o.jsx("button",{onClick:()=>C(null),style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:`1px solid ${Q.border}`,borderRadius:6,color:Q.textSecondary,fontSize:"0.8rem",cursor:"pointer"},children:"Close"})]})]})}),o.jsx(Sv,{isOpen:T,onClose:()=>I(!1),onApply:ie,theme:Q}),o.jsx(jv,{isOpen:B,onClose:()=>z(!1),onImport:(O,re,de)=>{t(O),n(re),de&&_(de),s(!0),z(!1),L({loading:!1,message:`Diagram "${de||"Imported"}" imported from image!`}),setTimeout(()=>L({loading:!1,message:""}),2e3)},theme:Q}),o.jsx(Xv,{isOpen:D,onClose:()=>U(!1),onImport:(O,re)=>{t(O),n(re),s(!0),U(!1),L({loading:!1,message:"PlantUML diagram imported!"}),setTimeout(()=>L({loading:!1,message:""}),2e3)},theme:Q}),o.jsx(Kv,{isOpen:N,onClose:()=>H(!1),diagramType:i,diagramSource:le,theme:Q}),o.jsx(Qv,{isOpen:ee,onClose:()=>ne(!1),onSelectShape:nn,theme:Q})]})}exports.ArchitectureDiagram=wg;exports.COLORS=v;exports.ClassDiagram=Cg;exports.DeploymentDiagram=Tg;exports.ERDDiagram=kg;exports.FlowDiagram=jr;exports.GanttDiagram=_g;exports.GitGraphDiagram=Rg;exports.MindMapDiagram=vg;exports.NetworkDiagram=jg;exports.OrgChartDiagram=Eg;exports.Parsers=bg;exports.PieChartDiagram=Ig;exports.QuadrantDiagram=Ag;exports.SequenceDiagram=Mg;exports.THEMES=me;exports.TimelineDiagram=$g;exports.UniversalDiagram=Lg;exports.UseCaseDiagram=Dg;exports.UserJourneyDiagram=Sg;exports.WireframeDiagram=Pg;exports.default=cw;
